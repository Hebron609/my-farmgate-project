(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerPolicy&&(n.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?n.credentials="include":r.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(r){if(r.ep)return;r.ep=!0;const n=t(r);fetch(r.href,n)}})();function Bo(i){const e=Object.create(null);for(const t of i.split(","))e[t]=1;return t=>t in e}const De={},xi=[],es=()=>{},If=()=>!1,Pn=i=>i.charCodeAt(0)===111&&i.charCodeAt(1)===110&&(i.charCodeAt(2)>122||i.charCodeAt(2)<97),Uo=i=>i.startsWith("onUpdate:"),ze=Object.assign,Go=(i,e)=>{const t=i.indexOf(e);t>-1&&i.splice(t,1)},vg=Object.prototype.hasOwnProperty,Le=(i,e)=>vg.call(i,e),ue=Array.isArray,Ti=i=>On(i)==="[object Map]",Lf=i=>On(i)==="[object Set]",de=i=>typeof i=="function",Ke=i=>typeof i=="string",Ks=i=>typeof i=="symbol",Me=i=>i!==null&&typeof i=="object",_f=i=>(Me(i)||de(i))&&de(i.then)&&de(i.catch),Rf=Object.prototype.toString,On=i=>Rf.call(i),Eg=i=>On(i).slice(8,-1),Cf=i=>On(i)==="[object Object]",Vo=i=>Ke(i)&&i!=="NaN"&&i[0]!=="-"&&""+parseInt(i,10)===i,Ki=Bo(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Mn=i=>{const e=Object.create(null);return(t=>e[t]||(e[t]=i(t)))},xg=/-\w/g,Dt=Mn(i=>i.replace(xg,e=>e.slice(1).toUpperCase())),Tg=/\B([A-Z])/g,ai=Mn(i=>i.replace(Tg,"-$1").toLowerCase()),Fn=Mn(i=>i.charAt(0).toUpperCase()+i.slice(1)),ea=Mn(i=>i?`on${Fn(i)}`:""),Ms=(i,e)=>!Object.is(i,e),Hr=(i,...e)=>{for(let t=0;t<i.length;t++)i[t](...e)},wf=(i,e,t,s=!1)=>{Object.defineProperty(i,e,{configurable:!0,enumerable:!1,writable:s,value:t})},Ko=i=>{const e=parseFloat(i);return isNaN(e)?i:e},Sg=i=>{const e=Ke(i)?Number(i):NaN;return isNaN(e)?i:e};let jl;const Nn=()=>jl||(jl=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function yr(i){if(ue(i)){const e={};for(let t=0;t<i.length;t++){const s=i[t],r=Ke(s)?Lg(s):yr(s);if(r)for(const n in r)e[n]=r[n]}return e}else if(Ke(i)||Me(i))return i}const bg=/;(?![^(]*\))/g,Ag=/:([^]+)/,Ig=/\/\*[^]*?\*\//g;function Lg(i){const e={};return i.replace(Ig,"").split(bg).forEach(t=>{if(t){const s=t.split(Ag);s.length>1&&(e[s[0].trim()]=s[1].trim())}}),e}function bt(i){let e="";if(Ke(i))e=i;else if(ue(i))for(let t=0;t<i.length;t++){const s=bt(i[t]);s&&(e+=s+" ")}else if(Me(i))for(const t in i)i[t]&&(e+=t+" ");return e.trim()}const _g="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",Rg=Bo(_g);function Df(i){return!!i||i===""}const kf=i=>!!(i&&i.__v_isRef===!0),us=i=>Ke(i)?i:i==null?"":ue(i)||Me(i)&&(i.toString===Rf||!de(i.toString))?kf(i)?us(i.value):JSON.stringify(i,Pf,2):String(i),Pf=(i,e)=>kf(e)?Pf(i,e.value):Ti(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((t,[s,r],n)=>(t[ta(s,n)+" =>"]=r,t),{})}:Lf(e)?{[`Set(${e.size})`]:[...e.values()].map(t=>ta(t))}:Ks(e)?ta(e):Me(e)&&!ue(e)&&!Cf(e)?String(e):e,ta=(i,e="")=>{var t;return Ks(i)?`Symbol(${(t=i.description)!=null?t:e})`:i};let pt;class Cg{constructor(e=!1){this.detached=e,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=pt,!e&&pt&&(this.index=(pt.scopes||(pt.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].pause();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].resume();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].resume()}}run(e){if(this._active){const t=pt;try{return pt=this,e()}finally{pt=t}}}on(){++this._on===1&&(this.prevScope=pt,pt=this)}off(){this._on>0&&--this._on===0&&(pt=this.prevScope,this.prevScope=void 0)}stop(e){if(this._active){this._active=!1;let t,s;for(t=0,s=this.effects.length;t<s;t++)this.effects[t].stop();for(this.effects.length=0,t=0,s=this.cleanups.length;t<s;t++)this.cleanups[t]();if(this.cleanups.length=0,this.scopes){for(t=0,s=this.scopes.length;t<s;t++)this.scopes[t].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const r=this.parent.scopes.pop();r&&r!==this&&(this.parent.scopes[this.index]=r,r.index=this.index)}this.parent=void 0}}}function wg(){return pt}let Oe;const sa=new WeakSet;class Of{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,pt&&pt.active&&pt.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,sa.has(this)&&(sa.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||Ff(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,Wl(this),Nf(this);const e=Oe,t=Nt;Oe=this,Nt=!0;try{return this.fn()}finally{$f(this),Oe=e,Nt=t,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)Wo(e);this.deps=this.depsTail=void 0,Wl(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?sa.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){ja(this)&&this.run()}get dirty(){return ja(this)}}let Mf=0,Hi,ji;function Ff(i,e=!1){if(i.flags|=8,e){i.next=ji,ji=i;return}i.next=Hi,Hi=i}function Ho(){Mf++}function jo(){if(--Mf>0)return;if(ji){let e=ji;for(ji=void 0;e;){const t=e.next;e.next=void 0,e.flags&=-9,e=t}}let i;for(;Hi;){let e=Hi;for(Hi=void 0;e;){const t=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(s){i||(i=s)}e=t}}if(i)throw i}function Nf(i){for(let e=i.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function $f(i){let e,t=i.depsTail,s=t;for(;s;){const r=s.prevDep;s.version===-1?(s===t&&(t=r),Wo(s),Dg(s)):e=s,s.dep.activeLink=s.prevActiveLink,s.prevActiveLink=void 0,s=r}i.deps=e,i.depsTail=t}function ja(i){for(let e=i.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(Bf(e.dep.computed)||e.dep.version!==e.version))return!0;return!!i._dirty}function Bf(i){if(i.flags&4&&!(i.flags&16)||(i.flags&=-17,i.globalVersion===sr)||(i.globalVersion=sr,!i.isSSR&&i.flags&128&&(!i.deps&&!i._dirty||!ja(i))))return;i.flags|=2;const e=i.dep,t=Oe,s=Nt;Oe=i,Nt=!0;try{Nf(i);const r=i.fn(i._value);(e.version===0||Ms(r,i._value))&&(i.flags|=128,i._value=r,e.version++)}catch(r){throw e.version++,r}finally{Oe=t,Nt=s,$f(i),i.flags&=-3}}function Wo(i,e=!1){const{dep:t,prevSub:s,nextSub:r}=i;if(s&&(s.nextSub=r,i.prevSub=void 0),r&&(r.prevSub=s,i.nextSub=void 0),t.subs===i&&(t.subs=s,!s&&t.computed)){t.computed.flags&=-5;for(let n=t.computed.deps;n;n=n.nextDep)Wo(n,!0)}!e&&!--t.sc&&t.map&&t.map.delete(t.key)}function Dg(i){const{prevDep:e,nextDep:t}=i;e&&(e.nextDep=t,i.prevDep=void 0),t&&(t.prevDep=e,i.nextDep=void 0)}let Nt=!0;const Uf=[];function ys(){Uf.push(Nt),Nt=!1}function vs(){const i=Uf.pop();Nt=i===void 0?!0:i}function Wl(i){const{cleanup:e}=i;if(i.cleanup=void 0,e){const t=Oe;Oe=void 0;try{e()}finally{Oe=t}}}let sr=0;class kg{constructor(e,t){this.sub=e,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class Yo{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(e){if(!Oe||!Nt||Oe===this.computed)return;let t=this.activeLink;if(t===void 0||t.sub!==Oe)t=this.activeLink=new kg(Oe,this),Oe.deps?(t.prevDep=Oe.depsTail,Oe.depsTail.nextDep=t,Oe.depsTail=t):Oe.deps=Oe.depsTail=t,Gf(t);else if(t.version===-1&&(t.version=this.version,t.nextDep)){const s=t.nextDep;s.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=s),t.prevDep=Oe.depsTail,t.nextDep=void 0,Oe.depsTail.nextDep=t,Oe.depsTail=t,Oe.deps===t&&(Oe.deps=s)}return t}trigger(e){this.version++,sr++,this.notify(e)}notify(e){Ho();try{for(let t=this.subs;t;t=t.prevSub)t.sub.notify()&&t.sub.dep.notify()}finally{jo()}}}function Gf(i){if(i.dep.sc++,i.sub.flags&4){const e=i.dep.computed;if(e&&!i.dep.subs){e.flags|=20;for(let s=e.deps;s;s=s.nextDep)Gf(s)}const t=i.dep.subs;t!==i&&(i.prevSub=t,t&&(t.nextSub=i)),i.dep.subs=i}}const Wa=new WeakMap,ei=Symbol(""),Ya=Symbol(""),ir=Symbol("");function nt(i,e,t){if(Nt&&Oe){let s=Wa.get(i);s||Wa.set(i,s=new Map);let r=s.get(t);r||(s.set(t,r=new Yo),r.map=s,r.key=t),r.track()}}function hs(i,e,t,s,r,n){const a=Wa.get(i);if(!a){sr++;return}const o=l=>{l&&l.trigger()};if(Ho(),e==="clear")a.forEach(o);else{const l=ue(i),c=l&&Vo(t);if(l&&t==="length"){const u=Number(s);a.forEach((f,d)=>{(d==="length"||d===ir||!Ks(d)&&d>=u)&&o(f)})}else switch((t!==void 0||a.has(void 0))&&o(a.get(t)),c&&o(a.get(ir)),e){case"add":l?c&&o(a.get("length")):(o(a.get(ei)),Ti(i)&&o(a.get(Ya)));break;case"delete":l||(o(a.get(ei)),Ti(i)&&o(a.get(Ya)));break;case"set":Ti(i)&&o(a.get(ei));break}}jo()}function oi(i){const e=Ae(i);return e===i?e:(nt(e,"iterate",ir),wt(i)?e:e.map($t))}function $n(i){return nt(i=Ae(i),"iterate",ir),i}function Rs(i,e){return Es(i)?ti(i)?Ci($t(e)):Ci(e):$t(e)}const Pg={__proto__:null,[Symbol.iterator](){return ia(this,Symbol.iterator,i=>Rs(this,i))},concat(...i){return oi(this).concat(...i.map(e=>ue(e)?oi(e):e))},entries(){return ia(this,"entries",i=>(i[1]=Rs(this,i[1]),i))},every(i,e){return is(this,"every",i,e,void 0,arguments)},filter(i,e){return is(this,"filter",i,e,t=>t.map(s=>Rs(this,s)),arguments)},find(i,e){return is(this,"find",i,e,t=>Rs(this,t),arguments)},findIndex(i,e){return is(this,"findIndex",i,e,void 0,arguments)},findLast(i,e){return is(this,"findLast",i,e,t=>Rs(this,t),arguments)},findLastIndex(i,e){return is(this,"findLastIndex",i,e,void 0,arguments)},forEach(i,e){return is(this,"forEach",i,e,void 0,arguments)},includes(...i){return ra(this,"includes",i)},indexOf(...i){return ra(this,"indexOf",i)},join(i){return oi(this).join(i)},lastIndexOf(...i){return ra(this,"lastIndexOf",i)},map(i,e){return is(this,"map",i,e,void 0,arguments)},pop(){return Mi(this,"pop")},push(...i){return Mi(this,"push",i)},reduce(i,...e){return Yl(this,"reduce",i,e)},reduceRight(i,...e){return Yl(this,"reduceRight",i,e)},shift(){return Mi(this,"shift")},some(i,e){return is(this,"some",i,e,void 0,arguments)},splice(...i){return Mi(this,"splice",i)},toReversed(){return oi(this).toReversed()},toSorted(i){return oi(this).toSorted(i)},toSpliced(...i){return oi(this).toSpliced(...i)},unshift(...i){return Mi(this,"unshift",i)},values(){return ia(this,"values",i=>Rs(this,i))}};function ia(i,e,t){const s=$n(i),r=s[e]();return s!==i&&!wt(i)&&(r._next=r.next,r.next=()=>{const n=r._next();return n.done||(n.value=t(n.value)),n}),r}const Og=Array.prototype;function is(i,e,t,s,r,n){const a=$n(i),o=a!==i&&!wt(i),l=a[e];if(l!==Og[e]){const f=l.apply(i,n);return o?$t(f):f}let c=t;a!==i&&(o?c=function(f,d){return t.call(this,Rs(i,f),d,i)}:t.length>2&&(c=function(f,d){return t.call(this,f,d,i)}));const u=l.call(a,c,s);return o&&r?r(u):u}function Yl(i,e,t,s){const r=$n(i);let n=t;return r!==i&&(wt(i)?t.length>3&&(n=function(a,o,l){return t.call(this,a,o,l,i)}):n=function(a,o,l){return t.call(this,a,Rs(i,o),l,i)}),r[e](n,...s)}function ra(i,e,t){const s=Ae(i);nt(s,"iterate",ir);const r=s[e](...t);return(r===-1||r===!1)&&Qo(t[0])?(t[0]=Ae(t[0]),s[e](...t)):r}function Mi(i,e,t=[]){ys(),Ho();const s=Ae(i)[e].apply(i,t);return jo(),vs(),s}const Mg=Bo("__proto__,__v_isRef,__isVue"),Vf=new Set(Object.getOwnPropertyNames(Symbol).filter(i=>i!=="arguments"&&i!=="caller").map(i=>Symbol[i]).filter(Ks));function Fg(i){Ks(i)||(i=String(i));const e=Ae(this);return nt(e,"has",i),e.hasOwnProperty(i)}class Kf{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,s){if(t==="__v_skip")return e.__v_skip;const r=this._isReadonly,n=this._isShallow;if(t==="__v_isReactive")return!r;if(t==="__v_isReadonly")return r;if(t==="__v_isShallow")return n;if(t==="__v_raw")return s===(r?n?Wg:Yf:n?Wf:jf).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(s)?e:void 0;const a=ue(e);if(!r){let l;if(a&&(l=Pg[t]))return l;if(t==="hasOwnProperty")return Fg}const o=Reflect.get(e,t,ot(e)?e:s);if((Ks(t)?Vf.has(t):Mg(t))||(r||nt(e,"get",t),n))return o;if(ot(o)){const l=a&&Vo(t)?o:o.value;return r&&Me(l)?qa(l):l}return Me(o)?r?qa(o):qo(o):o}}class Hf extends Kf{constructor(e=!1){super(!1,e)}set(e,t,s,r){let n=e[t];const a=ue(e)&&Vo(t);if(!this._isShallow){const c=Es(n);if(!wt(s)&&!Es(s)&&(n=Ae(n),s=Ae(s)),!a&&ot(n)&&!ot(s))return c||(n.value=s),!0}const o=a?Number(t)<e.length:Le(e,t),l=Reflect.set(e,t,s,ot(e)?e:r);return e===Ae(r)&&(o?Ms(s,n)&&hs(e,"set",t,s):hs(e,"add",t,s)),l}deleteProperty(e,t){const s=Le(e,t);e[t];const r=Reflect.deleteProperty(e,t);return r&&s&&hs(e,"delete",t,void 0),r}has(e,t){const s=Reflect.has(e,t);return(!Ks(t)||!Vf.has(t))&&nt(e,"has",t),s}ownKeys(e){return nt(e,"iterate",ue(e)?"length":ei),Reflect.ownKeys(e)}}class Ng extends Kf{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const $g=new Hf,Bg=new Ng,Ug=new Hf(!0);const za=i=>i,br=i=>Reflect.getPrototypeOf(i);function Gg(i,e,t){return function(...s){const r=this.__v_raw,n=Ae(r),a=Ti(n),o=i==="entries"||i===Symbol.iterator&&a,l=i==="keys"&&a,c=r[i](...s),u=t?za:e?Ci:$t;return!e&&nt(n,"iterate",l?Ya:ei),{next(){const{value:f,done:d}=c.next();return d?{value:f,done:d}:{value:o?[u(f[0]),u(f[1])]:u(f),done:d}},[Symbol.iterator](){return this}}}}function Ar(i){return function(...e){return i==="delete"?!1:i==="clear"?void 0:this}}function Vg(i,e){const t={get(r){const n=this.__v_raw,a=Ae(n),o=Ae(r);i||(Ms(r,o)&&nt(a,"get",r),nt(a,"get",o));const{has:l}=br(a),c=e?za:i?Ci:$t;if(l.call(a,r))return c(n.get(r));if(l.call(a,o))return c(n.get(o));n!==a&&n.get(r)},get size(){const r=this.__v_raw;return!i&&nt(Ae(r),"iterate",ei),r.size},has(r){const n=this.__v_raw,a=Ae(n),o=Ae(r);return i||(Ms(r,o)&&nt(a,"has",r),nt(a,"has",o)),r===o?n.has(r):n.has(r)||n.has(o)},forEach(r,n){const a=this,o=a.__v_raw,l=Ae(o),c=e?za:i?Ci:$t;return!i&&nt(l,"iterate",ei),o.forEach((u,f)=>r.call(n,c(u),c(f),a))}};return ze(t,i?{add:Ar("add"),set:Ar("set"),delete:Ar("delete"),clear:Ar("clear")}:{add(r){!e&&!wt(r)&&!Es(r)&&(r=Ae(r));const n=Ae(this);return br(n).has.call(n,r)||(n.add(r),hs(n,"add",r,r)),this},set(r,n){!e&&!wt(n)&&!Es(n)&&(n=Ae(n));const a=Ae(this),{has:o,get:l}=br(a);let c=o.call(a,r);c||(r=Ae(r),c=o.call(a,r));const u=l.call(a,r);return a.set(r,n),c?Ms(n,u)&&hs(a,"set",r,n):hs(a,"add",r,n),this},delete(r){const n=Ae(this),{has:a,get:o}=br(n);let l=a.call(n,r);l||(r=Ae(r),l=a.call(n,r)),o&&o.call(n,r);const c=n.delete(r);return l&&hs(n,"delete",r,void 0),c},clear(){const r=Ae(this),n=r.size!==0,a=r.clear();return n&&hs(r,"clear",void 0,void 0),a}}),["keys","values","entries",Symbol.iterator].forEach(r=>{t[r]=Gg(r,i,e)}),t}function zo(i,e){const t=Vg(i,e);return(s,r,n)=>r==="__v_isReactive"?!i:r==="__v_isReadonly"?i:r==="__v_raw"?s:Reflect.get(Le(t,r)&&r in s?t:s,r,n)}const Kg={get:zo(!1,!1)},Hg={get:zo(!1,!0)},jg={get:zo(!0,!1)};const jf=new WeakMap,Wf=new WeakMap,Yf=new WeakMap,Wg=new WeakMap;function Yg(i){switch(i){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function zg(i){return i.__v_skip||!Object.isExtensible(i)?0:Yg(Eg(i))}function qo(i){return Es(i)?i:Xo(i,!1,$g,Kg,jf)}function qg(i){return Xo(i,!1,Ug,Hg,Wf)}function qa(i){return Xo(i,!0,Bg,jg,Yf)}function Xo(i,e,t,s,r){if(!Me(i)||i.__v_raw&&!(e&&i.__v_isReactive))return i;const n=zg(i);if(n===0)return i;const a=r.get(i);if(a)return a;const o=new Proxy(i,n===2?s:t);return r.set(i,o),o}function ti(i){return Es(i)?ti(i.__v_raw):!!(i&&i.__v_isReactive)}function Es(i){return!!(i&&i.__v_isReadonly)}function wt(i){return!!(i&&i.__v_isShallow)}function Qo(i){return i?!!i.__v_raw:!1}function Ae(i){const e=i&&i.__v_raw;return e?Ae(e):i}function Xg(i){return!Le(i,"__v_skip")&&Object.isExtensible(i)&&wf(i,"__v_skip",!0),i}const $t=i=>Me(i)?qo(i):i,Ci=i=>Me(i)?qa(i):i;function ot(i){return i?i.__v_isRef===!0:!1}function Ye(i){return Qg(i,!1)}function Qg(i,e){return ot(i)?i:new Zg(i,e)}class Zg{constructor(e,t){this.dep=new Yo,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=t?e:Ae(e),this._value=t?e:$t(e),this.__v_isShallow=t}get value(){return this.dep.track(),this._value}set value(e){const t=this._rawValue,s=this.__v_isShallow||wt(e)||Es(e);e=s?e:Ae(e),Ms(e,t)&&(this._rawValue=e,this._value=s?e:$t(e),this.dep.trigger())}}function Wt(i){return ot(i)?i.value:i}const Jg={get:(i,e,t)=>e==="__v_raw"?i:Wt(Reflect.get(i,e,t)),set:(i,e,t,s)=>{const r=i[e];return ot(r)&&!ot(t)?(r.value=t,!0):Reflect.set(i,e,t,s)}};function zf(i){return ti(i)?i:new Proxy(i,Jg)}class em{constructor(e,t,s){this.fn=e,this.setter=t,this._value=void 0,this.dep=new Yo(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=sr-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!t,this.isSSR=s}notify(){if(this.flags|=16,!(this.flags&8)&&Oe!==this)return Ff(this,!0),!0}get value(){const e=this.dep.track();return Bf(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function tm(i,e,t=!1){let s,r;return de(i)?s=i:(s=i.get,r=i.set),new em(s,r,t)}const Ir={},ln=new WeakMap;let Xs;function sm(i,e=!1,t=Xs){if(t){let s=ln.get(t);s||ln.set(t,s=[]),s.push(i)}}function im(i,e,t=De){const{immediate:s,deep:r,once:n,scheduler:a,augmentJob:o,call:l}=t,c=T=>r?T:wt(T)||r===!1||r===0?gs(T,1):gs(T);let u,f,d,h,g=!1,m=!1;if(ot(i)?(f=()=>i.value,g=wt(i)):ti(i)?(f=()=>c(i),g=!0):ue(i)?(m=!0,g=i.some(T=>ti(T)||wt(T)),f=()=>i.map(T=>{if(ot(T))return T.value;if(ti(T))return c(T);if(de(T))return l?l(T,2):T()})):de(i)?e?f=l?()=>l(i,2):i:f=()=>{if(d){ys();try{d()}finally{vs()}}const T=Xs;Xs=u;try{return l?l(i,3,[h]):i(h)}finally{Xs=T}}:f=es,e&&r){const T=f,S=r===!0?1/0:r;f=()=>gs(T(),S)}const p=wg(),v=()=>{u.stop(),p&&p.active&&Go(p.effects,u)};if(n&&e){const T=e;e=(...S)=>{T(...S),v()}}let E=m?new Array(i.length).fill(Ir):Ir;const x=T=>{if(!(!(u.flags&1)||!u.dirty&&!T))if(e){const S=u.run();if(r||g||(m?S.some((C,A)=>Ms(C,E[A])):Ms(S,E))){d&&d();const C=Xs;Xs=u;try{const A=[S,E===Ir?void 0:m&&E[0]===Ir?[]:E,h];E=S,l?l(e,3,A):e(...A)}finally{Xs=C}}}else u.run()};return o&&o(x),u=new Of(f),u.scheduler=a?()=>a(x,!1):x,h=T=>sm(T,!1,u),d=u.onStop=()=>{const T=ln.get(u);if(T){if(l)l(T,4);else for(const S of T)S();ln.delete(u)}},e?s?x(!0):E=u.run():a?a(x.bind(null,!0),!0):u.run(),v.pause=u.pause.bind(u),v.resume=u.resume.bind(u),v.stop=v,v}function gs(i,e=1/0,t){if(e<=0||!Me(i)||i.__v_skip||(t=t||new Map,(t.get(i)||0)>=e))return i;if(t.set(i,e),e--,ot(i))gs(i.value,e,t);else if(ue(i))for(let s=0;s<i.length;s++)gs(i[s],e,t);else if(Lf(i)||Ti(i))i.forEach(s=>{gs(s,e,t)});else if(Cf(i)){for(const s in i)gs(i[s],e,t);for(const s of Object.getOwnPropertySymbols(i))Object.prototype.propertyIsEnumerable.call(i,s)&&gs(i[s],e,t)}return i}function vr(i,e,t,s){try{return s?i(...s):i()}catch(r){Bn(r,e,t)}}function Bt(i,e,t,s){if(de(i)){const r=vr(i,e,t,s);return r&&_f(r)&&r.catch(n=>{Bn(n,e,t)}),r}if(ue(i)){const r=[];for(let n=0;n<i.length;n++)r.push(Bt(i[n],e,t,s));return r}}function Bn(i,e,t,s=!0){const r=e?e.vnode:null,{errorHandler:n,throwUnhandledErrorInProduction:a}=e&&e.appContext.config||De;if(e){let o=e.parent;const l=e.proxy,c=`https://vuejs.org/error-reference/#runtime-${t}`;for(;o;){const u=o.ec;if(u){for(let f=0;f<u.length;f++)if(u[f](i,l,c)===!1)return}o=o.parent}if(n){ys(),vr(n,null,10,[i,l,c]),vs();return}}rm(i,t,r,s,a)}function rm(i,e,t,s=!0,r=!1){if(r)throw i;console.error(i)}const ft=[];let Yt=-1;const Si=[];let Cs=null,mi=0;const qf=Promise.resolve();let cn=null;function nm(i){const e=cn||qf;return i?e.then(this?i.bind(this):i):e}function am(i){let e=Yt+1,t=ft.length;for(;e<t;){const s=e+t>>>1,r=ft[s],n=rr(r);n<i||n===i&&r.flags&2?e=s+1:t=s}return e}function Zo(i){if(!(i.flags&1)){const e=rr(i),t=ft[ft.length-1];!t||!(i.flags&2)&&e>=rr(t)?ft.push(i):ft.splice(am(e),0,i),i.flags|=1,Xf()}}function Xf(){cn||(cn=qf.then(Zf))}function om(i){ue(i)?Si.push(...i):Cs&&i.id===-1?Cs.splice(mi+1,0,i):i.flags&1||(Si.push(i),i.flags|=1),Xf()}function zl(i,e,t=Yt+1){for(;t<ft.length;t++){const s=ft[t];if(s&&s.flags&2){if(i&&s.id!==i.uid)continue;ft.splice(t,1),t--,s.flags&4&&(s.flags&=-2),s(),s.flags&4||(s.flags&=-2)}}}function Qf(i){if(Si.length){const e=[...new Set(Si)].sort((t,s)=>rr(t)-rr(s));if(Si.length=0,Cs){Cs.push(...e);return}for(Cs=e,mi=0;mi<Cs.length;mi++){const t=Cs[mi];t.flags&4&&(t.flags&=-2),t.flags&8||t(),t.flags&=-2}Cs=null,mi=0}}const rr=i=>i.id==null?i.flags&2?-1:1/0:i.id;function Zf(i){try{for(Yt=0;Yt<ft.length;Yt++){const e=ft[Yt];e&&!(e.flags&8)&&(e.flags&4&&(e.flags&=-2),vr(e,e.i,e.i?15:14),e.flags&4||(e.flags&=-2))}}finally{for(;Yt<ft.length;Yt++){const e=ft[Yt];e&&(e.flags&=-2)}Yt=-1,ft.length=0,Qf(),cn=null,(ft.length||Si.length)&&Zf()}}let It=null,Jf=null;function un(i){const e=It;return It=i,Jf=i&&i.type.__scopeId||null,e}function fs(i,e=It,t){if(!e||i._n)return i;const s=(...r)=>{s._d&&gn(-1);const n=un(e);let a;try{a=i(...r)}finally{un(n),s._d&&gn(1)}return a};return s._n=!0,s._c=!0,s._d=!0,s}function jr(i,e){if(It===null)return i;const t=jn(It),s=i.dirs||(i.dirs=[]);for(let r=0;r<e.length;r++){let[n,a,o,l=De]=e[r];n&&(de(n)&&(n={mounted:n,updated:n}),n.deep&&gs(a),s.push({dir:n,instance:t,value:a,oldValue:void 0,arg:o,modifiers:l}))}return i}function Hs(i,e,t,s){const r=i.dirs,n=e&&e.dirs;for(let a=0;a<r.length;a++){const o=r[a];n&&(o.oldValue=n[a].value);let l=o.dir[s];l&&(ys(),Bt(l,t,8,[i.el,o,i,e]),vs())}}function lm(i,e){if(at){let t=at.provides;const s=at.parent&&at.parent.provides;s===t&&(t=at.provides=Object.create(s)),t[i]=e}}function Wr(i,e,t=!1){const s=Cd();if(s||bi){let r=bi?bi._context.provides:s?s.parent==null||s.ce?s.vnode.appContext&&s.vnode.appContext.provides:s.parent.provides:void 0;if(r&&i in r)return r[i];if(arguments.length>1)return t&&de(e)?e.call(s&&s.proxy):e}}const cm=Symbol.for("v-scx"),um=()=>Wr(cm);function Wi(i,e,t){return ed(i,e,t)}function ed(i,e,t=De){const{immediate:s,deep:r,flush:n,once:a}=t,o=ze({},t),l=e&&s||!e&&n!=="post";let c;if(or){if(n==="sync"){const h=um();c=h.__watcherHandles||(h.__watcherHandles=[])}else if(!l){const h=()=>{};return h.stop=es,h.resume=es,h.pause=es,h}}const u=at;o.call=(h,g,m)=>Bt(h,u,g,m);let f=!1;n==="post"?o.scheduler=h=>{xt(h,u&&u.suspense)}:n!=="sync"&&(f=!0,o.scheduler=(h,g)=>{g?h():Zo(h)}),o.augmentJob=h=>{e&&(h.flags|=4),f&&(h.flags|=2,u&&(h.id=u.uid,h.i=u))};const d=im(i,e,o);return or&&(c?c.push(d):l&&d()),d}function fm(i,e,t){const s=this.proxy,r=Ke(i)?i.includes(".")?td(s,i):()=>s[i]:i.bind(s,s);let n;de(e)?n=e:(n=e.handler,t=e);const a=Er(this),o=ed(r,n.bind(s),t);return a(),o}function td(i,e){const t=e.split(".");return()=>{let s=i;for(let r=0;r<t.length&&s;r++)s=s[t[r]];return s}}const dm=Symbol("_vte"),sd=i=>i.__isTeleport,ds=Symbol("_leaveCb"),Lr=Symbol("_enterCb");function hm(){const i={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return Vn(()=>{i.isMounted=!0}),Jo(()=>{i.isUnmounting=!0}),i}const Ct=[Function,Array],id={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:Ct,onEnter:Ct,onAfterEnter:Ct,onEnterCancelled:Ct,onBeforeLeave:Ct,onLeave:Ct,onAfterLeave:Ct,onLeaveCancelled:Ct,onBeforeAppear:Ct,onAppear:Ct,onAfterAppear:Ct,onAppearCancelled:Ct},rd=i=>{const e=i.subTree;return e.component?rd(e.component):e},gm={name:"BaseTransition",props:id,setup(i,{slots:e}){const t=Cd(),s=hm();return()=>{const r=e.default&&od(e.default(),!0);if(!r||!r.length)return;const n=nd(r),a=Ae(i),{mode:o}=a;if(s.isLeaving)return na(n);const l=ql(n);if(!l)return na(n);let c=Xa(l,a,s,t,f=>c=f);l.type!==ht&&nr(l,c);let u=t.subTree&&ql(t.subTree);if(u&&u.type!==ht&&!Zs(u,l)&&rd(t).type!==ht){let f=Xa(u,a,s,t);if(nr(u,f),o==="out-in"&&l.type!==ht)return s.isLeaving=!0,f.afterLeave=()=>{s.isLeaving=!1,t.job.flags&8||t.update(),delete f.afterLeave,u=void 0},na(n);o==="in-out"&&l.type!==ht?f.delayLeave=(d,h,g)=>{const m=ad(s,u);m[String(u.key)]=u,d[ds]=()=>{h(),d[ds]=void 0,delete c.delayedLeave,u=void 0},c.delayedLeave=()=>{g(),delete c.delayedLeave,u=void 0}}:u=void 0}else u&&(u=void 0);return n}}};function nd(i){let e=i[0];if(i.length>1){for(const t of i)if(t.type!==ht){e=t;break}}return e}const mm=gm;function ad(i,e){const{leavingVNodes:t}=i;let s=t.get(e.type);return s||(s=Object.create(null),t.set(e.type,s)),s}function Xa(i,e,t,s,r){const{appear:n,mode:a,persisted:o=!1,onBeforeEnter:l,onEnter:c,onAfterEnter:u,onEnterCancelled:f,onBeforeLeave:d,onLeave:h,onAfterLeave:g,onLeaveCancelled:m,onBeforeAppear:p,onAppear:v,onAfterAppear:E,onAppearCancelled:x}=e,T=String(i.key),S=ad(t,i),C=(L,I)=>{L&&Bt(L,s,9,I)},A=(L,I)=>{const O=I[1];C(L,I),ue(L)?L.every(P=>P.length<=1)&&O():L.length<=1&&O()},w={mode:a,persisted:o,beforeEnter(L){let I=l;if(!t.isMounted)if(n)I=p||l;else return;L[ds]&&L[ds](!0);const O=S[T];O&&Zs(i,O)&&O.el[ds]&&O.el[ds](),C(I,[L])},enter(L){let I=c,O=u,P=f;if(!t.isMounted)if(n)I=v||c,O=E||u,P=x||f;else return;let H=!1;const Q=L[Lr]=Z=>{H||(H=!0,Z?C(P,[L]):C(O,[L]),w.delayedLeave&&w.delayedLeave(),L[Lr]=void 0)};I?A(I,[L,Q]):Q()},leave(L,I){const O=String(i.key);if(L[Lr]&&L[Lr](!0),t.isUnmounting)return I();C(d,[L]);let P=!1;const H=L[ds]=Q=>{P||(P=!0,I(),Q?C(m,[L]):C(g,[L]),L[ds]=void 0,S[O]===i&&delete S[O])};S[O]=i,h?A(h,[L,H]):H()},clone(L){const I=Xa(L,e,t,s,r);return r&&r(I),I}};return w}function na(i){if(Un(i))return i=Ns(i),i.children=null,i}function ql(i){if(!Un(i))return sd(i.type)&&i.children?nd(i.children):i;if(i.component)return i.component.subTree;const{shapeFlag:e,children:t}=i;if(t){if(e&16)return t[0];if(e&32&&de(t.default))return t.default()}}function nr(i,e){i.shapeFlag&6&&i.component?(i.transition=e,nr(i.component.subTree,e)):i.shapeFlag&128?(i.ssContent.transition=e.clone(i.ssContent),i.ssFallback.transition=e.clone(i.ssFallback)):i.transition=e}function od(i,e=!1,t){let s=[],r=0;for(let n=0;n<i.length;n++){let a=i[n];const o=t==null?a.key:String(t)+String(a.key!=null?a.key:n);a.type===dt?(a.patchFlag&128&&r++,s=s.concat(od(a.children,e,o))):(e||a.type!==ht)&&s.push(o!=null?Ns(a,{key:o}):a)}if(r>1)for(let n=0;n<s.length;n++)s[n].patchFlag=-2;return s}function pm(i,e){return de(i)?ze({name:i.name},e,{setup:i}):i}function ld(i){i.ids=[i.ids[0]+i.ids[2]+++"-",0,0]}const fn=new WeakMap;function Yi(i,e,t,s,r=!1){if(ue(i)){i.forEach((g,m)=>Yi(g,e&&(ue(e)?e[m]:e),t,s,r));return}if(zi(s)&&!r){s.shapeFlag&512&&s.type.__asyncResolved&&s.component.subTree.component&&Yi(i,e,t,s.component.subTree);return}const n=s.shapeFlag&4?jn(s.component):s.el,a=r?null:n,{i:o,r:l}=i,c=e&&e.r,u=o.refs===De?o.refs={}:o.refs,f=o.setupState,d=Ae(f),h=f===De?If:g=>Le(d,g);if(c!=null&&c!==l){if(Xl(e),Ke(c))u[c]=null,h(c)&&(f[c]=null);else if(ot(c)){c.value=null;const g=e;g.k&&(u[g.k]=null)}}if(de(l))vr(l,o,12,[a,u]);else{const g=Ke(l),m=ot(l);if(g||m){const p=()=>{if(i.f){const v=g?h(l)?f[l]:u[l]:l.value;if(r)ue(v)&&Go(v,n);else if(ue(v))v.includes(n)||v.push(n);else if(g)u[l]=[n],h(l)&&(f[l]=u[l]);else{const E=[n];l.value=E,i.k&&(u[i.k]=E)}}else g?(u[l]=a,h(l)&&(f[l]=a)):m&&(l.value=a,i.k&&(u[i.k]=a))};if(a){const v=()=>{p(),fn.delete(i)};v.id=-1,fn.set(i,v),xt(v,t)}else Xl(i),p()}}}function Xl(i){const e=fn.get(i);e&&(e.flags|=8,fn.delete(i))}Nn().requestIdleCallback;Nn().cancelIdleCallback;const zi=i=>!!i.type.__asyncLoader,Un=i=>i.type.__isKeepAlive;function ym(i,e){cd(i,"a",e)}function vm(i,e){cd(i,"da",e)}function cd(i,e,t=at){const s=i.__wdc||(i.__wdc=()=>{let r=t;for(;r;){if(r.isDeactivated)return;r=r.parent}return i()});if(Gn(e,s,t),t){let r=t.parent;for(;r&&r.parent;)Un(r.parent.vnode)&&Em(s,e,t,r),r=r.parent}}function Em(i,e,t,s){const r=Gn(e,i,s,!0);el(()=>{Go(s[e],r)},t)}function Gn(i,e,t=at,s=!1){if(t){const r=t[i]||(t[i]=[]),n=e.__weh||(e.__weh=(...a)=>{ys();const o=Er(t),l=Bt(e,t,i,a);return o(),vs(),l});return s?r.unshift(n):r.push(n),n}}const Ss=i=>(e,t=at)=>{(!or||i==="sp")&&Gn(i,(...s)=>e(...s),t)},xm=Ss("bm"),Vn=Ss("m"),Tm=Ss("bu"),Sm=Ss("u"),Jo=Ss("bum"),el=Ss("um"),bm=Ss("sp"),Am=Ss("rtg"),Im=Ss("rtc");function Lm(i,e=at){Gn("ec",i,e)}const _m="components";function ud(i,e){return Cm(_m,i,!0,e)||i}const Rm=Symbol.for("v-ndc");function Cm(i,e,t=!0,s=!1){const r=It||at;if(r){const n=r.type;{const o=gp(n,!1);if(o&&(o===e||o===Dt(e)||o===Fn(Dt(e))))return n}const a=Ql(r[i]||n[i],e)||Ql(r.appContext[i],e);return!a&&s?n:a}}function Ql(i,e){return i&&(i[e]||i[Dt(e)]||i[Fn(Dt(e))])}function dn(i,e,t,s){let r;const n=t,a=ue(i);if(a||Ke(i)){const o=a&&ti(i);let l=!1,c=!1;o&&(l=!wt(i),c=Es(i),i=$n(i)),r=new Array(i.length);for(let u=0,f=i.length;u<f;u++)r[u]=e(l?c?Ci($t(i[u])):$t(i[u]):i[u],u,void 0,n)}else if(typeof i=="number"){r=new Array(i);for(let o=0;o<i;o++)r[o]=e(o+1,o,void 0,n)}else if(Me(i))if(i[Symbol.iterator])r=Array.from(i,(o,l)=>e(o,l,void 0,n));else{const o=Object.keys(i);r=new Array(o.length);for(let l=0,c=o.length;l<c;l++){const u=o[l];r[l]=e(i[u],u,l,n)}}else r=[];return r}const Qa=i=>i?wd(i)?jn(i):Qa(i.parent):null,qi=ze(Object.create(null),{$:i=>i,$el:i=>i.vnode.el,$data:i=>i.data,$props:i=>i.props,$attrs:i=>i.attrs,$slots:i=>i.slots,$refs:i=>i.refs,$parent:i=>Qa(i.parent),$root:i=>Qa(i.root),$host:i=>i.ce,$emit:i=>i.emit,$options:i=>dd(i),$forceUpdate:i=>i.f||(i.f=()=>{Zo(i.update)}),$nextTick:i=>i.n||(i.n=nm.bind(i.proxy)),$watch:i=>fm.bind(i)}),aa=(i,e)=>i!==De&&!i.__isScriptSetup&&Le(i,e),wm={get({_:i},e){if(e==="__v_skip")return!0;const{ctx:t,setupState:s,data:r,props:n,accessCache:a,type:o,appContext:l}=i;if(e[0]!=="$"){const d=a[e];if(d!==void 0)switch(d){case 1:return s[e];case 2:return r[e];case 4:return t[e];case 3:return n[e]}else{if(aa(s,e))return a[e]=1,s[e];if(r!==De&&Le(r,e))return a[e]=2,r[e];if(Le(n,e))return a[e]=3,n[e];if(t!==De&&Le(t,e))return a[e]=4,t[e];Za&&(a[e]=0)}}const c=qi[e];let u,f;if(c)return e==="$attrs"&&nt(i.attrs,"get",""),c(i);if((u=o.__cssModules)&&(u=u[e]))return u;if(t!==De&&Le(t,e))return a[e]=4,t[e];if(f=l.config.globalProperties,Le(f,e))return f[e]},set({_:i},e,t){const{data:s,setupState:r,ctx:n}=i;return aa(r,e)?(r[e]=t,!0):s!==De&&Le(s,e)?(s[e]=t,!0):Le(i.props,e)||e[0]==="$"&&e.slice(1)in i?!1:(n[e]=t,!0)},has({_:{data:i,setupState:e,accessCache:t,ctx:s,appContext:r,props:n,type:a}},o){let l;return!!(t[o]||i!==De&&o[0]!=="$"&&Le(i,o)||aa(e,o)||Le(n,o)||Le(s,o)||Le(qi,o)||Le(r.config.globalProperties,o)||(l=a.__cssModules)&&l[o])},defineProperty(i,e,t){return t.get!=null?i._.accessCache[e]=0:Le(t,"value")&&this.set(i,e,t.value,null),Reflect.defineProperty(i,e,t)}};function Zl(i){return ue(i)?i.reduce((e,t)=>(e[t]=null,e),{}):i}let Za=!0;function Dm(i){const e=dd(i),t=i.proxy,s=i.ctx;Za=!1,e.beforeCreate&&Jl(e.beforeCreate,i,"bc");const{data:r,computed:n,methods:a,watch:o,provide:l,inject:c,created:u,beforeMount:f,mounted:d,beforeUpdate:h,updated:g,activated:m,deactivated:p,beforeDestroy:v,beforeUnmount:E,destroyed:x,unmounted:T,render:S,renderTracked:C,renderTriggered:A,errorCaptured:w,serverPrefetch:L,expose:I,inheritAttrs:O,components:P,directives:H,filters:Q}=e;if(c&&km(c,s,null),a)for(const Y in a){const G=a[Y];de(G)&&(s[Y]=G.bind(t))}if(r){const Y=r.call(t,t);Me(Y)&&(i.data=qo(Y))}if(Za=!0,n)for(const Y in n){const G=n[Y],te=de(G)?G.bind(t,t):de(G.get)?G.get.bind(t,t):es,oe=!de(G)&&de(G.set)?G.set.bind(t):es,z=Ds({get:te,set:oe});Object.defineProperty(s,Y,{enumerable:!0,configurable:!0,get:()=>z.value,set:j=>z.value=j})}if(o)for(const Y in o)fd(o[Y],s,t,Y);if(l){const Y=de(l)?l.call(t):l;Reflect.ownKeys(Y).forEach(G=>{lm(G,Y[G])})}u&&Jl(u,i,"c");function U(Y,G){ue(G)?G.forEach(te=>Y(te.bind(t))):G&&Y(G.bind(t))}if(U(xm,f),U(Vn,d),U(Tm,h),U(Sm,g),U(ym,m),U(vm,p),U(Lm,w),U(Im,C),U(Am,A),U(Jo,E),U(el,T),U(bm,L),ue(I))if(I.length){const Y=i.exposed||(i.exposed={});I.forEach(G=>{Object.defineProperty(Y,G,{get:()=>t[G],set:te=>t[G]=te,enumerable:!0})})}else i.exposed||(i.exposed={});S&&i.render===es&&(i.render=S),O!=null&&(i.inheritAttrs=O),P&&(i.components=P),H&&(i.directives=H),L&&ld(i)}function km(i,e,t=es){ue(i)&&(i=Ja(i));for(const s in i){const r=i[s];let n;Me(r)?"default"in r?n=Wr(r.from||s,r.default,!0):n=Wr(r.from||s):n=Wr(r),ot(n)?Object.defineProperty(e,s,{enumerable:!0,configurable:!0,get:()=>n.value,set:a=>n.value=a}):e[s]=n}}function Jl(i,e,t){Bt(ue(i)?i.map(s=>s.bind(e.proxy)):i.bind(e.proxy),e,t)}function fd(i,e,t,s){let r=s.includes(".")?td(t,s):()=>t[s];if(Ke(i)){const n=e[i];de(n)&&Wi(r,n)}else if(de(i))Wi(r,i.bind(t));else if(Me(i))if(ue(i))i.forEach(n=>fd(n,e,t,s));else{const n=de(i.handler)?i.handler.bind(t):e[i.handler];de(n)&&Wi(r,n,i)}}function dd(i){const e=i.type,{mixins:t,extends:s}=e,{mixins:r,optionsCache:n,config:{optionMergeStrategies:a}}=i.appContext,o=n.get(e);let l;return o?l=o:!r.length&&!t&&!s?l=e:(l={},r.length&&r.forEach(c=>hn(l,c,a,!0)),hn(l,e,a)),Me(e)&&n.set(e,l),l}function hn(i,e,t,s=!1){const{mixins:r,extends:n}=e;n&&hn(i,n,t,!0),r&&r.forEach(a=>hn(i,a,t,!0));for(const a in e)if(!(s&&a==="expose")){const o=Pm[a]||t&&t[a];i[a]=o?o(i[a],e[a]):e[a]}return i}const Pm={data:ec,props:tc,emits:tc,methods:Bi,computed:Bi,beforeCreate:ct,created:ct,beforeMount:ct,mounted:ct,beforeUpdate:ct,updated:ct,beforeDestroy:ct,beforeUnmount:ct,destroyed:ct,unmounted:ct,activated:ct,deactivated:ct,errorCaptured:ct,serverPrefetch:ct,components:Bi,directives:Bi,watch:Mm,provide:ec,inject:Om};function ec(i,e){return e?i?function(){return ze(de(i)?i.call(this,this):i,de(e)?e.call(this,this):e)}:e:i}function Om(i,e){return Bi(Ja(i),Ja(e))}function Ja(i){if(ue(i)){const e={};for(let t=0;t<i.length;t++)e[i[t]]=i[t];return e}return i}function ct(i,e){return i?[...new Set([].concat(i,e))]:e}function Bi(i,e){return i?ze(Object.create(null),i,e):e}function tc(i,e){return i?ue(i)&&ue(e)?[...new Set([...i,...e])]:ze(Object.create(null),Zl(i),Zl(e??{})):e}function Mm(i,e){if(!i)return e;if(!e)return i;const t=ze(Object.create(null),i);for(const s in e)t[s]=ct(i[s],e[s]);return t}function hd(){return{app:null,config:{isNativeTag:If,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let Fm=0;function Nm(i,e){return function(s,r=null){de(s)||(s=ze({},s)),r!=null&&!Me(r)&&(r=null);const n=hd(),a=new WeakSet,o=[];let l=!1;const c=n.app={_uid:Fm++,_component:s,_props:r,_container:null,_context:n,_instance:null,version:pp,get config(){return n.config},set config(u){},use(u,...f){return a.has(u)||(u&&de(u.install)?(a.add(u),u.install(c,...f)):de(u)&&(a.add(u),u(c,...f))),c},mixin(u){return n.mixins.includes(u)||n.mixins.push(u),c},component(u,f){return f?(n.components[u]=f,c):n.components[u]},directive(u,f){return f?(n.directives[u]=f,c):n.directives[u]},mount(u,f,d){if(!l){const h=c._ceVNode||xe(s,r);return h.appContext=n,d===!0?d="svg":d===!1&&(d=void 0),i(h,u,d),l=!0,c._container=u,u.__vue_app__=c,jn(h.component)}},onUnmount(u){o.push(u)},unmount(){l&&(Bt(o,c._instance,16),i(null,c._container),delete c._container.__vue_app__)},provide(u,f){return n.provides[u]=f,c},runWithContext(u){const f=bi;bi=c;try{return u()}finally{bi=f}}};return c}}let bi=null;const $m=(i,e)=>e==="modelValue"||e==="model-value"?i.modelModifiers:i[`${e}Modifiers`]||i[`${Dt(e)}Modifiers`]||i[`${ai(e)}Modifiers`];function Bm(i,e,...t){if(i.isUnmounted)return;const s=i.vnode.props||De;let r=t;const n=e.startsWith("update:"),a=n&&$m(s,e.slice(7));a&&(a.trim&&(r=t.map(u=>Ke(u)?u.trim():u)),a.number&&(r=t.map(Ko)));let o,l=s[o=ea(e)]||s[o=ea(Dt(e))];!l&&n&&(l=s[o=ea(ai(e))]),l&&Bt(l,i,6,r);const c=s[o+"Once"];if(c){if(!i.emitted)i.emitted={};else if(i.emitted[o])return;i.emitted[o]=!0,Bt(c,i,6,r)}}const Um=new WeakMap;function gd(i,e,t=!1){const s=t?Um:e.emitsCache,r=s.get(i);if(r!==void 0)return r;const n=i.emits;let a={},o=!1;if(!de(i)){const l=c=>{const u=gd(c,e,!0);u&&(o=!0,ze(a,u))};!t&&e.mixins.length&&e.mixins.forEach(l),i.extends&&l(i.extends),i.mixins&&i.mixins.forEach(l)}return!n&&!o?(Me(i)&&s.set(i,null),null):(ue(n)?n.forEach(l=>a[l]=null):ze(a,n),Me(i)&&s.set(i,a),a)}function Kn(i,e){return!i||!Pn(e)?!1:(e=e.slice(2).replace(/Once$/,""),Le(i,e[0].toLowerCase()+e.slice(1))||Le(i,ai(e))||Le(i,e))}function sc(i){const{type:e,vnode:t,proxy:s,withProxy:r,propsOptions:[n],slots:a,attrs:o,emit:l,render:c,renderCache:u,props:f,data:d,setupState:h,ctx:g,inheritAttrs:m}=i,p=un(i);let v,E;try{if(t.shapeFlag&4){const T=r||s,S=T;v=qt(c.call(S,T,u,f,h,d,g)),E=o}else{const T=e;v=qt(T.length>1?T(f,{attrs:o,slots:a,emit:l}):T(f,null)),E=e.props?o:Gm(o)}}catch(T){Xi.length=0,Bn(T,i,1),v=xe(ht)}let x=v;if(E&&m!==!1){const T=Object.keys(E),{shapeFlag:S}=x;T.length&&S&7&&(n&&T.some(Uo)&&(E=Vm(E,n)),x=Ns(x,E,!1,!0))}return t.dirs&&(x=Ns(x,null,!1,!0),x.dirs=x.dirs?x.dirs.concat(t.dirs):t.dirs),t.transition&&nr(x,t.transition),v=x,un(p),v}const Gm=i=>{let e;for(const t in i)(t==="class"||t==="style"||Pn(t))&&((e||(e={}))[t]=i[t]);return e},Vm=(i,e)=>{const t={};for(const s in i)(!Uo(s)||!(s.slice(9)in e))&&(t[s]=i[s]);return t};function Km(i,e,t){const{props:s,children:r,component:n}=i,{props:a,children:o,patchFlag:l}=e,c=n.emitsOptions;if(e.dirs||e.transition)return!0;if(t&&l>=0){if(l&1024)return!0;if(l&16)return s?ic(s,a,c):!!a;if(l&8){const u=e.dynamicProps;for(let f=0;f<u.length;f++){const d=u[f];if(a[d]!==s[d]&&!Kn(c,d))return!0}}}else return(r||o)&&(!o||!o.$stable)?!0:s===a?!1:s?a?ic(s,a,c):!0:!!a;return!1}function ic(i,e,t){const s=Object.keys(e);if(s.length!==Object.keys(i).length)return!0;for(let r=0;r<s.length;r++){const n=s[r];if(e[n]!==i[n]&&!Kn(t,n))return!0}return!1}function Hm({vnode:i,parent:e},t){for(;e;){const s=e.subTree;if(s.suspense&&s.suspense.activeBranch===i&&(s.el=i.el),s===i)(i=e.vnode).el=t,e=e.parent;else break}}const md={},pd=()=>Object.create(md),yd=i=>Object.getPrototypeOf(i)===md;function jm(i,e,t,s=!1){const r={},n=pd();i.propsDefaults=Object.create(null),vd(i,e,r,n);for(const a in i.propsOptions[0])a in r||(r[a]=void 0);t?i.props=s?r:qg(r):i.type.props?i.props=r:i.props=n,i.attrs=n}function Wm(i,e,t,s){const{props:r,attrs:n,vnode:{patchFlag:a}}=i,o=Ae(r),[l]=i.propsOptions;let c=!1;if((s||a>0)&&!(a&16)){if(a&8){const u=i.vnode.dynamicProps;for(let f=0;f<u.length;f++){let d=u[f];if(Kn(i.emitsOptions,d))continue;const h=e[d];if(l)if(Le(n,d))h!==n[d]&&(n[d]=h,c=!0);else{const g=Dt(d);r[g]=eo(l,o,g,h,i,!1)}else h!==n[d]&&(n[d]=h,c=!0)}}}else{vd(i,e,r,n)&&(c=!0);let u;for(const f in o)(!e||!Le(e,f)&&((u=ai(f))===f||!Le(e,u)))&&(l?t&&(t[f]!==void 0||t[u]!==void 0)&&(r[f]=eo(l,o,f,void 0,i,!0)):delete r[f]);if(n!==o)for(const f in n)(!e||!Le(e,f))&&(delete n[f],c=!0)}c&&hs(i.attrs,"set","")}function vd(i,e,t,s){const[r,n]=i.propsOptions;let a=!1,o;if(e)for(let l in e){if(Ki(l))continue;const c=e[l];let u;r&&Le(r,u=Dt(l))?!n||!n.includes(u)?t[u]=c:(o||(o={}))[u]=c:Kn(i.emitsOptions,l)||(!(l in s)||c!==s[l])&&(s[l]=c,a=!0)}if(n){const l=Ae(t),c=o||De;for(let u=0;u<n.length;u++){const f=n[u];t[f]=eo(r,l,f,c[f],i,!Le(c,f))}}return a}function eo(i,e,t,s,r,n){const a=i[t];if(a!=null){const o=Le(a,"default");if(o&&s===void 0){const l=a.default;if(a.type!==Function&&!a.skipFactory&&de(l)){const{propsDefaults:c}=r;if(t in c)s=c[t];else{const u=Er(r);s=c[t]=l.call(null,e),u()}}else s=l;r.ce&&r.ce._setProp(t,s)}a[0]&&(n&&!o?s=!1:a[1]&&(s===""||s===ai(t))&&(s=!0))}return s}const Ym=new WeakMap;function Ed(i,e,t=!1){const s=t?Ym:e.propsCache,r=s.get(i);if(r)return r;const n=i.props,a={},o=[];let l=!1;if(!de(i)){const u=f=>{l=!0;const[d,h]=Ed(f,e,!0);ze(a,d),h&&o.push(...h)};!t&&e.mixins.length&&e.mixins.forEach(u),i.extends&&u(i.extends),i.mixins&&i.mixins.forEach(u)}if(!n&&!l)return Me(i)&&s.set(i,xi),xi;if(ue(n))for(let u=0;u<n.length;u++){const f=Dt(n[u]);rc(f)&&(a[f]=De)}else if(n)for(const u in n){const f=Dt(u);if(rc(f)){const d=n[u],h=a[f]=ue(d)||de(d)?{type:d}:ze({},d),g=h.type;let m=!1,p=!0;if(ue(g))for(let v=0;v<g.length;++v){const E=g[v],x=de(E)&&E.name;if(x==="Boolean"){m=!0;break}else x==="String"&&(p=!1)}else m=de(g)&&g.name==="Boolean";h[0]=m,h[1]=p,(m||Le(h,"default"))&&o.push(f)}}const c=[a,o];return Me(i)&&s.set(i,c),c}function rc(i){return i[0]!=="$"&&!Ki(i)}const tl=i=>i==="_"||i==="_ctx"||i==="$stable",sl=i=>ue(i)?i.map(qt):[qt(i)],zm=(i,e,t)=>{if(e._n)return e;const s=fs((...r)=>sl(e(...r)),t);return s._c=!1,s},xd=(i,e,t)=>{const s=i._ctx;for(const r in i){if(tl(r))continue;const n=i[r];if(de(n))e[r]=zm(r,n,s);else if(n!=null){const a=sl(n);e[r]=()=>a}}},Td=(i,e)=>{const t=sl(e);i.slots.default=()=>t},Sd=(i,e,t)=>{for(const s in e)(t||!tl(s))&&(i[s]=e[s])},qm=(i,e,t)=>{const s=i.slots=pd();if(i.vnode.shapeFlag&32){const r=e._;r?(Sd(s,e,t),t&&wf(s,"_",r,!0)):xd(e,s)}else e&&Td(i,e)},Xm=(i,e,t)=>{const{vnode:s,slots:r}=i;let n=!0,a=De;if(s.shapeFlag&32){const o=e._;o?t&&o===1?n=!1:Sd(r,e,t):(n=!e.$stable,xd(e,r)),a=e}else e&&(Td(i,e),a={default:1});if(n)for(const o in r)!tl(o)&&a[o]==null&&delete r[o]},xt=tp;function Qm(i){return Zm(i)}function Zm(i,e){const t=Nn();t.__VUE__=!0;const{insert:s,remove:r,patchProp:n,createElement:a,createText:o,createComment:l,setText:c,setElementText:u,parentNode:f,nextSibling:d,setScopeId:h=es,insertStaticContent:g}=i,m=(b,_,F,V=null,M=null,$=null,q=void 0,X=null,K=!!_.dynamicChildren)=>{if(b===_)return;b&&!Zs(b,_)&&(V=Ue(b),j(b,M,$,!0),b=null),_.patchFlag===-2&&(K=!1,_.dynamicChildren=null);const{type:B,ref:re,shapeFlag:ee}=_;switch(B){case Hn:p(b,_,F,V);break;case ht:v(b,_,F,V);break;case Yr:b==null&&E(_,F,V,q);break;case dt:P(b,_,F,V,M,$,q,X,K);break;default:ee&1?S(b,_,F,V,M,$,q,X,K):ee&6?H(b,_,F,V,M,$,q,X,K):(ee&64||ee&128)&&B.process(b,_,F,V,M,$,q,X,K,tt)}re!=null&&M?Yi(re,b&&b.ref,$,_||b,!_):re==null&&b&&b.ref!=null&&Yi(b.ref,null,$,b,!0)},p=(b,_,F,V)=>{if(b==null)s(_.el=o(_.children),F,V);else{const M=_.el=b.el;_.children!==b.children&&c(M,_.children)}},v=(b,_,F,V)=>{b==null?s(_.el=l(_.children||""),F,V):_.el=b.el},E=(b,_,F,V)=>{[b.el,b.anchor]=g(b.children,_,F,V,b.el,b.anchor)},x=({el:b,anchor:_},F,V)=>{let M;for(;b&&b!==_;)M=d(b),s(b,F,V),b=M;s(_,F,V)},T=({el:b,anchor:_})=>{let F;for(;b&&b!==_;)F=d(b),r(b),b=F;r(_)},S=(b,_,F,V,M,$,q,X,K)=>{if(_.type==="svg"?q="svg":_.type==="math"&&(q="mathml"),b==null)C(_,F,V,M,$,q,X,K);else{const B=b.el&&b.el._isVueCE?b.el:null;try{B&&B._beginPatch(),L(b,_,M,$,q,X,K)}finally{B&&B._endPatch()}}},C=(b,_,F,V,M,$,q,X)=>{let K,B;const{props:re,shapeFlag:ee,transition:ne,dirs:le}=b;if(K=b.el=a(b.type,$,re&&re.is,re),ee&8?u(K,b.children):ee&16&&w(b.children,K,null,V,M,oa(b,$),q,X),le&&Hs(b,null,V,"created"),A(K,b,b.scopeId,q,V),re){for(const _e in re)_e!=="value"&&!Ki(_e)&&n(K,_e,null,re[_e],$,V);"value"in re&&n(K,"value",null,re.value,$),(B=re.onVnodeBeforeMount)&&Kt(B,V,b)}le&&Hs(b,null,V,"beforeMount");const ye=Jm(M,ne);ye&&ne.beforeEnter(K),s(K,_,F),((B=re&&re.onVnodeMounted)||ye||le)&&xt(()=>{B&&Kt(B,V,b),ye&&ne.enter(K),le&&Hs(b,null,V,"mounted")},M)},A=(b,_,F,V,M)=>{if(F&&h(b,F),V)for(let $=0;$<V.length;$++)h(b,V[$]);if(M){let $=M.subTree;if(_===$||Ld($.type)&&($.ssContent===_||$.ssFallback===_)){const q=M.vnode;A(b,q,q.scopeId,q.slotScopeIds,M.parent)}}},w=(b,_,F,V,M,$,q,X,K=0)=>{for(let B=K;B<b.length;B++){const re=b[B]=X?ws(b[B]):qt(b[B]);m(null,re,_,F,V,M,$,q,X)}},L=(b,_,F,V,M,$,q)=>{const X=_.el=b.el;let{patchFlag:K,dynamicChildren:B,dirs:re}=_;K|=b.patchFlag&16;const ee=b.props||De,ne=_.props||De;let le;if(F&&js(F,!1),(le=ne.onVnodeBeforeUpdate)&&Kt(le,F,_,b),re&&Hs(_,b,F,"beforeUpdate"),F&&js(F,!0),(ee.innerHTML&&ne.innerHTML==null||ee.textContent&&ne.textContent==null)&&u(X,""),B?I(b.dynamicChildren,B,X,F,V,oa(_,M),$):q||G(b,_,X,null,F,V,oa(_,M),$,!1),K>0){if(K&16)O(X,ee,ne,F,M);else if(K&2&&ee.class!==ne.class&&n(X,"class",null,ne.class,M),K&4&&n(X,"style",ee.style,ne.style,M),K&8){const ye=_.dynamicProps;for(let _e=0;_e<ye.length;_e++){const be=ye[_e],qe=ee[be],Xe=ne[be];(Xe!==qe||be==="value")&&n(X,be,qe,Xe,M,F)}}K&1&&b.children!==_.children&&u(X,_.children)}else!q&&B==null&&O(X,ee,ne,F,M);((le=ne.onVnodeUpdated)||re)&&xt(()=>{le&&Kt(le,F,_,b),re&&Hs(_,b,F,"updated")},V)},I=(b,_,F,V,M,$,q)=>{for(let X=0;X<_.length;X++){const K=b[X],B=_[X],re=K.el&&(K.type===dt||!Zs(K,B)||K.shapeFlag&198)?f(K.el):F;m(K,B,re,null,V,M,$,q,!0)}},O=(b,_,F,V,M)=>{if(_!==F){if(_!==De)for(const $ in _)!Ki($)&&!($ in F)&&n(b,$,_[$],null,M,V);for(const $ in F){if(Ki($))continue;const q=F[$],X=_[$];q!==X&&$!=="value"&&n(b,$,X,q,M,V)}"value"in F&&n(b,"value",_.value,F.value,M)}},P=(b,_,F,V,M,$,q,X,K)=>{const B=_.el=b?b.el:o(""),re=_.anchor=b?b.anchor:o("");let{patchFlag:ee,dynamicChildren:ne,slotScopeIds:le}=_;le&&(X=X?X.concat(le):le),b==null?(s(B,F,V),s(re,F,V),w(_.children||[],F,re,M,$,q,X,K)):ee>0&&ee&64&&ne&&b.dynamicChildren&&b.dynamicChildren.length===ne.length?(I(b.dynamicChildren,ne,F,M,$,q,X),(_.key!=null||M&&_===M.subTree)&&bd(b,_,!0)):G(b,_,F,re,M,$,q,X,K)},H=(b,_,F,V,M,$,q,X,K)=>{_.slotScopeIds=X,b==null?_.shapeFlag&512?M.ctx.activate(_,F,V,q,K):Q(_,F,V,M,$,q,K):Z(b,_,K)},Q=(b,_,F,V,M,$,q)=>{const X=b.component=cp(b,V,M);if(Un(b)&&(X.ctx.renderer=tt),up(X,!1,q),X.asyncDep){if(M&&M.registerDep(X,U,q),!b.el){const K=X.subTree=xe(ht);v(null,K,_,F),b.placeholder=K.el}}else U(X,b,_,F,M,$,q)},Z=(b,_,F)=>{const V=_.component=b.component;if(Km(b,_,F))if(V.asyncDep&&!V.asyncResolved){Y(V,_,F);return}else V.next=_,V.update();else _.el=b.el,V.vnode=_},U=(b,_,F,V,M,$,q)=>{const X=()=>{if(b.isMounted){let{next:ee,bu:ne,u:le,parent:ye,vnode:_e}=b;{const Gt=Ad(b);if(Gt){ee&&(ee.el=_e.el,Y(b,ee,q)),Gt.asyncDep.then(()=>{b.isUnmounted||X()});return}}let be=ee,qe;js(b,!1),ee?(ee.el=_e.el,Y(b,ee,q)):ee=_e,ne&&Hr(ne),(qe=ee.props&&ee.props.onVnodeBeforeUpdate)&&Kt(qe,ye,ee,_e),js(b,!0);const Xe=sc(b),st=b.subTree;b.subTree=Xe,m(st,Xe,f(st.el),Ue(st),b,M,$),ee.el=Xe.el,be===null&&Hm(b,Xe.el),le&&xt(le,M),(qe=ee.props&&ee.props.onVnodeUpdated)&&xt(()=>Kt(qe,ye,ee,_e),M)}else{let ee;const{el:ne,props:le}=_,{bm:ye,m:_e,parent:be,root:qe,type:Xe}=b,st=zi(_);js(b,!1),ye&&Hr(ye),!st&&(ee=le&&le.onVnodeBeforeMount)&&Kt(ee,be,_),js(b,!0);{qe.ce&&qe.ce._def.shadowRoot!==!1&&qe.ce._injectChildStyle(Xe);const Gt=b.subTree=sc(b);m(null,Gt,F,V,b,M,$),_.el=Gt.el}if(_e&&xt(_e,M),!st&&(ee=le&&le.onVnodeMounted)){const Gt=_;xt(()=>Kt(ee,be,Gt),M)}(_.shapeFlag&256||be&&zi(be.vnode)&&be.vnode.shapeFlag&256)&&b.a&&xt(b.a,M),b.isMounted=!0,_=F=V=null}};b.scope.on();const K=b.effect=new Of(X);b.scope.off();const B=b.update=K.run.bind(K),re=b.job=K.runIfDirty.bind(K);re.i=b,re.id=b.uid,K.scheduler=()=>Zo(re),js(b,!0),B()},Y=(b,_,F)=>{_.component=b;const V=b.vnode.props;b.vnode=_,b.next=null,Wm(b,_.props,V,F),Xm(b,_.children,F),ys(),zl(b),vs()},G=(b,_,F,V,M,$,q,X,K=!1)=>{const B=b&&b.children,re=b?b.shapeFlag:0,ee=_.children,{patchFlag:ne,shapeFlag:le}=_;if(ne>0){if(ne&128){oe(B,ee,F,V,M,$,q,X,K);return}else if(ne&256){te(B,ee,F,V,M,$,q,X,K);return}}le&8?(re&16&&me(B,M,$),ee!==B&&u(F,ee)):re&16?le&16?oe(B,ee,F,V,M,$,q,X,K):me(B,M,$,!0):(re&8&&u(F,""),le&16&&w(ee,F,V,M,$,q,X,K))},te=(b,_,F,V,M,$,q,X,K)=>{b=b||xi,_=_||xi;const B=b.length,re=_.length,ee=Math.min(B,re);let ne;for(ne=0;ne<ee;ne++){const le=_[ne]=K?ws(_[ne]):qt(_[ne]);m(b[ne],le,F,null,M,$,q,X,K)}B>re?me(b,M,$,!0,!1,ee):w(_,F,V,M,$,q,X,K,ee)},oe=(b,_,F,V,M,$,q,X,K)=>{let B=0;const re=_.length;let ee=b.length-1,ne=re-1;for(;B<=ee&&B<=ne;){const le=b[B],ye=_[B]=K?ws(_[B]):qt(_[B]);if(Zs(le,ye))m(le,ye,F,null,M,$,q,X,K);else break;B++}for(;B<=ee&&B<=ne;){const le=b[ee],ye=_[ne]=K?ws(_[ne]):qt(_[ne]);if(Zs(le,ye))m(le,ye,F,null,M,$,q,X,K);else break;ee--,ne--}if(B>ee){if(B<=ne){const le=ne+1,ye=le<re?_[le].el:V;for(;B<=ne;)m(null,_[B]=K?ws(_[B]):qt(_[B]),F,ye,M,$,q,X,K),B++}}else if(B>ne)for(;B<=ee;)j(b[B],M,$,!0),B++;else{const le=B,ye=B,_e=new Map;for(B=ye;B<=ne;B++){const vt=_[B]=K?ws(_[B]):qt(_[B]);vt.key!=null&&_e.set(vt.key,B)}let be,qe=0;const Xe=ne-ye+1;let st=!1,Gt=0;const Oi=new Array(Xe);for(B=0;B<Xe;B++)Oi[B]=0;for(B=le;B<=ee;B++){const vt=b[B];if(qe>=Xe){j(vt,M,$,!0);continue}let Vt;if(vt.key!=null)Vt=_e.get(vt.key);else for(be=ye;be<=ne;be++)if(Oi[be-ye]===0&&Zs(vt,_[be])){Vt=be;break}Vt===void 0?j(vt,M,$,!0):(Oi[Vt-ye]=B+1,Vt>=Gt?Gt=Vt:st=!0,m(vt,_[Vt],F,null,M,$,q,X,K),qe++)}const Vl=st?ep(Oi):xi;for(be=Vl.length-1,B=Xe-1;B>=0;B--){const vt=ye+B,Vt=_[vt],Kl=_[vt+1],Hl=vt+1<re?Kl.el||Id(Kl):V;Oi[B]===0?m(null,Vt,F,Hl,M,$,q,X,K):st&&(be<0||B!==Vl[be]?z(Vt,F,Hl,2):be--)}}},z=(b,_,F,V,M=null)=>{const{el:$,type:q,transition:X,children:K,shapeFlag:B}=b;if(B&6){z(b.component.subTree,_,F,V);return}if(B&128){b.suspense.move(_,F,V);return}if(B&64){q.move(b,_,F,tt);return}if(q===dt){s($,_,F);for(let ee=0;ee<K.length;ee++)z(K[ee],_,F,V);s(b.anchor,_,F);return}if(q===Yr){x(b,_,F);return}if(V!==2&&B&1&&X)if(V===0)X.beforeEnter($),s($,_,F),xt(()=>X.enter($),M);else{const{leave:ee,delayLeave:ne,afterLeave:le}=X,ye=()=>{b.ctx.isUnmounted?r($):s($,_,F)},_e=()=>{$._isLeaving&&$[ds](!0),ee($,()=>{ye(),le&&le()})};ne?ne($,ye,_e):_e()}else s($,_,F)},j=(b,_,F,V=!1,M=!1)=>{const{type:$,props:q,ref:X,children:K,dynamicChildren:B,shapeFlag:re,patchFlag:ee,dirs:ne,cacheIndex:le}=b;if(ee===-2&&(M=!1),X!=null&&(ys(),Yi(X,null,F,b,!0),vs()),le!=null&&(_.renderCache[le]=void 0),re&256){_.ctx.deactivate(b);return}const ye=re&1&&ne,_e=!zi(b);let be;if(_e&&(be=q&&q.onVnodeBeforeUnmount)&&Kt(be,_,b),re&6)ge(b.component,F,V);else{if(re&128){b.suspense.unmount(F,V);return}ye&&Hs(b,null,_,"beforeUnmount"),re&64?b.type.remove(b,_,F,tt,V):B&&!B.hasOnce&&($!==dt||ee>0&&ee&64)?me(B,_,F,!1,!0):($===dt&&ee&384||!M&&re&16)&&me(K,_,F),V&&he(b)}(_e&&(be=q&&q.onVnodeUnmounted)||ye)&&xt(()=>{be&&Kt(be,_,b),ye&&Hs(b,null,_,"unmounted")},F)},he=b=>{const{type:_,el:F,anchor:V,transition:M}=b;if(_===dt){Se(F,V);return}if(_===Yr){T(b);return}const $=()=>{r(F),M&&!M.persisted&&M.afterLeave&&M.afterLeave()};if(b.shapeFlag&1&&M&&!M.persisted){const{leave:q,delayLeave:X}=M,K=()=>q(F,$);X?X(b.el,$,K):K()}else $()},Se=(b,_)=>{let F;for(;b!==_;)F=d(b),r(b),b=F;r(_)},ge=(b,_,F)=>{const{bum:V,scope:M,job:$,subTree:q,um:X,m:K,a:B}=b;nc(K),nc(B),V&&Hr(V),M.stop(),$&&($.flags|=8,j(q,b,_,F)),X&&xt(X,_),xt(()=>{b.isUnmounted=!0},_)},me=(b,_,F,V=!1,M=!1,$=0)=>{for(let q=$;q<b.length;q++)j(b[q],_,F,V,M)},Ue=b=>{if(b.shapeFlag&6)return Ue(b.component.subTree);if(b.shapeFlag&128)return b.suspense.next();const _=d(b.anchor||b.el),F=_&&_[dm];return F?d(F):_};let Ge=!1;const lt=(b,_,F)=>{let V;b==null?_._vnode&&(j(_._vnode,null,null,!0),V=_._vnode.component):m(_._vnode||null,b,_,null,null,null,F),_._vnode=b,Ge||(Ge=!0,zl(V),Qf(),Ge=!1)},tt={p:m,um:j,m:z,r:he,mt:Q,mc:w,pc:G,pbc:I,n:Ue,o:i};return{render:lt,hydrate:void 0,createApp:Nm(lt)}}function oa({type:i,props:e},t){return t==="svg"&&i==="foreignObject"||t==="mathml"&&i==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:t}function js({effect:i,job:e},t){t?(i.flags|=32,e.flags|=4):(i.flags&=-33,e.flags&=-5)}function Jm(i,e){return(!i||i&&!i.pendingBranch)&&e&&!e.persisted}function bd(i,e,t=!1){const s=i.children,r=e.children;if(ue(s)&&ue(r))for(let n=0;n<s.length;n++){const a=s[n];let o=r[n];o.shapeFlag&1&&!o.dynamicChildren&&((o.patchFlag<=0||o.patchFlag===32)&&(o=r[n]=ws(r[n]),o.el=a.el),!t&&o.patchFlag!==-2&&bd(a,o)),o.type===Hn&&(o.patchFlag!==-1?o.el=a.el:o.__elIndex=n+(i.type===dt?1:0)),o.type===ht&&!o.el&&(o.el=a.el)}}function ep(i){const e=i.slice(),t=[0];let s,r,n,a,o;const l=i.length;for(s=0;s<l;s++){const c=i[s];if(c!==0){if(r=t[t.length-1],i[r]<c){e[s]=r,t.push(s);continue}for(n=0,a=t.length-1;n<a;)o=n+a>>1,i[t[o]]<c?n=o+1:a=o;c<i[t[n]]&&(n>0&&(e[s]=t[n-1]),t[n]=s)}}for(n=t.length,a=t[n-1];n-- >0;)t[n]=a,a=e[a];return t}function Ad(i){const e=i.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:Ad(e)}function nc(i){if(i)for(let e=0;e<i.length;e++)i[e].flags|=8}function Id(i){if(i.placeholder)return i.placeholder;const e=i.component;return e?Id(e.subTree):null}const Ld=i=>i.__isSuspense;function tp(i,e){e&&e.pendingBranch?ue(i)?e.effects.push(...i):e.effects.push(i):om(i)}const dt=Symbol.for("v-fgt"),Hn=Symbol.for("v-txt"),ht=Symbol.for("v-cmt"),Yr=Symbol.for("v-stc"),Xi=[];let Lt=null;function Te(i=!1){Xi.push(Lt=i?null:[])}function sp(){Xi.pop(),Lt=Xi[Xi.length-1]||null}let ar=1;function gn(i,e=!1){ar+=i,i<0&&Lt&&e&&(Lt.hasOnce=!0)}function _d(i){return i.dynamicChildren=ar>0?Lt||xi:null,sp(),ar>0&&Lt&&Lt.push(i),i}function Ie(i,e,t,s,r,n){return _d(R(i,e,t,s,r,n,!0))}function il(i,e,t,s,r){return _d(xe(i,e,t,s,r,!0))}function mn(i){return i?i.__v_isVNode===!0:!1}function Zs(i,e){return i.type===e.type&&i.key===e.key}const Rd=({key:i})=>i??null,zr=({ref:i,ref_key:e,ref_for:t})=>(typeof i=="number"&&(i=""+i),i!=null?Ke(i)||ot(i)||de(i)?{i:It,r:i,k:e,f:!!t}:i:null);function R(i,e=null,t=null,s=0,r=null,n=i===dt?0:1,a=!1,o=!1){const l={__v_isVNode:!0,__v_skip:!0,type:i,props:e,key:e&&Rd(e),ref:e&&zr(e),scopeId:Jf,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:n,patchFlag:s,dynamicProps:r,dynamicChildren:null,appContext:null,ctx:It};return o?(rl(l,t),n&128&&i.normalize(l)):t&&(l.shapeFlag|=Ke(t)?8:16),ar>0&&!a&&Lt&&(l.patchFlag>0||n&6)&&l.patchFlag!==32&&Lt.push(l),l}const xe=ip;function ip(i,e=null,t=null,s=0,r=null,n=!1){if((!i||i===Rm)&&(i=ht),mn(i)){const o=Ns(i,e,!0);return t&&rl(o,t),ar>0&&!n&&Lt&&(o.shapeFlag&6?Lt[Lt.indexOf(i)]=o:Lt.push(o)),o.patchFlag=-2,o}if(mp(i)&&(i=i.__vccOpts),e){e=rp(e);let{class:o,style:l}=e;o&&!Ke(o)&&(e.class=bt(o)),Me(l)&&(Qo(l)&&!ue(l)&&(l=ze({},l)),e.style=yr(l))}const a=Ke(i)?1:Ld(i)?128:sd(i)?64:Me(i)?4:de(i)?2:0;return R(i,e,t,s,r,a,n,!0)}function rp(i){return i?Qo(i)||yd(i)?ze({},i):i:null}function Ns(i,e,t=!1,s=!1){const{props:r,ref:n,patchFlag:a,children:o,transition:l}=i,c=e?ap(r||{},e):r,u={__v_isVNode:!0,__v_skip:!0,type:i.type,props:c,key:c&&Rd(c),ref:e&&e.ref?t&&n?ue(n)?n.concat(zr(e)):[n,zr(e)]:zr(e):n,scopeId:i.scopeId,slotScopeIds:i.slotScopeIds,children:o,target:i.target,targetStart:i.targetStart,targetAnchor:i.targetAnchor,staticCount:i.staticCount,shapeFlag:i.shapeFlag,patchFlag:e&&i.type!==dt?a===-1?16:a|16:a,dynamicProps:i.dynamicProps,dynamicChildren:i.dynamicChildren,appContext:i.appContext,dirs:i.dirs,transition:l,component:i.component,suspense:i.suspense,ssContent:i.ssContent&&Ns(i.ssContent),ssFallback:i.ssFallback&&Ns(i.ssFallback),placeholder:i.placeholder,el:i.el,anchor:i.anchor,ctx:i.ctx,ce:i.ce};return l&&s&&nr(u,l.clone(u)),u}function it(i=" ",e=0){return xe(Hn,null,i,e)}function np(i,e){const t=xe(Yr,null,i);return t.staticCount=e,t}function ut(i="",e=!1){return e?(Te(),il(ht,null,i)):xe(ht,null,i)}function qt(i){return i==null||typeof i=="boolean"?xe(ht):ue(i)?xe(dt,null,i.slice()):mn(i)?ws(i):xe(Hn,null,String(i))}function ws(i){return i.el===null&&i.patchFlag!==-1||i.memo?i:Ns(i)}function rl(i,e){let t=0;const{shapeFlag:s}=i;if(e==null)e=null;else if(ue(e))t=16;else if(typeof e=="object")if(s&65){const r=e.default;r&&(r._c&&(r._d=!1),rl(i,r()),r._c&&(r._d=!0));return}else{t=32;const r=e._;!r&&!yd(e)?e._ctx=It:r===3&&It&&(It.slots._===1?e._=1:(e._=2,i.patchFlag|=1024))}else de(e)?(e={default:e,_ctx:It},t=32):(e=String(e),s&64?(t=16,e=[it(e)]):t=8);i.children=e,i.shapeFlag|=t}function ap(...i){const e={};for(let t=0;t<i.length;t++){const s=i[t];for(const r in s)if(r==="class")e.class!==s.class&&(e.class=bt([e.class,s.class]));else if(r==="style")e.style=yr([e.style,s.style]);else if(Pn(r)){const n=e[r],a=s[r];a&&n!==a&&!(ue(n)&&n.includes(a))&&(e[r]=n?[].concat(n,a):a)}else r!==""&&(e[r]=s[r])}return e}function Kt(i,e,t,s=null){Bt(i,e,7,[t,s])}const op=hd();let lp=0;function cp(i,e,t){const s=i.type,r=(e?e.appContext:i.appContext)||op,n={uid:lp++,vnode:i,type:s,parent:e,appContext:r,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new Cg(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(r.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Ed(s,r),emitsOptions:gd(s,r),emit:null,emitted:null,propsDefaults:De,inheritAttrs:s.inheritAttrs,ctx:De,data:De,props:De,attrs:De,slots:De,refs:De,setupState:De,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return n.ctx={_:n},n.root=e?e.root:n,n.emit=Bm.bind(null,n),i.ce&&i.ce(n),n}let at=null;const Cd=()=>at||It;let pn,to;{const i=Nn(),e=(t,s)=>{let r;return(r=i[t])||(r=i[t]=[]),r.push(s),n=>{r.length>1?r.forEach(a=>a(n)):r[0](n)}};pn=e("__VUE_INSTANCE_SETTERS__",t=>at=t),to=e("__VUE_SSR_SETTERS__",t=>or=t)}const Er=i=>{const e=at;return pn(i),i.scope.on(),()=>{i.scope.off(),pn(e)}},ac=()=>{at&&at.scope.off(),pn(null)};function wd(i){return i.vnode.shapeFlag&4}let or=!1;function up(i,e=!1,t=!1){e&&to(e);const{props:s,children:r}=i.vnode,n=wd(i);jm(i,s,n,e),qm(i,r,t||e);const a=n?fp(i,e):void 0;return e&&to(!1),a}function fp(i,e){const t=i.type;i.accessCache=Object.create(null),i.proxy=new Proxy(i.ctx,wm);const{setup:s}=t;if(s){ys();const r=i.setupContext=s.length>1?hp(i):null,n=Er(i),a=vr(s,i,0,[i.props,r]),o=_f(a);if(vs(),n(),(o||i.sp)&&!zi(i)&&ld(i),o){if(a.then(ac,ac),e)return a.then(l=>{oc(i,l)}).catch(l=>{Bn(l,i,0)});i.asyncDep=a}else oc(i,a)}else Dd(i)}function oc(i,e,t){de(e)?i.type.__ssrInlineRender?i.ssrRender=e:i.render=e:Me(e)&&(i.setupState=zf(e)),Dd(i)}function Dd(i,e,t){const s=i.type;i.render||(i.render=s.render||es);{const r=Er(i);ys();try{Dm(i)}finally{vs(),r()}}}const dp={get(i,e){return nt(i,"get",""),i[e]}};function hp(i){const e=t=>{i.exposed=t||{}};return{attrs:new Proxy(i.attrs,dp),slots:i.slots,emit:i.emit,expose:e}}function jn(i){return i.exposed?i.exposeProxy||(i.exposeProxy=new Proxy(zf(Xg(i.exposed)),{get(e,t){if(t in e)return e[t];if(t in qi)return qi[t](i)},has(e,t){return t in e||t in qi}})):i.proxy}function gp(i,e=!0){return de(i)?i.displayName||i.name:i.name||e&&i.__name}function mp(i){return de(i)&&"__vccOpts"in i}const Ds=(i,e)=>tm(i,e,or);function kd(i,e,t){try{gn(-1);const s=arguments.length;return s===2?Me(e)&&!ue(e)?mn(e)?xe(i,null,[e]):xe(i,e):xe(i,null,e):(s>3?t=Array.prototype.slice.call(arguments,2):s===3&&mn(t)&&(t=[t]),xe(i,e,t))}finally{gn(1)}}const pp="3.5.26";let so;const lc=typeof window<"u"&&window.trustedTypes;if(lc)try{so=lc.createPolicy("vue",{createHTML:i=>i})}catch{}const Pd=so?i=>so.createHTML(i):i=>i,yp="http://www.w3.org/2000/svg",vp="http://www.w3.org/1998/Math/MathML",os=typeof document<"u"?document:null,cc=os&&os.createElement("template"),Ep={insert:(i,e,t)=>{e.insertBefore(i,t||null)},remove:i=>{const e=i.parentNode;e&&e.removeChild(i)},createElement:(i,e,t,s)=>{const r=e==="svg"?os.createElementNS(yp,i):e==="mathml"?os.createElementNS(vp,i):t?os.createElement(i,{is:t}):os.createElement(i);return i==="select"&&s&&s.multiple!=null&&r.setAttribute("multiple",s.multiple),r},createText:i=>os.createTextNode(i),createComment:i=>os.createComment(i),setText:(i,e)=>{i.nodeValue=e},setElementText:(i,e)=>{i.textContent=e},parentNode:i=>i.parentNode,nextSibling:i=>i.nextSibling,querySelector:i=>os.querySelector(i),setScopeId(i,e){i.setAttribute(e,"")},insertStaticContent(i,e,t,s,r,n){const a=t?t.previousSibling:e.lastChild;if(r&&(r===n||r.nextSibling))for(;e.insertBefore(r.cloneNode(!0),t),!(r===n||!(r=r.nextSibling)););else{cc.innerHTML=Pd(s==="svg"?`<svg>${i}</svg>`:s==="mathml"?`<math>${i}</math>`:i);const o=cc.content;if(s==="svg"||s==="mathml"){const l=o.firstChild;for(;l.firstChild;)o.appendChild(l.firstChild);o.removeChild(l)}e.insertBefore(o,t)}return[a?a.nextSibling:e.firstChild,t?t.previousSibling:e.lastChild]}},Is="transition",Fi="animation",lr=Symbol("_vtc"),Od={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},xp=ze({},id,Od),Tp=i=>(i.displayName="Transition",i.props=xp,i),ks=Tp((i,{slots:e})=>kd(mm,Sp(i),e)),Ws=(i,e=[])=>{ue(i)?i.forEach(t=>t(...e)):i&&i(...e)},uc=i=>i?ue(i)?i.some(e=>e.length>1):i.length>1:!1;function Sp(i){const e={};for(const P in i)P in Od||(e[P]=i[P]);if(i.css===!1)return e;const{name:t="v",type:s,duration:r,enterFromClass:n=`${t}-enter-from`,enterActiveClass:a=`${t}-enter-active`,enterToClass:o=`${t}-enter-to`,appearFromClass:l=n,appearActiveClass:c=a,appearToClass:u=o,leaveFromClass:f=`${t}-leave-from`,leaveActiveClass:d=`${t}-leave-active`,leaveToClass:h=`${t}-leave-to`}=i,g=bp(r),m=g&&g[0],p=g&&g[1],{onBeforeEnter:v,onEnter:E,onEnterCancelled:x,onLeave:T,onLeaveCancelled:S,onBeforeAppear:C=v,onAppear:A=E,onAppearCancelled:w=x}=e,L=(P,H,Q,Z)=>{P._enterCancelled=Z,Ys(P,H?u:o),Ys(P,H?c:a),Q&&Q()},I=(P,H)=>{P._isLeaving=!1,Ys(P,f),Ys(P,h),Ys(P,d),H&&H()},O=P=>(H,Q)=>{const Z=P?A:E,U=()=>L(H,P,Q);Ws(Z,[H,U]),fc(()=>{Ys(H,P?l:n),rs(H,P?u:o),uc(Z)||dc(H,s,m,U)})};return ze(e,{onBeforeEnter(P){Ws(v,[P]),rs(P,n),rs(P,a)},onBeforeAppear(P){Ws(C,[P]),rs(P,l),rs(P,c)},onEnter:O(!1),onAppear:O(!0),onLeave(P,H){P._isLeaving=!0;const Q=()=>I(P,H);rs(P,f),P._enterCancelled?(rs(P,d),mc(P)):(mc(P),rs(P,d)),fc(()=>{P._isLeaving&&(Ys(P,f),rs(P,h),uc(T)||dc(P,s,p,Q))}),Ws(T,[P,Q])},onEnterCancelled(P){L(P,!1,void 0,!0),Ws(x,[P])},onAppearCancelled(P){L(P,!0,void 0,!0),Ws(w,[P])},onLeaveCancelled(P){I(P),Ws(S,[P])}})}function bp(i){if(i==null)return null;if(Me(i))return[la(i.enter),la(i.leave)];{const e=la(i);return[e,e]}}function la(i){return Sg(i)}function rs(i,e){e.split(/\s+/).forEach(t=>t&&i.classList.add(t)),(i[lr]||(i[lr]=new Set)).add(e)}function Ys(i,e){e.split(/\s+/).forEach(s=>s&&i.classList.remove(s));const t=i[lr];t&&(t.delete(e),t.size||(i[lr]=void 0))}function fc(i){requestAnimationFrame(()=>{requestAnimationFrame(i)})}let Ap=0;function dc(i,e,t,s){const r=i._endId=++Ap,n=()=>{r===i._endId&&s()};if(t!=null)return setTimeout(n,t);const{type:a,timeout:o,propCount:l}=Ip(i,e);if(!a)return s();const c=a+"end";let u=0;const f=()=>{i.removeEventListener(c,d),n()},d=h=>{h.target===i&&++u>=l&&f()};setTimeout(()=>{u<l&&f()},o+1),i.addEventListener(c,d)}function Ip(i,e){const t=window.getComputedStyle(i),s=g=>(t[g]||"").split(", "),r=s(`${Is}Delay`),n=s(`${Is}Duration`),a=hc(r,n),o=s(`${Fi}Delay`),l=s(`${Fi}Duration`),c=hc(o,l);let u=null,f=0,d=0;e===Is?a>0&&(u=Is,f=a,d=n.length):e===Fi?c>0&&(u=Fi,f=c,d=l.length):(f=Math.max(a,c),u=f>0?a>c?Is:Fi:null,d=u?u===Is?n.length:l.length:0);const h=u===Is&&/\b(?:transform|all)(?:,|$)/.test(s(`${Is}Property`).toString());return{type:u,timeout:f,propCount:d,hasTransform:h}}function hc(i,e){for(;i.length<e.length;)i=i.concat(i);return Math.max(...e.map((t,s)=>gc(t)+gc(i[s])))}function gc(i){return i==="auto"?0:Number(i.slice(0,-1).replace(",","."))*1e3}function mc(i){return(i?i.ownerDocument:document).body.offsetHeight}function Lp(i,e,t){const s=i[lr];s&&(e=(e?[e,...s]:[...s]).join(" ")),e==null?i.removeAttribute("class"):t?i.setAttribute("class",e):i.className=e}const yn=Symbol("_vod"),Md=Symbol("_vsh"),Fd={name:"show",beforeMount(i,{value:e},{transition:t}){i[yn]=i.style.display==="none"?"":i.style.display,t&&e?t.beforeEnter(i):Ni(i,e)},mounted(i,{value:e},{transition:t}){t&&e&&t.enter(i)},updated(i,{value:e,oldValue:t},{transition:s}){!e!=!t&&(s?e?(s.beforeEnter(i),Ni(i,!0),s.enter(i)):s.leave(i,()=>{Ni(i,!1)}):Ni(i,e))},beforeUnmount(i,{value:e}){Ni(i,e)}};function Ni(i,e){i.style.display=e?i[yn]:"none",i[Md]=!e}const _p=Symbol(""),Rp=/(?:^|;)\s*display\s*:/;function Cp(i,e,t){const s=i.style,r=Ke(t);let n=!1;if(t&&!r){if(e)if(Ke(e))for(const a of e.split(";")){const o=a.slice(0,a.indexOf(":")).trim();t[o]==null&&qr(s,o,"")}else for(const a in e)t[a]==null&&qr(s,a,"");for(const a in t)a==="display"&&(n=!0),qr(s,a,t[a])}else if(r){if(e!==t){const a=s[_p];a&&(t+=";"+a),s.cssText=t,n=Rp.test(t)}}else e&&i.removeAttribute("style");yn in i&&(i[yn]=n?s.display:"",i[Md]&&(s.display="none"))}const pc=/\s*!important$/;function qr(i,e,t){if(ue(t))t.forEach(s=>qr(i,e,s));else if(t==null&&(t=""),e.startsWith("--"))i.setProperty(e,t);else{const s=wp(i,e);pc.test(t)?i.setProperty(ai(s),t.replace(pc,""),"important"):i[s]=t}}const yc=["Webkit","Moz","ms"],ca={};function wp(i,e){const t=ca[e];if(t)return t;let s=Dt(e);if(s!=="filter"&&s in i)return ca[e]=s;s=Fn(s);for(let r=0;r<yc.length;r++){const n=yc[r]+s;if(n in i)return ca[e]=n}return e}const vc="http://www.w3.org/1999/xlink";function Ec(i,e,t,s,r,n=Rg(e)){s&&e.startsWith("xlink:")?t==null?i.removeAttributeNS(vc,e.slice(6,e.length)):i.setAttributeNS(vc,e,t):t==null||n&&!Df(t)?i.removeAttribute(e):i.setAttribute(e,n?"":Ks(t)?String(t):t)}function xc(i,e,t,s,r){if(e==="innerHTML"||e==="textContent"){t!=null&&(i[e]=e==="innerHTML"?Pd(t):t);return}const n=i.tagName;if(e==="value"&&n!=="PROGRESS"&&!n.includes("-")){const o=n==="OPTION"?i.getAttribute("value")||"":i.value,l=t==null?i.type==="checkbox"?"on":"":String(t);(o!==l||!("_value"in i))&&(i.value=l),t==null&&i.removeAttribute(e),i._value=t;return}let a=!1;if(t===""||t==null){const o=typeof i[e];o==="boolean"?t=Df(t):t==null&&o==="string"?(t="",a=!0):o==="number"&&(t=0,a=!0)}try{i[e]=t}catch{}a&&i.removeAttribute(r||e)}function pi(i,e,t,s){i.addEventListener(e,t,s)}function Dp(i,e,t,s){i.removeEventListener(e,t,s)}const Tc=Symbol("_vei");function kp(i,e,t,s,r=null){const n=i[Tc]||(i[Tc]={}),a=n[e];if(s&&a)a.value=s;else{const[o,l]=Pp(e);if(s){const c=n[e]=Fp(s,r);pi(i,o,c,l)}else a&&(Dp(i,o,a,l),n[e]=void 0)}}const Sc=/(?:Once|Passive|Capture)$/;function Pp(i){let e;if(Sc.test(i)){e={};let s;for(;s=i.match(Sc);)i=i.slice(0,i.length-s[0].length),e[s[0].toLowerCase()]=!0}return[i[2]===":"?i.slice(3):ai(i.slice(2)),e]}let ua=0;const Op=Promise.resolve(),Mp=()=>ua||(Op.then(()=>ua=0),ua=Date.now());function Fp(i,e){const t=s=>{if(!s._vts)s._vts=Date.now();else if(s._vts<=t.attached)return;Bt(Np(s,t.value),e,5,[s])};return t.value=i,t.attached=Mp(),t}function Np(i,e){if(ue(e)){const t=i.stopImmediatePropagation;return i.stopImmediatePropagation=()=>{t.call(i),i._stopped=!0},e.map(s=>r=>!r._stopped&&s&&s(r))}else return e}const bc=i=>i.charCodeAt(0)===111&&i.charCodeAt(1)===110&&i.charCodeAt(2)>96&&i.charCodeAt(2)<123,$p=(i,e,t,s,r,n)=>{const a=r==="svg";e==="class"?Lp(i,s,a):e==="style"?Cp(i,t,s):Pn(e)?Uo(e)||kp(i,e,t,s,n):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):Bp(i,e,s,a))?(xc(i,e,s),!i.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&Ec(i,e,s,a,n,e!=="value")):i._isVueCE&&(/[A-Z]/.test(e)||!Ke(s))?xc(i,Dt(e),s,n,e):(e==="true-value"?i._trueValue=s:e==="false-value"&&(i._falseValue=s),Ec(i,e,s,a))};function Bp(i,e,t,s){if(s)return!!(e==="innerHTML"||e==="textContent"||e in i&&bc(e)&&de(t));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="autocorrect"||e==="sandbox"&&i.tagName==="IFRAME"||e==="form"||e==="list"&&i.tagName==="INPUT"||e==="type"&&i.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const r=i.tagName;if(r==="IMG"||r==="VIDEO"||r==="CANVAS"||r==="SOURCE")return!1}return bc(e)&&Ke(t)?!1:e in i}const Ac=i=>{const e=i.props["onUpdate:modelValue"]||!1;return ue(e)?t=>Hr(e,t):e};function Up(i){i.target.composing=!0}function Ic(i){const e=i.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const fa=Symbol("_assign");function Lc(i,e,t){return e&&(i=i.trim()),t&&(i=Ko(i)),i}const _c={created(i,{modifiers:{lazy:e,trim:t,number:s}},r){i[fa]=Ac(r);const n=s||r.props&&r.props.type==="number";pi(i,e?"change":"input",a=>{a.target.composing||i[fa](Lc(i.value,t,n))}),(t||n)&&pi(i,"change",()=>{i.value=Lc(i.value,t,n)}),e||(pi(i,"compositionstart",Up),pi(i,"compositionend",Ic),pi(i,"change",Ic))},mounted(i,{value:e}){i.value=e??""},beforeUpdate(i,{value:e,oldValue:t,modifiers:{lazy:s,trim:r,number:n}},a){if(i[fa]=Ac(a),i.composing)return;const o=(n||i.type==="number")&&!/^0\d/.test(i.value)?Ko(i.value):i.value,l=e??"";o!==l&&(document.activeElement===i&&i.type!=="range"&&(s&&e===t||r&&i.value.trim()===l)||(i.value=l))}},Gp=["ctrl","shift","alt","meta"],Vp={stop:i=>i.stopPropagation(),prevent:i=>i.preventDefault(),self:i=>i.target!==i.currentTarget,ctrl:i=>!i.ctrlKey,shift:i=>!i.shiftKey,alt:i=>!i.altKey,meta:i=>!i.metaKey,left:i=>"button"in i&&i.button!==0,middle:i=>"button"in i&&i.button!==1,right:i=>"button"in i&&i.button!==2,exact:(i,e)=>Gp.some(t=>i[`${t}Key`]&&!e.includes(t))},Kp=(i,e)=>{const t=i._withMods||(i._withMods={}),s=e.join(".");return t[s]||(t[s]=((r,...n)=>{for(let a=0;a<e.length;a++){const o=Vp[e[a]];if(o&&o(r,e))return}return i(r,...n)}))},Hp=ze({patchProp:$p},Ep);let Rc;function jp(){return Rc||(Rc=Qm(Hp))}const Wp=((...i)=>{const e=jp().createApp(...i),{mount:t}=e;return e.mount=s=>{const r=zp(s);if(!r)return;const n=e._component;!de(n)&&!n.render&&!n.template&&(n.template=r.innerHTML),r.nodeType===1&&(r.textContent="");const a=t(r,!1,Yp(r));return r instanceof Element&&(r.removeAttribute("v-cloak"),r.setAttribute("data-v-app","")),a},e});function Yp(i){if(i instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&i instanceof MathMLElement)return"mathml"}function zp(i){return Ke(i)?document.querySelector(i):i}const qp=["fill"],Xp=["fill"],li={__name:"LeafIcon",props:{color:{type:String,default:"currentColor"},size:{type:String,default:"w-3.5 h-4.5"},rotate:{type:String,default:"rotate-[15deg]"}},setup(i){return(e,t)=>(Te(),Ie("svg",{class:bt([i.size,i.rotate]),viewBox:"0 0 5 7",xmlns:"http://www.w3.org/2000/svg"},[R("path",{d:"M4.85 2.41003C4.53 3.81003 3.78 4.59003 2.61 4.75003V6.13003C2.49 6.19003 2.36 6.26003 2.24 6.33003V4.75003C1.07 4.59003 0.32 3.81003 0 2.41003C1.42 2.73003 2.21 3.49003 2.36 4.68003H2.49C2.65 3.48003 3.43 2.73003 4.85 2.41003Z",fill:i.color},null,8,qp),R("path",{d:"M2.42987 0C1.62987 1.26 1.62987 2.37 2.41987 3.34C3.20987 2.37 3.21987 1.26 2.42987 0Z",fill:i.color},null,8,Xp)],2))}},Qp="/assets/pattern-bg1-BiuzruOX.webp",da="/assets/fg%20logo-white1-65DDT0pQ.png",Ui="/assets/fg%20logo-white2-v7LMqUsm.png",nl=(i,e)=>{const t=i.__vccOpts||i;for(const[s,r]of e)t[s]=r;return t},Zp={class:"relative w-full"},Jp={class:"flex items-start justify-between w-full mb-4 sm:hidden"},e1={key:0,class:"flex items-center h-[50px]"},t1={href:"/"},s1=["src"],i1={key:1,class:"flex items-start h-[50px]"},r1={href:"/marketplace.html",class:"flex group relative overflow-hidden px-3 py-1.5 backdrop-blur-md bg-[rgba(253,250,250,0.26)] rounded-4xl items-center cursor-pointer"},n1={class:"flex items-center gap-2 transition-transform duration-300 transform translate-y-0 group-hover:-translate-y-full"},a1={class:"absolute inset-0 flex items-center justify-center w-full h-full gap-2 text-black transition-transform duration-300 transform translate-y-full bg-yellow-400 group-hover:translate-y-0"},o1={class:"flex items-center gap-3"},l1={key:0,class:"relative flex items-center"},c1={key:0,class:"fixed flex items-center px-4 py-3 border shadow-2xl left-4 right-4 top-32 bg-white/20 backdrop-blur-xl rounded-2xl border-white/30 focus-within:ring-2 focus-within:ring-yellow-400 sm:hidden"},u1={key:0,class:"fixed overflow-hidden border shadow-2xl left-4 right-4 top-48 bg-white/25 backdrop-blur-2xl rounded-2xl border-white/30 sm:hidden"},f1=["onClick"],d1={key:0,class:"px-6 py-4 text-sm text-white/80"},h1={key:1,href:"/marketplace.html",class:"flex group relative overflow-hidden px-3 py-1.5 backdrop-blur-md bg-[rgba(253,250,250,0.26)] rounded-4xl items-center cursor-pointer"},g1={class:"flex items-center gap-2 transition-transform duration-300 transform translate-y-0 group-hover:-translate-y-full"},m1={class:"absolute inset-0 flex items-center justify-center w-full h-full gap-2 text-black transition-transform duration-300 transform translate-y-full bg-yellow-400 group-hover:translate-y-0"},p1={key:0,href:"/",class:"flex items-center justify-center px-8 py-6 sm:hidden bg-gradient-to-b from-transparent via-white/5 to-transparent"},y1=["src"],v1={href:"/",class:"items-start hidden sm:flex"},E1=["src"],x1={class:"items-start hidden gap-6 sm:flex"},T1={class:"relative flex items-center"},S1={key:0,class:"absolute flex items-center px-4 py-2 mt-1 border shadow-2xl right-12 w-38 sm:w-160 bg-white/20 backdrop-blur-xl rounded-2xl border-white/30 focus-within:ring-2 focus-within:ring-yellow-400 hidden:animate-none sm:animate-pulse"},b1={key:0,class:"absolute mt-40 overflow-hidden border shadow-2xl right-12 w-38 sm:w-160 bg-white/25 backdrop-blur-2xl rounded-2xl border-white/30"},A1=["onClick"],I1={key:0,class:"px-6 py-4 text-sm text-white/80"},L1={href:"/marketplace.html",class:"flex group relative overflow-hidden px-4 py-2 backdrop-blur-md bg-[rgba(253,250,250,0.26)] rounded-4xl items-center cursor-pointer"},_1={class:"flex items-center gap-2 transition-transform duration-300 transform translate-y-0 group-hover:-translate-y-full"},R1={class:"absolute inset-0 flex items-center justify-center w-full h-full gap-2 text-black transition-transform duration-300 transform translate-y-full bg-yellow-400 group-hover:translate-y-0"},C1={class:"relative flex flex-col lg:flex-row lg:justify-between p-12 max-w-[1820px] mx-auto overflow-y-auto h-full space-y-12 lg:space-y-0 pb-24"},w1={class:"absolute top-6 left-6"},D1={href:"/"},k1=["src"],P1={class:"flex-1 mt-20"},O1={class:"space-y-5"},M1={__name:"Header",props:{showMobileLogo:{type:Boolean,default:!0},videoVariant:{type:Number,default:1}},setup(i){const e=Ye(!1),t=()=>e.value=window.scrollY>20;Vn(()=>window.addEventListener("scroll",t)),el(()=>window.removeEventListener("scroll",t));const s=Ye(!1),r=()=>s.value=!s.value;Wi(s,h=>{document.body.style.overflow=h?"hidden":"",h?document.body.classList.add("menu-open"):document.body.classList.remove("menu-open")});const n=Ye({home:!1,about:!1,programs:!1,contact:!1}),a=h=>{n.value[h]=!n.value[h]},o=Ye(!1),l=Ye(""),c=Ye(["Our Story","Our Services","Marketplace","Sustainability","Invest in FarmGate","Our Impact","Projects","Our People","Manifesto"]),u=()=>{o.value=!o.value,o.value||(l.value="")},f=Ds(()=>c.value.filter(h=>h.toLowerCase().includes(l.value.toLowerCase()))),d=h=>{l.value=h,o.value=!1;const g=h.toLowerCase();g.includes("story")?window.location.href="/about.html":g.includes("service")?window.location.href="/solutions.html":g.includes("market")?window.location.href="/marketplace.html":g.includes("impact")?window.location.href="/impact.html":g.includes("projects")?window.location.href="/projects.html":g.includes("people")?window.location.href="/people.html":g.includes("manifesto")&&(window.location.href="/manifesto.html")};return(h,g)=>{const m=ud("font-awesome-icon");return Te(),Ie("div",Zp,[R("div",{class:bt(["fixed top-0 left-0 right-0 z-50 transition-all duration-300",e.value?"py-0 sm:py-2":"py-2",e.value?"bg-[rgb(3,89,37)] shadow-md":"bg-transparent"])},[R("nav",{class:bt(["text-white flex flex-col sm:flex-row sm:justify-between items-center sm:items-start max-w-[1900px] mx-auto font-montserrat px-6 sm:px-8",e.value?"pt-4 pb-0 sm:pb-0":"pt-4 pb-6 sm:pb-0"])},[R("div",Jp,[i.videoVariant===2?(Te(),Ie("div",e1,[R("a",t1,[R("img",{src:e.value?Wt(da):Wt(Ui),alt:"FarmGate Africa Logo",class:bt(["object-contain",e.value?"w-[130px] h-[130px]":"w-[65px] h-[65px]"])},null,10,s1)])])):(Te(),Ie("div",i1,[R("a",r1,[R("span",n1,[xe(li,{class:"w-4 h-4 text-white"}),g[3]||(g[3]=R("span",{class:"text-xs font-semibold leading-none text-white"},"Marketplace",-1))]),R("span",a1,[xe(li,{class:"w-4 h-4 text-black"}),g[4]||(g[4]=R("span",{class:"text-xs font-semibold leading-none"},"Marketplace",-1))])])])),R("div",o1,[i.videoVariant!==2?(Te(),Ie("div",l1,[R("button",{onClick:u,class:"flex items-center justify-center p-2 transition-all rounded-full cursor-pointer bg-white/25 backdrop-blur-md hover:bg-yellow-400 hover:text-black"},[xe(m,{icon:["fas","search"],class:"text-base text-white"})]),xe(ks,{name:"slide"},{default:fs(()=>[o.value?(Te(),Ie("div",c1,[xe(m,{icon:["fas","search"],class:"mr-2 text-sm text-white/90"}),jr(R("input",{"onUpdate:modelValue":g[0]||(g[0]=p=>l.value=p),type:"text",placeholder:"Type to search...",class:"w-full text-sm text-white bg-transparent placeholder-white/70 focus:outline-none"},null,512),[[_c,l.value]]),R("button",{onClick:u,class:"ml-2 text-white/70 hover:text-white"},"  ")])):ut("",!0)]),_:1}),xe(ks,{name:"fade"},{default:fs(()=>[o.value&&l.value?(Te(),Ie("ul",u1,[(Te(!0),Ie(dt,null,dn(f.value,p=>(Te(),Ie("li",{key:p,onClick:v=>d(p),class:"px-6 py-4 text-sm text-white transition-all cursor-pointer hover:bg-yellow-400 hover:text-black"},us(p),9,f1))),128)),f.value.length===0?(Te(),Ie("li",d1," No results ")):ut("",!0)])):ut("",!0)]),_:1})])):ut("",!0),i.videoVariant===2?(Te(),Ie("a",h1,[R("span",g1,[xe(li,{class:"w-4 h-4 text-white"}),g[5]||(g[5]=R("span",{class:"text-xs font-semibold leading-none text-white"},"Marketplace",-1))]),R("span",m1,[xe(li,{class:"w-4 h-4 text-black"}),g[6]||(g[6]=R("span",{class:"text-xs font-semibold leading-none"},"Marketplace",-1))])])):ut("",!0),R("button",{onClick:r,class:"relative w-8 h-8 flex items-center justify-center z-[100] cursor-pointer"},[R("div",{class:bt(["hamburger",{open:s.value}])},[...g[7]||(g[7]=[R("span",null,null,-1),R("span",null,null,-1),R("span",null,null,-1)])],2)])])]),i.showMobileLogo&&i.videoVariant!==2?(Te(),Ie("a",p1,[R("img",{class:"object-contain w-[70px] h-[70px]",src:e.value?Wt(da):Wt(Ui),alt:"FarmGate Africa Logo"},null,8,y1)])):ut("",!0),R("a",v1,[R("img",{class:bt(["object-contain transition-all duration-300",e.value?"w-[100px] md:w-[150px]":"w-[140px] md:w-[160px]"]),src:e.value?Wt(da):Wt(Ui),alt:"Logo"},null,10,E1)]),R("div",x1,[R("div",T1,[R("button",{onClick:u,class:"flex items-center justify-center p-2 transition-all rounded-full cursor-pointer bg-white/25 backdrop-blur-md hover:bg-yellow-400 hover:text-black"},[xe(m,{icon:["fas","search"],class:"text-lg text-white"})]),xe(ks,{name:"slide"},{default:fs(()=>[o.value?(Te(),Ie("div",S1,[xe(m,{icon:["fas","search"],class:"mr-2 text-sm text-white/90"}),jr(R("input",{"onUpdate:modelValue":g[1]||(g[1]=p=>l.value=p),type:"text",placeholder:"Type to search...",class:"w-full text-sm text-white bg-transparent placeholder-white/70 focus:outline-none"},null,512),[[_c,l.value]])])):ut("",!0)]),_:1}),xe(ks,{name:"fade"},{default:fs(()=>[o.value&&l.value?(Te(),Ie("ul",b1,[(Te(!0),Ie(dt,null,dn(f.value,p=>(Te(),Ie("li",{key:p,onClick:v=>d(p),class:"px-6 py-4 text-sm text-white transition-all cursor-pointer hover:bg-yellow-400 hover:text-black"},us(p),9,A1))),128)),f.value.length===0?(Te(),Ie("li",I1," No results ")):ut("",!0)])):ut("",!0)]),_:1})]),R("a",L1,[R("span",_1,[xe(li,{class:"text-white"}),g[8]||(g[8]=R("span",{class:"text-sm font-semibold leading-none text-white"},"Marketplace",-1))]),R("span",R1,[xe(li,{class:"text-black"}),g[9]||(g[9]=R("span",{class:"text-sm font-semibold leading-none"},"Marketplace",-1))])]),R("button",{onClick:r,class:"relative w-8 h-8 flex items-center justify-center z-[100] cursor-pointer"},[R("div",{class:bt(["hamburger",{open:s.value}])},[...g[10]||(g[10]=[R("span",null,null,-1),R("span",null,null,-1),R("span",null,null,-1)])],2)])])],2)],2),xe(ks,{name:"fade"},{default:fs(()=>[s.value?(Te(),Ie("div",{key:0,class:"fixed inset-0 z-50 text-white bg-[#020f28] bg-cover bg-center bg-fixed",style:yr({backgroundImage:`url(${Wt(Qp)})`})},[g[17]||(g[17]=R("div",{class:"absolute inset-0 bg-[rgba(0,0,0,0.65)] backdrop-blur-sm"},null,-1)),R("div",C1,[R("div",w1,[R("a",D1,[R("img",{class:"w-[75px] sm:w-[100px] h-auto",src:Wt(Ui),alt:"Logo"},null,8,k1)])]),g[14]||(g[14]=R("div",{class:"flex-1 mt-20"},[R("h3",{class:"mb-6 text-2xl font-semibold"},"Home"),R("ul",{class:"space-y-5"},[R("li",null,[R("a",{href:"/index.html",class:"relative pb-2 text-xl font-medium group"},[it(" Homepage "),R("span",{class:"absolute left-0 -bottom-0.5 w-0 h-[2px] bg-yellow-400 transition-all duration-300 group-hover:w-full"})])])])],-1)),g[15]||(g[15]=R("div",{class:"flex-1 mt-20"},[R("h3",{class:"mb-6 text-2xl font-semibold"},"About Us"),R("ul",{class:"space-y-5"},[R("li",null,[R("a",{href:"/about.html",class:"relative pb-2 text-xl font-medium group"},[it(" Our Story "),R("span",{class:"absolute left-0 -bottom-0.5 w-0 h-[2px] bg-yellow-400 transition-all duration-300 group-hover:w-full"})])])])],-1)),R("div",P1,[R("h3",{class:"flex items-center mb-6 text-2xl font-semibold cursor-pointer",onClick:g[2]||(g[2]=p=>a("programs"))},[g[12]||(g[12]=it(" Our Initiatives ",-1)),(Te(),Ie("svg",{width:"25",height:"25",viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg",class:bt(["ml-2 transition-transform duration-300",{"rotate-90":n.value.programs}])},[...g[11]||(g[11]=[R("path",{d:"M3 4.5L6 7.5L9 4.5",stroke:"currentColor","stroke-width":"1","stroke-linecap":"round","stroke-linejoin":"round"},null,-1)])],2))]),xe(ks,{name:"slide"},{default:fs(()=>[jr(R("ul",O1,[...g[13]||(g[13]=[R("li",null,[R("a",{href:"/solutions.html",class:"relative pb-2 text-xl font-medium group"},[it(" Solutions "),R("span",{class:"absolute left-0 -bottom-0.5 w-0 h-[2px] bg-yellow-400 transition-all duration-300 group-hover:w-full"})])],-1),R("li",null,[R("a",{href:"/impact.html",class:"relative pb-2 text-xl font-medium group"},[it(" Impact "),R("span",{class:"absolute left-0 -bottom-0.5 w-0 h-[2px] bg-yellow-400 transition-all duration-300 group-hover:w-full"})])],-1),R("li",null,[R("a",{href:"/projects.html",class:"relative pb-2 text-xl font-medium group"},[it(" Projects "),R("span",{class:"absolute left-0 -bottom-0.5 w-0 h-[2px] bg-yellow-400 transition-all duration-300 group-hover:w-full"})])],-1),R("li",null,[R("a",{href:"/people.html",class:"relative pb-2 text-xl font-medium group"},[it(" Our Team "),R("span",{class:"absolute left-0 -bottom-0.5 w-0 h-[2px] bg-yellow-400 transition-all duration-300 group-hover:w-full"})])],-1),R("li",null,[R("a",{href:"/manifesto.html",class:"relative pb-2 text-xl font-medium group"},[it(" Manifesto "),R("span",{class:"absolute left-0 -bottom-0.5 w-0 h-[2px] bg-yellow-400 transition-all duration-300 group-hover:w-full"})])],-1)])],512),[[Fd,n.value.programs]])]),_:1})]),g[16]||(g[16]=R("div",{class:"flex-1 mt-20"},[R("h3",{class:"mb-6 text-2xl font-semibold text-yellow-400"}," Connect with us "),R("p",{class:"mb-4 font-medium"},"FarmGate Africa & Industries Ltd"),R("div",{class:"flex items-start gap-2 mb-4"},[R("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 682.66669 682.66669",class:"flex-shrink-0 w-5 h-5 text-white",fill:"none",stroke:"currentColor","stroke-width":"2"},[R("g",{transform:"matrix(1.3333333,0,0,-1.3333333,0,682.66667)"},[R("g",{"clip-path":"url(#clipPath2426)"},[R("g",{transform:"translate(378.6821,256.8721)"},[R("path",{d:"M 0,0 118.318,-75.157 V -237.29 L 0,-162.133 l -123.64,-77.321 -121.724,77.321 -118.318,-75.157 V -75.157 L -245.364,0",stroke:"currentColor","stroke-width":"30",fill:"none"})]),R("g",{transform:"translate(256,494.582)"},[R("path",{d:"m 0,0 c 82.873,0 150.055,-67.183 150.055,-150.056 0,-69.816 -47.681,-128.492 -112.256,-145.25 L 0,-370.906 l -37.801,75.6 c -64.573,16.759 -112.255,75.435 -112.255,145.25 C -150.056,-67.183 -82.874,0 0,0 Z",stroke:"currentColor","stroke-width":"30",fill:"none"})]),R("g",{transform:"translate(256,309.8984)"},[R("path",{d:"M 0,0 C 19.073,0 34.628,15.556 34.628,34.628 34.628,53.701 19.073,69.257 0,69.257 -19.073,69.257 -34.628,53.701 -34.628,34.628 -34.628,15.556 -19.073,0 0,0 Z",stroke:"currentColor","stroke-width":"30",fill:"none"})])])])]),R("div",null,[R("p",{class:"font-semibold text-white"},"Office Location:"),R("p",{class:"text-gray-300"},[it(" No. 6 Nii Notes Baale Ave, "),R("br"),it(" East Legon, Accra,"),R("br"),it(" Greater Accra Region (GA-414-1928) ")])])]),R("div",{class:"flex items-start gap-2 mb-4"},[R("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 512 512",class:"flex-shrink-0 w-5 h-5 text-white",fill:"currentColor"},[R("path",{d:`M496.516,169.574c-0.458-0.458-0.944-0.885-1.457-1.279c-2.223-1.711-21.537-16.577-48.082-36.865V49.055
      c0-8.283-6.715-14.998-14.998-14.998h-63.992c-8.283,0-14.998,6.715-14.998,14.998v11.081
      c-28.25-21.209-54.119-40.348-70.17-51.582c-16.292-11.405-37.347-11.405-53.639,0C177.404,44.794,23.468,163.269,16.94,168.294
      c-0.513,0.395-0.999,0.822-1.457,1.279c-18.322,18.325-18.321,48.138,0.001,66.461c9.162,9.16,21.195,13.74,33.23,13.74
      c5.53,0,11.057-0.98,16.308-2.915V497c0,8.284,6.715,14.999,14.998,14.999h351.958c8.283,0,14.998-6.715,14.998-14.998V246.863
      c16.679,6.143,36.167,2.542,49.538-10.829C514.837,217.713,514.838,187.898,496.516,169.574z M382.985,64.053h33.996v44.498
      c-10.992-8.366-22.475-17.085-33.996-25.802V64.053z M416.981,482.003H280.48l46.885-91.974
      c25.225-21.168,39.621-51.958,39.621-85.005c0-61.199-49.788-110.987-110.987-110.987s-110.987,49.788-110.987,110.987
      c0,33.047,14.397,63.836,39.621,85.005l46.885,91.974H95.019V226.215L256,103.234l160.981,122.98V482.003z M256,463.977
      l-46.077-90.388c-0.982-1.927-2.37-3.619-4.068-4.959c-19.604-15.479-30.846-38.662-30.846-63.605
      c0-44.659,36.332-80.99,80.99-80.99s80.99,36.332,80.99,80.99c0,24.943-11.243,48.126-30.846,63.605
      c-1.698,1.341-3.085,3.033-4.068,4.959L256,463.977z M475.307,214.823c-6.628,6.627-17.413,6.627-24.041,0
      c-1.228-1.227-138.534-105.998-186.16-142.381c-5.375-4.106-12.834-4.106-18.21,0c-47.618,36.377-184.933,141.155-186.16,142.381
      c-6.627,6.627-17.412,6.627-24.04,0.001c-6.432-6.432-6.621-16.781-0.567-23.445c12.91-9.932,161.033-123.799,210.254-158.252
      c5.843-4.09,13.393-4.09,19.236,0c49.219,34.451,197.344,148.319,210.254,158.252
      C481.927,198.043,481.738,208.392,475.307,214.823z`}),R("path",{d:`M256,258.03c-25.913,0-46.994,21.081-46.994,46.994s21.081,46.994,46.994,46.994s46.994-21.082,46.994-46.994
      S281.914,258.03,256,258.03z M256,322.022c-9.373,0-16.998-7.625-16.998-16.998s7.625-16.998,16.998-16.998
      s16.998,7.625,16.998,16.998S265.374,322.022,256,322.022z`})]),R("div",null,[R("p",{class:"font-semibold text-white"},"Registered Address:"),R("p",{class:"text-gray-300"},[it(" Aveyime Mangoase, Battor, "),R("br"),it(" Volta Region (VT-0320-8690) ")])])]),R("div",{class:"flex items-start gap-2 mb-4"},[R("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1707 1707",class:"flex-shrink-0 w-5 h-5 text-white",fill:"currentColor"},[R("path",{d:"m1554 1053h-889c-11 0-20-9-20-20v-433c0-132-108-240-241-240-26 0-26-40 0-40h803c202 0 367 164 367 366v347c0 11-9 20-20 20zm-869-40h849v-327c0-180-147-326-327-326h-658c82 49 136 138 136 240z"}),R("path",{d:"m665 631h-521c-21 0-20-20-20-31 0-155 126-280 280-280 155 0 281 125 281 280 0 11 1 31-20 31zm-501-40h481c-5-128-111-231-241-231-129 0-235 103-240 231z"}),R("path",{d:"m1687 1184h-1543c-11 0-20-9-20-20v-131c0-11 9-20 20-20h1543c11 0 20 9 20 20v131c0 11-9 20-20 20zm-1523-40h1503v-91h-1503z"}),R("path",{d:"m665 1184c-11 0-20-9-20-20v-131c0-27 40-26 40 0v131c0 11-9 20-20 20z"}),R("path",{d:"m1277 1652h-174c-11 0-20-9-20-20v-468c0-11 9-20 20-20h174c11 0 20 9 20 20v468c0 11-9 20-20 20zm-154-40h134v-428h-134z"}),R("path",{d:"m665 1053h-645c-11 0-20-9-20-20v-422c0-11 9-20 20-20h645c11 0 20 9 20 20v422c0 11-9 20-20 20zm-625-40h605v-382h-605z"}),R("path",{d:"m378 898c-4 0-8-1-12-4l-358-267c-15-11-7-36 12-36h645c28 0 20 39 20 73 0 6-3 12-8 16l-287 214c-4 3-8 4-12 4zm-298-267 298 222 267-199v-23z"}),R("path",{d:"m1399 1652h-417c-27 0-27-40 0-40h417c26 0 26 40 0 40z"}),R("path",{d:"m1554 941h-889c-26 0-26-40 0-40h889c26 0 26 40 0 40z"}),R("path",{d:"m1122 461c-11 0-20-9-20-20v-366c0-27 40-27 40 0v366c0 12-9 20-20 20z"}),R("path",{d:"m1342 270h-220c-11 0-20-9-20-20v-175c0-11 9-20 20-20h220c11 0 20 9 20 20v175c0 11-9 20-20 20zm-200-40h180v-135h-180z"}),R("path",{d:"m1122 605c-50 0-92-41-92-92 0-50 42-92 92-92 121 0 121 184 0 184zm0-144c-68 0-68 104 0 104 69 0 69-104 0-104z"})]),R("div",null,[R("p",{class:"font-semibold text-white"},"Postal Address:"),R("p",{class:"text-gray-300"},[it(" P. O. Box 2186, Adenta - Accra,"),R("br"),it(" Ghana, West Africa ")])])]),R("div",{class:"flex items-center gap-2 mb-4"},[R("svg",{id:"Layer_1","enable-background":"new 0 0 48 48",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",class:"flex-shrink-0 text-white",fill:"currentColor"},[R("g",{width:"100%",height:"100%",transform:"matrix(1,0,0,1,0,0)"},[R("g",{fill:"currentColor"},[R("path",{d:"m4.7 18h8.8c1.1 0 2.2-.4 3-1.2s1.2-1.8 1.2-3v-1.5c.7-.5 2.8-1.4 6.2-1.4 3.5 0 5.6.9 6.2 1.3v1.6c0 1.1.4 2.2 1.2 3s1.9 1.2 3 1.2h8.8c1.1 0 2.2-.4 3-1.2s1.2-1.8 1.2-3v-2c0-3.4-2.7-6.5-7.7-8.6-4.1-1.7-9.7-2.7-15.6-2.7-9.2 0-17.3 2.3-21.1 6.1-1.6 1.6-2.4 3.4-2.4 5.3v2c0 2.2 1.9 4.1 4.2 4.1zm-1.2-6.2c0-1 .5-2.1 1.5-3.1 3.2-3.1 10.8-5.2 19-5.2 5.5 0 10.7.9 14.6 2.5 3.7 1.6 5.9 3.7 5.9 5.8v2c0 .3-.1.6-.4.8-.2.2-.5.4-.9.4h-8.8c-.3 0-.6-.1-.9-.4-.2-.2-.4-.5-.4-.8v-1.9c0-2.3-4-4-9.2-4-3.7 0-7 .9-8.4 2.3-.6.6-.8 1.2-.8 1.6v1.9c0 .3-.1.6-.4.8-.2.2-.5.4-.9.4h-8.7c-.7 0-1.2-.5-1.2-1.2z"}),R("path",{d:"m17.9 18.3c-.8 0-1.5.7-1.5 1.5v1.3h-7.2c-.7 0-1.2.4-1.4 1.1l-5.4 17.6c-.6 1.8-.4 3.7.7 5.3s2.9 2.5 4.8 2.5h32c1.9 0 3.7-.9 4.8-2.5 1.1-1.5 1.4-3.5.8-5.2l-5.3-17.6c-.2-.6-.8-1.1-1.4-1.1h-7.2v-1.3c0-.8-.7-1.5-1.5-1.5s-1.5.7-1.5 1.5v1.3h-9.2v-1.3c0-.9-.7-1.6-1.5-1.6zm24.8 22.4c.3.9.2 1.8-.4 2.5-.6.8-1.4 1.2-2.4 1.2h-31.9c-1 0-1.8-.4-2.4-1.2-.5-.7-.7-1.7-.3-2.6l5-16.5h27.4z"}),R("path",{d:"m19.6 28.5c0-.1-.1-.2-.1-.3-.1-.1-.1-.2-.2-.2-.3-.4-.9-.5-1.3-.4-.1 0-.2 0-.3.1-.1 0-.2.1-.3.1s-.2.1-.2.2c-.1.1-.1.1-.2.2 0 .1-.1 .2-.1 .3s-.1 .2-.1 .3v.3c0 .2 0 .4.1 .6s.2 .3.3 .5c.3 .3.7 .4 1.1 .4s.8-.2 1.1-.4c.1-.1.2-.3.3-.5s.1-.4.1-.6c0-.1 0-.2 0-.3-.1-.1-.2-.2-.2-.3z"}),R("path",{d:"m25.4 28.5c0-.1-.1-.2-.1-.3s-.1-.2-.2-.2c-.4-.4-.9-.5-1.4-.4-.1 0-.2 0-.3 .1-.1 0-.2 .1-.3 .1s-.2 .1-.2 .2c-.1 .1-.1 .1-.2 .2 0 .1-.1 .2-.1 .3s-.1 .2-.1 .3v.3c0 .2 0 .4.1 .6s.2 .3.3 .5c.3 .3.7 .4 1.1 .4s.8-.2 1.1-.4c.1-.1.2-.3.3-.5s.1-.4.1-.6c0-.1 0-.2 0-.3-.1-.1-.1-.2-.1-.3z"}),R("path",{d:"m29.5 27.6c-.1 0-.2 0-.3 .1-.1 0-.2 .1-.3 .1s-.2 .1-.2 .2c-.3 .3-.4 .7-.4 1.1 0 .2 0 .4.1 .6s.2 .3.3 .5c.3 .3.7 .4 1.1 .4.2 0 .4 0 .6-.1s.3-.2.5-.3c.1-.1.3-.3.3-.5.1-.2.1-.4.1-.6 0-.4-.2-.8-.4-1.1-.1-.1-.1-.1-.2-.2s-.2-.1-.3-.1-.2-.1-.3-.1c-.2-.1-.4-.1-.6 0z"}),R("path",{d:"m19.6 33.8c0-.1-.1-.2-.1-.3-.1-.1-.1-.2-.2-.2-.3-.3-.9-.5-1.3-.4-.1 0-.2 .1-.3 .1s-.2 .1-.3 .1-.2 .1-.2 .2c-.1 .1-.1 .2-.2 .2 0 .1-.1 .2-.1 .3s-.1 .2-.1 .3v.3c0 .4.2 .8.4 1.1.3 .3.7 .4 1.1 .4s.8-.2 1.1-.4c.3-.3.4-.7.4-1.1 0-.1 0-.2 0-.3-.1-.2-.2-.2-.2-.3z"}),R("path",{d:"m25.4 33.8c0-.1-.1-.2-.1-.3s-.1-.2-.2-.2c-.4-.3-.9-.5-1.4-.4-.1 0-.2 .1-.3 .1s-.2 .1-.3 .1-.2 .1-.2 .2c-.3 .3-.4 .7-.4 1.1s.2 .8.4 1.1c.3 .3.7 .4 1.1 .4s.8-.2 1.1-.4c.3-.3.4-.7.4-1.1 0-.1 0-.2 0-.3-.1-.2-.1-.2-.1-.3z"}),R("path",{d:"m31.2 33.8c0-.1-.1-.2-.1-.3s-.1-.2-.2-.2c-.1-.1-.1-.1-.2-.2-.1 0-.2-.1-.3-.1s-.2-.1-.3-.1c-.2 0-.4 0-.6 0-.1 0-.2 .1-.3 .1s-.2 .1-.3 .1c-.1 .1-.2 .1-.2 .2-.3 .3-.4 .7-.4 1.1s.2 .8.4 1.1c.3 .3.7 .4 1.1 .4.2 0 .4 0 .6-.1s.3-.2.5-.3c.3-.3.4-.7.4-1.1 0-.1 0-.2 0-.3-.1-.2-.1-.2-.1-.3z"}),R("path",{d:"m19.6 39c0-.1-.1-.2-.1-.3-.1-.1-.1-.2-.2-.2-.3-.3-.9-.5-1.3-.4-.1 0-.2 0-.3 .1-.1 0-.2 .1-.3 .1-.1 .1-.2 .1-.2 .2s-.2 .2-.2 .3-.1 .2-.1 .3-.1 .2-.1 .3v.3c0 .4.2 .8.4 1.1.1 .1.3 .3.5 .3.2 .1.4 .1.6 .1.4 0 .8-.1 1.1-.4s.4-.7.4-1.1c0-.1 0-.2 0-.3-.1-.2-.2-.3-.2-.4z"}),R("path",{d:"m25.4 39c0-.1-.1-.2-.1-.3s-.1-.2-.2-.2-.2-.1-.2-.2c-.1 0-.2-.1-.3-.1s-.2-.1-.3-.1c-.2 0-.4 0-.6 0-.1 0-.2 0-.3 .1-.1 0-.2 .1-.3 .1-.1 .1-.2 .1-.2 .2-.3 .3-.4 .7-.4 1.1s.2 .8.4 1.1c.3 .3.7 .4 1.1 .4s.8-.1 1.1-.4c.1-.1.2-.3.3-.5s.1-.4.1-.6c0-.1 0-.2 0-.3-.1-.1-.1-.2-.1-.3z"}),R("path",{d:"m31.2 39c0-.1-.1-.2-.1-.3s-.1-.2-.2-.2c-.1-.1-.1-.1-.2-.2-.1 0-.2-.1-.3-.1s-.2-.1-.3-.1c-.2 0-.4 0-.6 0-.1 0-.2 0-.3 .1-.1 0-.2 .1-.3 .1-.1 .1-.2 .1-.2 .2-.3 .3-.4 .7-.4 1.1 0 .2 0 .4.1 .6s.2 .3.3 .5c.3 .3.7 .4 1.1 .4.2 0 .4 0 .6-.1s.3-.2.5-.3c.1-.1.3-.3.3-.5.1-.2.1-.4.1-.6 0-.1 0-.2 0-.3-.1-.1-.1-.2-.1-.3z"})])])]),R("p",{class:"text-gray-300"},"+233 30 398 0443")]),R("div",{class:"flex items-center gap-2 mb-4"},[R("svg",{version:"1.1",id:"Capa_1",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",x:"0px",y:"0px",viewBox:"0 0 512.076 512.076","xml:space":"preserve",width:"20",height:"20",class:"flex-shrink-0 text-white",fill:"currentColor"},[R("g",{transform:"translate(-1 -1)"},[R("g",null,[R("g",null,[R("path",{d:`M499.639,396.039l-103.646-69.12c-13.153-8.701-30.784-5.838-40.508,6.579l-30.191,38.818
            c-3.88,5.116-10.933,6.6-16.546,3.482l-5.743-3.166c-19.038-10.377-42.726-23.296-90.453-71.04s-60.672-71.45-71.049-90.453
            l-3.149-5.743c-3.161-5.612-1.705-12.695,3.413-16.606l38.792-30.182c12.412-9.725,15.279-27.351,6.588-40.508l-69.12-103.646
            C109.12,1.056,91.25-2.966,77.461,5.323L34.12,31.358C20.502,39.364,10.511,52.33,6.242,67.539
            c-15.607,56.866-3.866,155.008,140.706,299.597c115.004,114.995,200.619,145.92,259.465,145.92
            c13.543,0.058,27.033-1.704,40.107-5.239c15.212-4.264,28.18-14.256,36.181-27.878l26.061-43.315
            C517.063,422.832,513.043,404.951,499.639,396.039z M494.058,427.868l-26.001,43.341c-5.745,9.832-15.072,17.061-26.027,20.173
            c-52.497,14.413-144.213,2.475-283.008-136.32S8.29,124.559,22.703,72.054c3.116-10.968,10.354-20.307,20.198-26.061
            l43.341-26.001c5.983-3.6,13.739-1.855,17.604,3.959l37.547,56.371l31.514,47.266c3.774,5.707,2.534,13.356-2.85,17.579
            l-38.801,30.182c-11.808,9.029-15.18,25.366-7.91,38.332l3.081,5.598c10.906,20.002,24.465,44.885,73.967,94.379
            c49.502,49.493,74.377,63.053,94.37,73.958l5.606,3.089c12.965,7.269,29.303,3.898,38.332-7.91l30.182-38.801
            c4.224-5.381,11.87-6.62,17.579-2.85l103.637,69.12C495.918,414.126,497.663,421.886,494.058,427.868z`,fill:"currentColor"}),R("path",{d:`M291.161,86.39c80.081,0.089,144.977,64.986,145.067,145.067c0,4.713,3.82,8.533,8.533,8.533s8.533-3.82,8.533-8.533
            c-0.099-89.503-72.63-162.035-162.133-162.133c-4.713,0-8.533,3.82-8.533,8.533S286.448,86.39,291.161,86.39z`,fill:"currentColor"}),R("path",{d:`M291.161,137.59c51.816,0.061,93.806,42.051,93.867,93.867c0,4.713,3.821,8.533,8.533,8.533
            c4.713,0,8.533-3.82,8.533-8.533c-0.071-61.238-49.696-110.863-110.933-110.933c-4.713,0-8.533,3.82-8.533,8.533
            S286.448,137.59,291.161,137.59z`,fill:"currentColor"}),R("path",{d:`M291.161,188.79c23.552,0.028,42.638,19.114,42.667,42.667c0,4.713,3.821,8.533,8.533,8.533s8.533-3.82,8.533-8.533
            c-0.038-32.974-26.759-59.696-59.733-59.733c-4.713,0-8.533,3.82-8.533,8.533S286.448,188.79,291.161,188.79z`,fill:"currentColor"})])])])]),R("p",{class:"text-gray-300"},"+233 50 330 1132")]),R("div",{class:"flex items-center gap-2 mb-4"},[R("svg",{id:"Layer_1",viewBox:"0 0 512 512",xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",class:"flex-shrink-0 text-white",fill:"currentColor"},[R("g",{transform:"matrix(1,0,0,1,0,0)"},[R("path",{d:"m499.509 83.651-.006-.007-.012-.01a40.863 40.863 0 0 0 -28.6-11.583h-429.781a40.87 40.87 0 0 0 -28.367 11.36l-.014.013-.008.007-.005.005-.009.01a40.719 40.719 0 0 0 -12.707 29.712v285.685a41.136 41.136 0 0 0 41.11 41.11h429.779a41.135 41.135 0 0 0 41.111-41.11v-285.685a40.768 40.768 0 0 0 -12.491-29.507zm-170.6 172.073 162.318-150.58a21.813 21.813 0 0 1 1.508 8.014v285.685a21.8 21.8 0 0 1 -1.5 7.969zm141.98-164.417a21.924 21.924 0 0 1 6.025.849l-220.746 204.782-116.55-108.117-104.258-96.734a21.942 21.942 0 0 1 5.75-.78zm-450.133 315.506a21.837 21.837 0 0 1 -1.5-7.97v-285.685a21.808 21.808 0 0 1 1.6-8.251l105.662 98.033 56.732 52.627zm20.354 13.88a21.871 21.871 0 0 1 -6.07-.862l162.369-151.131 52.21 48.433a9.632 9.632 0 0 0 13.1 0l52.038-48.275 162.2 150.974a21.91 21.91 0 0 1 -6.071.861z",fill:"currentColor"})])]),R("p",{class:"text-gray-300"},"connect@farmgate.africa")])],-1)),R("button",{onClick:r,class:"absolute text-3xl cursor-pointer top-6 right-6 lg:text-5xl hover:text-yellow-400"},"  ")])],4)):ut("",!0)]),_:1})])}}},F1=nl(M1,[["__scopeId","data-v-6526b1e2"]]),N1="/images/Mouse-hero1.gif",$1={class:"text-center"},B1={__name:"ScrollDown",setup(i){return(e,t)=>(Te(),Ie("div",$1,[...t[0]||(t[0]=[R("img",{src:N1,alt:"Click to explore solutions",class:"w-12 h-12 mx-auto mb-2 transition-transform cursor-pointer hover:scale-110"},null,-1),R("p",{class:"text-sm text-white animate-bounce"},"Click to Explore",-1)])]))}},U1=nl(B1,[["__scopeId","data-v-16546e7d"]]),J=Number.isFinite||function(i){return typeof i=="number"&&isFinite(i)},G1=Number.isSafeInteger||function(i){return typeof i=="number"&&Math.abs(i)<=V1},V1=Number.MAX_SAFE_INTEGER||9007199254740991;let ie=(function(i){return i.NETWORK_ERROR="networkError",i.MEDIA_ERROR="mediaError",i.KEY_SYSTEM_ERROR="keySystemError",i.MUX_ERROR="muxError",i.OTHER_ERROR="otherError",i})({}),k=(function(i){return i.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",i.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",i.KEY_SYSTEM_NO_SESSION="keySystemNoSession",i.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",i.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",i.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",i.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",i.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",i.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",i.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",i.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",i.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",i.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",i.MANIFEST_LOAD_ERROR="manifestLoadError",i.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",i.MANIFEST_PARSING_ERROR="manifestParsingError",i.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",i.LEVEL_EMPTY_ERROR="levelEmptyError",i.LEVEL_LOAD_ERROR="levelLoadError",i.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",i.LEVEL_PARSING_ERROR="levelParsingError",i.LEVEL_SWITCH_ERROR="levelSwitchError",i.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",i.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",i.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",i.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",i.FRAG_LOAD_ERROR="fragLoadError",i.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",i.FRAG_DECRYPT_ERROR="fragDecryptError",i.FRAG_PARSING_ERROR="fragParsingError",i.FRAG_GAP="fragGap",i.REMUX_ALLOC_ERROR="remuxAllocError",i.KEY_LOAD_ERROR="keyLoadError",i.KEY_LOAD_TIMEOUT="keyLoadTimeOut",i.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",i.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",i.BUFFER_APPEND_ERROR="bufferAppendError",i.BUFFER_APPENDING_ERROR="bufferAppendingError",i.BUFFER_STALLED_ERROR="bufferStalledError",i.BUFFER_FULL_ERROR="bufferFullError",i.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",i.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",i.ASSET_LIST_LOAD_ERROR="assetListLoadError",i.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",i.ASSET_LIST_PARSING_ERROR="assetListParsingError",i.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",i.INTERNAL_EXCEPTION="internalException",i.INTERNAL_ABORTED="aborted",i.ATTACH_MEDIA_ERROR="attachMediaError",i.UNKNOWN="unknown",i})({}),y=(function(i){return i.MEDIA_ATTACHING="hlsMediaAttaching",i.MEDIA_ATTACHED="hlsMediaAttached",i.MEDIA_DETACHING="hlsMediaDetaching",i.MEDIA_DETACHED="hlsMediaDetached",i.MEDIA_ENDED="hlsMediaEnded",i.STALL_RESOLVED="hlsStallResolved",i.BUFFER_RESET="hlsBufferReset",i.BUFFER_CODECS="hlsBufferCodecs",i.BUFFER_CREATED="hlsBufferCreated",i.BUFFER_APPENDING="hlsBufferAppending",i.BUFFER_APPENDED="hlsBufferAppended",i.BUFFER_EOS="hlsBufferEos",i.BUFFERED_TO_END="hlsBufferedToEnd",i.BUFFER_FLUSHING="hlsBufferFlushing",i.BUFFER_FLUSHED="hlsBufferFlushed",i.MANIFEST_LOADING="hlsManifestLoading",i.MANIFEST_LOADED="hlsManifestLoaded",i.MANIFEST_PARSED="hlsManifestParsed",i.LEVEL_SWITCHING="hlsLevelSwitching",i.LEVEL_SWITCHED="hlsLevelSwitched",i.LEVEL_LOADING="hlsLevelLoading",i.LEVEL_LOADED="hlsLevelLoaded",i.LEVEL_UPDATED="hlsLevelUpdated",i.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",i.LEVELS_UPDATED="hlsLevelsUpdated",i.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",i.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",i.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",i.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",i.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",i.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",i.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",i.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",i.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",i.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",i.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",i.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",i.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",i.CUES_PARSED="hlsCuesParsed",i.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",i.INIT_PTS_FOUND="hlsInitPtsFound",i.FRAG_LOADING="hlsFragLoading",i.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",i.FRAG_LOADED="hlsFragLoaded",i.FRAG_DECRYPTED="hlsFragDecrypted",i.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",i.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",i.FRAG_PARSING_METADATA="hlsFragParsingMetadata",i.FRAG_PARSED="hlsFragParsed",i.FRAG_BUFFERED="hlsFragBuffered",i.FRAG_CHANGED="hlsFragChanged",i.FPS_DROP="hlsFpsDrop",i.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",i.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",i.ERROR="hlsError",i.DESTROYING="hlsDestroying",i.KEY_LOADING="hlsKeyLoading",i.KEY_LOADED="hlsKeyLoaded",i.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",i.BACK_BUFFER_REACHED="hlsBackBufferReached",i.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",i.ASSET_LIST_LOADING="hlsAssetListLoading",i.ASSET_LIST_LOADED="hlsAssetListLoaded",i.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",i.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",i.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",i.INTERSTITIAL_STARTED="hlsInterstitialStarted",i.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",i.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",i.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",i.INTERSTITIAL_ENDED="hlsInterstitialEnded",i.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",i.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",i.EVENT_CUE_ENTER="hlsEventCueEnter",i})({});var Ee={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},se={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class ci{constructor(e,t=0,s=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=s}sample(e,t){const s=Math.pow(this.alpha_,e);this.estimate_=t*(1-s)+s*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class K1{constructor(e,t,s,r=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=s,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new ci(e),this.fast_=new ci(t),this.defaultTTFB_=r,this.ttfb_=new ci(e)}update(e,t){const{slow_:s,fast_:r,ttfb_:n}=this;s.halfLife!==e&&(this.slow_=new ci(e,s.getEstimate(),s.getTotalWeight())),r.halfLife!==t&&(this.fast_=new ci(t,r.getEstimate(),r.getTotalWeight())),n.halfLife!==e&&(this.ttfb_=new ci(e,n.getEstimate(),n.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const s=8*t,r=e/1e3,n=s/r;this.fast_.sample(r,n),this.slow_.sample(r,n)}sampleTTFB(e){const t=e/1e3,s=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(s,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function H1(i,e,t){return(e=W1(e))in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function we(){return we=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var s in t)({}).hasOwnProperty.call(t,s)&&(i[s]=t[s])}return i},we.apply(null,arguments)}function Cc(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);e&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(i,r).enumerable})),t.push.apply(t,s)}return t}function Re(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Cc(Object(t),!0).forEach(function(s){H1(i,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):Cc(Object(t)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(t,s))})}return i}function j1(i,e){if(typeof i!="object"||!i)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function W1(i){var e=j1(i,"string");return typeof e=="symbol"?e:e+""}class Pt{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const s=`[${e}]:`;this.trace=Ps,this.debug=t.debug.bind(null,s),this.log=t.log.bind(null,s),this.warn=t.warn.bind(null,s),this.info=t.info.bind(null,s),this.error=t.error.bind(null,s)}}const Ps=function(){},Y1={trace:Ps,debug:Ps,log:Ps,warn:Ps,info:Ps,error:Ps};function io(){return we({},Y1)}function z1(i,e){const t=self.console[i];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${i}] >`):Ps}function wc(i,e,t){return e[i]?e[i].bind(e):z1(i,t)}const ro=io();function q1(i,e,t){const s=io();if(typeof console=="object"&&i===!0||typeof i=="object"){const r=["debug","log","info","warn","error"];r.forEach(n=>{s[n]=wc(n,i,t)});try{s.log(`Debug logs enabled for "${e}" in hls.js version 1.6.15`)}catch{return io()}r.forEach(n=>{ro[n]=wc(n,i)})}else we(ro,s);return s}const Ce=ro;function $s(i=!0){return typeof self>"u"?void 0:(i||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function X1(i){return typeof self<"u"&&i===self.ManagedMediaSource}function Nd(i,e){const t=Object.keys(i),s=Object.keys(e),r=t.length,n=s.length;return!r||!n||r===n&&!t.some(a=>s.indexOf(a)===-1)}function _t(i,e=!1){if(typeof TextDecoder<"u"){const c=new TextDecoder("utf-8").decode(i);if(e){const u=c.indexOf("\0");return u!==-1?c.substring(0,u):c}return c.replace(/\0/g,"")}const t=i.length;let s,r,n,a="",o=0;for(;o<t;){if(s=i[o++],s===0&&e)return a;if(s===0||s===3)continue;switch(s>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(s);break;case 12:case 13:r=i[o++],a+=String.fromCharCode((s&31)<<6|r&63);break;case 14:r=i[o++],n=i[o++],a+=String.fromCharCode((s&15)<<12|(r&63)<<6|(n&63)<<0);break}}return a}function Ze(i){let e="";for(let t=0;t<i.length;t++){let s=i[t].toString(16);s.length<2&&(s="0"+s),e+=s}return e}function $d(i){return Uint8Array.from(i.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function Q1(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var ha={exports:{}},Dc;function Z1(){return Dc||(Dc=1,(function(i,e){(function(t){var s=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,r=/^(?=([^\/?#]*))\1([^]*)$/,n=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,o={buildAbsoluteURL:function(l,c,u){if(u=u||{},l=l.trim(),c=c.trim(),!c){if(!u.alwaysNormalize)return l;var f=o.parseURL(l);if(!f)throw new Error("Error trying to parse base URL.");return f.path=o.normalizePath(f.path),o.buildURLFromParts(f)}var d=o.parseURL(c);if(!d)throw new Error("Error trying to parse relative URL.");if(d.scheme)return u.alwaysNormalize?(d.path=o.normalizePath(d.path),o.buildURLFromParts(d)):c;var h=o.parseURL(l);if(!h)throw new Error("Error trying to parse base URL.");if(!h.netLoc&&h.path&&h.path[0]!=="/"){var g=r.exec(h.path);h.netLoc=g[1],h.path=g[2]}h.netLoc&&!h.path&&(h.path="/");var m={scheme:h.scheme,netLoc:d.netLoc,path:null,params:d.params,query:d.query,fragment:d.fragment};if(!d.netLoc&&(m.netLoc=h.netLoc,d.path[0]!=="/"))if(!d.path)m.path=h.path,d.params||(m.params=h.params,d.query||(m.query=h.query));else{var p=h.path,v=p.substring(0,p.lastIndexOf("/")+1)+d.path;m.path=o.normalizePath(v)}return m.path===null&&(m.path=u.alwaysNormalize?o.normalizePath(d.path):d.path),o.buildURLFromParts(m)},parseURL:function(l){var c=s.exec(l);return c?{scheme:c[1]||"",netLoc:c[2]||"",path:c[3]||"",params:c[4]||"",query:c[5]||"",fragment:c[6]||""}:null},normalizePath:function(l){for(l=l.split("").reverse().join("").replace(n,"");l.length!==(l=l.replace(a,"")).length;);return l.split("").reverse().join("")},buildURLFromParts:function(l){return l.scheme+l.netLoc+l.path+l.params+l.query+l.fragment}};i.exports=o})()})(ha)),ha.exports}var al=Z1();class ol{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var ke={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class Bd{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,ey(this,"stats")}setByteRange(e,t){const s=e.split("@",2);let r;s.length===1?r=t?.byteRangeEndOffset||0:r=parseInt(s[1]),this._byteRange=[r,parseInt(s[0])+r]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[ke.AUDIO]:null,[ke.VIDEO]:null,[ke.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new ol),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=al.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[ke.AUDIO]=null,e[ke.VIDEO]=null,e[ke.AUDIOVIDEO]=null}}function Ve(i){return i.sn!=="initSegment"}class ga extends Bd{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange.length){const e=this.byteRange[0],t=this.byteRange[1];if(J(e)&&J(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){var e;const{levelkeys:t}=this;if(!t||t.NONE)return null;if(t.identity)this._decryptdata||(this._decryptdata=t.identity.getDecryptData(this.sn));else if(!((e=this._decryptdata)!=null&&e.keyId)){const s=Object.keys(t);if(s.length===1){const r=this._decryptdata=t[s[0]]||null;r&&(this._decryptdata=r.getDecryptData(this.sn,t))}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=J(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){var t;const s=Object.keys(this.levelkeys),r=s.length;if(r>1||r===1&&(t=this.levelkeys[s[0]])!=null&&t.encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!J(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return Ve(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){const t=this.levelkeys;if(t){var s;const r=t[e];r&&!((s=this._decryptdata)!=null&&s.keyId)&&(this._decryptdata=r.getDecryptData(this.sn,t))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,s,r,n,a=!1){const{elementaryStreams:o}=this,l=o[e];if(!l){o[e]={startPTS:t,endPTS:s,startDTS:r,endDTS:n,partial:a};return}l.startPTS=Math.min(l.startPTS,t),l.endPTS=Math.max(l.endPTS,s),l.startDTS=Math.min(l.startDTS,r),l.endDTS=Math.max(l.endDTS,n)}}class J1 extends Bd{constructor(e,t,s,r,n){super(s),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=r;const a=e.enumeratedString("BYTERANGE");a&&this.setByteRange(a,n),n&&(this.fragOffset=n.fragOffset+n.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function Ud(i,e){const t=Object.getPrototypeOf(i);if(t){const s=Object.getOwnPropertyDescriptor(t,e);return s||Ud(t,e)}}function ey(i,e){const t=Ud(i,e);t&&(t.enumerable=!0,Object.defineProperty(i,e,t))}const kc=Math.pow(2,32)-1,ty=[].push,Gd={video:1,audio:2,id3:3,text:4};function He(i){return String.fromCharCode.apply(null,i)}function Vd(i,e){const t=i[e]<<8|i[e+1];return t<0?65536+t:t}function ce(i,e){const t=Kd(i,e);return t<0?4294967296+t:t}function Pc(i,e){let t=ce(i,e);return t*=Math.pow(2,32),t+=ce(i,e+4),t}function Kd(i,e){return i[e]<<24|i[e+1]<<16|i[e+2]<<8|i[e+3]}function sy(i){const e=i.byteLength;for(let t=0;t<e;){const s=ce(i,t);if(s>8&&i[t+4]===109&&i[t+5]===111&&i[t+6]===111&&i[t+7]===102)return!0;t=s>1?t+s:e}return!1}function ve(i,e){const t=[];if(!e.length)return t;const s=i.byteLength;for(let r=0;r<s;){const n=ce(i,r),a=He(i.subarray(r+4,r+8)),o=n>1?r+n:s;if(a===e[0])if(e.length===1)t.push(i.subarray(r+8,o));else{const l=ve(i.subarray(r+8,o),e.slice(1));l.length&&ty.apply(t,l)}r=o}return t}function iy(i){const e=[],t=i[0];let s=8;const r=ce(i,s);s+=4;let n=0,a=0;t===0?(n=ce(i,s),a=ce(i,s+4),s+=8):(n=Pc(i,s),a=Pc(i,s+8),s+=16),s+=2;let o=i.length+a;const l=Vd(i,s);s+=2;for(let c=0;c<l;c++){let u=s;const f=ce(i,u);u+=4;const d=f&2147483647;if((f&2147483648)>>>31===1)return Ce.warn("SIDX has hierarchical references (not supported)"),null;const g=ce(i,u);u+=4,e.push({referenceSize:d,subsegmentDuration:g,info:{duration:g/r,start:o,end:o+d-1}}),o+=d,u+=4,s=u}return{earliestPresentationTime:n,timescale:r,version:t,referencesCount:l,references:e}}function Hd(i){const e=[],t=ve(i,["moov","trak"]);for(let r=0;r<t.length;r++){const n=t[r],a=ve(n,["tkhd"])[0];if(a){let o=a[0];const l=ce(a,o===0?12:20),c=ve(n,["mdia","mdhd"])[0];if(c){o=c[0];const u=ce(c,o===0?12:20),f=ve(n,["mdia","hdlr"])[0];if(f){const d=He(f.subarray(8,12)),h={soun:ke.AUDIO,vide:ke.VIDEO}[d],g=ve(n,["mdia","minf","stbl","stsd"])[0],m=ry(g);h?(e[l]={timescale:u,type:h,stsd:m},e[h]=Re({timescale:u,id:l},m)):e[l]={timescale:u,type:d,stsd:m}}}}}return ve(i,["moov","mvex","trex"]).forEach(r=>{const n=ce(r,4),a=e[n];a&&(a.default={duration:ce(r,12),flags:ce(r,20)})}),e}function ry(i){const e=i.subarray(8),t=e.subarray(86),s=He(e.subarray(4,8));let r=s,n;const a=s==="enca"||s==="encv";if(a){const c=ve(e,[s])[0].subarray(s==="enca"?28:78);ve(c,["sinf"]).forEach(f=>{const d=ve(f,["schm"])[0];if(d){const h=He(d.subarray(4,8));if(h==="cbcs"||h==="cenc"){const g=ve(f,["frma"])[0];g&&(r=He(g))}}})}const o=r;switch(r){case"avc1":case"avc2":case"avc3":case"avc4":{const l=ve(t,["avcC"])[0];l&&l.length>3&&(r+="."+Rr(l[1])+Rr(l[2])+Rr(l[3]),n=_r(o==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const l=ve(e,[s])[0],c=ve(l.subarray(28),["esds"])[0];if(c&&c.length>7){let u=4;if(c[u++]!==3)break;u=ma(c,u),u+=2;const f=c[u++];if(f&128&&(u+=2),f&64&&(u+=c[u++]),c[u++]!==4)break;u=ma(c,u);const d=c[u++];if(d===64)r+="."+Rr(d);else break;if(u+=12,c[u++]!==5)break;u=ma(c,u);const h=c[u++];let g=(h&248)>>3;g===31&&(g+=1+((h&7)<<3)+((c[u]&224)>>5)),r+="."+g}break}case"hvc1":case"hev1":{const l=ve(t,["hvcC"])[0];if(l&&l.length>12){const c=l[1],u=["","A","B","C"][c>>6],f=c&31,d=ce(l,2),h=(c&32)>>5?"H":"L",g=l[12],m=l.subarray(6,12);r+="."+u+f,r+="."+ny(d).toString(16).toUpperCase(),r+="."+h+g;let p="";for(let v=m.length;v--;){const E=m[v];(E||p)&&(p="."+E.toString(16).toUpperCase()+p)}r+=p}n=_r(o=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{r=_r(r,t)||r;break}case"vp09":{const l=ve(t,["vpcC"])[0];if(l&&l.length>6){const c=l[4],u=l[5],f=l[6]>>4&15;r+="."+zt(c)+"."+zt(u)+"."+zt(f)}break}case"av01":{const l=ve(t,["av1C"])[0];if(l&&l.length>2){const c=l[1]>>>5,u=l[1]&31,f=l[2]>>>7?"H":"M",d=(l[2]&64)>>6,h=(l[2]&32)>>5,g=c===2&&d?h?12:10:d?10:8,m=(l[2]&16)>>4,p=(l[2]&8)>>3,v=(l[2]&4)>>2,E=l[2]&3;r+="."+c+"."+zt(u)+f+"."+zt(g)+"."+m+"."+p+v+E+"."+zt(1)+"."+zt(1)+"."+zt(1)+"."+0,n=_r("dav1",t)}break}}return{codec:r,encrypted:a,supplemental:n}}function _r(i,e){const t=ve(e,["dvvC"]),s=t.length?t[0]:ve(e,["dvcC"])[0];if(s){const r=s[2]>>1&127,n=s[2]<<5&32|s[3]>>3&31;return i+"."+zt(r)+"."+zt(n)}}function ny(i){let e=0;for(let t=0;t<32;t++)e|=(i>>t&1)<<31-t;return e>>>0}function ma(i,e){const t=e+5;for(;i[e++]&128&&e<t;);return e}function Rr(i){return("0"+i.toString(16).toUpperCase()).slice(-2)}function zt(i){return(i<10?"0":"")+i}function ay(i,e){if(!i||!e)return;const t=e.keyId;t&&e.isCommonEncryption&&jd(i,(s,r)=>{const n=s.subarray(8,24);n.some(a=>a!==0)||(Ce.log(`[eme] Patching keyId in 'enc${r?"a":"v"}>sinf>>tenc' box: ${Ze(n)} -> ${Ze(t)}`),s.set(t,8))})}function oy(i){const e=[];return jd(i,t=>e.push(t.subarray(8,24))),e}function jd(i,e){ve(i,["moov","trak"]).forEach(s=>{const r=ve(s,["mdia","minf","stbl","stsd"])[0];if(!r)return;const n=r.subarray(8);let a=ve(n,["enca"]);const o=a.length>0;o||(a=ve(n,["encv"])),a.forEach(l=>{const c=o?l.subarray(28):l.subarray(78);ve(c,["sinf"]).forEach(f=>{const d=Wd(f);d&&e(d,o)})})})}function Wd(i){const e=ve(i,["schm"])[0];if(e){const t=He(e.subarray(4,8));if(t==="cbcs"||t==="cenc"){const s=ve(i,["schi","tenc"])[0];if(s)return s}}}function ly(i,e,t){const s={},r=ve(i,["moof","traf"]);for(let n=0;n<r.length;n++){const a=r[n],o=ve(a,["tfhd"])[0],l=ce(o,4),c=e[l];if(!c)continue;s[l]||(s[l]={start:NaN,duration:0,sampleCount:0,timescale:c.timescale,type:c.type});const u=s[l],f=ve(a,["tfdt"])[0];if(f){const x=f[0];let T=ce(f,4);x===1&&(T===kc?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(T*=kc+1,T+=ce(f,8))),J(T)&&(!J(u.start)||T<u.start)&&(u.start=T)}const d=c.default,h=ce(o,0)|d?.flags;let g=d?.duration||0;h&8&&(h&2?g=ce(o,12):g=ce(o,8));const m=ve(a,["trun"]);let p=u.start||0,v=0,E=g;for(let x=0;x<m.length;x++){const T=m[x],S=ce(T,4),C=u.sampleCount;u.sampleCount+=S;const A=T[3]&1,w=T[3]&4,L=T[2]&1,I=T[2]&2,O=T[2]&4,P=T[2]&8;let H=8,Q=S;for(A&&(H+=4),w&&S&&(!(T[H+1]&1)&&u.keyFrameIndex===void 0&&(u.keyFrameIndex=C),H+=4,L?(E=ce(T,H),H+=4):E=g,I&&(H+=4),P&&(H+=4),p+=E,v+=E,Q--);Q--;)L?(E=ce(T,H),H+=4):E=g,I&&(H+=4),O&&(T[H+1]&1||u.keyFrameIndex===void 0&&(u.keyFrameIndex=u.sampleCount-(Q+1),u.keyFrameStart=p),H+=4),P&&(H+=4),p+=E,v+=E;!v&&g&&(v+=g*S)}u.duration+=v}if(!Object.keys(s).some(n=>s[n].duration)){let n=1/0,a=0;const o=ve(i,["sidx"]);for(let l=0;l<o.length;l++){const c=iy(o[l]);if(c!=null&&c.references){n=Math.min(n,c.earliestPresentationTime/c.timescale);const u=c.references.reduce((f,d)=>f+d.info.duration||0,0);a=Math.max(a,u+c.earliestPresentationTime/c.timescale)}}a&&J(a)&&Object.keys(s).forEach(l=>{s[l].duration||(s[l].duration=a*s[l].timescale-s[l].start)})}return s}function cy(i){const e={valid:null,remainder:null},t=ve(i,["moof"]);if(t.length<2)return e.remainder=i,e;const s=t[t.length-1];return e.valid=i.slice(0,s.byteOffset-8),e.remainder=i.slice(s.byteOffset-8),e}function kt(i,e){const t=new Uint8Array(i.length+e.length);return t.set(i),t.set(e,i.length),t}function Oc(i,e){const t=[],s=e.samples,r=e.timescale,n=e.id;let a=!1;return ve(s,["moof"]).map(l=>{const c=l.byteOffset-8;ve(l,["traf"]).map(f=>{const d=ve(f,["tfdt"]).map(h=>{const g=h[0];let m=ce(h,4);return g===1&&(m*=Math.pow(2,32),m+=ce(h,8)),m/r})[0];return d!==void 0&&(i=d),ve(f,["tfhd"]).map(h=>{const g=ce(h,4),m=ce(h,0)&16777215,p=(m&1)!==0,v=(m&2)!==0,E=(m&8)!==0;let x=0;const T=(m&16)!==0;let S=0;const C=(m&32)!==0;let A=8;g===n&&(p&&(A+=8),v&&(A+=4),E&&(x=ce(h,A),A+=4),T&&(S=ce(h,A),A+=4),C&&(A+=4),e.type==="video"&&(a=Wn(e.codec)),ve(f,["trun"]).map(w=>{const L=w[0],I=ce(w,0)&16777215,O=(I&1)!==0;let P=0;const H=(I&4)!==0,Q=(I&256)!==0;let Z=0;const U=(I&512)!==0;let Y=0;const G=(I&1024)!==0,te=(I&2048)!==0;let oe=0;const z=ce(w,4);let j=8;O&&(P=ce(w,j),j+=4),H&&(j+=4);let he=P+c;for(let Se=0;Se<z;Se++){if(Q?(Z=ce(w,j),j+=4):Z=x,U?(Y=ce(w,j),j+=4):Y=S,G&&(j+=4),te&&(L===0?oe=ce(w,j):oe=Kd(w,j),j+=4),e.type===ke.VIDEO){let ge=0;for(;ge<Y;){const me=ce(s,he);if(he+=4,uy(a,s[he])){const Ue=s.subarray(he,he+me);ll(Ue,a?2:1,i+oe/r,t)}he+=me,ge+=me+4}}i+=Z/r}}))})})}),t}function Wn(i){if(!i)return!1;const e=i.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function uy(i,e){if(i){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function ll(i,e,t,s){const r=Yd(i);let n=0;n+=e;let a=0,o=0,l=0;for(;n<r.length;){a=0;do{if(n>=r.length)break;l=r[n++],a+=l}while(l===255);o=0;do{if(n>=r.length)break;l=r[n++],o+=l}while(l===255);const c=r.length-n;let u=n;if(o<c)n+=o;else if(o>c){Ce.error(`Malformed SEI payload. ${o} is too small, only ${c} bytes left to parse.`);break}if(a===4){if(r[u++]===181){const d=Vd(r,u);if(u+=2,d===49){const h=ce(r,u);if(u+=4,h===1195456820){const g=r[u++];if(g===3){const m=r[u++],p=31&m,v=64&m,E=v?2+p*3:0,x=new Uint8Array(E);if(v){x[0]=m;for(let T=1;T<E;T++)x[T]=r[u++]}s.push({type:g,payloadType:a,pts:t,bytes:x})}}}}}else if(a===5&&o>16){const f=[];for(let g=0;g<16;g++){const m=r[u++].toString(16);f.push(m.length==1?"0"+m:m),(g===3||g===5||g===7||g===9)&&f.push("-")}const d=o-16,h=new Uint8Array(d);for(let g=0;g<d;g++)h[g]=r[u++];s.push({payloadType:a,pts:t,uuid:f.join(""),userData:_t(h),userDataBytes:h})}}}function Yd(i){const e=i.byteLength,t=[];let s=1;for(;s<e-2;)i[s]===0&&i[s+1]===0&&i[s+2]===3?(t.push(s+2),s+=2):s++;if(t.length===0)return i;const r=e-t.length,n=new Uint8Array(r);let a=0;for(s=0;s<r;a++,s++)a===t[0]&&(a++,t.shift()),n[s]=i[a];return n}function fy(i){const e=i[0];let t="",s="",r=0,n=0,a=0,o=0,l=0,c=0;if(e===0){for(;He(i.subarray(c,c+1))!=="\0";)t+=He(i.subarray(c,c+1)),c+=1;for(t+=He(i.subarray(c,c+1)),c+=1;He(i.subarray(c,c+1))!=="\0";)s+=He(i.subarray(c,c+1)),c+=1;s+=He(i.subarray(c,c+1)),c+=1,r=ce(i,12),n=ce(i,16),o=ce(i,20),l=ce(i,24),c=28}else if(e===1){c+=4,r=ce(i,c),c+=4;const f=ce(i,c);c+=4;const d=ce(i,c);for(c+=4,a=2**32*f+d,G1(a)||(a=Number.MAX_SAFE_INTEGER,Ce.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=ce(i,c),c+=4,l=ce(i,c),c+=4;He(i.subarray(c,c+1))!=="\0";)t+=He(i.subarray(c,c+1)),c+=1;for(t+=He(i.subarray(c,c+1)),c+=1;He(i.subarray(c,c+1))!=="\0";)s+=He(i.subarray(c,c+1)),c+=1;s+=He(i.subarray(c,c+1)),c+=1}const u=i.subarray(c,i.byteLength);return{schemeIdUri:t,value:s,timeScale:r,presentationTime:a,presentationTimeDelta:n,eventDuration:o,id:l,payload:u}}function dy(i,...e){const t=e.length;let s=8,r=t;for(;r--;)s+=e[r].byteLength;const n=new Uint8Array(s);for(n[0]=s>>24&255,n[1]=s>>16&255,n[2]=s>>8&255,n[3]=s&255,n.set(i,4),r=0,s=8;r<t;r++)n.set(e[r],s),s+=e[r].byteLength;return n}function hy(i,e,t){if(i.byteLength!==16)throw new RangeError("Invalid system id");let s,r;s=0,r=new Uint8Array;let n;s>0?(n=new Uint8Array(4),e.length>0&&new DataView(n.buffer).setUint32(0,e.length,!1)):n=new Uint8Array;const a=new Uint8Array(4);return t.byteLength>0&&new DataView(a.buffer).setUint32(0,t.byteLength,!1),dy([112,115,115,104],new Uint8Array([s,0,0,0]),i,n,r,a,t)}function gy(i){const e=[];if(i instanceof ArrayBuffer){const t=i.byteLength;let s=0;for(;s+32<t;){const r=new DataView(i,s),n=my(r);e.push(n),s+=n.size}}return e}function my(i){const e=i.getUint32(0),t=i.byteOffset,s=i.byteLength;if(s<e)return{offset:t,size:s};if(i.getUint32(4)!==1886614376)return{offset:t,size:e};const n=i.getUint32(8)>>>24;if(n!==0&&n!==1)return{offset:t,size:e};const a=i.buffer,o=Ze(new Uint8Array(a,t+12,16));let l=null,c=null,u=0;if(n===0)u=28;else{const d=i.getUint32(28);if(!d||s<32+d*16)return{offset:t,size:e};l=[];for(let h=0;h<d;h++)l.push(new Uint8Array(a,t+32+h*16,16));u=32+d*16}if(!u)return{offset:t,size:e};const f=i.getUint32(u);return e-32<f?{offset:t,size:e}:(c=new Uint8Array(a,t+u+4,f),{version:n,systemId:o,kids:l,data:c,offset:t,size:e})}const zd=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),wi={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function cl(i,e){const t=wi[e];return!!t&&!!t[i.slice(0,4)]}function cr(i,e,t=!0){return!i.split(",").some(s=>!ul(s,e,t))}function ul(i,e,t=!0){var s;const r=$s(t);return(s=r?.isTypeSupported(ur(i,e)))!=null?s:!1}function ur(i,e){return`${e}/mp4;codecs=${i}`}function Mc(i){if(i){const e=i.substring(0,4);return wi.video[e]}return 2}function vn(i){const e=zd();return i.split(",").reduce((t,s)=>{const n=e&&Wn(s)?9:wi.video[s];return n?(n*2+t)/(t?3:2):(wi.audio[s]+t)/(t?2:1)},0)}const pa={};function py(i,e=!0){if(pa[i])return pa[i];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[i];for(let r=0;r<t.length;r++){var s;if(ul(t[r],"audio",e))return pa[i]=t[r],t[r];if(t[r]==="mp3"&&(s=$s(e))!=null&&s.isTypeSupported("audio/mpeg"))return""}return i}const yy=/flac|opus|mp4a\.40\.34/i;function En(i,e=!0){return i.replace(yy,t=>py(t.toLowerCase(),e))}function vy(i,e){const t=[];if(i){const s=i.split(",");for(let r=0;r<s.length;r++)cl(s[r],"video")||t.push(s[r])}return e&&t.push(e),t.join(",")}function Xr(i,e){if(i&&(i.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(i)!==-1)&&(Fc(i,"audio")||Fc(i,"video")))return i;if(e){const t=e.split(",");if(t.length>1){if(i){for(let s=t.length;s--;)if(t[s].substring(0,4)===i.substring(0,4))return t[s]}return t[0]}}return e||i}function Fc(i,e){return cl(i,e)&&ul(i,e)}function Ey(i){const e=i.split(",");for(let t=0;t<e.length;t++){const s=e[t].split(".");s.length>2&&s[0]==="avc1"&&(e[t]=`avc1.${parseInt(s[1]).toString(16)}${("000"+parseInt(s[2]).toString(16)).slice(-4)}`)}return e.join(",")}function xy(i){if(i.startsWith("av01.")){const e=i.split("."),t=["0","111","01","01","01","0"];for(let s=e.length;s>4&&s<10;s++)e[s]=t[s-4];return e.join(".")}return i}function Nc(i){const e=$s(i)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function no(i){return i.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const Ty={supported:!0,powerEfficient:!0,smooth:!0},Sy={supported:!1,smooth:!1,powerEfficient:!1},qd={supported:!0,configurations:[],decodingInfoResults:[Ty]};function Xd(i,e){return{supported:!1,configurations:e,decodingInfoResults:[Sy],error:i}}function by(i,e,t,s,r,n){const a=i.videoCodec,o=i.audioCodec?i.audioGroups:null,l=n?.audioCodec,c=n?.channels,u=c?parseInt(c):l?1/0:2;let f=null;if(o!=null&&o.length)try{o.length===1&&o[0]?f=e.groups[o[0]].channels:f=o.reduce((d,h)=>{if(h){const g=e.groups[h];if(!g)throw new Error(`Audio track group ${h} not found`);Object.keys(g.channels).forEach(m=>{d[m]=(d[m]||0)+g.channels[m]})}return d},{2:0})}catch{return!0}return a!==void 0&&(a.split(",").some(d=>Wn(d))||i.width>1920&&i.height>1088||i.height>1920&&i.width>1088||i.frameRate>Math.max(s,30)||i.videoRange!=="SDR"&&i.videoRange!==t||i.bitrate>Math.max(r,8e6))||!!f&&J(u)&&Object.keys(f).some(d=>parseInt(d)>u)}function Qd(i,e,t,s={}){const r=i.videoCodec;if(!r&&!i.audioCodec||!t)return Promise.resolve(qd);const n=[],a=Ay(i),o=a.length,l=Iy(i,e,o>0),c=l.length;for(let u=o||1*c||1;u--;){const f={type:"media-source"};if(o&&(f.video=a[u%o]),c){f.audio=l[u%c];const d=f.audio.bitrate;f.video&&d&&(f.video.bitrate-=d)}n.push(f)}if(r){const u=navigator.userAgent;if(r.split(",").some(f=>Wn(f))&&zd())return Promise.resolve(Xd(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${u})`),n))}return Promise.all(n.map(u=>{const f=_y(u);return s[f]||(s[f]=t.decodingInfo(u))})).then(u=>({supported:!u.some(f=>!f.supported),configurations:n,decodingInfoResults:u})).catch(u=>({supported:!1,configurations:n,decodingInfoResults:[],error:u}))}function Ay(i){var e;const t=(e=i.videoCodec)==null?void 0:e.split(","),s=Zd(i),r=i.width||640,n=i.height||480,a=i.frameRate||30,o=i.videoRange.toLowerCase();return t?t.map(l=>{const c={contentType:ur(xy(l),"video"),width:r,height:n,bitrate:s,framerate:a};return o!=="sdr"&&(c.transferFunction=o),c}):[]}function Iy(i,e,t){var s;const r=(s=i.audioCodec)==null?void 0:s.split(","),n=Zd(i);return r&&i.audioGroups?i.audioGroups.reduce((a,o)=>{var l;const c=o?(l=e.groups[o])==null?void 0:l.tracks:null;return c?c.reduce((u,f)=>{if(f.groupId===o){const d=parseFloat(f.channels||"");r.forEach(h=>{const g={contentType:ur(h,"audio"),bitrate:t?Ly(h,n):n};d&&(g.channels=""+d),u.push(g)})}return u},a):a},[]):[]}function Ly(i,e){if(e<=1)return 1;let t=128e3;return i==="ec-3"?t=768e3:i==="ac-3"&&(t=64e4),Math.min(e/2,t)}function Zd(i){return Math.ceil(Math.max(i.bitrate*.9,i.averageBitrate)/1e3)*1e3||1}function _y(i){let e="";const{audio:t,video:s}=i;if(s){const r=no(s.contentType);e+=`${r}_r${s.height}x${s.width}f${Math.ceil(s.framerate)}${s.transferFunction||"sd"}_${Math.ceil(s.bitrate/1e5)}`}if(t){const r=no(t.contentType);e+=`${s?"_":""}${r}_c${t.channels}`}return e}const ao=["NONE","TYPE-0","TYPE-1",null];function Ry(i){return ao.indexOf(i)>-1}const xn=["SDR","PQ","HLG"];function Cy(i){return!!i&&xn.indexOf(i)>-1}var Qr={No:"",Yes:"YES",v2:"v2"};function $c(i){const{canSkipUntil:e,canSkipDateRanges:t,age:s}=i,r=s<e/2;return e&&r?t?Qr.v2:Qr.Yes:Qr.No}class Bc{constructor(e,t,s){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=s}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class fr{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(s=>!!s).map(s=>s.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const s=(t=e.supplemental)==null?void 0:t.videoCodec;s&&s!==e.videoCodec&&(this.codecSet+=`,${s.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return Uc(this._audioGroups,e)}hasSubtitleGroup(e){return Uc(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let s=this._audioGroups;s||(s=this._audioGroups=[]),s.indexOf(t)===-1&&s.push(t)}else if(e==="text"){let s=this._subtitleGroups;s||(s=this._subtitleGroups=[]),s.indexOf(t)===-1&&s.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function Uc(i,e){return!e||!i?!1:i.indexOf(e)!==-1}function wy(){if(typeof matchMedia=="function"){const i=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(i.media!==e.media)return i.matches===!0}return!1}function Dy(i,e){let t=!1,s=[];if(i&&(t=i!=="SDR",s=[i]),e){s=e.allowedVideoRanges||xn.slice(0);const r=s.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:r&&wy(),t||(s=["SDR"])}return{preferHDR:t,allowedVideoRanges:s}}const ky=i=>{const e=new WeakSet;return(t,s)=>{if(i&&(s=i(t,s)),typeof s=="object"&&s!==null){if(e.has(s))return;e.add(s)}return s}},Pe=(i,e)=>JSON.stringify(i,ky(e));function Py(i,e,t,s,r){const n=Object.keys(i),a=s?.channels,o=s?.audioCodec,l=r?.videoCodec,c=a&&parseInt(a)===2;let u=!1,f=!1,d=1/0,h=1/0,g=1/0,m=1/0,p=0,v=[];const{preferHDR:E,allowedVideoRanges:x}=Dy(e,r);for(let w=n.length;w--;){const L=i[n[w]];u||(u=L.channels[2]>0),d=Math.min(d,L.minHeight),h=Math.min(h,L.minFramerate),g=Math.min(g,L.minBitrate),x.filter(O=>L.videoRanges[O]>0).length>0&&(f=!0)}d=J(d)?d:0,h=J(h)?h:0;const T=Math.max(1080,d),S=Math.max(30,h);g=J(g)?g:t,t=Math.max(g,t),f||(e=void 0);const C=n.length>1;return{codecSet:n.reduce((w,L)=>{const I=i[L];if(L===w)return w;if(v=f?x.filter(O=>I.videoRanges[O]>0):[],C){if(I.minBitrate>t)return Ht(L,`min bitrate of ${I.minBitrate} > current estimate of ${t}`),w;if(!I.hasDefaultAudio)return Ht(L,"no renditions with default or auto-select sound found"),w;if(o&&L.indexOf(o.substring(0,4))%5!==0)return Ht(L,`audio codec preference "${o}" not found`),w;if(a&&!c){if(!I.channels[a])return Ht(L,`no renditions with ${a} channel sound found (channels options: ${Object.keys(I.channels)})`),w}else if((!o||c)&&u&&I.channels[2]===0)return Ht(L,"no renditions with stereo sound found"),w;if(I.minHeight>T)return Ht(L,`min resolution of ${I.minHeight} > maximum of ${T}`),w;if(I.minFramerate>S)return Ht(L,`min framerate of ${I.minFramerate} > maximum of ${S}`),w;if(!v.some(O=>I.videoRanges[O]>0))return Ht(L,`no variants with VIDEO-RANGE of ${Pe(v)} found`),w;if(l&&L.indexOf(l.substring(0,4))%5!==0)return Ht(L,`video codec preference "${l}" not found`),w;if(I.maxScore<p)return Ht(L,`max score of ${I.maxScore} < selected max of ${p}`),w}return w&&(vn(L)>=vn(w)||I.fragmentError>i[w].fragmentError)?w:(m=I.minIndex,p=I.maxScore,L)},void 0),videoRanges:v,preferHDR:E,minFramerate:h,minBitrate:g,minIndex:m}}function Ht(i,e){Ce.log(`[abr] start candidates with "${i}" ignored because ${e}`)}function Jd(i){return i.reduce((e,t)=>{let s=e.groups[t.groupId];s||(s=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),s.tracks.push(t);const r=t.channels||"2";return s.channels[r]=(s.channels[r]||0)+1,s.hasDefault=s.hasDefault||t.default,s.hasAutoSelect=s.hasAutoSelect||t.autoselect,s.hasDefault&&(e.hasDefaultAudio=!0),s.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function Oy(i,e,t,s){return i.slice(t,s+1).reduce((r,n,a)=>{if(!n.codecSet)return r;const o=n.audioGroups;let l=r[n.codecSet];l||(r[n.codecSet]=l={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:a,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!o,fragmentError:0}),l.minBitrate=Math.min(l.minBitrate,n.bitrate);const c=Math.min(n.height,n.width);return l.minHeight=Math.min(l.minHeight,c),l.minFramerate=Math.min(l.minFramerate,n.frameRate),l.minIndex=Math.min(l.minIndex,a),l.maxScore=Math.max(l.maxScore,n.score),l.fragmentError+=n.fragmentError,l.videoRanges[n.videoRange]=(l.videoRanges[n.videoRange]||0)+1,o&&o.forEach(u=>{if(!u)return;const f=e.groups[u];f&&(l.hasDefaultAudio=l.hasDefaultAudio||e.hasDefaultAudio?f.hasDefault:f.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(f.channels).forEach(d=>{l.channels[d]=(l.channels[d]||0)+f.channels[d]}))}),r},{})}function Gc(i){if(!i)return i;const{lang:e,assocLang:t,characteristics:s,channels:r,audioCodec:n}=i;return{lang:e,assocLang:t,characteristics:s,channels:r,audioCodec:n}}function Qt(i,e,t){if("attrs"in i){const s=e.indexOf(i);if(s!==-1)return s}for(let s=0;s<e.length;s++){const r=e[s];if(si(i,r,t))return s}return-1}function si(i,e,t){const{groupId:s,name:r,lang:n,assocLang:a,default:o}=i,l=i.forced;return(s===void 0||e.groupId===s)&&(r===void 0||e.name===r)&&(n===void 0||My(n,e.lang))&&(n===void 0||e.assocLang===a)&&(o===void 0||e.default===o)&&(l===void 0||e.forced===l)&&(!("characteristics"in i)||Fy(i.characteristics||"",e.characteristics))&&(t===void 0||t(i,e))}function My(i,e="--"){return i.length===e.length?i===e:i.startsWith(e)||e.startsWith(i)}function Fy(i,e=""){const t=i.split(","),s=e.split(",");return t.length===s.length&&!t.some(r=>s.indexOf(r)===-1)}function Qs(i,e){const{audioCodec:t,channels:s}=i;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(s===void 0||s===(e.channels||"2"))}function Ny(i,e,t,s,r){const n=e[s],o=e.reduce((d,h,g)=>{const m=h.uri;return(d[m]||(d[m]=[])).push(g),d},{})[n.uri];o.length>1&&(s=Math.max.apply(Math,o));const l=n.videoRange,c=n.frameRate,u=n.codecSet.substring(0,4),f=Vc(e,s,d=>{if(d.videoRange!==l||d.frameRate!==c||d.codecSet.substring(0,4)!==u)return!1;const h=d.audioGroups,g=t.filter(m=>!h||h.indexOf(m.groupId)!==-1);return Qt(i,g,r)>-1});return f>-1?f:Vc(e,s,d=>{const h=d.audioGroups,g=t.filter(m=>!h||h.indexOf(m.groupId)!==-1);return Qt(i,g,r)>-1})}function Vc(i,e,t){for(let s=e;s>-1;s--)if(t(i[s]))return s;for(let s=e+1;s<i.length;s++)if(t(i[s]))return s;return-1}function Tn(i,e){var t;return!!i&&i!==((t=e.loadLevelObj)==null?void 0:t.uri)}class $y extends Pt{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var s;const{fragCurrent:r,partCurrent:n,hls:a}=this,{autoLevelEnabled:o,media:l}=a;if(!r||!l)return;const c=performance.now(),u=n?n.stats:r.stats,f=n?n.duration:r.duration,d=c-u.loading.start,h=a.minAutoLevel,g=r.level,m=this._nextAutoLevel;if(u.aborted||u.loaded&&u.loaded===u.total||g<=h){this.clearTimer(),this._nextAutoLevel=-1;return}if(!o)return;const p=m>-1&&m!==g,v=!!t||p;if(!v&&(l.paused||!l.playbackRate||!l.readyState))return;const E=a.mainForwardBufferInfo;if(!v&&E===null)return;const x=this.bwEstimator.getEstimateTTFB(),T=Math.abs(l.playbackRate);if(d<=Math.max(x,1e3*(f/(T*2))))return;const S=E?E.len/T:0,C=u.loading.first?u.loading.first-u.loading.start:-1,A=u.loaded&&C>-1,w=this.getBwEstimate(),L=a.levels,I=L[g],O=Math.max(u.loaded,Math.round(f*(r.bitrate||I.averageBitrate)/8));let P=A?d-C:d;P<1&&A&&(P=Math.min(d,u.loaded*8/w));const H=A?u.loaded*1e3/P:0,Q=x/1e3,Z=H?(O-u.loaded)/H:O*8/w+Q;if(Z<=S)return;const U=H?H*8:w,Y=((s=t?.details||this.hls.latestLevelDetails)==null?void 0:s.live)===!0,G=this.hls.config.abrBandWidthUpFactor;let te=Number.POSITIVE_INFINITY,oe;for(oe=g-1;oe>h;oe--){const Se=L[oe].maxBitrate,ge=!L[oe].details||Y;if(te=this.getTimeToLoadFrag(Q,U,f*Se,ge),te<Math.min(S,f+Q))break}if(te>=Z||te>f*10)return;A?this.bwEstimator.sample(d-Math.min(x,C),u.loaded):this.bwEstimator.sampleTTFB(d);const z=L[oe].maxBitrate;this.getBwEstimate()*G>z&&this.resetEstimator(z);const j=this.findBestLevel(z,h,oe,0,S,1,1);j>-1&&(oe=j),this.warn(`Fragment ${r.sn}${n?" part "+n.index:""} of level ${g} is loading too slowly;
      Fragment duration: ${r.duration.toFixed(3)}
      Time to underbuffer: ${S.toFixed(3)} s
      Estimated load time for current fragment: ${Z.toFixed(3)} s
      Estimated load time for down switch fragment: ${te.toFixed(3)} s
      TTFB estimate: ${C|0} ms
      Current BW estimate: ${J(w)?w|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${oe} @ ${z|0} bps`),a.nextLoadLevel=a.nextAutoLevel=oe,this.clearTimer();const he=()=>{if(this.clearTimer(),this.fragCurrent===r&&this.hls.loadLevel===oe&&oe>0){const Se=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${oe>0?"and switching down":""}
      Fragment duration: ${r.duration.toFixed(3)} s
      Time to underbuffer: ${Se.toFixed(3)} s`),r.abortRequests(),this.fragCurrent=this.partCurrent=null,oe>h){let ge=this.findBestLevel(this.hls.levels[h].bitrate,h,oe,0,Se,1,1);ge===-1&&(ge=h),this.hls.nextLoadLevel=this.hls.nextAutoLevel=ge,this.resetEstimator(this.hls.levels[ge].bitrate)}}};p||Z>te*2?he():this.timer=self.setInterval(he,te*1e3),a.trigger(y.FRAG_LOAD_EMERGENCY_ABORTED,{frag:r,part:n,stats:u})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new K1(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.FRAG_LOADING,this.onFragLoading,this),e.on(y.FRAG_LOADED,this.onFragLoaded,this),e.on(y.FRAG_BUFFERED,this.onFragBuffered,this),e.on(y.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(y.LEVEL_LOADED,this.onLevelLoaded,this),e.on(y.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(y.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(y.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.FRAG_LOADING,this.onFragLoading,this),e.off(y.FRAG_LOADED,this.onFragLoaded,this),e.off(y.FRAG_BUFFERED,this.onFragBuffered,this),e.off(y.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(y.LEVEL_LOADED,this.onLevelLoaded,this),e.off(y.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(y.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(y.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const s=t.frag;if(!this.ignoreFragment(s)){if(!s.bitrateTest){var r;this.fragCurrent=s,this.partCurrent=(r=t.part)!=null?r:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case k.BUFFER_ADD_CODEC_ERROR:case k.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case k.FRAG_LOAD_TIMEOUT:{const s=t.frag,{fragCurrent:r,partCurrent:n}=this;if(s&&r&&s.sn===r.sn&&s.level===r.level){const a=performance.now(),o=n?n.stats:s.stats,l=a-o.loading.start,c=o.loading.first?o.loading.first-o.loading.start:-1;if(o.loaded&&c>-1){const f=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(l-Math.min(f,c),o.loaded)}else this.bwEstimator.sampleTTFB(l)}break}}}getTimeToLoadFrag(e,t,s,r){const n=e+s/t,a=r?e+this.lastLevelLoadSec:0;return n+a}onLevelLoaded(e,t){const s=this.hls.config,{loading:r}=t.stats,n=r.end-r.first;J(n)&&(this.lastLevelLoadSec=n/1e3),t.details.live?this.bwEstimator.update(s.abrEwmaSlowLive,s.abrEwmaFastLive):this.bwEstimator.update(s.abrEwmaSlowVoD,s.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:s}){const r=s?s.stats:t.stats;if(t.type===se.MAIN&&this.bwEstimator.sampleTTFB(r.loading.first-r.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const n=s?s.duration:t.duration,a=this.hls.levels[t.level],o=(a.loaded?a.loaded.bytes:0)+r.loaded,l=(a.loaded?a.loaded.duration:0)+n;a.loaded={bytes:o,duration:l},a.realBitrate=Math.round(8*o/l)}if(t.bitrateTest){const n={stats:r,frag:t,part:s,id:t.type};this.onFragBuffered(y.FRAG_BUFFERED,n),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:s,part:r}=t,n=r!=null&&r.stats.loaded?r.stats:s.stats;if(n.aborted||this.ignoreFragment(s))return;const a=n.parsing.end-n.loading.start-Math.min(n.loading.first-n.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(a,n.loaded),n.bwEstimate=this.getBwEstimate(),s.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==se.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,s=this.getBwEstimate(),r=this.hls.config.maxStarvationDelay,n=this.findBestLevel(s,t,e,0,r,1,1);if(n>-1)return n;const a=this.hls.firstLevel,o=Math.min(Math.max(a,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${a} clamped to ${o}`),o}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,s=this.bwEstimator.canEstimate(),r=this.lastLoadedFragLevel>-1;if(e!==-1&&(!s||!r||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const n=s&&r?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const a=this.hls.levels;if(a.length>Math.max(e,n)&&a[e].loadError<=a[n].loadError)return e}return this._nextAutoLevel=n,this.nextAutoLevelKey=this.getAutoLevelKey(),n}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:s}=this;if(s.levels.length<=1)return s.loadLevel;const{maxAutoLevel:r,config:n,minAutoLevel:a}=s,o=t?t.duration:e?e.duration:0,l=this.getBwEstimate(),c=this.getStarvationDelay();let u=n.abrBandWidthFactor,f=n.abrBandWidthUpFactor;if(c){const p=this.findBestLevel(l,a,r,c,0,u,f);if(p>=0)return this.rebufferNotice=-1,p}let d=o?Math.min(o,n.maxStarvationDelay):n.maxStarvationDelay;if(!c){const p=this.bitrateTestDelay;p&&(d=(o?Math.min(o,n.maxLoadingDelay):n.maxLoadingDelay)-p,this.info(`bitrate test took ${Math.round(1e3*p)}ms, set first fragment max fetchDuration to ${Math.round(1e3*d)} ms`),u=f=1)}const h=this.findBestLevel(l,a,r,c,d,u,f);if(this.rebufferNotice!==h&&(this.rebufferNotice=h,this.info(`${c?"rebuffering expected":"buffer is empty"}, optimal quality level ${h}`)),h>-1)return h;const g=s.levels[a],m=s.loadLevelObj;return m&&g?.bitrate<m.bitrate?a:s.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const s=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,r=e.mainForwardBufferInfo;return(r?r.len:0)/s}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,s,r,n,a,o){var l;const c=r+n,u=this.lastLoadedFragLevel,f=u===-1?this.hls.firstLevel:u,{fragCurrent:d,partCurrent:h}=this,{levels:g,allAudioTracks:m,loadLevel:p,config:v}=this.hls;if(g.length===1)return 0;const E=g[f],x=!!((l=this.hls.latestLevelDetails)!=null&&l.live),T=p===-1||u===-1;let S,C="SDR",A=E?.frameRate||0;const{audioPreference:w,videoPreference:L}=v,I=this.audioTracksByGroup||(this.audioTracksByGroup=Jd(m));let O=-1;if(T){if(this.firstSelection!==-1)return this.firstSelection;const U=this.codecTiers||(this.codecTiers=Oy(g,I,t,s)),Y=Py(U,C,e,w,L),{codecSet:G,videoRanges:te,minFramerate:oe,minBitrate:z,minIndex:j,preferHDR:he}=Y;O=j,S=G,C=he?te[te.length-1]:te[0],A=oe,e=Math.max(e,z),this.log(`picked start tier ${Pe(Y)}`)}else S=E?.codecSet,C=E?.videoRange;const P=h?h.duration:d?d.duration:0,H=this.bwEstimator.getEstimateTTFB()/1e3,Q=[];for(let U=s;U>=t;U--){var Z;const Y=g[U],G=U>f;if(!Y)continue;if(v.useMediaCapabilities&&!Y.supportedResult&&!Y.supportedPromise){const ge=navigator.mediaCapabilities;typeof ge?.decodingInfo=="function"&&by(Y,I,C,A,e,w)?(Y.supportedPromise=Qd(Y,I,ge,this.supportedCache),Y.supportedPromise.then(me=>{if(!this.hls)return;Y.supportedResult=me;const Ue=this.hls.levels,Ge=Ue.indexOf(Y);me.error?this.warn(`MediaCapabilities decodingInfo error: "${me.error}" for level ${Ge} ${Pe(me)}`):me.supported?me.decodingInfoResults.some(lt=>lt.smooth===!1||lt.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${Ge} not smooth or powerEfficient: ${Pe(me)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${Ge} ${Pe(me)}`),Ge>-1&&Ue.length>1&&(this.log(`Removing unsupported level ${Ge}`),this.hls.removeLevel(Ge),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))}).catch(me=>{this.warn(`Error handling MediaCapabilities decodingInfo: ${me}`)})):Y.supportedResult=qd}if((S&&Y.codecSet!==S||C&&Y.videoRange!==C||G&&A>Y.frameRate||!G&&A>0&&A<Y.frameRate||(Z=Y.supportedResult)!=null&&(Z=Z.decodingInfoResults)!=null&&Z.some(ge=>ge.smooth===!1))&&(!T||U!==O)){Q.push(U);continue}const te=Y.details,oe=(h?te?.partTarget:te?.averagetargetduration)||P;let z;G?z=o*e:z=a*e;const j=P&&r>=P*2&&n===0?Y.averageBitrate:Y.maxBitrate,he=this.getTimeToLoadFrag(H,z,j*oe,te===void 0);if(z>=j&&(U===u||Y.loadError===0&&Y.fragmentError===0)&&(he<=H||!J(he)||x&&!this.bitrateTestDelay||he<c)){const ge=this.forcedAutoLevel;return U!==p&&(ge===-1||ge!==p)&&(Q.length&&this.trace(`Skipped level(s) ${Q.join(",")} of ${s} max with CODECS and VIDEO-RANGE:"${g[Q[0]].codecs}" ${g[Q[0]].videoRange}; not compatible with "${S}" ${C}`),this.info(`switch candidate:${f}->${U} adjustedbw(${Math.round(z)})-bitrate=${Math.round(z-j)} ttfb:${H.toFixed(1)} avgDuration:${oe.toFixed(1)} maxFetchDuration:${c.toFixed(1)} fetchDuration:${he.toFixed(1)} firstSelection:${T} codecSet:${Y.codecSet} videoRange:${Y.videoRange} hls.loadLevel:${p}`)),T&&(this.firstSelection=U),U}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:s}=this.hls;return Math.min(Math.max(e,s),t)}}const eh={search:function(i,e){let t=0,s=i.length-1,r=null,n=null;for(;t<=s;){r=(t+s)/2|0,n=i[r];const a=e(n);if(a>0)t=r+1;else if(a<0)s=r-1;else return n}return null}};function By(i,e,t){if(e===null||!Array.isArray(i)||!i.length||!J(e))return null;const s=i[0].programDateTime;if(e<(s||0))return null;const r=i[i.length-1].endProgramDateTime;if(e>=(r||0))return null;for(let n=0;n<i.length;++n){const a=i[n];if(Gy(e,t,a))return a}return null}function ii(i,e,t=0,s=0,r=.005){let n=null;if(i){n=e[1+i.sn-e[0].sn]||null;const o=i.endDTS-t;o>0&&o<15e-7&&(t+=15e-7),n&&i.level!==n.level&&n.end<=i.end&&(n=e[2+i.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(n=e[0]);if(n&&((!i||i.level===n.level)&&Kc(t,s,n)===0||Uy(n,i,Math.min(r,s))))return n;const a=eh.search(e,Kc.bind(null,t,s));return a&&(a!==i||!n)?a:n}function Uy(i,e,t){if(e&&e.start===0&&e.level<i.level&&(e.endPTS||0)>0){const s=e.tagList.reduce((r,n)=>(n[0]==="INF"&&(r+=parseFloat(n[1])),r),t);return i.start<=s}return!1}function Kc(i=0,e=0,t){if(t.start<=i&&t.start+t.duration>i)return 0;const s=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-s<=i?1:t.start-s>i&&t.start?-1:0}function Gy(i,e,t){const s=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-s>i}function th(i,e,t){if(i&&i.startCC<=e&&i.endCC>=e){let s=i.fragments;const{fragmentHint:r}=i;r&&(s=s.concat(r));let n;return eh.search(s,a=>a.cc<e?1:a.cc>e?-1:(n=a,a.end<=t?1:a.start>t?-1:0)),n||null}return null}function Sn(i){switch(i.details){case k.FRAG_LOAD_TIMEOUT:case k.KEY_LOAD_TIMEOUT:case k.LEVEL_LOAD_TIMEOUT:case k.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function sh(i){return i.details.startsWith("key")}function ih(i){return sh(i)&&!!i.frag&&!i.frag.decryptdata}function Hc(i,e){const t=Sn(e);return i.default[`${t?"timeout":"error"}Retry`]}function fl(i,e){const t=i.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*i.retryDelayMs,i.maxRetryDelayMs)}function jc(i){return Re(Re({},i),{errorRetry:null,timeoutRetry:null})}function bn(i,e,t,s){if(!i)return!1;const r=s?.code,n=e<i.maxNumRetry&&(Vy(r)||!!t);return i.shouldRetry?i.shouldRetry(i,e,t,s,n):n}function Vy(i){return oo(i)||!!i&&(i<400||i>499)}function oo(i){return i===0&&navigator.onLine===!1}var Qe={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},Tt={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,MoveAllAlternatesMatchingKey:4};class Ky extends Pt{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(y.ERROR,this.onError,this),e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(y.ERROR,this.onError,this),e.off(y.ERROR,this.onErrorOut,this),e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return e?.type===se.MAIN?e.level:this.getVariantIndex()}getVariantIndex(){var e;const t=this.hls,s=t.currentLevel;return(e=t.loadLevelObj)!=null&&e.details||s===-1?t.loadLevel:s}variantHasKey(e,t){if(e){var s;if((s=e.details)!=null&&s.hasKey(t))return!0;const r=e.audioGroups;if(r)return this.hls.allAudioTracks.filter(a=>r.indexOf(a.groupId)>=0).some(a=>{var o;return(o=a.details)==null?void 0:o.hasKey(t)})}return!1}onManifestLoading(){this.playlistError=0}onLevelUpdated(){this.playlistError=0}onError(e,t){var s;if(t.fatal)return;const r=this.hls,n=t.context;switch(t.details){case k.FRAG_LOAD_ERROR:case k.FRAG_LOAD_TIMEOUT:case k.KEY_LOAD_ERROR:case k.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case k.FRAG_PARSING_ERROR:if((s=t.frag)!=null&&s.gap){t.errorAction=Ai();return}case k.FRAG_GAP:case k.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=Qe.SendAlternateToPenaltyBox;return}case k.LEVEL_EMPTY_ERROR:case k.LEVEL_PARSING_ERROR:{var a;const l=t.parent===se.MAIN?t.level:r.loadLevel;t.details===k.LEVEL_EMPTY_ERROR&&((a=t.context)!=null&&(a=a.levelDetails)!=null&&a.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,l):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,l))}return;case k.LEVEL_LOAD_ERROR:case k.LEVEL_LOAD_TIMEOUT:typeof n?.level=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,n.level));return;case k.AUDIO_TRACK_LOAD_ERROR:case k.AUDIO_TRACK_LOAD_TIMEOUT:case k.SUBTITLE_LOAD_ERROR:case k.SUBTITLE_TRACK_LOAD_TIMEOUT:if(n){const l=r.loadLevelObj;if(l&&(n.type===Ee.AUDIO_TRACK&&l.hasAudioGroup(n.groupId)||n.type===Ee.SUBTITLE_TRACK&&l.hasSubtitleGroup(n.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r.loadLevel),t.errorAction.action=Qe.SendAlternateToPenaltyBox,t.errorAction.flags=Tt.MoveAllAlternatesMatchingHost;return}}return;case k.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:t.errorAction={action:Qe.SendAlternateToPenaltyBox,flags:Tt.MoveAllAlternatesMatchingHDCP};return;case k.KEY_SYSTEM_SESSION_UPDATE_FAILED:case k.KEY_SYSTEM_STATUS_INTERNAL_ERROR:case k.KEY_SYSTEM_NO_SESSION:t.errorAction={action:Qe.SendAlternateToPenaltyBox,flags:Tt.MoveAllAlternatesMatchingKey};return;case k.BUFFER_ADD_CODEC_ERROR:case k.REMUX_ALLOC_ERROR:case k.BUFFER_APPEND_ERROR:if(!t.errorAction){var o;t.errorAction=this.getLevelSwitchAction(t,(o=t.level)!=null?o:r.loadLevel)}return;case k.INTERNAL_EXCEPTION:case k.BUFFER_APPENDING_ERROR:case k.BUFFER_FULL_ERROR:case k.LEVEL_SWITCH_ERROR:case k.BUFFER_STALLED_ERROR:case k.BUFFER_SEEK_OVER_HOLE:case k.BUFFER_NUDGE_ON_STALL:t.errorAction=Ai();return}t.type===ie.KEY_SYSTEM_ERROR&&(t.levelRetry=!1,t.errorAction=Ai())}getPlaylistRetryOrSwitchAction(e,t){const s=this.hls,r=Hc(s.config.playlistLoadPolicy,e),n=this.playlistError++;if(bn(r,n,Sn(e),e.response))return{action:Qe.RetryRequest,flags:Tt.None,retryConfig:r,retryCount:n};const o=this.getLevelSwitchAction(e,t);return r&&(o.retryConfig=r,o.retryCount=n),o}getFragRetryOrSwitchAction(e){const t=this.hls,s=this.getVariantLevelIndex(e.frag),r=t.levels[s],{fragLoadPolicy:n,keyLoadPolicy:a}=t.config,o=Hc(sh(e)?a:n,e),l=t.levels.reduce((u,f)=>u+f.fragmentError,0);if(r&&(e.details!==k.FRAG_GAP&&r.fragmentError++,!ih(e)&&bn(o,l,Sn(e),e.response)))return{action:Qe.RetryRequest,flags:Tt.None,retryConfig:o,retryCount:l};const c=this.getLevelSwitchAction(e,s);return o&&(c.retryConfig=o,c.retryCount=l),c}getLevelSwitchAction(e,t){const s=this.hls;t==null&&(t=s.loadLevel);const r=this.hls.levels[t];if(r){var n,a;const c=e.details;r.loadError++,c===k.BUFFER_APPEND_ERROR&&r.fragmentError++;let u=-1;const{levels:f,loadLevel:d,minAutoLevel:h,maxAutoLevel:g}=s;!s.autoLevelEnabled&&!s.config.preserveManualLevelOnError&&(s.loadLevel=-1);const m=(n=e.frag)==null?void 0:n.type,v=(m===se.AUDIO&&c===k.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(c===k.BUFFER_ADD_CODEC_ERROR||c===k.BUFFER_APPEND_ERROR))&&f.some(({audioCodec:C})=>r.audioCodec!==C),x=e.sourceBufferName==="video"&&(c===k.BUFFER_ADD_CODEC_ERROR||c===k.BUFFER_APPEND_ERROR)&&f.some(({codecSet:C,audioCodec:A})=>r.codecSet!==C&&r.audioCodec===A),{type:T,groupId:S}=(a=e.context)!=null?a:{};for(let C=f.length;C--;){const A=(C+d)%f.length;if(A!==d&&A>=h&&A<=g&&f[A].loadError===0){var o,l;const w=f[A];if(c===k.FRAG_GAP&&m===se.MAIN&&e.frag){const L=f[A].details;if(L){const I=ii(e.frag,L.fragments,e.frag.start);if(I!=null&&I.gap)continue}}else{if(T===Ee.AUDIO_TRACK&&w.hasAudioGroup(S)||T===Ee.SUBTITLE_TRACK&&w.hasSubtitleGroup(S))continue;if(m===se.AUDIO&&(o=r.audioGroups)!=null&&o.some(L=>w.hasAudioGroup(L))||m===se.SUBTITLE&&(l=r.subtitleGroups)!=null&&l.some(L=>w.hasSubtitleGroup(L))||v&&r.audioCodec===w.audioCodec||x&&r.codecSet===w.codecSet||!v&&r.codecSet!==w.codecSet)continue}u=A;break}}if(u>-1&&s.loadLevel!==u)return e.levelRetry=!0,this.playlistError=0,{action:Qe.SendAlternateToPenaltyBox,flags:Tt.None,nextAutoLevel:u}}return{action:Qe.SendAlternateToPenaltyBox,flags:Tt.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var s;switch((s=t.errorAction)==null?void 0:s.action){case Qe.DoNothing:break;case Qe.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==k.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,s=e.errorAction;if(!s)return;const{flags:r}=s,n=s.nextAutoLevel;switch(r){case Tt.None:this.switchLevel(e,n);break;case Tt.MoveAllAlternatesMatchingHDCP:{const l=this.getVariantLevelIndex(e.frag),c=t.levels[l],u=c?.attrs["HDCP-LEVEL"];if(s.hdcpLevel=u,u==="NONE")this.warn("HDCP policy resticted output with HDCP-LEVEL=NONE");else if(u){t.maxHdcpLevel=ao[ao.indexOf(u)-1],s.resolved=!0,this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}}case Tt.MoveAllAlternatesMatchingKey:{const l=e.decryptdata;if(l){const c=this.hls.levels,u=c.length;for(let d=u;d--;)if(this.variantHasKey(c[d],l)){var a,o;this.log(`Banned key found in level ${d} (${c[d].bitrate}bps) or audio group "${(a=c[d].audioGroups)==null?void 0:a.join(",")}" (${(o=e.frag)==null?void 0:o.type} fragment) ${Ze(l.keyId||[])}`),c[d].fragmentError++,c[d].loadError++,this.log(`Removing level ${d} with key error (${e.error})`),this.hls.removeLevel(d)}const f=e.frag;if(this.hls.levels.length<u)s.resolved=!0;else if(f&&f.type!==se.MAIN){const d=f.decryptdata;d&&!l.matches(d)&&(s.resolved=!0)}}break}}s.resolved||this.switchLevel(e,n)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===k.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const s=no(e.mimeType),r=this.hls.levels;for(let n=r.length;n--;)r[n][`${e.sourceBufferName}Codec`]===s&&(this.log(`Removing level ${n} for ${e.details} ("${s}" not supported)`),this.hls.removeLevel(n))}}}function Ai(i){const e={action:Qe.DoNothing,flags:Tt.None};return i&&(e.resolved=!0),e}var je={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class Hy{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e&&(e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.BUFFER_APPENDED,this.onBufferAppended,this),e.on(y.FRAG_BUFFERED,this.onFragBuffered,this),e.on(y.FRAG_LOADED,this.onFragLoaded,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.BUFFER_APPENDED,this.onBufferAppended,this),e.off(y.FRAG_BUFFERED,this.onFragBuffered,this),e.off(y.FRAG_LOADED,this.onFragLoaded,this))}destroy(){this._unregisterListeners(),this.hls=this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const s=this.activePartLists[t];if(s)for(let r=s.length;r--;){const n=s[r];if(!n)break;if(n.start<=e&&e<=n.end&&n.loaded)return n}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,s){const{fragments:r}=this,n=Object.keys(r);for(let a=n.length;a--;){const o=r[n[a]];if(o?.body.type===t&&(!s||o.buffered)){const l=o.body;if(l.start<=e&&e<=l.end)return l}}return null}detectEvictedFragments(e,t,s,r,n){this.timeRanges&&(this.timeRanges[e]=t);const a=r?.fragment.sn||-1;Object.keys(this.fragments).forEach(o=>{const l=this.fragments[o];if(!l||a>=l.body.sn)return;if(!l.buffered&&(!l.loaded||n)){l.body.type===s&&this.removeFragment(l.body);return}const c=l.range[e];if(c){if(c.time.length===0){this.removeFragment(l.body);return}c.time.some(u=>{const f=!this.isTimeBuffered(u.startPTS,u.endPTS,t);return f&&this.removeFragment(l.body),f})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const s=e.frag,r=ui(s),n=this.fragments[r];if(!n||n.buffered&&s.gap)return;const a=!s.relurl;Object.keys(t).forEach(o=>{const l=s.elementaryStreams[o];if(!l)return;const c=t[o],u=a||l.partial===!0;n.range[o]=this.getBufferedTimes(s,e.part,u,c)}),n.loaded=null,Object.keys(n.range).length?(this.bufferedEnd(n,s),Cr(n)||this.removeParts(s.sn-1,s.type)):this.removeFragment(n.body)}bufferedEnd(e,t){e.buffered=!0,(e.body.endList=t.endList||e.body.endList)&&(this.endListFragments[e.body.type]=e)}removeParts(e,t){const s=this.activePartLists[t];s&&(this.activePartLists[t]=Wc(s,r=>r.fragment.sn>=e))}fragBuffered(e,t){const s=ui(e);let r=this.fragments[s];!r&&t&&(r=this.fragments[s]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),r&&(r.loaded=null,this.bufferedEnd(r,e))}getBufferedTimes(e,t,s,r){const n={time:[],partial:s},a=e.start,o=e.end,l=e.minEndPTS||o,c=e.maxStartPTS||a;for(let u=0;u<r.length;u++){const f=r.start(u)-this.bufferPadding,d=r.end(u)+this.bufferPadding;if(c>=f&&l<=d){n.time.push({startPTS:Math.max(a,r.start(u)),endPTS:Math.min(o,r.end(u))});break}else if(a<d&&o>f){const h=Math.max(a,r.start(u)),g=Math.min(o,r.end(u));g>h&&(n.partial=!0,n.time.push({startPTS:h,endPTS:g}))}else if(o<=f)break}return n}getPartialFragment(e){let t=null,s,r,n,a=0;const{bufferPadding:o,fragments:l}=this;return Object.keys(l).forEach(c=>{const u=l[c];u&&Cr(u)&&(r=u.body.start-o,n=u.body.end+o,e>=r&&e<=n&&(s=Math.min(e-r,n-e),a<=s&&(t=u.body,a=s)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||Cr(t))}getState(e){const t=ui(e),s=this.fragments[t];return s?s.buffered?Cr(s)?je.PARTIAL:je.OK:je.APPENDING:je.NOT_LOADED}isTimeBuffered(e,t,s){let r,n;for(let a=0;a<s.length;a++){if(r=s.start(a)-this.bufferPadding,n=s.end(a)+this.bufferPadding,e>=r&&t<=n)return!0;if(t<=r)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const s=t.frag,r=t.part?null:t,n=ui(s);this.fragments[n]={body:s,appendedPTS:null,loaded:r,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:s,part:r,timeRanges:n,type:a}=t;if(s.sn==="initSegment")return;const o=s.type;if(r){let c=this.activePartLists[o];c||(this.activePartLists[o]=c=[]),c.push(r)}this.timeRanges=n;const l=n[a];this.detectEvictedFragments(a,l,o,r)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=ui(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,s=Object.keys(t);if(!e)return s.length>0;for(let r=s.length;r--;){const n=t[s[r]];if(n?.body.type===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,s,r,n){r&&!this.hasGaps||Object.keys(this.fragments).forEach(a=>{const o=this.fragments[a];if(!o)return;const l=o.body;l.type!==s||r&&!l.gap||l.start<t&&l.end>e&&(o.buffered||n)&&this.removeFragment(l)})}removeFragment(e){const t=ui(e);e.clearElementaryStreamInfo();const s=this.activePartLists[e.type];if(s){const r=e.sn;this.activePartLists[e.type]=Wc(s,n=>n.fragment.sn!==r)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const t=(e=this.hls)==null||(e=e.latestLevelDetails)==null?void 0:e.partList;t&&t.forEach(s=>s.clearElementaryStreamInfo())}}function Cr(i){var e,t,s;return i.buffered&&!!(i.body.gap||(e=i.range.video)!=null&&e.partial||(t=i.range.audio)!=null&&t.partial||(s=i.range.audiovideo)!=null&&s.partial)}function ui(i){return`${i.type}_${i.level}_${i.sn}`}function Wc(i,e){return i.filter(t=>{const s=e(t);return s||t.clearElementaryStreamInfo(),s})}var Bs={cbc:0,ctr:1};class jy{constructor(e,t,s){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=s}decrypt(e,t){switch(this.aesMode){case Bs.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case Bs.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function Wy(i){const e=i.byteLength,t=e&&new DataView(i.buffer).getUint8(e-1);return t?i.slice(0,e-t):i}class Yy{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),s=new Uint32Array(4);for(let r=0;r<4;r++)s[r]=t.getUint32(r*4);return s}initTable(){const e=this.sBox,t=this.invSBox,s=this.subMix,r=s[0],n=s[1],a=s[2],o=s[3],l=this.invSubMix,c=l[0],u=l[1],f=l[2],d=l[3],h=new Uint32Array(256);let g=0,m=0,p=0;for(p=0;p<256;p++)p<128?h[p]=p<<1:h[p]=p<<1^283;for(p=0;p<256;p++){let v=m^m<<1^m<<2^m<<3^m<<4;v=v>>>8^v&255^99,e[g]=v,t[v]=g;const E=h[g],x=h[E],T=h[x];let S=h[v]*257^v*16843008;r[g]=S<<24|S>>>8,n[g]=S<<16|S>>>16,a[g]=S<<8|S>>>24,o[g]=S,S=T*16843009^x*65537^E*257^g*16843008,c[v]=S<<24|S>>>8,u[v]=S<<16|S>>>16,f[v]=S<<8|S>>>24,d[v]=S,g?(g=E^h[h[h[T^E]]],m^=h[h[m]]):g=m=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let s=!0,r=0;for(;r<t.length&&s;)s=t[r]===this.key[r],r++;if(s)return;this.key=t;const n=this.keySize=t.length;if(n!==4&&n!==6&&n!==8)throw new Error("Invalid aes key size="+n);const a=this.ksRows=(n+6+1)*4;let o,l;const c=this.keySchedule=new Uint32Array(a),u=this.invKeySchedule=new Uint32Array(a),f=this.sBox,d=this.rcon,h=this.invSubMix,g=h[0],m=h[1],p=h[2],v=h[3];let E,x;for(o=0;o<a;o++){if(o<n){E=c[o]=t[o];continue}x=E,o%n===0?(x=x<<8|x>>>24,x=f[x>>>24]<<24|f[x>>>16&255]<<16|f[x>>>8&255]<<8|f[x&255],x^=d[o/n|0]<<24):n>6&&o%n===4&&(x=f[x>>>24]<<24|f[x>>>16&255]<<16|f[x>>>8&255]<<8|f[x&255]),c[o]=E=(c[o-n]^x)>>>0}for(l=0;l<a;l++)o=a-l,l&3?x=c[o]:x=c[o-4],l<4||o<=4?u[l]=x:u[l]=g[f[x>>>24]]^m[f[x>>>16&255]]^p[f[x>>>8&255]]^v[f[x&255]],u[l]=u[l]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,s){const r=this.keySize+6,n=this.invKeySchedule,a=this.invSBox,o=this.invSubMix,l=o[0],c=o[1],u=o[2],f=o[3],d=this.uint8ArrayToUint32Array_(s);let h=d[0],g=d[1],m=d[2],p=d[3];const v=new Int32Array(e),E=new Int32Array(v.length);let x,T,S,C,A,w,L,I,O,P,H,Q,Z,U;const Y=this.networkToHostOrderSwap;for(;t<v.length;){for(O=Y(v[t]),P=Y(v[t+1]),H=Y(v[t+2]),Q=Y(v[t+3]),A=O^n[0],w=Q^n[1],L=H^n[2],I=P^n[3],Z=4,U=1;U<r;U++)x=l[A>>>24]^c[w>>16&255]^u[L>>8&255]^f[I&255]^n[Z],T=l[w>>>24]^c[L>>16&255]^u[I>>8&255]^f[A&255]^n[Z+1],S=l[L>>>24]^c[I>>16&255]^u[A>>8&255]^f[w&255]^n[Z+2],C=l[I>>>24]^c[A>>16&255]^u[w>>8&255]^f[L&255]^n[Z+3],A=x,w=T,L=S,I=C,Z=Z+4;x=a[A>>>24]<<24^a[w>>16&255]<<16^a[L>>8&255]<<8^a[I&255]^n[Z],T=a[w>>>24]<<24^a[L>>16&255]<<16^a[I>>8&255]<<8^a[A&255]^n[Z+1],S=a[L>>>24]<<24^a[I>>16&255]<<16^a[A>>8&255]<<8^a[w&255]^n[Z+2],C=a[I>>>24]<<24^a[A>>16&255]<<16^a[w>>8&255]<<8^a[L&255]^n[Z+3],E[t]=Y(x^h),E[t+1]=Y(C^g),E[t+2]=Y(S^m),E[t+3]=Y(T^p),h=O,g=P,m=H,p=Q,t=t+4}return E.buffer}}class zy{constructor(e,t,s){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=s}expandKey(){const e=qy(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function qy(i){switch(i){case Bs.cbc:return"AES-CBC";case Bs.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${i}`)}}const Xy=16;class dl{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const s=self.crypto;s&&(this.subtle=s.subtle||s.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const s=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?Wy(s):s}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,s,r){return this.useSoftware?new Promise((n,a)=>{const o=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(o,t,s,r);const l=this.flush();l?n(l.buffer):a(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,s,r)}softwareDecrypt(e,t,s,r){const{currentIV:n,currentResult:a,remainderData:o}=this;if(r!==Bs.cbc||t.byteLength!==16)return Ce.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),o&&(e=kt(o,e),this.remainderData=null);const l=this.getValidChunk(e);if(!l.length)return null;n&&(s=n);let c=this.softwareDecrypter;c||(c=this.softwareDecrypter=new Yy),c.expandKey(t);const u=a;return this.currentResult=c.decrypt(l.buffer,0,s),this.currentIV=l.slice(-16).buffer,u||null}webCryptoDecrypt(e,t,s,r){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,s,r));this.key=t,this.fastAesKey=new zy(this.subtle,t,r)}return this.fastAesKey.expandKey().then(n=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new jy(this.subtle,new Uint8Array(s),r).decrypt(e.buffer,n)):Promise.reject(new Error("web crypto not initialized"))).catch(n=>(Ce.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${n.name}: ${n.message}`),this.onWebCryptoError(e,t,s,r)))}onWebCryptoError(e,t,s,r){const n=this.enableSoftwareAES;if(n){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,s,r);const a=this.flush();if(a)return a.buffer}throw new Error("WebCrypto"+(n?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const s=e.length-e.length%Xy;return s!==e.length&&(t=e.slice(0,s),this.remainderData=e.slice(s)),t}logOnce(e){this.logEnabled&&(Ce.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const Yc=Math.pow(2,17);class Qy{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const s=e.url;if(!s)return Promise.reject(new ls({type:ie.NETWORK_ERROR,details:k.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${s?"part list":"url"}`),networkDetails:null}));this.abort();const r=this.config,n=r.fLoader,a=r.loader;return new Promise((o,l)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(g=>g[0]==="GAP")){l(qc(e));return}else e.gap=!1;const c=this.loader=n?new n(r):new a(r),u=zc(e);e.loader=c;const f=jc(r.fragLoadPolicy.default),d={loadPolicy:f,timeout:f.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:Yc};e.stats=c.stats;const h={onSuccess:(g,m,p,v)=>{this.resetLoader(e,c);let E=g.data;p.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(E.slice(0,16)),E=E.slice(16)),o({frag:e,part:null,payload:E,networkDetails:v})},onError:(g,m,p,v)=>{this.resetLoader(e,c),l(new ls({type:ie.NETWORK_ERROR,details:k.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:Re({url:s,data:void 0},g),error:new Error(`HTTP Error ${g.code} ${g.text}`),networkDetails:p,stats:v}))},onAbort:(g,m,p)=>{this.resetLoader(e,c),l(new ls({type:ie.NETWORK_ERROR,details:k.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:p,stats:g}))},onTimeout:(g,m,p)=>{this.resetLoader(e,c),l(new ls({type:ie.NETWORK_ERROR,details:k.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${d.timeout}ms`),networkDetails:p,stats:g}))}};t&&(h.onProgress=(g,m,p,v)=>t({frag:e,part:null,payload:p,networkDetails:v})),c.load(u,d,h)})}loadPart(e,t,s){this.abort();const r=this.config,n=r.fLoader,a=r.loader;return new Promise((o,l)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){l(qc(e,t));return}const c=this.loader=n?new n(r):new a(r),u=zc(e,t);e.loader=c;const f=jc(r.fragLoadPolicy.default),d={loadPolicy:f,timeout:f.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:Yc};t.stats=c.stats,c.load(u,d,{onSuccess:(h,g,m,p)=>{this.resetLoader(e,c),this.updateStatsFromPart(e,t);const v={frag:e,part:t,payload:h.data,networkDetails:p};s(v),o(v)},onError:(h,g,m,p)=>{this.resetLoader(e,c),l(new ls({type:ie.NETWORK_ERROR,details:k.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:Re({url:u.url,data:void 0},h),error:new Error(`HTTP Error ${h.code} ${h.text}`),networkDetails:m,stats:p}))},onAbort:(h,g,m)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,c),l(new ls({type:ie.NETWORK_ERROR,details:k.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:m,stats:h}))},onTimeout:(h,g,m)=>{this.resetLoader(e,c),l(new ls({type:ie.NETWORK_ERROR,details:k.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${d.timeout}ms`),networkDetails:m,stats:h}))}})})}updateStatsFromPart(e,t){const s=e.stats,r=t.stats,n=r.total;if(s.loaded+=r.loaded,n){const l=Math.round(e.duration/t.duration),c=Math.min(Math.round(s.loaded/n),l),f=(l-c)*Math.round(s.loaded/c);s.total=s.loaded+f}else s.total=Math.max(s.loaded,s.total);const a=s.loading,o=r.loading;a.start?a.first+=o.first-o.start:(a.start=o.start,a.first=o.first),a.end=o.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function zc(i,e=null){const t=e||i,s={frag:i,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},r=t.byteRangeStartOffset,n=t.byteRangeEndOffset;if(J(r)&&J(n)){var a;let o=r,l=n;if(i.sn==="initSegment"&&Zy((a=i.decryptdata)==null?void 0:a.method)){const c=n-r;c%16&&(l=n+(16-c%16)),r!==0&&(s.resetIV=!0,o=r-16)}s.rangeStart=o,s.rangeEnd=l}return s}function qc(i,e){const t=new Error(`GAP ${i.gap?"tag":"attribute"} found`),s={type:ie.MEDIA_ERROR,details:k.FRAG_GAP,fatal:!1,frag:i,error:t,networkDetails:null};return e&&(s.part=e),(e||i).stats.aborted=!0,new ls(s)}function Zy(i){return i==="AES-128"||i==="AES-256"}class ls extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class rh extends Pt{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class hl{constructor(e,t,s,r=0,n=-1,a=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=wr(),this.buffering={audio:wr(),video:wr(),audiovideo:wr()},this.level=e,this.sn=t,this.id=s,this.size=r,this.part=n,this.partial=a}}function wr(){return{start:0,executeStart:0,executeEnd:0,end:0}}const Xc={length:0,start:()=>0,end:()=>0};class fe{static isBuffered(e,t){if(e){const s=fe.getBuffered(e);for(let r=s.length;r--;)if(t>=s.start(r)&&t<=s.end(r))return!0}return!1}static bufferedRanges(e){if(e){const t=fe.getBuffered(e);return fe.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let s=0;s<e.length;s++)t.push({start:e.start(s),end:e.end(s)});return t}static bufferInfo(e,t,s){if(e){const r=fe.bufferedRanges(e);if(r.length)return fe.bufferedInfo(r,t,s)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,s){t=Math.max(0,t),e.length>1&&e.sort((u,f)=>u.start-f.start||f.end-u.end);let r=-1,n=[];if(s)for(let u=0;u<e.length;u++){t>=e[u].start&&t<=e[u].end&&(r=u);const f=n.length;if(f){const d=n[f-1].end;e[u].start-d<s?e[u].end>d&&(n[f-1].end=e[u].end):n.push(e[u])}else n.push(e[u])}else n=e;let a=0,o,l=t,c=t;for(let u=0;u<n.length;u++){const f=n[u].start,d=n[u].end;if(r===-1&&t>=f&&t<=d&&(r=u),t+s>=f&&t<d)l=f,c=d,a=c-t;else if(t+s<f){o=f;break}}return{len:a,start:l||0,end:c||0,nextStart:o,buffered:e,bufferedIndex:r}}static getBuffered(e){try{return e.buffered||Xc}catch(t){return Ce.log("failed to get media.buffered",t),Xc}}}const nh=/\{\$([a-zA-Z0-9-_]+)\}/g;function Qc(i){return nh.test(i)}function lo(i,e){if(i.variableList!==null||i.hasVariableRefs){const t=i.variableList;return e.replace(nh,s=>{const r=s.substring(2,s.length-1),n=t?.[r];return n===void 0?(i.playlistParsingError||(i.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${r}"`)),s):n})}return e}function Zc(i,e,t){let s=i.variableList;s||(i.variableList=s={});let r,n;if("QUERYPARAM"in e){r=e.QUERYPARAM;try{const a=new self.URL(t).searchParams;if(a.has(r))n=a.get(r);else throw new Error(`"${r}" does not match any query parameter in URI: "${t}"`)}catch(a){i.playlistParsingError||(i.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${a.message}`))}}else r=e.NAME,n=e.VALUE;r in s?i.playlistParsingError||(i.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${r}"`)):s[r]=n||""}function Jy(i,e,t){const s=e.IMPORT;if(t&&s in t){let r=i.variableList;r||(i.variableList=r={}),r[s]=t[s]}else i.playlistParsingError||(i.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${s}"`))}const ev=/^(\d+)x(\d+)$/,Jc=/(.+?)=(".*?"|.*?)(?:,|$)/g;class Ne{constructor(e,t){typeof e=="string"&&(e=Ne.parseAttrList(e,t)),we(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const s=new Uint8Array(t.length/2);for(let r=0;r<t.length/2;r++)s[r]=parseInt(t.slice(r*2,r*2+2),16);return s}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const s=this[e];return s?parseFloat(s):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const s=this[e];return(s?s.split(/[ ,]+/):[]).reduce((r,n)=>(r[n.toLowerCase()]=!0,r),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=ev.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let s;const r={};for(Jc.lastIndex=0;(s=Jc.exec(e))!==null;){const a=s[1].trim();let o=s[2];const l=o.indexOf('"')===0&&o.lastIndexOf('"')===o.length-1;let c=!1;if(l)o=o.slice(1,-1);else switch(a){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":c=!0}if(t&&(l||c))o=lo(t,o);else if(!c&&!l)switch(a){case"CLOSED-CAPTIONS":if(o==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":Ce.warn(`${e}: attribute ${a} is missing quotes`)}r[a]=o}return r}}const tv="com.apple.hls.interstitial";function sv(i){return i!=="ID"&&i!=="CLASS"&&i!=="CUE"&&i!=="START-DATE"&&i!=="DURATION"&&i!=="END-DATE"&&i!=="END-ON-NEXT"}function iv(i){return i==="SCTE35-OUT"||i==="SCTE35-IN"||i==="SCTE35-CMD"}class ah{constructor(e,t,s=0){var r;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=t?.tagAnchor||null,this.tagOrder=(r=t?.tagOrder)!=null?r:s,t){const n=t.attr;for(const a in n)if(Object.prototype.hasOwnProperty.call(e,a)&&e[a]!==n[a]){Ce.warn(`DATERANGE tag attribute: "${a}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=a;break}e=we(new Ne({}),n,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const n=t?.endDate||new Date(this.attr["END-DATE"]);J(n.getTime())&&(this._endDate=n)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(Ce.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(J(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===tv}get isValid(){return!!this.id&&!this._badValueForSameId&&J(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const rv=10;class nv{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,s=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!s||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&s>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}hasKey(e){return this.encryptedFragments.some(t=>{let s=t.decryptdata;return s||(t.setKeyFormat(e.keyFormat),s=t.decryptdata),!!s&&e.matches(s)})}get hasProgramDateTime(){return this.fragments.length?J(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||rv}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){return this.fragments.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){return this.fragments.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let s=e.length;s--;)if(e[s].index>t)return e[s].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function An(i,e){return i.length===e.length?!i.some((t,s)=>t!==e[s]):!1}function eu(i,e){return!i&&!e?!0:!i||!e?!1:An(i,e)}function Ii(i){return i==="AES-128"||i==="AES-256"||i==="AES-256-CTR"}function gl(i){switch(i){case"AES-128":case"AES-256":return Bs.cbc;case"AES-256-CTR":return Bs.ctr;default:throw new Error(`invalid full segment method ${i}`)}}function ml(i){return Uint8Array.from(atob(i),e=>e.charCodeAt(0))}function co(i){return Uint8Array.from(unescape(encodeURIComponent(i)),e=>e.charCodeAt(0))}function av(i){const e=co(i).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function oh(i){const e=function(s,r,n){const a=s[r];s[r]=s[n],s[n]=a};e(i,0,3),e(i,1,2),e(i,4,5),e(i,6,7)}function lh(i){const e=i.split(":");let t=null;if(e[0]==="data"&&e.length===2){const s=e[1].split(";"),r=s[s.length-1].split(",");if(r.length===2){const n=r[0]==="base64",a=r[1];n?(s.splice(-1,1),t=ml(a)):t=av(a)}}return t}const In=typeof self<"u"?self:void 0;var $e={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Je={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function Zr(i){switch(i){case Je.FAIRPLAY:return $e.FAIRPLAY;case Je.PLAYREADY:return $e.PLAYREADY;case Je.WIDEVINE:return $e.WIDEVINE;case Je.CLEARKEY:return $e.CLEARKEY}}function ya(i){switch(i){case $e.FAIRPLAY:return Je.FAIRPLAY;case $e.PLAYREADY:return Je.PLAYREADY;case $e.WIDEVINE:return Je.WIDEVINE;case $e.CLEARKEY:return Je.CLEARKEY}}function Gi(i){const{drmSystems:e,widevineLicenseUrl:t}=i,s=e?[$e.FAIRPLAY,$e.WIDEVINE,$e.PLAYREADY,$e.CLEARKEY].filter(r=>!!e[r]):[];return!s[$e.WIDEVINE]&&t&&s.push($e.WIDEVINE),s}const ch=(function(i){return In!=null&&(i=In.navigator)!=null&&i.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null})();function ov(i,e,t,s){let r;switch(i){case $e.FAIRPLAY:r=["cenc","sinf"];break;case $e.WIDEVINE:case $e.PLAYREADY:r=["cenc"];break;case $e.CLEARKEY:r=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${i}`)}return lv(r,e,t,s)}function lv(i,e,t,s){return[{initDataTypes:i,persistentState:s.persistentState||"optional",distinctiveIdentifier:s.distinctiveIdentifier||"optional",sessionTypes:s.sessionTypes||[s.sessionType||"temporary"],audioCapabilities:e.map(n=>({contentType:`audio/mp4; codecs=${n}`,robustness:s.audioRobustness||"",encryptionScheme:s.audioEncryptionScheme||null})),videoCapabilities:t.map(n=>({contentType:`video/mp4; codecs=${n}`,robustness:s.videoRobustness||"",encryptionScheme:s.videoEncryptionScheme||null}))}]}function cv(i){var e;return!!i&&(i.sessionType==="persistent-license"||!!((e=i.sessionTypes)!=null&&e.some(t=>t==="persistent-license")))}function uh(i){const e=new Uint16Array(i.buffer,i.byteOffset,i.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),s=t.substring(t.indexOf("<"),t.length),a=new DOMParser().parseFromString(s,"text/xml").getElementsByTagName("KID")[0];if(a){const o=a.childNodes[0]?a.childNodes[0].nodeValue:a.getAttribute("VALUE");if(o){const l=ml(o).subarray(0,16);return oh(l),l}}return null}let fi={};class Fs{static clearKeyUriToKeyIdMap(){fi={}}static setKeyIdForUri(e,t){fi[e]=t}static addKeyIdForUri(e){const t=Object.keys(fi).length%Number.MAX_SAFE_INTEGER,s=new Uint8Array(16);return new DataView(s.buffer,12,4).setUint32(0,t),fi[e]=s,s}constructor(e,t,s,r=[1],n=null,a){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=s,this.keyFormatVersions=r,this.iv=n,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!Ii(e),a!=null&&a.startsWith("0x")&&(this.keyId=new Uint8Array($d(a)))}matches(e){return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&An(e.keyFormatVersions,this.keyFormatVersions)&&eu(e.iv,this.iv)&&eu(e.keyId,this.keyId)}isSupported(){if(this.method){if(Ii(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case Je.FAIRPLAY:case Je.WIDEVINE:case Je.PLAYREADY:case Je.CLEARKEY:return["SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e,t){if(!this.encrypted||!this.uri)return null;if(Ii(this.method)){let n=this.iv;return n||(typeof e!="number"&&(Ce.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0),n=fv(e)),new Fs(this.method,this.uri,"identity",this.keyFormatVersions,n)}if(this.keyId){const n=fi[this.uri];if(n&&!An(this.keyId,n)&&Fs.setKeyIdForUri(this.uri,this.keyId),this.pssh)return this}const s=lh(this.uri);if(s)switch(this.keyFormat){case Je.WIDEVINE:if(this.pssh=s,!this.keyId){const n=gy(s.buffer);if(n.length){var r;const a=n[0];this.keyId=(r=a.kids)!=null&&r.length?a.kids[0]:null}}this.keyId||(this.keyId=tu(t));break;case Je.PLAYREADY:{const n=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=hy(n,null,s),this.keyId=uh(s);break}default:{let n=s.subarray(0,16);if(n.length!==16){const a=new Uint8Array(16);a.set(n,16-n.length),n=a}this.keyId=n;break}}if(!this.keyId||this.keyId.byteLength!==16){let n;n=uv(t),n||(n=tu(t),n||(n=fi[this.uri])),n&&(this.keyId=n,Fs.setKeyIdForUri(this.uri,n))}return this}}function uv(i){const e=i?.[Je.WIDEVINE];return e?e.keyId:null}function tu(i){const e=i?.[Je.PLAYREADY];if(e){const t=lh(e.uri);if(t)return uh(t)}return null}function fv(i){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=i>>8*(15-t)&255;return e}const su=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,iu=/#EXT-X-MEDIA:(.*)/g,dv=/^#EXT(?:INF|-X-TARGETDURATION):/m,va=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),hv=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class Zt{static findGroup(e,t){for(let s=0;s<e.length;s++){const r=e[s];if(r.id===t)return r}}static resolve(e,t){return al.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return dv.test(e)}static parseMasterPlaylist(e,t){const s=Qc(e),r={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:s},n=[];if(su.lastIndex=0,!e.startsWith("#EXTM3U"))return r.playlistParsingError=new Error("no EXTM3U delimiter"),r;let a;for(;(a=su.exec(e))!=null;)if(a[1]){var o;const c=new Ne(a[1],r),u=lo(r,a[2]),f={attrs:c,bitrate:c.decimalInteger("BANDWIDTH")||c.decimalInteger("AVERAGE-BANDWIDTH"),name:c.NAME,url:Zt.resolve(u,t)},d=c.decimalResolution("RESOLUTION");d&&(f.width=d.width,f.height=d.height),au(c.CODECS,f);const h=c["SUPPLEMENTAL-CODECS"];h&&(f.supplemental={},au(h,f.supplemental)),(o=f.unknownCodecs)!=null&&o.length||n.push(f),r.levels.push(f)}else if(a[3]){const c=a[3],u=a[4];switch(c){case"SESSION-DATA":{const f=new Ne(u,r),d=f["DATA-ID"];d&&(r.sessionData===null&&(r.sessionData={}),r.sessionData[d]=f);break}case"SESSION-KEY":{const f=ru(u,t,r);f.encrypted&&f.isSupported()?(r.sessionKeys===null&&(r.sessionKeys=[]),r.sessionKeys.push(f)):Ce.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${u}"`);break}case"DEFINE":{{const f=new Ne(u,r);Zc(r,f,t)}break}case"CONTENT-STEERING":{const f=new Ne(u,r);r.contentSteering={uri:Zt.resolve(f["SERVER-URI"],t),pathwayId:f["PATHWAY-ID"]||"."};break}case"START":{r.startTimeOffset=nu(u);break}}}const l=n.length>0&&n.length<r.levels.length;return r.levels=l?n:r.levels,r.levels.length===0&&(r.playlistParsingError=new Error("no levels found in manifest")),r}static parseMasterPlaylistMedia(e,t,s){let r;const n={},a=s.levels,o={AUDIO:a.map(c=>({id:c.attrs.AUDIO,audioCodec:c.audioCodec})),SUBTITLES:a.map(c=>({id:c.attrs.SUBTITLES,textCodec:c.textCodec})),"CLOSED-CAPTIONS":[]};let l=0;for(iu.lastIndex=0;(r=iu.exec(e))!==null;){const c=new Ne(r[1],s),u=c.TYPE;if(u){const f=o[u],d=n[u]||[];n[u]=d;const h=c.LANGUAGE,g=c["ASSOC-LANGUAGE"],m=c.CHANNELS,p=c.CHARACTERISTICS,v=c["INSTREAM-ID"],E={attrs:c,bitrate:0,id:l++,groupId:c["GROUP-ID"]||"",name:c.NAME||h||"",type:u,default:c.bool("DEFAULT"),autoselect:c.bool("AUTOSELECT"),forced:c.bool("FORCED"),lang:h,url:c.URI?Zt.resolve(c.URI,t):""};if(g&&(E.assocLang=g),m&&(E.channels=m),p&&(E.characteristics=p),v&&(E.instreamId=v),f!=null&&f.length){const x=Zt.findGroup(f,E.groupId)||f[0];ou(E,x,"audioCodec"),ou(E,x,"textCodec")}d.push(E)}}return n}static parseLevelPlaylist(e,t,s,r,n,a){var o;const l={url:t},c=new nv(t),u=c.fragments,f=[];let d=null,h=0,g=0,m=0,p=0,v=0,E=null,x=new ga(r,l),T,S,C,A=-1,w=!1,L=null,I;if(va.lastIndex=0,c.m3u8=e,c.hasVariableRefs=Qc(e),((o=va.exec(e))==null?void 0:o[0])!=="#EXTM3U")return c.playlistParsingError=new Error("Missing format identifier #EXTM3U"),c;for(;(T=va.exec(e))!==null;){w&&(w=!1,x=new ga(r,l),x.playlistOffset=m,x.setStart(m),x.sn=h,x.cc=p,v&&(x.bitrate=v),x.level=s,d&&(x.initSegment=d,d.rawProgramDateTime&&(x.rawProgramDateTime=d.rawProgramDateTime,d.rawProgramDateTime=null),L&&(x.setByteRange(L),L=null)));const Q=T[1];if(Q){x.duration=parseFloat(Q);const Z=(" "+T[2]).slice(1);x.title=Z||null,x.tagList.push(Z?["INF",Q,Z]:["INF",Q])}else if(T[3]){if(J(x.duration)){x.playlistOffset=m,x.setStart(m),C&&cu(x,C,c),x.sn=h,x.level=s,x.cc=p,u.push(x);const Z=(" "+T[3]).slice(1);x.relurl=lo(c,Z),uo(x,E,f),E=x,m+=x.duration,h++,g=0,w=!0}}else{if(T=T[0].match(hv),!T){Ce.warn("No matches on slow regex match for level playlist!");continue}for(S=1;S<T.length&&T[S]===void 0;S++);const Z=(" "+T[S]).slice(1),U=(" "+T[S+1]).slice(1),Y=T[S+2]?(" "+T[S+2]).slice(1):null;switch(Z){case"BYTERANGE":E?x.setByteRange(U,E):x.setByteRange(U);break;case"PROGRAM-DATE-TIME":x.rawProgramDateTime=U,x.tagList.push(["PROGRAM-DATE-TIME",U]),A===-1&&(A=u.length);break;case"PLAYLIST-TYPE":c.type&&ns(c,Z,T),c.type=U.toUpperCase();break;case"MEDIA-SEQUENCE":c.startSN!==0?ns(c,Z,T):u.length>0&&uu(c,Z,T),h=c.startSN=parseInt(U);break;case"SKIP":{c.skippedSegments&&ns(c,Z,T);const G=new Ne(U,c),te=G.decimalInteger("SKIPPED-SEGMENTS");if(J(te)){c.skippedSegments+=te;for(let z=te;z--;)u.push(null);h+=te}const oe=G.enumeratedString("RECENTLY-REMOVED-DATERANGES");oe&&(c.recentlyRemovedDateranges=(c.recentlyRemovedDateranges||[]).concat(oe.split("	")));break}case"TARGETDURATION":c.targetduration!==0&&ns(c,Z,T),c.targetduration=Math.max(parseInt(U),1);break;case"VERSION":c.version!==null&&ns(c,Z,T),c.version=parseInt(U);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":c.live||ns(c,Z,T),c.live=!1;break;case"#":(U||Y)&&x.tagList.push(Y?[U,Y]:[U]);break;case"DISCONTINUITY":p++,x.tagList.push(["DIS"]);break;case"GAP":x.gap=!0,x.tagList.push([Z]);break;case"BITRATE":x.tagList.push([Z,U]),v=parseInt(U)*1e3,J(v)?x.bitrate=v:v=0;break;case"DATERANGE":{const G=new Ne(U,c),te=new ah(G,c.dateRanges[G.ID],c.dateRangeTagCount);c.dateRangeTagCount++,te.isValid||c.skippedSegments?c.dateRanges[te.id]=te:Ce.warn(`Ignoring invalid DATERANGE tag: "${U}"`),x.tagList.push(["EXT-X-DATERANGE",U]);break}case"DEFINE":{{const G=new Ne(U,c);"IMPORT"in G?Jy(c,G,a):Zc(c,G,t)}break}case"DISCONTINUITY-SEQUENCE":c.startCC!==0?ns(c,Z,T):u.length>0&&uu(c,Z,T),c.startCC=p=parseInt(U);break;case"KEY":{const G=ru(U,t,c);if(G.isSupported()){if(G.method==="NONE"){C=void 0;break}C||(C={});const te=C[G.keyFormat];te!=null&&te.matches(G)||(te&&(C=we({},C)),C[G.keyFormat]=G)}else Ce.warn(`[Keys] Ignoring unsupported EXT-X-KEY tag: "${U}"`);break}case"START":c.startTimeOffset=nu(U);break;case"MAP":{const G=new Ne(U,c);if(x.duration){const te=new ga(r,l);lu(te,G,s,C),d=te,x.initSegment=d,d.rawProgramDateTime&&!x.rawProgramDateTime&&(x.rawProgramDateTime=d.rawProgramDateTime)}else{const te=x.byteRangeEndOffset;if(te){const oe=x.byteRangeStartOffset;L=`${te-oe}@${oe}`}else L=null;lu(x,G,s,C),d=x,w=!0}d.cc=p;break}case"SERVER-CONTROL":{I&&ns(c,Z,T),I=new Ne(U),c.canBlockReload=I.bool("CAN-BLOCK-RELOAD"),c.canSkipUntil=I.optionalFloat("CAN-SKIP-UNTIL",0),c.canSkipDateRanges=c.canSkipUntil>0&&I.bool("CAN-SKIP-DATERANGES"),c.partHoldBack=I.optionalFloat("PART-HOLD-BACK",0),c.holdBack=I.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{c.partTarget&&ns(c,Z,T);const G=new Ne(U);c.partTarget=G.decimalFloatingPoint("PART-TARGET");break}case"PART":{let G=c.partList;G||(G=c.partList=[]);const te=g>0?G[G.length-1]:void 0,oe=g++,z=new Ne(U,c),j=new J1(z,x,l,oe,te);G.push(j),x.duration+=j.duration;break}case"PRELOAD-HINT":{const G=new Ne(U,c);c.preloadHint=G;break}case"RENDITION-REPORT":{const G=new Ne(U,c);c.renditionReports=c.renditionReports||[],c.renditionReports.push(G);break}default:Ce.warn(`line parsed but not handled: ${T}`);break}}}E&&!E.relurl?(u.pop(),m-=E.duration,c.partList&&(c.fragmentHint=E)):c.partList&&(uo(x,E,f),x.cc=p,c.fragmentHint=x,C&&cu(x,C,c)),c.targetduration||(c.playlistParsingError=new Error("Missing Target Duration"));const O=u.length,P=u[0],H=u[O-1];if(m+=c.skippedSegments*c.targetduration,m>0&&O&&H){c.averagetargetduration=m/O;const Q=H.sn;c.endSN=Q!=="initSegment"?Q:0,c.live||(H.endList=!0),A>0&&(mv(u,A),P&&f.unshift(P))}return c.fragmentHint&&(m+=c.fragmentHint.duration),c.totalduration=m,f.length&&c.dateRangeTagCount&&P&&fh(f,c),c.endCC=p,c}}function fh(i,e){let t=i.length;if(!t)if(e.hasProgramDateTime){const o=e.fragments[e.fragments.length-1];i.push(o),t++}else return;const s=i[t-1],r=e.live?1/0:e.totalduration,n=Object.keys(e.dateRanges);for(let o=n.length;o--;){const l=e.dateRanges[n[o]],c=l.startDate.getTime();l.tagAnchor=s.ref;for(let u=t;u--;){var a;if(((a=i[u])==null?void 0:a.sn)<e.startSN)break;const f=gv(e,c,i,u,r);if(f!==-1){l.tagAnchor=e.fragments[f].ref;break}}}}function gv(i,e,t,s,r){const n=t[s];if(n){const o=n.programDateTime;if(e>=o||s===0){var a;const l=(((a=t[s+1])==null?void 0:a.start)||r)-n.start;if(e<=o+l*1e3){const c=t[s].sn-i.startSN;if(c<0)return-1;const u=i.fragments;if(u.length>t.length){const d=(t[s+1]||u[u.length-1]).sn-i.startSN;for(let h=d;h>c;h--){const g=u[h].programDateTime;if(e>=g&&e<g+u[h].duration*1e3)return h}}return c}}}return-1}function ru(i,e,t){var s,r;const n=new Ne(i,t),a=(s=n.METHOD)!=null?s:"",o=n.URI,l=n.hexadecimalInteger("IV"),c=n.KEYFORMATVERSIONS,u=(r=n.KEYFORMAT)!=null?r:"identity";o&&n.IV&&!l&&Ce.error(`Invalid IV: ${n.IV}`);const f=o?Zt.resolve(o,e):"",d=(c||"1").split("/").map(Number).filter(Number.isFinite);return new Fs(a,f,u,d,l,n.KEYID)}function nu(i){const t=new Ne(i).decimalFloatingPoint("TIME-OFFSET");return J(t)?t:null}function au(i,e){let t=(i||"").split(/[ ,]+/).filter(s=>s);["video","audio","text"].forEach(s=>{const r=t.filter(n=>cl(n,s));r.length&&(e[`${s}Codec`]=r.map(n=>n.split("/")[0]).join(","),t=t.filter(n=>r.indexOf(n)===-1))}),e.unknownCodecs=t}function ou(i,e,t){const s=e[t];s&&(i[t]=s)}function mv(i,e){let t=i[e];for(let s=e;s--;){const r=i[s];if(!r)return;r.programDateTime=t.programDateTime-r.duration*1e3,t=r}}function uo(i,e,t){i.rawProgramDateTime?t.push(i):e!=null&&e.programDateTime&&(i.programDateTime=e.endProgramDateTime)}function lu(i,e,t,s){i.relurl=e.URI,e.BYTERANGE&&i.setByteRange(e.BYTERANGE),i.level=t,i.sn="initSegment",s&&(i.levelkeys=s),i.initSegment=null}function cu(i,e,t){i.levelkeys=e;const{encryptedFragments:s}=t;(!s.length||s[s.length-1].levelkeys!==e)&&Object.keys(e).some(r=>e[r].isCommonEncryption)&&s.push(i)}function ns(i,e,t){i.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function uu(i,e,t){i.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function Ea(i,e){const t=e.startPTS;if(J(t)){let s=0,r;e.sn>i.sn?(s=t-i.start,r=i):(s=i.start-t,r=e),r.duration!==s&&r.setDuration(s)}else e.sn>i.sn?i.cc===e.cc&&i.minEndPTS?e.setStart(i.start+(i.minEndPTS-i.start)):e.setStart(i.start+i.duration):e.setStart(Math.max(i.start-e.duration,0))}function dh(i,e,t,s,r,n,a){s-t<=0&&(a.warn("Fragment should have a positive duration",e),s=t+e.duration,n=r+e.duration);let l=t,c=s;const u=e.startPTS,f=e.endPTS;if(J(u)){const v=Math.abs(u-t);i&&v>i.totalduration?a.warn(`media timestamps and playlist times differ by ${v}s for level ${e.level} ${i.url}`):J(e.deltaPTS)?e.deltaPTS=Math.max(v,e.deltaPTS):e.deltaPTS=v,l=Math.max(t,u),t=Math.min(t,u),r=e.startDTS!==void 0?Math.min(r,e.startDTS):r,c=Math.min(s,f),s=Math.max(s,f),n=e.endDTS!==void 0?Math.max(n,e.endDTS):n}const d=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(s-e.start),e.startPTS=t,e.maxStartPTS=l,e.startDTS=r,e.endPTS=s,e.minEndPTS=c,e.endDTS=n;const h=e.sn;if(!i||h<i.startSN||h>i.endSN)return 0;let g;const m=h-i.startSN,p=i.fragments;for(p[m]=e,g=m;g>0;g--)Ea(p[g],p[g-1]);for(g=m;g<p.length-1;g++)Ea(p[g],p[g+1]);return i.fragmentHint&&Ea(p[p.length-1],i.fragmentHint),i.PTSKnown=i.alignedSliding=!0,d}function pv(i,e,t){if(i===e)return;let s=null;const r=i.fragments;for(let u=r.length-1;u>=0;u--){const f=r[u].initSegment;if(f){s=f;break}}i.fragmentHint&&delete i.fragmentHint.endPTS;let n;Ev(i,e,(u,f,d,h)=>{if((!e.startCC||e.skippedSegments)&&f.cc!==u.cc){const g=u.cc-f.cc;for(let m=d;m<h.length;m++)h[m].cc+=g;e.endCC=h[h.length-1].cc}J(u.startPTS)&&J(u.endPTS)&&(f.setStart(f.startPTS=u.startPTS),f.startDTS=u.startDTS,f.maxStartPTS=u.maxStartPTS,f.endPTS=u.endPTS,f.endDTS=u.endDTS,f.minEndPTS=u.minEndPTS,f.setDuration(u.endPTS-u.startPTS),f.duration&&(n=f),e.PTSKnown=e.alignedSliding=!0),u.hasStreams&&(f.elementaryStreams=u.elementaryStreams),f.loader=u.loader,u.hasStats&&(f.stats=u.stats),u.initSegment&&(f.initSegment=u.initSegment,s=u.initSegment)});const a=e.fragments,o=e.fragmentHint?a.concat(e.fragmentHint):a;if(s&&o.forEach(u=>{var f;u&&(!u.initSegment||u.initSegment.relurl===((f=s)==null?void 0:f.relurl))&&(u.initSegment=s)}),e.skippedSegments){if(e.deltaUpdateFailed=a.some(u=>!u),e.deltaUpdateFailed){t.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let u=e.skippedSegments;u--;)a.shift();e.startSN=a[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=yv(i.dateRanges,e,t));const u=i.fragments.filter(f=>f.rawProgramDateTime);if(i.hasProgramDateTime&&!e.hasProgramDateTime)for(let f=1;f<o.length;f++)o[f].programDateTime===null&&uo(o[f],o[f-1],u);fh(u,e)}e.endCC=a[a.length-1].cc}if(!e.startCC){var l;const u=mh(i,e.startSN-1);e.startCC=(l=u?.cc)!=null?l:a[0].cc}vv(i.partList,e.partList,(u,f)=>{f.elementaryStreams=u.elementaryStreams,f.stats=u.stats}),n?dh(e,n,n.startPTS,n.endPTS,n.startDTS,n.endDTS,t):hh(i,e),a.length&&(e.totalduration=e.edge-a[0].start),e.driftStartTime=i.driftStartTime,e.driftStart=i.driftStart;const c=e.advancedDateTime;if(e.advanced&&c){const u=e.edge;e.driftStart||(e.driftStartTime=c,e.driftStart=u),e.driftEndTime=c,e.driftEnd=u}else e.driftEndTime=i.driftEndTime,e.driftEnd=i.driftEnd,e.advancedDateTime=i.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=i.requestScheduled)}function yv(i,e,t){const{dateRanges:s,recentlyRemovedDateranges:r}=e,n=we({},i);r&&r.forEach(l=>{delete n[l]});const o=Object.keys(n).length;return o?(Object.keys(s).forEach(l=>{const c=n[l],u=new ah(s[l].attr,c);u.isValid?(n[l]=u,c||(u.tagOrder+=o)):t.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${Pe(s[l].attr)}"`)}),n):s}function vv(i,e,t){if(i&&e){let s=0;for(let r=0,n=i.length;r<=n;r++){const a=i[r],o=e[r+s];a&&o&&a.index===o.index&&a.fragment.sn===o.fragment.sn?t(a,o):s--}}}function Ev(i,e,t){const s=e.skippedSegments,r=Math.max(i.startSN,e.startSN)-e.startSN,n=(i.fragmentHint?1:0)+(s?e.endSN:Math.min(i.endSN,e.endSN))-e.startSN,a=e.startSN-i.startSN,o=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,l=i.fragmentHint?i.fragments.concat(i.fragmentHint):i.fragments;for(let c=r;c<=n;c++){const u=l[a+c];let f=o[c];if(s&&!f&&u&&(f=e.fragments[c]=u),u&&f){t(u,f,c,o);const d=u.relurl,h=f.relurl;if(d&&xv(d,h)){e.playlistParsingError=fu(`media sequence mismatch ${f.sn}:`,i,e,u,f);return}else if(u.cc!==f.cc){e.playlistParsingError=fu(`discontinuity sequence mismatch (${u.cc}!=${f.cc})`,i,e,u,f);return}}}}function fu(i,e,t,s,r){return new Error(`${i} ${r.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function hh(i,e,t=!0){const s=e.startSN+e.skippedSegments-i.startSN,r=i.fragments,n=s>=0;let a=0;if(n&&s<r.length)a=r[s].start;else if(n&&e.startSN===i.endSN+1)a=i.fragmentEnd;else if(n&&t)a=i.fragmentStart+s*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)a=i.fragmentStart;else return;fo(e,a)}function fo(i,e){if(e){const t=i.fragments;for(let s=i.skippedSegments;s<t.length;s++)t[s].addStart(e);i.fragmentHint&&i.fragmentHint.addStart(e)}}function gh(i,e=1/0){let t=1e3*i.targetduration;if(i.updated){const s=i.fragments;if(s.length&&t*4>e){const n=s[s.length-1].duration*1e3;n<t&&(t=n)}}else t/=2;return Math.round(t)}function mh(i,e,t){if(!i)return null;let s=i.fragments[e-i.startSN];return s||(s=i.fragmentHint,s&&s.sn===e)?s:e<i.startSN&&t&&t.sn===e?t:null}function du(i,e,t){return i?ph(i.partList,e,t):null}function ph(i,e,t){if(i)for(let s=i.length;s--;){const r=i[s];if(r.index===t&&r.fragment.sn===e)return r}return null}function yh(i){i.forEach((e,t)=>{var s;(s=e.details)==null||s.fragments.forEach(r=>{r.level=t,r.initSegment&&(r.initSegment.level=t)})})}function xv(i,e){return i!==e&&e?hu(i)!==hu(e):!1}function hu(i){return i.replace(/\?[^?]*$/,"")}function Qi(i,e){for(let s=0,r=i.length;s<r;s++){var t;if(((t=i[s])==null?void 0:t.cc)===e)return i[s]}return null}function Tv(i,e){return!!(i&&e.startCC<i.endCC&&e.endCC>i.startCC)}function gu(i,e){const t=i.start+e;i.startPTS=t,i.setStart(t),i.endPTS=t+i.duration}function vh(i,e){const t=e.fragments;for(let s=0,r=t.length;s<r;s++)gu(t[s],i);e.fragmentHint&&gu(e.fragmentHint,i),e.alignedSliding=!0}function Sv(i,e){i&&(Eh(e,i),e.alignedSliding||Ln(e,i),!e.alignedSliding&&!e.skippedSegments&&hh(i,e,!1))}function Eh(i,e){if(!Tv(e,i))return;const t=Math.min(e.endCC,i.endCC),s=Qi(e.fragments,t),r=Qi(i.fragments,t);if(!s||!r)return;Ce.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const n=s.start-r.start;vh(n,i)}function Ln(i,e){if(!i.hasProgramDateTime||!e.hasProgramDateTime)return;const t=i.fragments,s=e.fragments;if(!t.length||!s.length)return;let r,n;const a=Math.min(e.endCC,i.endCC);e.startCC<a&&i.startCC<a&&(r=Qi(s,a),n=Qi(t,a)),(!r||!n)&&(r=s[Math.floor(s.length/2)],n=Qi(t,r.cc)||t[Math.floor(t.length/2)]);const o=r.programDateTime,l=n.programDateTime;if(!o||!l)return;const c=(l-o)/1e3-(n.start-r.start);vh(c,i)}function gt(i,e,t){yt(i,e,t),i.addEventListener(e,t)}function yt(i,e,t){i.removeEventListener(e,t)}const bv={toString:function(i){let e="";const t=i.length;for(let s=0;s<t;s++)e+=`[${i.start(s).toFixed(3)}-${i.end(s).toFixed(3)}]`;return e}},N={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class pl extends rh{constructor(e,t,s,r,n){super(r,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=N.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:a,fragCurrent:o,media:l,mediaBuffer:c,state:u}=this,f=l?l.currentTime:0,d=fe.bufferInfo(c||l,f,a.maxBufferHole),h=!d.len;if(this.log(`Media seeking to ${J(f)?f.toFixed(3):f}, state: ${u}, ${h?"out of":"in"} buffer`),this.state===N.ENDED)this.resetLoadingState();else if(o){const g=a.maxFragLookUpTolerance,m=o.start-g,p=o.start+o.duration+g;if(h||p<d.start||m>d.end){const v=f>p;(f<m||v)&&(v&&o.loader&&(this.log(`Cancelling fragment load for seek (sn: ${o.sn})`),o.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(l){this.fragmentTracker.removeFragmentsInRange(f,1/0,this.playlistType,!0);const g=this.lastCurrentTime;if(f>g&&(this.lastCurrentTime=f),!this.loadingParts){const m=Math.max(d.end,f),p=this.shouldLoadParts(this.getLevelDetails(),m);p&&(this.log(`LL-Part loading ON after seeking to ${f.toFixed(2)} with buffer @${m.toFixed(2)}`),this.loadingParts=p)}}this.hls.hasEnoughToStart||(this.log(`Setting ${h?"startPosition":"nextLoadPosition"} to ${f} for seek without enough to start`),this.nextLoadPosition=f,h&&(this.startPosition=f)),h&&this.state===N.IDLE&&this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=n,this.hls=e,this.fragmentLoader=new Qy(e.config),this.keyLoader=s,this.fragmentTracker=t,this.config=e.config,this.decrypter=new dl(e.config)}registerListeners(){const{hls:e}=this;e.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(y.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(y.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===N.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=N.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const s=e.end||0,r=this.config.timelineOffset||0;if(s<=r)return!1;const n=e.buffered;this.config.maxBufferHole&&n&&n.length>1&&(e=fe.bufferedInfo(n,e.start,0));const a=e.nextStart;if(a&&a>r&&a<t.edge||this.media.currentTime<e.start)return!1;const l=t.partList;if(l!=null&&l.length){const u=l[l.length-1];return fe.isBuffered(this.media,u.start+u.duration/2)}const c=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(c)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null)return this.levelLastLoaded.details}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const s=this.media=this.mediaBuffer=t.media;gt(s,"seeking",this.onMediaSeeking),gt(s,"ended",this.onMediaEnded);const r=this.config;this.levels&&r.autoStartLoad&&this.state===N.STOPPED&&this.startLoad(r.startPosition)}onMediaDetaching(e,t){const s=!!t.transferMedia,r=this.media;if(r!==null){if(r.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),yt(r,"seeking",this.onMediaSeeking),yt(r,"ended",this.onMediaEnded),this.keyLoader&&!s&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,s){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=N.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,s){this.startFragRequested=!0,this._loadFragForPlayback(e,t,s)}_loadFragForPlayback(e,t,s){const r=n=>{const a=n.frag;if(this.fragContextChanged(a)){this.warn(`${a.type} sn: ${a.sn}${n.part?" part: "+n.part.index:""} of ${this.fragInfo(a,!1,n.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(a);return}a.stats.chunkCount++,this._handleFragmentLoadProgress(n)};this._doFragLoad(e,t,s,r).then(n=>{if(!n)return;const a=this.state,o=n.frag;if(this.fragContextChanged(o)){(a===N.FRAG_LOADING||!this.fragCurrent&&a===N.PARSING)&&(this.fragmentTracker.removeFragment(o),this.state=N.IDLE);return}"payload"in n&&(this.log(`Loaded ${o.type} sn: ${o.sn} of ${this.playlistLabel()} ${o.level}`),this.hls.trigger(y.FRAG_LOADED,n)),this._handleFragmentLoadComplete(n)}).catch(n=>{this.state===N.STOPPED||this.state===N.ERROR||(this.warn(`Frag error: ${n?.message||n}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:s}=this;if(s.getState(e)===je.APPENDING){const n=e.type,a=this.getFwdBufferInfo(this.mediaBuffer,n),o=Math.max(e.duration,a?a.len:this.config.maxBufferLength),l=this.backtrackFragment;((l?e.sn-l.sn:0)===1||this.reduceMaxBufferLength(o,e.duration))&&s.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?s.removeAllFragments():s.hasParts(e.type)&&(s.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),s.getState(e)===je.PARTIAL&&s.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return t?.live&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,s=null){if(!(e-t))return;const r={startOffset:e,endOffset:t,type:s};this.hls.trigger(y.BUFFER_FLUSHING,r)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(s=>{const r=s?.frag;if(!r||this.fragContextChanged(r)||!this.levels)throw new Error("init load aborted");return s}).then(s=>{const{hls:r}=this,{frag:n,payload:a}=s,o=n.decryptdata;if(a&&a.byteLength>0&&o!=null&&o.key&&o.iv&&Ii(o.method)){const l=self.performance.now();return this.decrypter.decrypt(new Uint8Array(a),o.key.buffer,o.iv.buffer,gl(o.method)).catch(c=>{throw r.trigger(y.ERROR,{type:ie.MEDIA_ERROR,details:k.FRAG_DECRYPT_ERROR,fatal:!1,error:c,reason:c.message,frag:n}),c}).then(c=>{const u=self.performance.now();return r.trigger(y.FRAG_DECRYPTED,{frag:n,payload:c,stats:{tstart:l,tdecrypt:u}}),s.payload=c,this.completeInitSegmentLoad(s)})}return this.completeInitSegmentLoad(s)}).catch(s=>{this.state===N.STOPPED||this.state===N.ERROR||(this.warn(s),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const s=e.frag.stats;this.state!==N.STOPPED&&(this.state=N.IDLE),e.frag.data=new Uint8Array(e.payload),s.parsing.start=s.buffering.start=self.performance.now(),s.parsing.end=s.buffering.end=self.performance.now(),this.tick()}unhandledEncryptionError(e,t){var s,r;const n=e.tracks;if(n&&!t.encrypted&&((s=n.audio)!=null&&s.encrypted||(r=n.video)!=null&&r.encrypted)&&(!this.config.emeEnabled||!this.keyLoader.emeController)){const a=this.media,o=new Error(`Encrypted track with no key in ${this.fragInfo(t)} (media ${a?"attached mediaKeys: "+a.mediaKeys:"detached"})`);return this.warn(o.message),!a||a.mediaKeys?!1:(this.hls.trigger(y.ERROR,{type:ie.KEY_SYSTEM_ERROR,details:k.KEY_SYSTEM_NO_KEYS,fatal:!1,error:o,frag:t}),this.resetTransmuxer(),!0)}return!1}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const s=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${s?bv.toString(fe.getBuffered(s)):"(detached)"})`),Ve(e)){var r;if(e.type!==se.SUBTITLE){const a=e.elementaryStreams;if(!Object.keys(a).some(o=>!!a[o])){this.state=N.IDLE;return}}const n=(r=this.levels)==null?void 0:r[e.level];n!=null&&n.fragmentError&&(this.log(`Resetting level fragment error count of ${n.fragmentError} on frag buffered`),n.fragmentError=0)}this.state=N.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:s,part:r,partsLoaded:n}=e,a=!n||n.length===0||n.some(l=>!l),o=new hl(s.level,s.sn,s.stats.chunkCount+1,0,r?r.index:-1,!a);t.flush(o)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,s=null,r){var n;this.fragCurrent=e;const a=t.details;if(!this.levels||!a)throw new Error(`frag load aborted, missing level${a?"":" detail"}s`);let o=null;if(e.encrypted&&!((n=e.decryptdata)!=null&&n.key)){if(this.log(`Loading key for ${e.sn} of [${a.startSN}-${a.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=N.KEY_LOADING,this.fragCurrent=e,o=this.keyLoader.load(e).then(d=>{if(!this.fragContextChanged(d.frag))return this.hls.trigger(y.KEY_LOADED,d),this.state===N.KEY_LOADING&&(this.state=N.IDLE),d}),this.hls.trigger(y.KEY_LOADING,{frag:e}),this.fragCurrent===null)return this.log("context changed in KEY_LOADING"),Promise.resolve(null)}else e.encrypted||(o=this.keyLoader.loadClear(e,a.encryptedFragments,this.startFragRequested),o&&this.log("[eme] blocking frag load until media-keys acquired"));const l=this.fragPrevious;if(Ve(e)&&(!l||e.sn!==l.sn)){const d=this.shouldLoadParts(t.details,e.end);d!==this.loadingParts&&(this.log(`LL-Part loading ${d?"ON":"OFF"} loading sn ${l?.sn}->${e.sn}`),this.loadingParts=d)}if(s=Math.max(e.start,s||0),this.loadingParts&&Ve(e)){const d=a.partList;if(d&&r){s>a.fragmentEnd&&a.fragmentHint&&(e=a.fragmentHint);const h=this.getNextPart(d,e,s);if(h>-1){const g=d[h];e=this.fragCurrent=g.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${g.index} (${h}/${d.length-1}) of ${this.fragInfo(e,!1,g)}) cc: ${e.cc} [${a.startSN}-${a.endSN}], target: ${parseFloat(s.toFixed(3))}`),this.nextLoadPosition=g.start+g.duration,this.state=N.FRAG_LOADING;let m;return o?m=o.then(p=>!p||this.fragContextChanged(p.frag)?null:this.doFragPartsLoad(e,g,t,r)).catch(p=>this.handleFragLoadError(p)):m=this.doFragPartsLoad(e,g,t,r).catch(p=>this.handleFragLoadError(p)),this.hls.trigger(y.FRAG_LOADING,{frag:e,part:g,targetBufferTime:s}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):m}else if(!e.url||this.loadedEndOfParts(d,s))return Promise.resolve(null)}}if(Ve(e)&&this.loadingParts){var c;this.log(`LL-Part loading OFF after next part miss @${s.toFixed(2)} Check buffer at sn: ${e.sn} loaded parts: ${(c=a.partList)==null?void 0:c.filter(d=>d.loaded).map(d=>`[${d.start}-${d.end}]`)}`),this.loadingParts=!1}else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${"["+a.startSN+"-"+a.endSN+"]"}, target: ${parseFloat(s.toFixed(3))}`),J(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=N.FRAG_LOADING;const u=this.config.progressive&&e.type!==se.SUBTITLE;let f;return u&&o?f=o.then(d=>!d||this.fragContextChanged(d.frag)?null:this.fragmentLoader.load(e,r)).catch(d=>this.handleFragLoadError(d)):f=Promise.all([this.fragmentLoader.load(e,u?r:void 0),o]).then(([d])=>(!u&&r&&r(d),d)).catch(d=>this.handleFragLoadError(d)),this.hls.trigger(y.FRAG_LOADING,{frag:e,targetBufferTime:s}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):f}doFragPartsLoad(e,t,s,r){return new Promise((n,a)=>{var o;const l=[],c=(o=s.details)==null?void 0:o.partList,u=f=>{this.fragmentLoader.loadPart(e,f,r).then(d=>{l[f.index]=d;const h=d.part;this.hls.trigger(y.FRAG_LOADED,d);const g=du(s.details,e.sn,f.index+1)||ph(c,e.sn,f.index+1);if(g)u(g);else return n({frag:e,part:h,partsLoaded:l})}).catch(a)};u(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;t.frag&&t.details===k.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):t.frag&&t.type===ie.KEY_SYSTEM_ERROR?(t.frag.abortRequests(),this.resetStartWhenNotLoaded(),this.resetFragmentLoading(t.frag)):this.hls.trigger(y.ERROR,t)}else this.hls.trigger(y.ERROR,{type:ie.OTHER_ERROR,details:k.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==N.PARSING){!this.fragCurrent&&this.state!==N.STOPPED&&this.state!==N.ERROR&&(this.state=N.IDLE);return}const{frag:s,part:r,level:n}=t,a=self.performance.now();s.stats.parsing.end=a,r&&(r.stats.parsing.end=a);const o=this.getLevelDetails(),c=o&&s.sn>o.endSN||this.shouldLoadParts(o,s.end);c!==this.loadingParts&&(this.log(`LL-Part loading ${c?"ON":"OFF"} after parsing segment ending @${s.end.toFixed(2)}`),this.loadingParts=c),this.updateLevelTiming(s,r,n,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e.partList){var s;const n=e.partList[0];if(n.fragment.type===se.SUBTITLE)return!1;const a=n.end+(((s=e.fragmentHint)==null?void 0:s.duration)||0);if(t>=a){var r;if((this.hls.hasEnoughToStart?((r=this.media)==null?void 0:r.currentTime)||this.lastCurrentTime:this.getLoadPosition())>n.start-n.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:s}=this,{level:r,sn:n,part:a}=e;if(!(t!=null&&t[r]))return this.warn(`Levels object was unset while buffering fragment ${n} of ${this.playlistLabel()} ${r}. The current chunk will not be buffered.`),null;const o=t[r],l=o.details,c=a>-1?du(l,n,a):null,u=c?c.fragment:mh(l,n,s);return u?(s&&s!==u&&(u.stats=s.stats),{frag:u,part:c,level:o}):null}bufferFragmentData(e,t,s,r,n){if(this.state!==N.PARSING)return;const{data1:a,data2:o}=e;let l=a;if(o&&(l=kt(a,o)),!l.length)return;const c=this.initPTS[t.cc],u=c?-c.baseTime/c.timescale:void 0,f={type:e.type,frag:t,part:s,chunkMeta:r,offset:u,parent:t.type,data:l};if(this.hls.trigger(y.BUFFER_APPENDING,f),e.dropped&&e.independent&&!s){if(n)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!fe.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const s=t.currentTime,r=fe.bufferInfo(t,s,0),n=e.duration,a=Math.min(this.config.maxFragLookUpTolerance*2,n*.25),o=Math.max(Math.min(e.start-a,r.end-a),s+a);e.start-o>a&&this.flushMainBuffer(o,e.start)}getFwdBufferInfo(e,t){var s;const r=this.getLoadPosition();if(!J(r))return null;const a=this.lastCurrentTime>r||(s=this.media)!=null&&s.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,r,t,a)}getFwdBufferInfoAtPos(e,t,s,r){const n=fe.bufferInfo(e,t,r);if(n.len===0&&n.nextStart!==void 0){const a=this.fragmentTracker.getBufferedFrag(t,s);if(a&&(n.nextStart<=a.end||a.gap)){const o=Math.max(Math.min(n.nextStart,a.end)-t,r);return fe.bufferInfo(e,t,o)}}return n}getMaxBufferLength(e){const{config:t}=this;let s;return e?s=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):s=t.maxBufferLength,Math.min(s,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const s=this.config,r=Math.max(Math.min(e-t,s.maxBufferLength),t),n=Math.max(e-t*3,s.maxMaxBufferLength/2,r);return n>=r?(s.maxMaxBufferLength=n,this.warn(`Reduce max buffer length to ${n}s`),!0):!1}getAppendedFrag(e,t=se.MAIN){const s=this.fragmentTracker?this.fragmentTracker.getAppendedFrag(e,t):null;return s&&"fragment"in s?s.fragment:s}getNextFragment(e,t){const s=t.fragments,r=s.length;if(!r)return null;const{config:n}=this,a=s[0].start,o=n.lowLatencyMode&&!!t.partList;let l=null;if(t.live){const f=n.initialLiveManifestSize;if(r<f)return this.warn(`Not enough fragments to start playback (have: ${r}, need: ${f})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<a){var c;o&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),l=this.getInitialLiveFragment(t);const d=this.hls.startPosition,h=this.hls.liveSyncPosition,g=l?(d!==-1&&d>=a?d:h)||l.start:e;this.log(`Setting startPosition to ${g} to match start frag at live edge. mainStart: ${d} liveSyncPosition: ${h} frag.start: ${(c=l)==null?void 0:c.start}`),this.startPosition=this.nextLoadPosition=g}}else e<=a&&(l=s[0]);if(!l){const f=this.loadingParts?t.partEnd:t.fragmentEnd;l=this.getFragmentAtPosition(e,f,t)}let u=this.filterReplacedPrimary(l,t);if(!u&&l){const f=l.sn-t.startSN;u=this.filterReplacedPrimary(s[f+1]||null,t)}return this.mapToInitFragWhenRequired(u)}isLoopLoading(e,t){const s=this.fragmentTracker.getState(e);return(s===je.OK||s===je.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,s,r,n){let a=null;if(e.gap&&(a=this.getNextFragment(this.nextLoadPosition,t),a&&!a.gap&&s.nextStart)){const o=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,s.nextStart,r,0);if(o!==null&&s.len+o.len>=n){const l=a.sn;return this.loopSn!==l&&(this.log(`buffer full after gaps in "${r}" playlist starting at sn: ${l}`),this.loopSn=l),null}}return this.loopSn=void 0,a}get primaryPrefetch(){if(mu(this.config)){var e;if((e=this.hls.interstitialsManager)==null||(e=e.playingItem)==null?void 0:e.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(mu(this.config)&&e.type!==se.SUBTITLE){const s=this.hls.interstitialsManager,r=s?.bufferingItem;if(r){const a=r.event;if(a){if(a.appendInPlace||Math.abs(e.start-r.start)>1||r.start===0)return null}else if(e.end<=r.start&&t?.live===!1||e.start>r.end&&r.nextEvent&&(r.nextEvent.appendInPlace||e.start-r.end>1))return null}const n=s?.playerQueue;if(n)for(let a=n.length;a--;){const o=n[a].interstitial;if(o.appendInPlace&&e.start>=o.startTime&&e.end<=o.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!e.initSegment.data&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,s){let r=-1,n=!1,a=!0;for(let o=0,l=e.length;o<l;o++){const c=e[o];if(a=a&&!c.independent,r>-1&&s<c.start)break;const u=c.loaded;u?r=-1:(n||(c.independent||a)&&c.fragment===t)&&(c.fragment!==t&&this.warn(`Need buffer at ${s} but next unloaded part starts at ${c.start}`),r=o),n=u}return r}loadedEndOfParts(e,t){let s;for(let r=e.length;r--;){if(s=e[r],!s.loaded)return!1;if(t>s.start)return!0}return!1}getInitialLiveFragment(e){const t=e.fragments,s=this.fragPrevious;let r=null;if(s){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${s.programDateTime}`),r=By(t,s.endProgramDateTime,this.config.maxFragLookUpTolerance)),!r){const n=s.sn+1;if(n>=e.startSN&&n<=e.endSN){const a=t[n-e.startSN];s.cc===a.cc&&(r=a,this.log(`Live playlist, switching playlist, load frag with next SN: ${r.sn}`))}r||(r=th(e,s.cc,s.end),r&&this.log(`Live playlist, switching playlist, load frag with same CC: ${r.sn}`))}}else{const n=this.hls.liveSyncPosition;n!==null&&(r=this.getFragmentAtPosition(n,this.bitrateTest?e.fragmentEnd:e.edge,e))}return r}getFragmentAtPosition(e,t,s){const{config:r}=this;let{fragPrevious:n}=this,{fragments:a,endSN:o}=s;const{fragmentHint:l}=s,{maxFragLookUpTolerance:c}=r,u=s.partList,f=!!(this.loadingParts&&u!=null&&u.length&&l);f&&!this.bitrateTest&&u[u.length-1].fragment.sn===l.sn&&(a=a.concat(l),o=l.sn);let d;if(e<t){var h;const m=e<this.lastCurrentTime||e>t-c||(h=this.media)!=null&&h.paused||!this.startFragRequested?0:c;d=ii(n,a,e,m)}else d=a[a.length-1];if(d){const g=d.sn-s.startSN,m=this.fragmentTracker.getState(d);if((m===je.OK||m===je.PARTIAL&&d.gap)&&(n=d),n&&d.sn===n.sn&&(!f||u[0].fragment.sn>d.sn||!s.live)&&d.level===n.level){const v=a[g+1];d.sn<o&&this.fragmentTracker.getState(v)!==je.OK?d=v:d=null}}return d}alignPlaylists(e,t,s){const r=e.fragments.length;if(!r)return this.warn("No fragments in live playlist"),0;const n=e.fragmentStart,a=!t,o=e.alignedSliding&&J(n);if(a||!o&&!n){Sv(s,e);const l=e.fragmentStart;return this.log(`Live playlist sliding: ${l.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${r}`),l}return n}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let s=this.startPosition;s<t&&(s=-1);const r=this.timelineOffset;if(s===-1){const n=this.startTimeOffset!==null,a=n?this.startTimeOffset:e.startTimeOffset;a!==null&&J(a)?(s=t+a,a<0&&(s+=e.edge),s=Math.min(Math.max(t,s),t+e.totalduration),this.log(`Setting startPosition to ${s} for start time offset ${a} found in ${n?"multivariant":"media"} playlist`),this.startPosition=s):e.live?(s=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${s}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=s=0),this.lastCurrentTime=s+r}this.nextLoadPosition=s+r}getLoadPosition(){var e;const{media:t}=this;let s=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?s=t.currentTime:this.nextLoadPosition>=0&&(s=this.nextLoadPosition),s}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&Ve(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==N.FRAG_LOADING_WAITING_RETRY)&&(this.state=N.IDLE)}onFragmentOrKeyLoadError(e,t){var s;if(t.chunkMeta&&!t.frag){const v=this.getCurrentContext(t.chunkMeta);v&&(t.frag=v.frag)}const r=t.frag;if(!r||r.type!==e||!this.levels)return;if(this.fragContextChanged(r)){var n;this.warn(`Frag load error must match current frag to retry ${r.url} > ${(n=this.fragCurrent)==null?void 0:n.url}`);return}const a=t.details===k.FRAG_GAP;a&&this.fragmentTracker.fragBuffered(r,!0);const o=t.errorAction;if(!o){this.state=N.ERROR;return}const{action:l,flags:c,retryCount:u=0,retryConfig:f}=o,d=!!f,h=d&&l===Qe.RetryRequest,g=d&&!o.resolved&&c===Tt.MoveAllAlternatesMatchingHost,m=(s=this.hls.latestLevelDetails)==null?void 0:s.live;if(!h&&g&&Ve(r)&&!r.endList&&m&&!ih(t))this.resetFragmentErrors(e),this.treatAsGap(r),o.resolved=!0;else if((h||g)&&u<f.maxNumRetry){var p;const v=oo((p=t.response)==null?void 0:p.code),E=fl(f,u);if(this.resetStartWhenNotLoaded(),this.retryDate=self.performance.now()+E,this.state=N.FRAG_LOADING_WAITING_RETRY,o.resolved=!0,v){this.log("Waiting for connection (offline)"),this.retryDate=1/0,t.reason="offline";return}this.warn(`Fragment ${r.sn} of ${e} ${r.level} errored with ${t.details}, retrying loading ${u+1}/${f.maxNumRetry} in ${E}ms`)}else if(f)if(this.resetFragmentErrors(e),u<f.maxNumRetry)!a&&l!==Qe.RemoveAlternatePermanently&&(o.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${u})`);return}else l===Qe.SendAlternateToPenaltyBox?this.state=N.WAITING_LEVEL:this.state=N.ERROR;this.tickImmediate()}checkRetryDate(){const e=self.performance.now(),t=this.retryDate,s=t===1/0;(!t||e>=t||s&&!oo(0))&&(s&&this.log("Connection restored (online)"),this.resetStartWhenNotLoaded(),this.state=N.IDLE)}reduceLengthAndFlushBuffer(e){if(this.state===N.PARSING||this.state===N.PARSED){const t=e.frag,s=e.parent,r=this.getFwdBufferInfo(this.mediaBuffer,s),n=r&&r.len>.5;n&&this.reduceMaxBufferLength(r.len,t?.duration||10);const a=!n;return a&&this.warn(`Buffer full error while media.currentTime (${this.getLoadPosition()}) is not buffered, flush ${s} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),a}return!1}resetFragmentErrors(e){e===se.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==N.STOPPED&&(this.state=N.IDLE)}afterBufferFlushed(e,t,s){if(!e)return;const r=fe.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,r,s),this.state===N.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==N.STOPPED&&(this.state=N.IDLE)}resetStartWhenNotLoaded(){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const e=this.levelLastLoaded,t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.log(`Loading context changed while buffering sn ${e.sn} of ${this.playlistLabel()} ${e.level===-1?"<removed>":e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,s,r){const n=s.details;if(!n){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((l,c)=>{const u=e.elementaryStreams[c];if(u){const f=u.endPTS-u.startPTS;if(f<=0)return this.warn(`Could not parse fragment ${e.sn} ${c} duration reliably (${f})`),l||!1;const d=r?0:dh(n,e,u.startPTS,u.endPTS,u.startDTS,u.endDTS,this);return this.hls.trigger(y.LEVEL_PTS_UPDATED,{details:n,level:s,drift:d,type:c,frag:e,start:u.startPTS,end:u.endPTS}),!0}return l},!1)){var o;const l=((o=this.transmuxer)==null?void 0:o.error)===null;if((s.fragmentError===0||l&&(s.fragmentError<2||e.endList))&&this.treatAsGap(e,s),l){const c=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(c.message),this.hls.trigger(y.ERROR,{type:ie.MEDIA_ERROR,details:k.FRAG_PARSING_ERROR,fatal:!1,error:c,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${s.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=N.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(y.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===se.MAIN?"level":"track"}fragInfo(e,t=!0,s){var r,n;return`${this.playlistLabel()} ${e.level} (${s?"part":"frag"}:[${((r=t&&!s?e.startPTS:(s||e).start)!=null?r:NaN).toFixed(3)}-${((n=t&&!s?e.endPTS:(s||e).end)!=null?n:NaN).toFixed(3)}]${s&&e.type==="main"?"INDEPENDENT="+(s.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function mu(i){return!!i.interstitialsController&&i.enableInterstitialPlayback!==!1}class xh{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let s;if(e.length)e.length===1?s=e[0]:s=Av(e,t);else return new Uint8Array(0);return this.reset(),s}reset(){this.chunks.length=0,this.dataLength=0}}function Av(i,e){const t=new Uint8Array(e);let s=0;for(let r=0;r<i.length;r++){const n=i[r];t.set(n,s),s+=n.length}return t}var xa={exports:{}},pu;function Iv(){return pu||(pu=1,(function(i){var e=Object.prototype.hasOwnProperty,t="~";function s(){}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(t=!1));function r(l,c,u){this.fn=l,this.context=c,this.once=u||!1}function n(l,c,u,f,d){if(typeof u!="function")throw new TypeError("The listener must be a function");var h=new r(u,f||l,d),g=t?t+c:c;return l._events[g]?l._events[g].fn?l._events[g]=[l._events[g],h]:l._events[g].push(h):(l._events[g]=h,l._eventsCount++),l}function a(l,c){--l._eventsCount===0?l._events=new s:delete l._events[c]}function o(){this._events=new s,this._eventsCount=0}o.prototype.eventNames=function(){var c=[],u,f;if(this._eventsCount===0)return c;for(f in u=this._events)e.call(u,f)&&c.push(t?f.slice(1):f);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(u)):c},o.prototype.listeners=function(c){var u=t?t+c:c,f=this._events[u];if(!f)return[];if(f.fn)return[f.fn];for(var d=0,h=f.length,g=new Array(h);d<h;d++)g[d]=f[d].fn;return g},o.prototype.listenerCount=function(c){var u=t?t+c:c,f=this._events[u];return f?f.fn?1:f.length:0},o.prototype.emit=function(c,u,f,d,h,g){var m=t?t+c:c;if(!this._events[m])return!1;var p=this._events[m],v=arguments.length,E,x;if(p.fn){switch(p.once&&this.removeListener(c,p.fn,void 0,!0),v){case 1:return p.fn.call(p.context),!0;case 2:return p.fn.call(p.context,u),!0;case 3:return p.fn.call(p.context,u,f),!0;case 4:return p.fn.call(p.context,u,f,d),!0;case 5:return p.fn.call(p.context,u,f,d,h),!0;case 6:return p.fn.call(p.context,u,f,d,h,g),!0}for(x=1,E=new Array(v-1);x<v;x++)E[x-1]=arguments[x];p.fn.apply(p.context,E)}else{var T=p.length,S;for(x=0;x<T;x++)switch(p[x].once&&this.removeListener(c,p[x].fn,void 0,!0),v){case 1:p[x].fn.call(p[x].context);break;case 2:p[x].fn.call(p[x].context,u);break;case 3:p[x].fn.call(p[x].context,u,f);break;case 4:p[x].fn.call(p[x].context,u,f,d);break;default:if(!E)for(S=1,E=new Array(v-1);S<v;S++)E[S-1]=arguments[S];p[x].fn.apply(p[x].context,E)}}return!0},o.prototype.on=function(c,u,f){return n(this,c,u,f,!1)},o.prototype.once=function(c,u,f){return n(this,c,u,f,!0)},o.prototype.removeListener=function(c,u,f,d){var h=t?t+c:c;if(!this._events[h])return this;if(!u)return a(this,h),this;var g=this._events[h];if(g.fn)g.fn===u&&(!d||g.once)&&(!f||g.context===f)&&a(this,h);else{for(var m=0,p=[],v=g.length;m<v;m++)(g[m].fn!==u||d&&!g[m].once||f&&g[m].context!==f)&&p.push(g[m]);p.length?this._events[h]=p.length===1?p[0]:p:a(this,h)}return this},o.prototype.removeAllListeners=function(c){var u;return c?(u=t?t+c:c,this._events[u]&&a(this,u)):(this._events=new s,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,i.exports=o})(xa)),xa.exports}var Lv=Iv(),yl=Q1(Lv);const dr="1.6.15",Di={};function _v(){return typeof __HLS_WORKER_BUNDLE__=="function"}function Rv(){const i=Di[dr];if(i)return i.clientCount++,i;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),r={worker:new self.Worker(t),objectURL:t,clientCount:1};return Di[dr]=r,r}function Cv(i){const e=Di[i];if(e)return e.clientCount++,e;const t=new self.URL(i,self.location.href).href,r={worker:new self.Worker(t),scriptURL:t,clientCount:1};return Di[i]=r,r}function wv(i){const e=Di[i||dr];if(e&&e.clientCount--===1){const{worker:s,objectURL:r}=e;delete Di[i||dr],r&&self.URL.revokeObjectURL(r),s.terminate()}}function Th(i,e){return e+10<=i.length&&i[e]===51&&i[e+1]===68&&i[e+2]===73&&i[e+3]<255&&i[e+4]<255&&i[e+6]<128&&i[e+7]<128&&i[e+8]<128&&i[e+9]<128}function vl(i,e){return e+10<=i.length&&i[e]===73&&i[e+1]===68&&i[e+2]===51&&i[e+3]<255&&i[e+4]<255&&i[e+6]<128&&i[e+7]<128&&i[e+8]<128&&i[e+9]<128}function Yn(i,e){let t=0;return t=(i[e]&127)<<21,t|=(i[e+1]&127)<<14,t|=(i[e+2]&127)<<7,t|=i[e+3]&127,t}function hr(i,e){const t=e;let s=0;for(;vl(i,e);){s+=10;const r=Yn(i,e+6);s+=r,Th(i,e+10)&&(s+=10),e+=s}if(s>0)return i.subarray(t,t+s)}function Dv(i,e,t,s){const r=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],n=e[t+2],a=n>>2&15;if(a>12){const h=new Error(`invalid ADTS sampling index:${a}`);i.emit(y.ERROR,y.ERROR,{type:ie.MEDIA_ERROR,details:k.FRAG_PARSING_ERROR,fatal:!0,error:h,reason:h.message});return}const o=(n>>6&3)+1,l=e[t+3]>>6&3|(n&1)<<2,c="mp4a.40."+o,u=r[a];let f=a;(o===5||o===29)&&(f-=3);const d=[o<<3|(f&14)>>1,(f&1)<<7|l<<3];return Ce.log(`manifest codec:${s}, parsed codec:${c}, channels:${l}, rate:${u} (ADTS object type:${o} sampling index:${a})`),{config:d,samplerate:u,channelCount:l,codec:c,parsedCodec:c,manifestCodec:s}}function Sh(i,e){return i[e]===255&&(i[e+1]&246)===240}function bh(i,e){return i[e+1]&1?7:9}function El(i,e){return(i[e+3]&3)<<11|i[e+4]<<3|(i[e+5]&224)>>>5}function kv(i,e){return e+5<i.length}function _n(i,e){return e+1<i.length&&Sh(i,e)}function Pv(i,e){return kv(i,e)&&Sh(i,e)&&El(i,e)<=i.length-e}function Ov(i,e){if(_n(i,e)){const t=bh(i,e);if(e+t>=i.length)return!1;const s=El(i,e);if(s<=t)return!1;const r=e+s;return r===i.length||_n(i,r)}return!1}function Ah(i,e,t,s,r){if(!i.samplerate){const n=Dv(e,t,s,r);if(!n)return;we(i,n)}}function Ih(i){return 1024*9e4/i}function Mv(i,e){const t=bh(i,e);if(e+t<=i.length){const s=El(i,e)-t;if(s>0)return{headerLength:t,frameLength:s}}}function Lh(i,e,t,s,r){const n=Ih(i.samplerate),a=s+r*n,o=Mv(e,t);let l;if(o){const{frameLength:f,headerLength:d}=o,h=d+f,g=Math.max(0,t+h-e.length);g?(l=new Uint8Array(h-d),l.set(e.subarray(t+d,e.length),0)):l=e.subarray(t+d,t+h);const m={unit:l,pts:a};return g||i.samples.push(m),{sample:m,length:h,missing:g}}const c=e.length-t;return l=new Uint8Array(c),l.set(e.subarray(t,e.length),0),{sample:{unit:l,pts:a},length:c,missing:-1}}function Fv(i,e){return vl(i,e)&&Yn(i,e+6)+10<=i.length-e}function Nv(i){return i instanceof ArrayBuffer?i:i.byteOffset==0&&i.byteLength==i.buffer.byteLength?i.buffer:new Uint8Array(i).buffer}function Ta(i,e=0,t=1/0){return $v(i,e,t,Uint8Array)}function $v(i,e,t,s){const r=Bv(i);let n=1;"BYTES_PER_ELEMENT"in s&&(n=s.BYTES_PER_ELEMENT);const a=Uv(i)?i.byteOffset:0,o=(a+i.byteLength)/n,l=(a+e)/n,c=Math.floor(Math.max(0,Math.min(l,o))),u=Math.floor(Math.min(c+Math.max(t,0),o));return new s(r,c,u-c)}function Bv(i){return i instanceof ArrayBuffer?i:i.buffer}function Uv(i){return i&&i.buffer instanceof ArrayBuffer&&i.byteLength!==void 0&&i.byteOffset!==void 0}function Gv(i){const e={key:i.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(i.size<2)return;if(i.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const s=i.data.subarray(1).indexOf(0);if(s===-1)return;const r=_t(Ta(i.data,1,s)),n=i.data[2+s],a=i.data.subarray(3+s).indexOf(0);if(a===-1)return;const o=_t(Ta(i.data,3+s,a));let l;return r==="-->"?l=_t(Ta(i.data,4+s+a)):l=Nv(i.data.subarray(4+s+a)),e.mimeType=r,e.pictureType=n,e.description=o,e.data=l,e}function Vv(i){if(i.size<2)return;const e=_t(i.data,!0),t=new Uint8Array(i.data.subarray(e.length+1));return{key:i.type,info:e,data:t.buffer}}function Kv(i){if(i.size<2)return;if(i.type==="TXXX"){let t=1;const s=_t(i.data.subarray(t),!0);t+=s.length+1;const r=_t(i.data.subarray(t));return{key:i.type,info:s,data:r}}const e=_t(i.data.subarray(1));return{key:i.type,info:"",data:e}}function Hv(i){if(i.type==="WXXX"){if(i.size<2)return;let t=1;const s=_t(i.data.subarray(t),!0);t+=s.length+1;const r=_t(i.data.subarray(t));return{key:i.type,info:s,data:r}}const e=_t(i.data);return{key:i.type,info:"",data:e}}function jv(i){return i.type==="PRIV"?Vv(i):i.type[0]==="W"?Hv(i):i.type==="APIC"?Gv(i):Kv(i)}function Wv(i){const e=String.fromCharCode(i[0],i[1],i[2],i[3]),t=Yn(i,4),s=10;return{type:e,size:t,data:i.subarray(s,s+t)}}const Dr=10,Yv=10;function _h(i){let e=0;const t=[];for(;vl(i,e);){const s=Yn(i,e+6);i[e+5]>>6&1&&(e+=Dr),e+=Dr;const r=e+s;for(;e+Yv<r;){const n=Wv(i.subarray(e)),a=jv(n);a&&t.push(a),e+=n.size+Dr}Th(i,e)&&(e+=Dr)}return t}function Rh(i){return i&&i.key==="PRIV"&&i.info==="com.apple.streaming.transportStreamTimestamp"}function zv(i){if(i.data.byteLength===8){const e=new Uint8Array(i.data),t=e[3]&1;let s=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return s/=45,t&&(s+=4772185884e-2),Math.round(s)}}function xl(i){const e=_h(i);for(let t=0;t<e.length;t++){const s=e[t];if(Rh(s))return zv(s)}}let At=(function(i){return i.audioId3="org.id3",i.dateRange="com.apple.quicktime.HLS",i.emsg="https://aomedia.org/emsg/ID3",i.misbklv="urn:misb:KLV:bin:1910.1",i})({});function Xt(i="",e=9e4){return{type:i,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class Tl{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,s,r){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,s){}demux(e,t){this.cachedData&&(e=kt(this.cachedData,e),this.cachedData=null);let s=hr(e,0),r=s?s.length:0,n;const a=this._audioTrack,o=this._id3Track,l=s?xl(s):void 0,c=e.length;for((this.basePTS===null||this.frameIndex===0&&J(l))&&(this.basePTS=qv(l,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),s&&s.length>0&&o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:s,type:At.audioId3,duration:Number.POSITIVE_INFINITY});r<c;){if(this.canParse(e,r)){const u=this.appendFrame(a,e,r);u?(this.frameIndex++,this.lastPTS=u.sample.pts,r+=u.length,n=r):r=c}else Fv(e,r)?(s=hr(e,r),o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:s,type:At.audioId3,duration:Number.POSITIVE_INFINITY}),r+=s.length,n=r):r++;if(r===c&&n!==c){const u=e.slice(n);this.cachedData?this.cachedData=kt(this.cachedData,u):this.cachedData=u}}return{audioTrack:a,videoTrack:Xt(),id3Track:o,textTrack:Xt()}}demuxSampleAes(e,t,s){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Xt(),id3Track:this._id3Track,textTrack:Xt()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const qv=(i,e,t)=>{if(J(i))return i*90;const s=t?t.baseTime*9e4/t.timescale:0;return e*9e4+s};let kr=null;const Xv=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],Qv=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],Zv=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],Jv=[0,1,1,4];function Ch(i,e,t,s,r){if(t+24>e.length)return;const n=wh(e,t);if(n&&t+n.frameLength<=e.length){const a=n.samplesPerFrame*9e4/n.sampleRate,o=s+r*a,l={unit:e.subarray(t,t+n.frameLength),pts:o,dts:o};return i.config=[],i.channelCount=n.channelCount,i.samplerate=n.sampleRate,i.samples.push(l),{sample:l,length:n.frameLength,missing:0}}}function wh(i,e){const t=i[e+1]>>3&3,s=i[e+1]>>1&3,r=i[e+2]>>4&15,n=i[e+2]>>2&3;if(t!==1&&r!==0&&r!==15&&n!==3){const a=i[e+2]>>1&1,o=i[e+3]>>6,l=t===3?3-s:s===3?3:4,c=Xv[l*14+r-1]*1e3,f=Qv[(t===3?0:t===2?1:2)*3+n],d=o===3?1:2,h=Zv[t][s],g=Jv[s],m=h*8*g,p=Math.floor(h*c/f+a)*g;if(kr===null){const x=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);kr=x?parseInt(x[1]):0}return kr&&kr<=87&&s===2&&c>=224e3&&o===0&&(i[e+3]=i[e+3]|128),{sampleRate:f,channelCount:d,frameLength:p,samplesPerFrame:m}}}function Sl(i,e){return i[e]===255&&(i[e+1]&224)===224&&(i[e+1]&6)!==0}function Dh(i,e){return e+1<i.length&&Sl(i,e)}function eE(i,e){return Sl(i,e)&&4<=i.length-e}function kh(i,e){if(e+1<i.length&&Sl(i,e)){const s=wh(i,e);let r=4;s!=null&&s.frameLength&&(r=s.frameLength);const n=e+r;return n===i.length||Dh(i,n)}return!1}class tE extends Tl{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,s,r){super.resetInitSegment(e,t,s,r),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const s=hr(e,0);let r=s?.length||0;if(kh(e,r))return!1;for(let n=e.length;r<n;r++)if(Ov(e,r))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return Pv(e,t)}appendFrame(e,t,s){Ah(e,this.observer,t,s,e.manifestCodec);const r=Lh(e,t,s,this.basePTS,this.frameIndex);if(r&&r.missing===0)return r}}const Ph=(i,e)=>{let t=0,s=5;e+=s;const r=new Uint32Array(1),n=new Uint32Array(1),a=new Uint8Array(1);for(;s>0;){a[0]=i[e];const o=Math.min(s,8),l=8-o;n[0]=4278190080>>>24+l<<l,r[0]=(a[0]&n[0])>>l,t=t?t<<o|r[0]:r[0],e+=1,s-=o}return t};class sE extends Tl{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,s,r){super.resetInitSegment(e,t,s,r),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,s){const r=Oh(e,t,s,this.basePTS,this.frameIndex);if(r!==-1)return{sample:e.samples[e.samples.length-1],length:r,missing:0}}static probe(e){if(!e)return!1;const t=hr(e,0);if(!t)return!1;const s=t.length;return e[s]===11&&e[s+1]===119&&xl(t)!==void 0&&Ph(e,s)<16}}function Oh(i,e,t,s,r){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const n=e[t+4]>>6;if(n>=3)return-1;const o=[48e3,44100,32e3][n],l=e[t+4]&63,u=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][l*3+n]*2;if(t+u>e.length)return-1;const f=e[t+6]>>5;let d=0;f===2?d+=2:(f&1&&f!==1&&(d+=2),f&4&&(d+=2));const h=(e[t+6]<<8|e[t+7])>>12-d&1,m=[2,1,2,3,3,4,4,5][f]+h,p=e[t+5]>>3,v=e[t+5]&7,E=new Uint8Array([n<<6|p<<1|v>>2,(v&3)<<6|f<<3|h<<2|l>>4,l<<4&224]),x=1536/o*9e4,T=s+r*x,S=e.subarray(t,t+u);return i.config=E,i.channelCount=m,i.samplerate=o,i.samples.push({unit:S,pts:T}),u}class iE extends Tl{resetInitSegment(e,t,s,r){super.resetInitSegment(e,t,s,r),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=hr(e,0);let s=t?.length||0;if(t&&e[s]===11&&e[s+1]===119&&xl(t)!==void 0&&Ph(e,s)<=16)return!1;for(let r=e.length;s<r;s++)if(kh(e,s))return Ce.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return eE(e,t)}appendFrame(e,t,s){if(this.basePTS!==null)return Ch(e,t,s,this.basePTS,this.frameIndex)}}const rE=/\/emsg[-/]ID3/i;class nE{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,s,r){const n=this.videoTrack=Xt("video",1),a=this.audioTrack=Xt("audio",1),o=this.txtTrack=Xt("text",1);if(this.id3Track=Xt("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const l=Hd(e);if(l.video){const{id:c,timescale:u,codec:f,supplemental:d}=l.video;n.id=c,n.timescale=o.timescale=u,n.codec=f,n.supplemental=d}if(l.audio){const{id:c,timescale:u,codec:f}=l.audio;a.id=c,a.timescale=u,a.codec=f}o.id=Gd.text,n.sampleDuration=0,n.duration=a.duration=r}resetContiguity(){this.remainderData=null}static probe(e){return sy(e)}demux(e,t){this.timeOffset=t;let s=e;const r=this.videoTrack,n=this.txtTrack;if(this.config.progressive){this.remainderData&&(s=kt(this.remainderData,e));const o=cy(s);this.remainderData=o.remainder,r.samples=o.valid||new Uint8Array}else r.samples=s;const a=this.extractID3Track(r,t);return n.samples=Oc(t,r),{videoTrack:r,audioTrack:this.audioTrack,id3Track:a,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,s=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const r=this.extractID3Track(t,this.timeOffset);return s.samples=Oc(e,t),{videoTrack:t,audioTrack:Xt(),id3Track:r,textTrack:Xt()}}extractID3Track(e,t){const s=this.id3Track;if(e.samples.length){const r=ve(e.samples,["emsg"]);r&&r.forEach(n=>{const a=fy(n);if(rE.test(a.schemeIdUri)){const o=yu(a,t);let l=a.eventDuration===4294967295?Number.POSITIVE_INFINITY:a.eventDuration/a.timeScale;l<=.001&&(l=Number.POSITIVE_INFINITY);const c=a.payload;s.samples.push({data:c,len:c.byteLength,dts:o,pts:o,type:At.emsg,duration:l})}else if(this.config.enableEmsgKLVMetadata&&a.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const o=yu(a,t);s.samples.push({data:a.payload,len:a.payload.byteLength,dts:o,pts:o,type:At.misbklv,duration:Number.POSITIVE_INFINITY})}})}return s}demuxSampleAes(e,t,s){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function yu(i,e){return J(i.presentationTime)?i.presentationTime/i.timeScale:e+i.presentationTimeDelta/i.timeScale}class aE{constructor(e,t,s){this.keyData=void 0,this.decrypter=void 0,this.keyData=s,this.decrypter=new dl(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,Bs.cbc)}decryptAacSample(e,t,s){const r=e[t].unit;if(r.length<=16)return;const n=r.subarray(16,r.length-r.length%16),a=n.buffer.slice(n.byteOffset,n.byteOffset+n.length);this.decryptBuffer(a).then(o=>{const l=new Uint8Array(o);r.set(l,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,s)}).catch(s)}decryptAacSamples(e,t,s){for(;;t++){if(t>=e.length){s();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,s),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,s=new Int8Array(t);let r=0;for(let n=32;n<e.length-16;n+=160,r+=16)s.set(e.subarray(n,n+16),r);return s}getAvcDecryptedUnit(e,t){const s=new Uint8Array(t);let r=0;for(let n=32;n<e.length-16;n+=160,r+=16)e.set(s.subarray(r,r+16),n);return e}decryptAvcSample(e,t,s,r,n){const a=Yd(n.data),o=this.getAvcEncryptedData(a);this.decryptBuffer(o.buffer).then(l=>{n.data=this.getAvcDecryptedUnit(a,l),this.decrypter.isSync()||this.decryptAvcSamples(e,t,s+1,r)}).catch(r)}decryptAvcSamples(e,t,s,r){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,s=0){if(t>=e.length){r();return}const n=e[t].units;for(;!(s>=n.length);s++){const a=n[s];if(!(a.data.length<=48||a.type!==1&&a.type!==5)&&(this.decryptAvcSample(e,t,s,r,a),!this.decrypter.isSync()))return}}}}class Mh{constructor(){this.VideoSample=null}createVideoSample(e,t,s){return{key:e,frame:!1,pts:t,dts:s,units:[],length:0}}getLastNalUnit(e){var t;let s=this.VideoSample,r;if((!s||s.units.length===0)&&(s=e[e.length-1]),(t=s)!=null&&t.units){const n=s.units;r=n[n.length-1]}return r}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const s=t.samples,r=s.length;if(r){const n=s[r-1];e.pts=n.pts,e.dts=n.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,s){const r=t.byteLength;let n=e.naluState||0;const a=n,o=[];let l=0,c,u,f,d=-1,h=0;for(n===-1&&(d=0,h=this.getNALuType(t,0),n=0,l=1);l<r;){if(c=t[l++],!n){n=c?0:1;continue}if(n===1){n=c?0:2;continue}if(!c)n=3;else if(c===1){if(u=l-n-1,d>=0){const g={data:t.subarray(d,u),type:h};o.push(g)}else{const g=this.getLastNalUnit(e.samples);g&&(a&&l<=4-a&&g.state&&(g.data=g.data.subarray(0,g.data.byteLength-a)),u>0&&(g.data=kt(g.data,t.subarray(0,u)),g.state=0))}l<r?(f=this.getNALuType(t,l),d=l,h=f,n=0):n=-1}else n=0}if(d>=0&&n>=0){const g={data:t.subarray(d,r),type:h,state:n};o.push(g)}if(o.length===0){const g=this.getLastNalUnit(e.samples);g&&(g.data=kt(g.data,t))}return e.naluState=n,o}}class Zi{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,s=e.byteLength-t,r=new Uint8Array(4),n=Math.min(4,t);if(n===0)throw new Error("no bytes available");r.set(e.subarray(s,s+n)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=n*8,this.bytesAvailable-=n}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const s=this.word>>>32-t;if(e>32&&Ce.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?s<<t|this.readBits(t):s}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if((this.word&2147483648>>>e)!==0)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class oE extends Mh{parsePES(e,t,s,r){const n=this.parseNALu(e,s.data,r);let a=this.VideoSample,o,l=!1;s.data=null,a&&n.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),n.forEach(c=>{var u,f;switch(c.type){case 1:{let m=!1;o=!0;const p=c.data;if(l&&p.length>4){const v=this.readSliceType(p);(v===2||v===4||v===7||v===9)&&(m=!0)}if(m){var d;(d=a)!=null&&d.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),a.frame=!0,a.key=m;break}case 5:o=!0,(u=a)!=null&&u.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),a.key=!0,a.frame=!0;break;case 6:{o=!0,ll(c.data,1,s.pts,t.samples);break}case 7:{var h,g;o=!0,l=!0;const m=c.data,p=this.readSPS(m);if(!e.sps||e.width!==p.width||e.height!==p.height||((h=e.pixelRatio)==null?void 0:h[0])!==p.pixelRatio[0]||((g=e.pixelRatio)==null?void 0:g[1])!==p.pixelRatio[1]){e.width=p.width,e.height=p.height,e.pixelRatio=p.pixelRatio,e.sps=[m];const v=m.subarray(1,4);let E="avc1.";for(let x=0;x<3;x++){let T=v[x].toString(16);T.length<2&&(T="0"+T),E+=T}e.codec=E}break}case 8:o=!0,e.pps=[c.data];break;case 9:o=!0,e.audFound=!0,(f=a)!=null&&f.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts));break;case 12:o=!0;break;default:o=!1;break}a&&o&&a.units.push(c)}),r&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new Zi(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let s=8,r=8,n;for(let a=0;a<e;a++)r!==0&&(n=t.readEG(),r=(s+n+256)%256),s=r===0?s:r}readSPS(e){const t=new Zi(e);let s=0,r=0,n=0,a=0,o,l,c;const u=t.readUByte.bind(t),f=t.readBits.bind(t),d=t.readUEG.bind(t),h=t.readBoolean.bind(t),g=t.skipBits.bind(t),m=t.skipEG.bind(t),p=t.skipUEG.bind(t),v=this.skipScalingList.bind(this);u();const E=u();if(f(5),g(3),u(),p(),E===100||E===110||E===122||E===244||E===44||E===83||E===86||E===118||E===128){const w=d();if(w===3&&g(1),p(),p(),g(1),h())for(l=w!==3?8:12,c=0;c<l;c++)h()&&(c<6?v(16,t):v(64,t))}p();const x=d();if(x===0)d();else if(x===1)for(g(1),m(),m(),o=d(),c=0;c<o;c++)m();p(),g(1);const T=d(),S=d(),C=f(1);C===0&&g(1),g(1),h()&&(s=d(),r=d(),n=d(),a=d());let A=[1,1];if(h()&&h())switch(u()){case 1:A=[1,1];break;case 2:A=[12,11];break;case 3:A=[10,11];break;case 4:A=[16,11];break;case 5:A=[40,33];break;case 6:A=[24,11];break;case 7:A=[20,11];break;case 8:A=[32,11];break;case 9:A=[80,33];break;case 10:A=[18,11];break;case 11:A=[15,11];break;case 12:A=[64,33];break;case 13:A=[160,99];break;case 14:A=[4,3];break;case 15:A=[3,2];break;case 16:A=[2,1];break;case 255:{A=[u()<<8|u(),u()<<8|u()];break}}return{width:Math.ceil((T+1)*16-s*2-r*2),height:(2-C)*(S+1)*16-(C?2:4)*(n+a),pixelRatio:A}}}class lE extends Mh{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,s,r){const n=this.parseNALu(e,s.data,r);let a=this.VideoSample,o,l=!1;s.data=null,a&&n.length&&!e.audFound&&(this.pushAccessUnit(a,e),a=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),n.forEach(c=>{var u,f;switch(c.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:a||(a=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts)),a.frame=!0,o=!0;break;case 16:case 17:case 18:case 21:if(o=!0,l){var d;(d=a)!=null&&d.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null)}a||(a=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),a.key=!0,a.frame=!0;break;case 19:case 20:o=!0,(u=a)!=null&&u.frame&&!a.key&&(this.pushAccessUnit(a,e),a=this.VideoSample=null),a||(a=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),a.key=!0,a.frame=!0;break;case 39:o=!0,ll(c.data,2,s.pts,t.samples);break;case 32:o=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=we(e.params,this.readVPS(c.data)),this.initVPS=c.data),e.vps=[c.data];break;case 33:if(o=!0,l=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],c.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const h=this.readSPS(c.data);e.width=h.width,e.height=h.height,e.pixelRatio=h.pixelRatio,e.codec=h.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const g in h.params)e.params[g]=h.params[g]}this.pushParameterSet(e.sps,c.data,e.vps),a||(a=this.VideoSample=this.createVideoSample(!0,s.pts,s.dts)),a.key=!0;break;case 34:if(o=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const h=this.readPPS(c.data);for(const g in h)e.params[g]=h[g]}this.pushParameterSet(e.pps,c.data,e.vps)}break;case 35:o=!0,e.audFound=!0,(f=a)!=null&&f.frame&&(this.pushAccessUnit(a,e),a=null),a||(a=this.VideoSample=this.createVideoSample(!1,s.pts,s.dts));break;default:o=!1;break}a&&o&&a.units.push(c)}),r&&a&&(this.pushAccessUnit(a,e),this.VideoSample=null)}pushParameterSet(e,t,s){(s&&s[0]===this.initVPS||!s&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let s=0;for(let r=0;r<e.byteLength;r++)r>=2&&e[r]===3&&e[r-1]===0&&e[r-2]===0||(t[s]=e[r],s++);return new Uint8Array(t.buffer,0,s)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new Zi(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const s=t.readBits(3),r=t.readBoolean();return{numTemporalLayers:s+1,temporalIdNested:r}}readSPS(e){const t=new Zi(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const s=t.readBits(3);t.readBoolean();const r=t.readBits(2),n=t.readBoolean(),a=t.readBits(5),o=t.readUByte(),l=t.readUByte(),c=t.readUByte(),u=t.readUByte(),f=t.readUByte(),d=t.readUByte(),h=t.readUByte(),g=t.readUByte(),m=t.readUByte(),p=t.readUByte(),v=t.readUByte(),E=[],x=[];for(let M=0;M<s;M++)E.push(t.readBoolean()),x.push(t.readBoolean());if(s>0)for(let M=s;M<8;M++)t.readBits(2);for(let M=0;M<s;M++)E[M]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),x[M]&&t.readUByte();t.readUEG();const T=t.readUEG();T==3&&t.skipBits(1);const S=t.readUEG(),C=t.readUEG(),A=t.readBoolean();let w=0,L=0,I=0,O=0;A&&(w+=t.readUEG(),L+=t.readUEG(),I+=t.readUEG(),O+=t.readUEG());const P=t.readUEG(),H=t.readUEG(),Q=t.readUEG(),Z=t.readBoolean();for(let M=Z?0:s;M<=s;M++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let $=0;$<4;$++)for(let q=0;q<($===3?2:6);q++)if(!t.readBoolean())t.readUEG();else{const K=Math.min(64,1<<4+($<<1));$>1&&t.readEG();for(let B=0;B<K;B++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const G=t.readUEG();let te=0;for(let M=0;M<G;M++){let $=!1;if(M!==0&&($=t.readBoolean()),$){M===G&&t.readUEG(),t.readBoolean(),t.readUEG();let q=0;for(let X=0;X<=te;X++){const K=t.readBoolean();let B=!1;K||(B=t.readBoolean()),(K||B)&&q++}te=q}else{const q=t.readUEG(),X=t.readUEG();te=q+X;for(let K=0;K<q;K++)t.readUEG(),t.readBoolean();for(let K=0;K<X;K++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const M=t.readUEG();for(let $=0;$<M;$++){for(let q=0;q<Q+4;q++)t.readBits(1);t.readBits(1)}}let z=0,j=1,he=1,Se=!0,ge=1,me=0;t.readBoolean(),t.readBoolean();let Ue=!1;if(t.readBoolean()){if(t.readBoolean()){const re=t.readUByte(),ee=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],ne=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];re>0&&re<16?(j=ee[re-1],he=ne[re-1]):re===255&&(j=t.readBits(16),he=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),Ue=t.readBoolean(),Ue&&(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG()),t.readBoolean()&&(ge=t.readBits(32),me=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const ne=t.readBoolean(),le=t.readBoolean();let ye=!1;(ne||le)&&(ye=t.readBoolean(),ye&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),ye&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let _e=0;_e<=s;_e++){Se=t.readBoolean();const be=Se||t.readBoolean();let qe=!1;be?t.readEG():qe=t.readBoolean();const Xe=qe?1:t.readUEG()+1;if(ne)for(let st=0;st<Xe;st++)t.readUEG(),t.readUEG(),ye&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(le)for(let st=0;st<Xe;st++)t.readUEG(),t.readUEG(),ye&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),z=t.readUEG())}let lt=S,tt=C;if(A){let M=1,$=1;T===1?M=$=2:T==2&&(M=2),lt=S-M*L-M*w,tt=C-$*O-$*I}const As=r?["A","B","C"][r]:"",b=o<<24|l<<16|c<<8|u;let _=0;for(let M=0;M<32;M++)_=(_|(b>>M&1)<<31-M)>>>0;let F=_.toString(16);return a===1&&F==="2"&&(F="6"),{codecString:`hvc1.${As}${a}.${F}.${n?"H":"L"}${v}.B0`,params:{general_tier_flag:n,general_profile_idc:a,general_profile_space:r,general_profile_compatibility_flags:[o,l,c,u],general_constraint_indicator_flags:[f,d,h,g,m,p],general_level_idc:v,bit_depth:P+8,bit_depth_luma_minus8:P,bit_depth_chroma_minus8:H,min_spatial_segmentation_idc:z,chroma_format_idc:T,frame_rate:{fixed:Se,fps:me/ge}},width:lt,height:tt,pixelRatio:[j,he]}}readPPS(e){const t=new Zi(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const r=t.readBoolean(),n=t.readBoolean();let a=1;return n&&r?a=0:n?a=3:r&&(a=2),{parallelismType:a}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const We=188;class Os{constructor(e,t,s,r){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=s,this.logger=r,this.videoParser=null}static probe(e,t){const s=Os.syncOffset(e);return s>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${s}`),s!==-1}static syncOffset(e){const t=e.length;let s=Math.min(We*5,t-We)+1,r=0;for(;r<s;){let n=!1,a=-1,o=0;for(let l=r;l<t;l+=We)if(e[l]===71&&(t-l===We||e[l+We]===71)){if(o++,a===-1&&(a=l,a!==0&&(s=Math.min(a+We*99,e.length-We)+1)),n||(n=ho(e,l)===0),n&&o>1&&(a===0&&o>2||l+We>s))return a}else{if(o)return-1;break}r++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:Gd[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,s,r){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=Os.createTrack("video"),this._videoTrack.duration=r,this._audioTrack=Os.createTrack("audio",r),this._id3Track=Os.createTrack("id3"),this._txtTrack=Os.createTrack("text"),this._audioTrack.segmentCodec="aac",this.videoParser=null,this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=s}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:s}=this;e&&(e.pesData=null),t&&(t.pesData=null),s&&(s.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,s=!1,r=!1){s||(this.sampleAes=null);let n;const a=this._videoTrack,o=this._audioTrack,l=this._id3Track,c=this._txtTrack;let u=a.pid,f=a.pesData,d=o.pid,h=l.pid,g=o.pesData,m=l.pesData,p=null,v=this.pmtParsed,E=this._pmtId,x=e.length;if(this.remainderData&&(e=kt(this.remainderData,e),x=e.length,this.remainderData=null),x<We&&!r)return this.remainderData=e,{audioTrack:o,videoTrack:a,id3Track:l,textTrack:c};const T=Math.max(0,Os.syncOffset(e));x-=(x-T)%We,x<e.byteLength&&!r&&(this.remainderData=new Uint8Array(e.buffer,x,e.buffer.byteLength-x));let S=0;for(let A=T;A<x;A+=We)if(e[A]===71){const w=!!(e[A+1]&64),L=ho(e,A),I=(e[A+3]&48)>>4;let O;if(I>1){if(O=A+5+e[A+4],O===A+We)continue}else O=A+4;switch(L){case u:w&&(f&&(n=di(f,this.logger))&&(this.readyVideoParser(a.segmentCodec),this.videoParser!==null&&this.videoParser.parsePES(a,c,n,!1)),f={data:[],size:0}),f&&(f.data.push(e.subarray(O,A+We)),f.size+=A+We-O);break;case d:if(w){if(g&&(n=di(g,this.logger)))switch(o.segmentCodec){case"aac":this.parseAACPES(o,n);break;case"mp3":this.parseMPEGPES(o,n);break;case"ac3":this.parseAC3PES(o,n);break}g={data:[],size:0}}g&&(g.data.push(e.subarray(O,A+We)),g.size+=A+We-O);break;case h:w&&(m&&(n=di(m,this.logger))&&this.parseID3PES(l,n),m={data:[],size:0}),m&&(m.data.push(e.subarray(O,A+We)),m.size+=A+We-O);break;case 0:w&&(O+=e[O]+1),E=this._pmtId=cE(e,O);break;case E:{w&&(O+=e[O]+1);const P=uE(e,O,this.typeSupported,s,this.observer,this.logger);u=P.videoPid,u>0&&(a.pid=u,a.segmentCodec=P.segmentVideoCodec),d=P.audioPid,d>0&&(o.pid=d,o.segmentCodec=P.segmentAudioCodec),h=P.id3Pid,h>0&&(l.pid=h),p!==null&&!v&&(this.logger.warn(`MPEG-TS PMT found at ${A} after unknown PID '${p}'. Backtracking to sync byte @${T} to parse all TS packets.`),p=null,A=T-188),v=this.pmtParsed=!0;break}case 17:case 8191:break;default:p=L;break}}else S++;S>0&&go(this.observer,new Error(`Found ${S} TS packet/s that do not start with 0x47`),void 0,this.logger),a.pesData=f,o.pesData=g,l.pesData=m;const C={audioTrack:o,videoTrack:a,id3Track:l,textTrack:c};return r&&this.extractRemainingSamples(C),C}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:s,id3Track:r,textTrack:n}=e,a=s.pesData,o=t.pesData,l=r.pesData;let c;if(a&&(c=di(a,this.logger))?(this.readyVideoParser(s.segmentCodec),this.videoParser!==null&&(this.videoParser.parsePES(s,n,c,!0),s.pesData=null)):s.pesData=a,o&&(c=di(o,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,c);break;case"mp3":this.parseMPEGPES(t,c);break;case"ac3":this.parseAC3PES(t,c);break}t.pesData=null}else o!=null&&o.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=o;l&&(c=di(l,this.logger))?(this.parseID3PES(r,c),r.pesData=null):r.pesData=l}demuxSampleAes(e,t,s){const r=this.demux(e,s,!0,!this.config.progressive),n=this.sampleAes=new aE(this.observer,this.config,t);return this.decrypt(r,n)}readyVideoParser(e){this.videoParser===null&&(e==="avc"?this.videoParser=new oE:e==="hevc"&&(this.videoParser=new lE))}decrypt(e,t){return new Promise(s=>{const{audioTrack:r,videoTrack:n}=e;r.samples&&r.segmentCodec==="aac"?t.decryptAacSamples(r.samples,0,()=>{n.samples?t.decryptAvcSamples(n.samples,0,0,()=>{s(e)}):s(e)}):n.samples&&t.decryptAvcSamples(n.samples,0,0,()=>{s(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let s=0;const r=this.aacOverFlow;let n=t.data;if(r){this.aacOverFlow=null;const f=r.missing,d=r.sample.unit.byteLength;if(f===-1)n=kt(r.sample.unit,n);else{const h=d-f;r.sample.unit.set(n.subarray(0,f),h),e.samples.push(r.sample),s=r.missing}}let a,o;for(a=s,o=n.length;a<o-1&&!_n(n,a);a++);if(a!==s){let f;const d=a<o-1;if(d?f=`AAC PES did not start with ADTS header,offset:${a}`:f="No ADTS header found in AAC PES",go(this.observer,new Error(f),d,this.logger),!d)return}Ah(e,this.observer,n,a,this.audioCodec);let l;if(t.pts!==void 0)l=t.pts;else if(r){const f=Ih(e.samplerate);l=r.sample.pts+f}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let c=0,u;for(;a<o;)if(u=Lh(e,n,a,l,c),a+=u.length,u.missing){this.aacOverFlow=u;break}else for(c++;a<o-1&&!_n(n,a);a++);}parseMPEGPES(e,t){const s=t.data,r=s.length;let n=0,a=0;const o=t.pts;if(o===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;a<r;)if(Dh(s,a)){const l=Ch(e,s,a,o,n);if(l)a+=l.length,n++;else break}else a++}parseAC3PES(e,t){{const s=t.data,r=t.pts;if(r===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const n=s.length;let a=0,o=0,l;for(;o<n&&(l=Oh(e,s,o,r,a++))>0;)o+=l}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const s=we({},t,{type:this._videoTrack?At.emsg:At.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(s)}}function ho(i,e){return((i[e+1]&31)<<8)+i[e+2]}function cE(i,e){return(i[e+10]&31)<<8|i[e+11]}function uE(i,e,t,s,r,n){const a={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},o=(i[e+1]&15)<<8|i[e+2],l=e+3+o-4,c=(i[e+10]&15)<<8|i[e+11];for(e+=12+c;e<l;){const u=ho(i,e),f=(i[e+3]&15)<<8|i[e+4];switch(i[e]){case 207:if(!s){Sa("ADTS AAC",n);break}case 15:a.audioPid===-1&&(a.audioPid=u);break;case 21:a.id3Pid===-1&&(a.id3Pid=u);break;case 219:if(!s){Sa("H.264",n);break}case 27:a.videoPid===-1&&(a.videoPid=u);break;case 3:case 4:!t.mpeg&&!t.mp3?n.log("MPEG audio found, not supported in this browser"):a.audioPid===-1&&(a.audioPid=u,a.segmentAudioCodec="mp3");break;case 193:if(!s){Sa("AC-3",n);break}case 129:t.ac3?a.audioPid===-1&&(a.audioPid=u,a.segmentAudioCodec="ac3"):n.log("AC-3 audio found, not supported in this browser");break;case 6:if(a.audioPid===-1&&f>0){let d=e+5,h=f;for(;h>2;){i[d]===106&&(t.ac3!==!0?n.log("AC-3 audio found, not supported in this browser for now"):(a.audioPid=u,a.segmentAudioCodec="ac3"));const m=i[d+1]+2;d+=m,h-=m}}break;case 194:case 135:return go(r,new Error("Unsupported EC-3 in M2TS found"),void 0,n),a;case 36:a.videoPid===-1&&(a.videoPid=u,a.segmentVideoCodec="hevc",n.log("HEVC in M2TS found"));break}e+=f+5}return a}function go(i,e,t,s){s.warn(`parsing error: ${e.message}`),i.emit(y.ERROR,y.ERROR,{type:ie.MEDIA_ERROR,details:k.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function Sa(i,e){e.log(`${i} with AES-128-CBC encryption found in unencrypted stream`)}function di(i,e){let t=0,s,r,n,a,o;const l=i.data;if(!i||i.size===0)return null;for(;l[0].length<19&&l.length>1;)l[0]=kt(l[0],l[1]),l.splice(1,1);if(s=l[0],(s[0]<<16)+(s[1]<<8)+s[2]===1){if(r=(s[4]<<8)+s[5],r&&r>i.size-6)return null;const u=s[7];u&192&&(a=(s[9]&14)*536870912+(s[10]&255)*4194304+(s[11]&254)*16384+(s[12]&255)*128+(s[13]&254)/2,u&64?(o=(s[14]&14)*536870912+(s[15]&255)*4194304+(s[16]&254)*16384+(s[17]&255)*128+(s[18]&254)/2,a-o>60*9e4&&(e.warn(`${Math.round((a-o)/9e4)}s delta between PTS and DTS, align them`),a=o)):o=a),n=s[8];let f=n+9;if(i.size<=f)return null;i.size-=f;const d=new Uint8Array(i.size);for(let h=0,g=l.length;h<g;h++){s=l[h];let m=s.byteLength;if(f)if(f>m){f-=m;continue}else s=s.subarray(f),m-=f,f=0;d.set(s,t),t+=m}return r&&(r-=n+3),{data:d,pts:a,dts:o,len:r}}return null}class fE{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const Ls=Math.pow(2,32)-1;class D{static init(){D.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in D.types)D.types.hasOwnProperty(e)&&(D.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),s=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);D.HDLR_TYPES={video:t,audio:s};const r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),n=new Uint8Array([0,0,0,0,0,0,0,0]);D.STTS=D.STSC=D.STCO=n,D.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),D.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),D.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),D.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const a=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);D.FTYP=D.box(D.types.ftyp,a,l,a,o),D.DINF=D.box(D.types.dinf,D.box(D.types.dref,r))}static box(e,...t){let s=8,r=t.length;const n=r;for(;r--;)s+=t[r].byteLength;const a=new Uint8Array(s);for(a[0]=s>>24&255,a[1]=s>>16&255,a[2]=s>>8&255,a[3]=s&255,a.set(e,4),r=0,s=8;r<n;r++)a.set(t[r],s),s+=t[r].byteLength;return a}static hdlr(e){return D.box(D.types.hdlr,D.HDLR_TYPES[e])}static mdat(e){return D.box(D.types.mdat,e)}static mdhd(e,t){t*=e;const s=Math.floor(t/(Ls+1)),r=Math.floor(t%(Ls+1));return D.box(D.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,s>>24,s>>16&255,s>>8&255,s&255,r>>24,r>>16&255,r>>8&255,r&255,85,196,0,0]))}static mdia(e){return D.box(D.types.mdia,D.mdhd(e.timescale||0,e.duration||0),D.hdlr(e.type),D.minf(e))}static mfhd(e){return D.box(D.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?D.box(D.types.minf,D.box(D.types.smhd,D.SMHD),D.DINF,D.stbl(e)):D.box(D.types.minf,D.box(D.types.vmhd,D.VMHD),D.DINF,D.stbl(e))}static moof(e,t,s){return D.box(D.types.moof,D.mfhd(e),D.traf(s,t))}static moov(e){let t=e.length;const s=[];for(;t--;)s[t]=D.trak(e[t]);return D.box.apply(null,[D.types.moov,D.mvhd(e[0].timescale||0,e[0].duration||0)].concat(s).concat(D.mvex(e)))}static mvex(e){let t=e.length;const s=[];for(;t--;)s[t]=D.trex(e[t]);return D.box.apply(null,[D.types.mvex,...s])}static mvhd(e,t){t*=e;const s=Math.floor(t/(Ls+1)),r=Math.floor(t%(Ls+1)),n=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,s>>24,s>>16&255,s>>8&255,s&255,r>>24,r>>16&255,r>>8&255,r&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return D.box(D.types.mvhd,n)}static sdtp(e){const t=e.samples||[],s=new Uint8Array(4+t.length);let r,n;for(r=0;r<t.length;r++)n=t[r].flags,s[r+4]=n.dependsOn<<4|n.isDependedOn<<2|n.hasRedundancy;return D.box(D.types.sdtp,s)}static stbl(e){return D.box(D.types.stbl,D.stsd(e),D.box(D.types.stts,D.STTS),D.box(D.types.stsc,D.STSC),D.box(D.types.stsz,D.STSZ),D.box(D.types.stco,D.STCO))}static avc1(e){let t=[],s=[],r,n,a;for(r=0;r<e.sps.length;r++)n=e.sps[r],a=n.byteLength,t.push(a>>>8&255),t.push(a&255),t=t.concat(Array.prototype.slice.call(n));for(r=0;r<e.pps.length;r++)n=e.pps[r],a=n.byteLength,s.push(a>>>8&255),s.push(a&255),s=s.concat(Array.prototype.slice.call(n));const o=D.box(D.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(s))),l=e.width,c=e.height,u=e.pixelRatio[0],f=e.pixelRatio[1];return D.box(D.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,l&255,c>>8&255,c&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,D.box(D.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),D.box(D.types.pasp,new Uint8Array([u>>24,u>>16&255,u>>8&255,u&255,f>>24,f>>16&255,f>>8&255,f&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return D.box(D.types.mp4a,D.audioStsd(e),D.box(D.types.esds,D.esds(e)))}static mp3(e){return D.box(D.types[".mp3"],D.audioStsd(e))}static ac3(e){return D.box(D.types["ac-3"],D.audioStsd(e),D.box(D.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return D.box(D.types.stsd,D.STSD,D.mp4a(e));if(t==="ac3"&&e.config)return D.box(D.types.stsd,D.STSD,D.ac3(e));if(t==="mp3"&&e.codec==="mp3")return D.box(D.types.stsd,D.STSD,D.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return D.box(D.types.stsd,D.STSD,D.avc1(e));if(t==="hevc"&&e.vps)return D.box(D.types.stsd,D.STSD,D.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,s=(e.duration||0)*(e.timescale||0),r=e.width||0,n=e.height||0,a=Math.floor(s/(Ls+1)),o=Math.floor(s%(Ls+1));return D.box(D.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,a>>24,a>>16&255,a>>8&255,a&255,o>>24,o>>16&255,o>>8&255,o&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,r&255,0,0,n>>8&255,n&255,0,0]))}static traf(e,t){const s=D.sdtp(e),r=e.id,n=Math.floor(t/(Ls+1)),a=Math.floor(t%(Ls+1));return D.box(D.types.traf,D.box(D.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255])),D.box(D.types.tfdt,new Uint8Array([1,0,0,0,n>>24,n>>16&255,n>>8&255,n&255,a>>24,a>>16&255,a>>8&255,a&255])),D.trun(e,s.length+16+20+8+16+8+8),s)}static trak(e){return e.duration=e.duration||4294967295,D.box(D.types.trak,D.tkhd(e),D.mdia(e))}static trex(e){const t=e.id;return D.box(D.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const s=e.samples||[],r=s.length,n=12+16*r,a=new Uint8Array(n);let o,l,c,u,f,d;for(t+=8+n,a.set([e.type==="video"?1:0,0,15,1,r>>>24&255,r>>>16&255,r>>>8&255,r&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),o=0;o<r;o++)l=s[o],c=l.duration,u=l.size,f=l.flags,d=l.cts,a.set([c>>>24&255,c>>>16&255,c>>>8&255,c&255,u>>>24&255,u>>>16&255,u>>>8&255,u&255,f.isLeading<<2|f.dependsOn,f.isDependedOn<<6|f.hasRedundancy<<4|f.paddingValue<<1|f.isNonSync,f.degradPrio&61440,f.degradPrio&15,d>>>24&255,d>>>16&255,d>>>8&255,d&255],12+16*o);return D.box(D.types.trun,a)}static initSegment(e){D.types||D.init();const t=D.moov(e);return kt(D.FTYP,t)}static hvc1(e){const t=e.params,s=[e.vps,e.sps,e.pps],r=4,n=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),r-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),s.length]);let a=n.length;for(let g=0;g<s.length;g+=1){a+=3;for(let m=0;m<s[g].length;m+=1)a+=2+s[g][m].length}const o=new Uint8Array(a);o.set(n,0),a=n.length;const l=s.length-1;for(let g=0;g<s.length;g+=1){o.set(new Uint8Array([32+g|(g===l?128:0),0,s[g].length]),a),a+=3;for(let m=0;m<s[g].length;m+=1)o.set(new Uint8Array([s[g][m].length>>8,s[g][m].length&255]),a),a+=2,o.set(s[g][m],a),a+=s[g][m].length}const c=D.box(D.types.hvcC,o),u=e.width,f=e.height,d=e.pixelRatio[0],h=e.pixelRatio[1];return D.box(D.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,u&255,f>>8&255,f&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),c,D.box(D.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),D.box(D.types.pasp,new Uint8Array([d>>24,d>>16&255,d>>8&255,d&255,h>>24,h>>16&255,h>>8&255,h&255])))}}D.types=void 0;D.HDLR_TYPES=void 0;D.STTS=void 0;D.STSC=void 0;D.STCO=void 0;D.STSZ=void 0;D.VMHD=void 0;D.SMHD=void 0;D.STSD=void 0;D.FTYP=void 0;D.DINF=void 0;const Fh=9e4;function bl(i,e,t=1,s=!1){const r=i*e*t;return s?Math.round(r):r}function dE(i,e,t=1,s=!1){return bl(i,e,1/t,s)}function $i(i,e=!1){return bl(i,1e3,1/Fh,e)}function hE(i,e=1){return bl(i,Fh,1/e)}function vu(i){const{baseTime:e,timescale:t,trackId:s}=i;return`${e/t} (${e}/${t}) trackId: ${s}`}const gE=10*1e3,mE=1024,pE=1152,yE=1536;let hi=null,ba=null;function Eu(i,e,t,s){return{duration:e,size:t,cts:s,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:i?2:1,isNonSync:i?0:1}}}class Jr extends Pt{constructor(e,t,s,r){if(super("mp4-remuxer",r),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=s,this.ISGenerated=!1,hi===null){const a=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);hi=a?parseInt(a[1]):0}if(ba===null){const n=navigator.userAgent.match(/Safari\/(\d+)/i);ba=n?parseInt(n[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){const t=this._initPTS;(!t||!e||e.trackId!==t.trackId||e.baseTime!==t.baseTime||e.timescale!==t.timescale)&&this.log(`Reset initPTS: ${t&&vu(t)} > ${e&&vu(e)}`),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const s=e[0].pts,r=e.reduce((n,a)=>{let o=a.pts,l=o-n;return l<-4294967296&&(t=!0,o=St(o,s),l=o-n),l>0?n:o},s);return t&&this.debug("PTS rollover detected"),r}remux(e,t,s,r,n,a,o,l){let c,u,f,d,h,g,m=n,p=n;const v=e.pid>-1,E=t.pid>-1,x=t.samples.length,T=e.samples.length>0,S=o&&x>0||x>1;if((!v||T)&&(!E||S)||this.ISGenerated||o){if(this.ISGenerated){var A,w,L,I;const Q=this.videoTrackConfig;(Q&&(t.width!==Q.width||t.height!==Q.height||((A=t.pixelRatio)==null?void 0:A[0])!==((w=Q.pixelRatio)==null?void 0:w[0])||((L=t.pixelRatio)==null?void 0:L[1])!==((I=Q.pixelRatio)==null?void 0:I[1]))||!Q&&S||this.nextAudioTs===null&&T)&&this.resetInitSegment()}this.ISGenerated||(f=this.generateIS(e,t,n,a));const O=this.isVideoContiguous;let P=-1,H;if(S&&(P=vE(t.samples),!O&&this.config.forceKeyFrameOnDiscontinuity))if(g=!0,P>0){this.warn(`Dropped ${P} out of ${x} video samples due to a missing keyframe`);const Q=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(P),t.dropped+=P,p+=(t.samples[0].pts-Q)/t.inputTimeScale,H=p}else P===-1&&(this.warn(`No keyframe found out of ${x} video samples`),g=!1);if(this.ISGenerated){if(T&&S){const Q=this.getVideoStartPts(t.samples),U=(St(e.samples[0].pts,Q)-Q)/t.inputTimeScale;m+=Math.max(0,U),p+=Math.max(0,-U)}if(T){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),f=this.generateIS(e,t,n,a)),u=this.remuxAudio(e,m,this.isAudioContiguous,a,E||S||l===se.AUDIO?p:void 0),S){const Q=u?u.endPTS-u.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),f=this.generateIS(e,t,n,a)),c=this.remuxVideo(t,p,O,Q)}}else S&&(c=this.remuxVideo(t,p,O,0));c&&(c.firstKeyFrame=P,c.independent=P!==-1,c.firstKeyFramePTS=H)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(s.samples.length&&(h=Nh(s,n,this._initPTS,this._initDTS)),r.samples.length&&(d=$h(r,n,this._initPTS))),{audio:u,video:c,initSegment:f,independent:g,text:d,id3:h}}computeInitPts(e,t,s,r){const n=Math.round(s*t);let a=St(e,n);if(a<n+t)for(this.log(`Adjusting PTS for rollover in timeline near ${(n-a)/t} ${r}`);a<n+t;)a+=8589934592;return a-n}generateIS(e,t,s,r){const n=e.samples,a=t.samples,o=this.typeSupported,l={},c=this._initPTS;let u=!c||r,f="audio/mp4",d,h,g,m=-1;if(u&&(d=h=1/0),e.config&&n.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":o.mpeg?(f="audio/mpeg",e.codec=""):o.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}l.audio={id:"audio",container:f,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&o.mpeg?new Uint8Array(0):D.initSegment([e]),metadata:{channelCount:e.channelCount}},u&&(m=e.id,g=e.inputTimeScale,!c||g!==c.timescale?d=h=this.computeInitPts(n[0].pts,g,s,"audio"):u=!1)}if(t.sps&&t.pps&&a.length){if(t.timescale=t.inputTimeScale,l.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:D.initSegment([t]),metadata:{width:t.width,height:t.height}},u)if(m=t.id,g=t.inputTimeScale,!c||g!==c.timescale){const p=this.getVideoStartPts(a),v=St(a[0].dts,p),E=this.computeInitPts(v,g,s,"video"),x=this.computeInitPts(p,g,s,"video");h=Math.min(h,E),d=Math.min(d,x)}else u=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(l).length)return this.ISGenerated=!0,u?(c&&this.warn(`Timestamps at playlist time: ${r?"":"~"}${s} ${d/g} != initPTS: ${c.baseTime/c.timescale} (${c.baseTime}/${c.timescale}) trackId: ${c.trackId}`),this.log(`Found initPTS at playlist time: ${s} offset: ${d/g} (${d}/${g}) trackId: ${m}`),this._initPTS={baseTime:d,timescale:g,trackId:m},this._initDTS={baseTime:h,timescale:g,trackId:m}):d=g=void 0,{tracks:l,initPTS:d,timescale:g,trackId:m}}remuxVideo(e,t,s,r){const n=e.inputTimeScale,a=e.samples,o=[],l=a.length,c=this._initPTS,u=c.baseTime*n/c.timescale;let f=this.nextVideoTs,d=8,h=this.videoSampleDuration,g,m,p=Number.POSITIVE_INFINITY,v=Number.NEGATIVE_INFINITY,E=!1;if(!s||f===null){const z=u+t*n,j=a[0].pts-St(a[0].dts,a[0].pts);hi&&f!==null&&Math.abs(z-j-(f+u))<15e3?s=!0:f=z-j-u}const x=f+u;for(let z=0;z<l;z++){const j=a[z];j.pts=St(j.pts,x),j.dts=St(j.dts,x),j.dts<a[z>0?z-1:z].dts&&(E=!0)}E&&a.sort(function(z,j){const he=z.dts-j.dts,Se=z.pts-j.pts;return he||Se}),g=a[0].dts,m=a[a.length-1].dts;const T=m-g,S=T?Math.round(T/(l-1)):h||e.inputTimeScale/30;if(s){const z=g-x,j=z>S,he=z<-1;if((j||he)&&(j?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${$i(z,!0)} ms (${z}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${$i(-z,!0)} ms (${z}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!he||x>=a[0].pts||hi)){g=x;const Se=a[0].pts-z;if(j)a[0].dts=g,a[0].pts=Se;else{let ge=!0;for(let me=0;me<a.length&&!(a[me].dts>Se&&ge);me++){const Ue=a[me].pts;if(a[me].dts-=z,a[me].pts-=z,me<a.length-1){const Ge=a[me+1].pts,lt=a[me].pts,tt=Ge<=lt,As=Ge<=Ue;ge=tt==As}}}this.log(`Video: Initial PTS/DTS adjusted: ${$i(Se,!0)}/${$i(g,!0)}, delta: ${$i(z,!0)} ms`)}}g=Math.max(0,g);let C=0,A=0,w=g;for(let z=0;z<l;z++){const j=a[z],he=j.units,Se=he.length;let ge=0;for(let me=0;me<Se;me++)ge+=he[me].data.length;A+=ge,C+=Se,j.length=ge,j.dts<w?(j.dts=w,w+=S/4|0||1):w=j.dts,p=Math.min(j.pts,p),v=Math.max(j.pts,v)}m=a[l-1].dts;const L=A+4*C+8;let I;try{I=new Uint8Array(L)}catch(z){this.observer.emit(y.ERROR,y.ERROR,{type:ie.MUX_ERROR,details:k.REMUX_ALLOC_ERROR,fatal:!1,error:z,bytes:L,reason:`fail allocating video mdat ${L}`});return}const O=new DataView(I.buffer);O.setUint32(0,L),I.set(D.types.mdat,4);let P=!1,H=Number.POSITIVE_INFINITY,Q=Number.POSITIVE_INFINITY,Z=Number.NEGATIVE_INFINITY,U=Number.NEGATIVE_INFINITY;for(let z=0;z<l;z++){const j=a[z],he=j.units;let Se=0;for(let Ue=0,Ge=he.length;Ue<Ge;Ue++){const lt=he[Ue],tt=lt.data,As=lt.data.byteLength;O.setUint32(d,As),d+=4,I.set(tt,d),d+=As,Se+=4+As}let ge;if(z<l-1)h=a[z+1].dts-j.dts,ge=a[z+1].pts-j.pts;else{const Ue=this.config,Ge=z>0?j.dts-a[z-1].dts:S;if(ge=z>0?j.pts-a[z-1].pts:S,Ue.stretchShortVideoTrack&&this.nextAudioTs!==null){const lt=Math.floor(Ue.maxBufferHole*n),tt=(r?p+r*n:this.nextAudioTs+u)-j.pts;tt>lt?(h=tt-Ge,h<0?h=Ge:P=!0,this.log(`It is approximately ${tt/90} ms to the next segment; using duration ${h/90} ms for the last video frame.`)):h=Ge}else h=Ge}const me=Math.round(j.pts-j.dts);H=Math.min(H,h),Z=Math.max(Z,h),Q=Math.min(Q,ge),U=Math.max(U,ge),o.push(Eu(j.key,h,Se,me))}if(o.length){if(hi){if(hi<70){const z=o[0].flags;z.dependsOn=2,z.isNonSync=0}}else if(ba&&U-Q<Z-H&&S/Z<.025&&o[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let z=g;for(let j=0,he=o.length;j<he;j++){const Se=z+o[j].duration,ge=z+o[j].cts;if(j<he-1){const me=Se+o[j+1].cts;o[j].duration=me-ge}else o[j].duration=j?o[j-1].duration:S;o[j].cts=0,z=Se}}}h=P||!h?S:h;const Y=m+h;this.nextVideoTs=f=Y-u,this.videoSampleDuration=h,this.isVideoContiguous=!0;const oe={data1:D.moof(e.sequenceNumber++,g,we(e,{samples:o})),data2:I,startPTS:(p-u)/n,endPTS:(v+h-u)/n,startDTS:(g-u)/n,endDTS:f/n,type:"video",hasAudio:!1,hasVideo:!0,nb:o.length,dropped:e.dropped};return e.samples=[],e.dropped=0,oe}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return pE;case"ac3":return yE;default:return mE}}remuxAudio(e,t,s,r,n){const a=e.inputTimeScale,o=e.samplerate?e.samplerate:a,l=a/o,c=this.getSamplesPerFrame(e),u=c*l,f=this._initPTS,d=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,h=[],g=n!==void 0;let m=e.samples,p=d?0:8,v=this.nextAudioTs||-1;const E=f.baseTime*a/f.timescale,x=E+t*a;if(this.isAudioContiguous=s=s||m.length&&v>0&&(r&&Math.abs(x-(v+E))<9e3||Math.abs(St(m[0].pts,x)-(v+E))<20*u),m.forEach(function(U){U.pts=St(U.pts,x)}),!s||v<0){const U=m.length;if(m=m.filter(Y=>Y.pts>=0),U!==m.length&&this.warn(`Removed ${m.length-U} of ${U} samples (initPTS ${E} / ${a})`),!m.length)return;n===0?v=0:r&&!g?v=Math.max(0,x-E):v=m[0].pts-E}if(e.segmentCodec==="aac"){const U=this.config.maxAudioFramesDrift;for(let Y=0,G=v+E;Y<m.length;Y++){const te=m[Y],oe=te.pts,z=oe-G,j=Math.abs(1e3*z/a);if(z<=-U*u&&g)Y===0&&(this.warn(`Audio frame @ ${(oe/a).toFixed(3)}s overlaps marker by ${Math.round(1e3*z/a)} ms.`),this.nextAudioTs=v=oe-E,G=oe);else if(z>=U*u&&j<gE&&g){let he=Math.round(z/u);for(G=oe-he*u;G<0&&he&&u;)he--,G+=u;Y===0&&(this.nextAudioTs=v=G-E),this.warn(`Injecting ${he} audio frames @ ${((G-E)/a).toFixed(3)}s due to ${Math.round(1e3*z/a)} ms gap.`);for(let Se=0;Se<he;Se++){let ge=fE.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);ge||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),ge=te.unit.subarray()),m.splice(Y,0,{unit:ge,pts:G}),G+=u,Y++}}te.pts=G,G+=u}}let T=null,S=null,C,A=0,w=m.length;for(;w--;)A+=m[w].unit.byteLength;for(let U=0,Y=m.length;U<Y;U++){const G=m[U],te=G.unit;let oe=G.pts;if(S!==null){const j=h[U-1];j.duration=Math.round((oe-S)/l)}else if(s&&e.segmentCodec==="aac"&&(oe=v+E),T=oe,A>0){A+=p;try{C=new Uint8Array(A)}catch(j){this.observer.emit(y.ERROR,y.ERROR,{type:ie.MUX_ERROR,details:k.REMUX_ALLOC_ERROR,fatal:!1,error:j,bytes:A,reason:`fail allocating audio mdat ${A}`});return}d||(new DataView(C.buffer).setUint32(0,A),C.set(D.types.mdat,4))}else return;C.set(te,p);const z=te.byteLength;p+=z,h.push(Eu(!0,c,z,0)),S=oe}const L=h.length;if(!L)return;const I=h[h.length-1];v=S-E,this.nextAudioTs=v+l*I.duration;const O=d?new Uint8Array(0):D.moof(e.sequenceNumber++,T/l,we({},e,{samples:h}));e.samples=[];const P=(T-E)/a,H=this.nextAudioTs/a,Z={data1:O,data2:C,startPTS:P,endPTS:H,startDTS:P,endDTS:H,type:"audio",hasAudio:!0,hasVideo:!1,nb:L};return this.isAudioContiguous=!0,Z}}function St(i,e){let t;if(e===null)return i;for(e<i?t=-8589934592:t=8589934592;Math.abs(i-e)>4294967296;)i+=t;return i}function vE(i){for(let e=0;e<i.length;e++)if(i[e].key)return e;return-1}function Nh(i,e,t,s){const r=i.samples.length;if(!r)return;const n=i.inputTimeScale;for(let o=0;o<r;o++){const l=i.samples[o];l.pts=St(l.pts-t.baseTime*n/t.timescale,e*n)/n,l.dts=St(l.dts-s.baseTime*n/s.timescale,e*n)/n}const a=i.samples;return i.samples=[],{samples:a}}function $h(i,e,t){const s=i.samples.length;if(!s)return;const r=i.inputTimeScale;for(let a=0;a<s;a++){const o=i.samples[a];o.pts=St(o.pts-t.baseTime*r/t.timescale,e*r)/r}i.samples.sort((a,o)=>a.pts-o.pts);const n=i.samples;return i.samples=[],{samples:n}}class EE extends Pt{constructor(e,t,s,r){super("passthrough-remuxer",r),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,s,r){this.audioCodec=t,this.videoCodec=s,this.generateInitSegment(e,r),this.emitInitSegment=!0}generateInitSegment(e,t){let{audioCodec:s,videoCodec:r}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const{audio:n,video:a}=this.initData=Hd(e);if(t)ay(e,t);else{const l=n||a;l!=null&&l.encrypted&&this.warn(`Init segment with encrypted track with has no key ("${l.codec}")!`)}n&&(s=xu(n,ke.AUDIO,this)),a&&(r=xu(a,ke.VIDEO,this));const o={};n&&a?o.audiovideo={container:"video/mp4",codec:s+","+r,supplemental:a.supplemental,encrypted:a.encrypted,initSegment:e,id:"main"}:n?o.audio={container:"audio/mp4",codec:s,encrypted:n.encrypted,initSegment:e,id:"audio"}:a?o.video={container:"video/mp4",codec:r,supplemental:a.supplemental,encrypted:a.encrypted,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=o}remux(e,t,s,r,n,a){var o,l;let{initPTS:c,lastEndTime:u}=this;const f={audio:void 0,video:void 0,text:r,id3:s,initSegment:void 0};J(u)||(u=this.lastEndTime=n||0);const d=t.samples;if(!d.length)return f;const h={initPTS:void 0,timescale:void 0,trackId:void 0};let g=this.initData;if((o=g)!=null&&o.length||(this.generateInitSegment(d),g=this.initData),!((l=g)!=null&&l.length))return this.warn("Failed to generate initSegment."),f;this.emitInitSegment&&(h.tracks=this.initTracks,this.emitInitSegment=!1);const m=ly(d,g,this),p=g.audio?m[g.audio.id]:null,v=g.video?m[g.video.id]:null,E=Pr(v,1/0),x=Pr(p,1/0),T=Pr(v,0,!0),S=Pr(p,0,!0);let C=n,A=0;const w=p&&(!v||!c&&x<E||c&&c.trackId===g.audio.id),L=w?p:v;if(L){const G=L.timescale,te=L.start-n*G,oe=w?g.audio.id:g.video.id;C=L.start/G,A=w?S-x:T-E,(a||!c)&&(xE(c,C,n,A)||G!==c.timescale)&&(c&&this.warn(`Timestamps at playlist time: ${a?"":"~"}${n} ${te/G} != initPTS: ${c.baseTime/c.timescale} (${c.baseTime}/${c.timescale}) trackId: ${c.trackId}`),this.log(`Found initPTS at playlist time: ${n} offset: ${C-n} (${te}/${G}) trackId: ${oe}`),c=null,h.initPTS=te,h.timescale=G,h.trackId=oe)}else this.warn(`No audio or video samples found for initPTS at playlist time: ${n}`);c?(h.initPTS=c.baseTime,h.timescale=c.timescale,h.trackId=c.trackId):((!h.timescale||h.trackId===void 0||h.initPTS===void 0)&&(this.warn("Could not set initPTS"),h.initPTS=C,h.timescale=1,h.trackId=-1),this.initPTS=c={baseTime:h.initPTS,timescale:h.timescale,trackId:h.trackId});const I=C-c.baseTime/c.timescale,O=I+A;A>0?this.lastEndTime=O:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const P=!!g.audio,H=!!g.video;let Q="";P&&(Q+="audio"),H&&(Q+="video");const Z=(g.audio?g.audio.encrypted:!1)||(g.video?g.video.encrypted:!1),U={data1:d,startPTS:I,startDTS:I,endPTS:O,endDTS:O,type:Q,hasAudio:P,hasVideo:H,nb:1,dropped:0,encrypted:Z};f.audio=P&&!H?U:void 0,f.video=H?U:void 0;const Y=v?.sampleCount;if(Y){const G=v.keyFrameIndex,te=G!==-1;U.nb=Y,U.dropped=G===0||this.isVideoContiguous?0:te?G:Y,U.independent=te,U.firstKeyFrame=G,te&&v.keyFrameStart&&(U.firstKeyFramePTS=(v.keyFrameStart-c.baseTime)/c.timescale),this.isVideoContiguous||(f.independent=te),this.isVideoContiguous||(this.isVideoContiguous=te),U.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${G}/${Y} dropped: ${U.dropped} start: ${U.firstKeyFramePTS||"NA"}`)}return f.initSegment=h,f.id3=Nh(s,n,c,c),r.samples.length&&(f.text=$h(r,n,c)),f}}function Pr(i,e,t=!1){return i?.start!==void 0?(i.start+(t?i.duration:0))/i.timescale:e}function xE(i,e,t,s){if(i===null)return!0;const r=Math.max(s,1),n=e-i.baseTime/i.timescale;return Math.abs(n-t)>r}function xu(i,e,t){const s=i.codec;return s&&s.length>4?s:e===ke.AUDIO?s==="ec-3"||s==="ac-3"||s==="alac"?s:s==="fLaC"||s==="Opus"?En(s,!1):(t.warn(`Unhandled audio codec "${s}" in mp4 MAP`),s||"mp4a"):(t.warn(`Unhandled video codec "${s}" in mp4 MAP`),s||"avc1")}let cs;try{cs=self.performance.now.bind(self.performance)}catch{cs=Date.now}const en=[{demux:nE,remux:EE},{demux:Os,remux:Jr},{demux:tE,remux:Jr},{demux:iE,remux:Jr}];en.splice(2,0,{demux:sE,remux:Jr});class Tu{constructor(e,t,s,r,n,a){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=s,this.id=n,this.logger=a}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,s,r){const n=s.transmuxing;n.executeStart=cs();let a=new Uint8Array(e);const{currentTransmuxState:o,transmuxConfig:l}=this;r&&(this.currentTransmuxState=r);const{contiguous:c,discontinuity:u,trackSwitch:f,accurateTimeOffset:d,timeOffset:h,initSegmentChange:g}=r||o,{audioCodec:m,videoCodec:p,defaultInitPts:v,duration:E,initSegmentData:x}=l,T=TE(a,t);if(T&&Ii(T.method)){const w=this.getDecrypter(),L=gl(T.method);if(w.isSync()){let I=w.softwareDecrypt(a,T.key.buffer,T.iv.buffer,L);if(s.part>-1){const P=w.flush();I=P&&P.buffer}if(!I)return n.executeEnd=cs(),Aa(s);a=new Uint8Array(I)}else return this.asyncResult=!0,this.decryptionPromise=w.webCryptoDecrypt(a,T.key.buffer,T.iv.buffer,L).then(I=>{const O=this.push(I,null,s);return this.decryptionPromise=null,O}),this.decryptionPromise}const S=this.needsProbing(u,f);if(S){const w=this.configureTransmuxer(a);if(w)return this.logger.warn(`[transmuxer] ${w.message}`),this.observer.emit(y.ERROR,y.ERROR,{type:ie.MEDIA_ERROR,details:k.FRAG_PARSING_ERROR,fatal:!1,error:w,reason:w.message}),n.executeEnd=cs(),Aa(s)}(u||f||g||S)&&this.resetInitSegment(x,m,p,E,t),(u||g||S)&&this.resetInitialTimestamp(v),c||this.resetContiguity();const C=this.transmux(a,T,h,d,s);this.asyncResult=gr(C);const A=this.currentTransmuxState;return A.contiguous=!0,A.discontinuity=!1,A.trackSwitch=!1,n.executeEnd=cs(),C}flush(e){const t=e.transmuxing;t.executeStart=cs();const{decrypter:s,currentTransmuxState:r,decryptionPromise:n}=this;if(n)return this.asyncResult=!0,n.then(()=>this.flush(e));const a=[],{timeOffset:o}=r;if(s){const f=s.flush();f&&a.push(this.push(f.buffer,null,e))}const{demuxer:l,remuxer:c}=this;if(!l||!c){t.executeEnd=cs();const f=[Aa(e)];return this.asyncResult?Promise.resolve(f):f}const u=l.flush(o);return gr(u)?(this.asyncResult=!0,u.then(f=>(this.flushRemux(a,f,e),a))):(this.flushRemux(a,u,e),this.asyncResult?Promise.resolve(a):a)}flushRemux(e,t,s){const{audioTrack:r,videoTrack:n,id3Track:a,textTrack:o}=t,{accurateTimeOffset:l,timeOffset:c}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${s.sn}${s.part>-1?" part: "+s.part:""} of ${this.id===se.MAIN?"level":"track"} ${s.level}`);const u=this.remuxer.remux(r,n,a,o,c,l,!0,this.id);e.push({remuxResult:u,chunkMeta:s}),s.transmuxing.executeEnd=cs()}resetInitialTimestamp(e){const{demuxer:t,remuxer:s}=this;!t||!s||(t.resetTimeStamp(e),s.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,s,r,n){const{demuxer:a,remuxer:o}=this;!a||!o||(a.resetInitSegment(e,t,s,r),o.resetInitSegment(e,t,s,n))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,s,r,n){let a;return t&&t.method==="SAMPLE-AES"?a=this.transmuxSampleAes(e,t,s,r,n):a=this.transmuxUnencrypted(e,s,r,n),a}transmuxUnencrypted(e,t,s,r){const{audioTrack:n,videoTrack:a,id3Track:o,textTrack:l}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(n,a,o,l,t,s,!1,this.id),chunkMeta:r}}transmuxSampleAes(e,t,s,r,n){return this.demuxer.demuxSampleAes(e,t,s).then(a=>({remuxResult:this.remuxer.remux(a.audioTrack,a.videoTrack,a.id3Track,a.textTrack,s,r,!1,this.id),chunkMeta:n}))}configureTransmuxer(e){const{config:t,observer:s,typeSupported:r}=this;let n;for(let f=0,d=en.length;f<d;f++){var a;if((a=en[f].demux)!=null&&a.probe(e,this.logger)){n=en[f];break}}if(!n)return new Error("Failed to find demuxer by probing fragment data");const o=this.demuxer,l=this.remuxer,c=n.remux,u=n.demux;(!l||!(l instanceof c))&&(this.remuxer=new c(s,t,r,this.logger)),(!o||!(o instanceof u))&&(this.demuxer=new u(s,t,r,this.logger),this.probe=u.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new dl(this.config)),e}}function TE(i,e){let t=null;return i.byteLength>0&&e?.key!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const Aa=i=>({remuxResult:{},chunkMeta:i});function gr(i){return"then"in i&&i.then instanceof Function}class SE{constructor(e,t,s,r,n){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=s,this.duration=r,this.defaultInitPts=n||null}}class bE{constructor(e,t,s,r,n,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=s,this.trackSwitch=r,this.timeOffset=n,this.initSegmentChange=a}}let Su=0;class Bh{constructor(e,t,s,r){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=Su++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=l=>{const c=l.data,u=this.hls;if(!(!u||!(c!=null&&c.event)||c.instanceNo!==this.instanceNo))switch(c.event){case"init":{var f;const d=(f=this.workerContext)==null?void 0:f.objectURL;d&&self.URL.revokeObjectURL(d);break}case"transmuxComplete":{this.handleTransmuxComplete(c.data);break}case"flush":{this.onFlush(c.data);break}case"workerLog":{u.logger[c.data.logType]&&u.logger[c.data.logType](c.data.message);break}default:{c.data=c.data||{},c.data.frag=this.frag,c.data.part=this.part,c.data.id=this.id,u.trigger(c.event,c.data);break}}},this.onWorkerError=l=>{if(!this.hls)return;const c=new Error(`${l.message}  (${l.filename}:${l.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(y.ERROR,{type:ie.OTHER_ERROR,details:k.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:c})};const n=e.config;this.hls=e,this.id=t,this.useWorker=!!n.enableWorker,this.onTransmuxComplete=s,this.onFlush=r;const a=(l,c)=>{c=c||{},c.frag=this.frag||void 0,l===y.ERROR&&(c=c,c.parent=this.id,c.part=this.part,this.error=c.error),this.hls.trigger(l,c)};this.observer=new yl,this.observer.on(y.FRAG_DECRYPTED,a),this.observer.on(y.ERROR,a);const o=Nc(n.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const l=this.hls.logger;if(n.workerPath||_v()){try{n.workerPath?(l.log(`loading Web Worker ${n.workerPath} for "${t}"`),this.workerContext=Cv(n.workerPath)):(l.log(`injecting Web Worker for "${t}"`),this.workerContext=Rv());const{worker:u}=this.workerContext;u.addEventListener("message",this.onWorkerMessage),u.addEventListener("error",this.onWorkerError),u.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:o,id:t,config:Pe(n)})}catch(u){l.warn(`Error setting up "${t}" Web Worker, fallback to inline`,u),this.terminateWorker(),this.error=null,this.transmuxer=new Tu(this.observer,o,n,"",t,e.logger)}return}}this.transmuxer=new Tu(this.observer,o,n,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=Su++;const t=this.hls.config,s=Nc(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:s,id:this.id,config:Pe(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),wv(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,s,r,n,a,o,l,c,u){var f,d;c.transmuxing.start=self.performance.now();const{instanceNo:h,transmuxer:g}=this,m=a?a.start:n.start,p=n.decryptdata,v=this.frag,E=!(v&&n.cc===v.cc),x=!(v&&c.level===v.level),T=v?c.sn-v.sn:-1,S=this.part?c.part-this.part.index:-1,C=T===0&&c.id>1&&c.id===v?.stats.chunkCount,A=!x&&(T===1||T===0&&(S===1||C&&S<=0)),w=self.performance.now();(x||T||n.stats.parsing.start===0)&&(n.stats.parsing.start=w),a&&(S||!A)&&(a.stats.parsing.start=w);const L=!(v&&((f=n.initSegment)==null?void 0:f.url)===((d=v.initSegment)==null?void 0:d.url)),I=new bE(E,A,l,x,m,L);if(!A||E||L){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${n.type} sn: ${c.sn}${c.part>-1?" part: "+c.part:""} ${this.id===se.MAIN?"level":"track"}: ${c.level} id: ${c.id}
        discontinuity: ${E}
        trackSwitch: ${x}
        contiguous: ${A}
        accurateTimeOffset: ${l}
        timeOffset: ${m}
        initSegmentChange: ${L}`);const O=new SE(s,r,t,o,u);this.configureTransmuxer(O)}if(this.frag=n,this.part=a,this.workerContext)this.workerContext.worker.postMessage({instanceNo:h,cmd:"demux",data:e,decryptdata:p,chunkMeta:c,state:I},e instanceof ArrayBuffer?[e]:[]);else if(g){const O=g.push(e,p,c,I);gr(O)?O.then(P=>{this.handleTransmuxComplete(P)}).catch(P=>{this.transmuxerError(P,c,"transmuxer-interface push error")}):this.handleTransmuxComplete(O)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:s}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(s){const r=s.flush(e);gr(r)?r.then(n=>{this.handleFlushResult(n,e)}).catch(n=>{this.transmuxerError(n,e,"transmuxer-interface flush error")}):this.handleFlushResult(r,e)}}transmuxerError(e,t,s){this.hls&&(this.error=e,this.hls.trigger(y.ERROR,{type:ie.MEDIA_ERROR,details:k.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:s}))}handleFlushResult(e,t){e.forEach(s=>{this.handleTransmuxComplete(s)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:s}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):s&&s.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const bu=100;class AE extends pl{constructor(e,t,s){super(e,t,s,"audio-stream-controller",se.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(y.LEVEL_LOADED,this.onLevelLoaded,this),e.on(y.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(y.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(y.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(y.BUFFER_RESET,this.onBufferReset,this),e.on(y.BUFFER_CREATED,this.onBufferCreated,this),e.on(y.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(y.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(y.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(y.FRAG_LOADING,this.onFragLoading,this),e.on(y.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(y.LEVEL_LOADED,this.onLevelLoaded,this),e.off(y.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(y.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(y.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(y.BUFFER_RESET,this.onBufferReset,this),e.off(y.BUFFER_CREATED,this.onBufferCreated,this),e.off(y.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(y.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(y.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(y.FRAG_LOADING,this.onFragLoading,this),e.off(y.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:s,initPTS:r,timescale:n,trackId:a}){if(s===se.MAIN){const o=t.cc,l=this.fragCurrent;if(this.initPTS[o]={baseTime:r,timescale:n,trackId:a},this.log(`InitPTS for cc: ${o} found from main: ${r/n} (${r}/${n}) trackId: ${a}`),this.mainAnchor=t,this.state===N.WAITING_INIT_PTS){const c=this.waitingData;(!c&&!this.loadingParts||c&&c.frag.cc!==o)&&this.syncWithAnchor(t,c?.frag)}else!this.hls.hasEnoughToStart&&l&&l.cc!==o?(l.abortRequests(),this.syncWithAnchor(t,l)):this.state===N.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var s;const r=((s=this.mainFragLoading)==null?void 0:s.frag)||null;if(t&&r?.cc===t.cc)return;const n=(r||e).cc,a=this.getLevelDetails(),o=this.getLoadPosition(),l=th(a,n,o);l&&(this.log(`Syncing with main frag at ${l.start} cc ${l.cc}`),this.startFragRequested=!1,this.nextLoadPosition=l.start,this.resetLoadingState(),this.state===N.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=N.STOPPED;return}const s=this.lastCurrentTime;this.stopLoad(),this.setInterval(bu),s>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${s.toFixed(3)}`),e=s,this.state=N.IDLE):this.state=N.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case N.IDLE:this.doTickIdle();break;case N.WAITING_TRACK:{const{levels:e,trackId:t}=this,s=e?.[t],r=s?.details;if(r&&!this.waitForLive(s)){if(this.waitForCdnTuneIn(r))break;this.state=N.WAITING_INIT_PTS}break}case N.FRAG_LOADING_WAITING_RETRY:{this.checkRetryDate();break}case N.WAITING_INIT_PTS:{const e=this.waitingData;if(e){const{frag:t,part:s,cache:r,complete:n}=e,a=this.mainAnchor;if(this.initPTS[t.cc]!==void 0){this.waitingData=null,this.state=N.FRAG_LOADING;const o=r.flush().buffer,l={frag:t,part:s,payload:o,networkDetails:null};this._handleFragmentLoadProgress(l),n&&super._handleFragmentLoadComplete(l)}else a&&a.cc!==e.frag.cc&&this.syncWithAnchor(a,e.frag)}else this.state=N.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:s,media:r,trackId:n}=this,a=t.config;if(!this.buffering||!r&&!this.primaryPrefetch&&(this.startFragRequested||!a.startFragPrefetch)||!(s!=null&&s[n]))return;const o=s[n],l=o.details;if(!l||this.waitForLive(o)||this.waitForCdnTuneIn(l)){this.state=N.WAITING_TRACK,this.startFragRequested=!1;return}const c=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&c&&(this.bufferFlushed=!1,this.afterBufferFlushed(c,ke.AUDIO,se.AUDIO));const u=this.getFwdBufferInfo(c,se.AUDIO);if(u===null)return;if(!this.switchingTrack&&this._streamEnded(u,l)){t.trigger(y.BUFFER_EOS,{type:"audio"}),this.state=N.ENDED;return}const f=u.len,d=t.maxBufferLength,h=l.fragments,g=h[0].start,m=this.getLoadPosition(),p=this.flushing?m:u.end;if(this.switchingTrack&&r){const x=m;l.PTSKnown&&x<g&&(u.end>g||u.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),r.currentTime=g+.05)}if(f>=d&&!this.switchingTrack&&p<h[h.length-1].start)return;let v=this.getNextFragment(p,l);if(v&&this.isLoopLoading(v,p)&&(v=this.getNextFragmentLoopLoading(v,l,u,se.MAIN,d)),!v){this.bufferFlushed=!0;return}let E=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&E&&Ve(v)&&!v.endList&&(!l.live||!this.loadingParts&&p<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(E)===je.OK&&(this.mainFragLoading=E=null),E&&Ve(E))){if(v.start>E.end){const T=this.fragmentTracker.getFragAtPos(p,se.MAIN);T&&T.end>E.end&&(E=T,this.mainFragLoading={frag:T,targetBufferTime:null})}if(v.start>E.end)return}this.loadFragment(v,o,p)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(s=>new fr(s))}onAudioTrackSwitching(e,t){const s=!!t.url;this.trackId=t.id;const{fragCurrent:r}=this;r&&(r.abortRequests(),this.removeUnbufferedFrags(r.start)),this.resetLoadingState(),s?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==N.STOPPED&&(this.setInterval(bu),this.state=N.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const s=this.cachedTrackLoadedData;s&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(y.AUDIO_TRACK_LOADED,s))}onAudioTrackLoaded(e,t){var s;const{levels:r}=this,{details:n,id:a,groupId:o,track:l}=t;if(!r){this.warn(`Audio tracks reset while loading track ${a} "${l.name}" of "${o}"`);return}const c=this.mainDetails;if(!c||n.endCC>c.endCC||c.expired){this.cachedTrackLoadedData=t,this.state!==N.STOPPED&&(this.state=N.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${a} "${l.name}" of "${o}" loaded [${n.startSN},${n.endSN}]${n.lastPartSn?`[part-${n.lastPartSn}-${n.lastPartIndex}]`:""},duration:${n.totalduration}`);const u=r[a];let f=0;if(n.live||(s=u.details)!=null&&s.live){if(this.checkLiveUpdate(n),n.deltaUpdateFailed)return;if(u.details){var d;f=this.alignPlaylists(n,u.details,(d=this.levelLastLoaded)==null?void 0:d.details)}n.alignedSliding||(Eh(n,c),n.alignedSliding||Ln(n,c),f=n.fragmentStart)}u.details=n,this.levelLastLoaded=u,this.startFragRequested||this.setStartPosition(c,f),this.hls.trigger(y.AUDIO_TRACK_UPDATED,{details:n,id:a,groupId:t.groupId}),this.state===N.WAITING_TRACK&&!this.waitForCdnTuneIn(n)&&(this.state=N.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const s=e.frag,{part:r,payload:n}=e,{config:a,trackId:o,levels:l}=this;if(!l){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${s.sn} of level ${s.level} will not be buffered`);return}const c=l[o];if(!c){this.warn("Audio track is undefined on fragment load progress");return}const u=c.details;if(!u){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(s.start);return}const f=a.defaultAudioCodec||c.audioCodec||"mp4a.40.2";let d=this.transmuxer;d||(d=this.transmuxer=new Bh(this.hls,se.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const h=this.initPTS[s.cc],g=(t=s.initSegment)==null?void 0:t.data;if(h!==void 0){const p=r?r.index:-1,v=p!==-1,E=new hl(s.level,s.sn,s.stats.chunkCount,n.byteLength,p,v);d.push(n,g,f,"",s,r,u.totalduration,!1,E,h)}else{this.log(`Unknown video PTS for cc ${s.cc}, waiting for video PTS before demuxing audio frag ${s.sn} of [${u.startSN} ,${u.endSN}],track ${o}`);const{cache:m}=this.waitingData=this.waitingData||{frag:s,part:r,cache:new xh,complete:!1};m.push(new Uint8Array(n)),this.state!==N.STOPPED&&(this.state=N.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const s=t.tracks.audio;s&&(this.mediaBuffer=s.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===se.MAIN&&Ve(t.frag)&&(this.mainFragLoading=t,this.state===N.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:s,part:r}=t;if(s.type!==se.AUDIO){!this.audioOnly&&s.type===se.MAIN&&!s.elementaryStreams.video&&!s.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(s)){this.warn(`Fragment ${s.sn}${r?" p: "+r.index:""} of level ${s.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(Ve(s)){this.fragPrevious=s;const n=this.switchingTrack;n&&(this.bufferedTrack=n,this.switchingTrack=null,this.hls.trigger(y.AUDIO_TRACK_SWITCHED,Re({},n)))}this.fragBufferedComplete(s,r),this.media&&this.tick()}onError(e,t){var s;if(t.fatal){this.state=N.ERROR;return}switch(t.details){case k.FRAG_GAP:case k.FRAG_PARSING_ERROR:case k.FRAG_DECRYPT_ERROR:case k.FRAG_LOAD_ERROR:case k.FRAG_LOAD_TIMEOUT:case k.KEY_LOAD_ERROR:case k.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(se.AUDIO,t);break;case k.AUDIO_TRACK_LOAD_ERROR:case k.AUDIO_TRACK_LOAD_TIMEOUT:case k.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===N.WAITING_TRACK&&((s=t.context)==null?void 0:s.type)===Ee.AUDIO_TRACK&&(this.state=N.IDLE);break;case k.BUFFER_ADD_CODEC_ERROR:case k.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case k.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case k.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==ke.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==ke.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===N.ENDED&&(this.state=N.IDLE);const s=this.mediaBuffer||this.media;s&&(this.afterBufferFlushed(s,t,se.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const s="audio",{hls:r}=this,{remuxResult:n,chunkMeta:a}=e,o=this.getCurrentContext(a);if(!o){this.resetWhenMissingContext(a);return}const{frag:l,part:c,level:u}=o,{details:f}=u,{audio:d,text:h,id3:g,initSegment:m}=n;if(this.fragContextChanged(l)||!f){this.fragmentTracker.removeFragment(l);return}if(this.state=N.PARSING,this.switchingTrack&&d&&this.completeAudioSwitch(this.switchingTrack),m!=null&&m.tracks){const p=l.initSegment||l;if(this.unhandledEncryptionError(m,l))return;this._bufferInitSegment(u,m.tracks,p,a),r.trigger(y.FRAG_PARSING_INIT_SEGMENT,{frag:p,id:s,tracks:m.tracks})}if(d){const{startPTS:p,endPTS:v,startDTS:E,endDTS:x}=d;c&&(c.elementaryStreams[ke.AUDIO]={startPTS:p,endPTS:v,startDTS:E,endDTS:x}),l.setElementaryStreamInfo(ke.AUDIO,p,v,E,x),this.bufferFragmentData(d,l,c,a)}if(g!=null&&(t=g.samples)!=null&&t.length){const p=we({id:s,frag:l,details:f},g);r.trigger(y.FRAG_PARSING_METADATA,p)}if(h){const p=we({id:s,frag:l,details:f},h);r.trigger(y.FRAG_PARSING_USERDATA,p)}}_bufferInitSegment(e,t,s,r){if(this.state!==N.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const n=t.audio;n.id=se.AUDIO;const a=e.audioCodec;this.log(`Init audio buffer, container:${n.container}, codecs[level/parsed]=[${a}/${n.codec}]`),a&&a.split(",").length===1&&(n.levelCodec=a),this.hls.trigger(y.BUFFER_CODECS,t);const o=n.initSegment;if(o!=null&&o.byteLength){const l={type:"audio",frag:s,part:null,chunkMeta:r,parent:s.type,data:o};this.hls.trigger(y.BUFFER_APPENDING,l)}this.tickImmediate()}loadFragment(e,t,s){const r=this.fragmentTracker.getState(e);if(this.switchingTrack||r===je.NOT_LOADED||r===je.PARTIAL){var n;if(!Ve(e))this._loadInitSegment(e,t);else if((n=t.details)!=null&&n.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=N.WAITING_INIT_PTS;const a=this.mainDetails;a&&a.fragmentStart!==t.details.fragmentStart&&Ln(t.details,a)}else super.loadFragment(e,t,s)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:s,assocLang:r,characteristics:n,audioCodec:a,channels:o}=this.bufferedTrack;si({name:t,lang:s,assocLang:r,characteristics:n,audioCodec:a,channels:o},e,Qs)||(Tn(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(y.AUDIO_TRACK_SWITCHED,Re({},e))}}class Al extends Pt{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,s){const r=t?.renditionReports;if(r){let n=-1;for(let a=0;a<r.length;a++){const o=r[a];let l;try{l=new self.URL(o.URI,t.url).href}catch(c){this.warn(`Could not construct new URL for Rendition Report: ${c}`),l=o.URI||""}if(l===e){n=a;break}else l===e.substring(0,l.length)&&(n=a)}if(n!==-1){const a=r[n],o=parseInt(a["LAST-MSN"])||t.lastPartSn;let l=parseInt(a["LAST-PART"])||t.lastPartIndex;if(this.hls.config.lowLatencyMode){const u=Math.min(t.age-t.partTarget,t.targetduration);l>=0&&u>t.partTarget&&(l+=1)}const c=s&&$c(s);return new Bc(o,l>=0?l:void 0,c)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(s){this.warn(`Could not construct new URL with HLS Delivery Directives: ${s}`)}return e}playlistLoaded(e,t,s){const{details:r,stats:n}=t,a=self.performance.now(),o=n.loading.first?Math.max(0,a-n.loading.first):0;r.advancedDateTime=Date.now()-o;const l=this.hls.config.timelineOffset;if(l!==r.appliedTimelineOffset){const u=Math.max(l||0,0);r.appliedTimelineOffset=u,r.fragments.forEach(f=>{f.setStart(f.playlistOffset+u)})}if(r.live||s!=null&&s.live){const u="levelInfo"in t?t.levelInfo:t.track;if(r.reloaded(s),s&&r.fragments.length>0){pv(s,r,this);const E=r.playlistParsingError;if(E){this.warn(E);const x=this.hls;if(!x.config.ignorePlaylistParsingErrors){var c;const{networkDetails:T}=t;x.trigger(y.ERROR,{type:ie.NETWORK_ERROR,details:k.LEVEL_PARSING_ERROR,fatal:!1,url:r.url,error:E,reason:E.message,level:t.level||void 0,parent:(c=r.fragments[0])==null?void 0:c.type,networkDetails:T,stats:n});return}r.playlistParsingError=null}}r.requestScheduled===-1&&(r.requestScheduled=n.loading.start);const f=this.hls.mainForwardBufferInfo,d=f?f.end-f.len:0,h=(r.edge-d)*1e3,g=gh(r,h);if(r.requestScheduled+g<a?r.requestScheduled=a:r.requestScheduled+=g,this.log(`live playlist ${e} ${r.advanced?"REFRESHED "+r.lastPartSn+"-"+r.lastPartIndex:r.updated?"UPDATED":"MISSED"}`),!this.canLoad||!r.live)return;let m,p,v;if(r.canBlockReload&&r.endSN&&r.advanced){const E=this.hls.config.lowLatencyMode,x=r.lastPartSn,T=r.endSN,S=r.lastPartIndex,C=S!==-1,A=x===T;C?A?(p=T+1,v=E?0:S):(p=x,v=E?S+1:r.maxPartIndex):p=T+1;const w=r.age,L=w+r.ageHeader;let I=Math.min(L-r.partTarget,r.targetduration*1.5);if(I>0){if(L>r.targetduration*3)this.log(`Playlist last advanced ${w.toFixed(2)}s ago. Omitting segment and part directives.`),p=void 0,v=void 0;else if(s!=null&&s.tuneInGoal&&L-r.partTarget>s.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${s.tuneInGoal} to: ${I} with playlist age: ${r.age}`),I=0;else{const O=Math.floor(I/r.targetduration);if(p+=O,v!==void 0){const P=Math.round(I%r.targetduration/r.partTarget);v+=P}this.log(`CDN Tune-in age: ${r.ageHeader}s last advanced ${w.toFixed(2)}s goal: ${I} skip sn ${O} to part ${v}`)}r.tuneInGoal=I}if(m=this.getDeliveryDirectives(r,t.deliveryDirectives,p,v),E||!A){r.requestScheduled=a,this.loadingPlaylist(u,m);return}}else(r.canBlockReload||r.canSkipUntil)&&(m=this.getDeliveryDirectives(r,t.deliveryDirectives,p,v));m&&p!==void 0&&r.canBlockReload&&(r.requestScheduled=n.loading.first+Math.max(g-o*2,g/2)),this.scheduleLoading(u,m,r)}else this.clearTimer()}scheduleLoading(e,t,s){const r=s||e.details;if(!r){this.loadingPlaylist(e,t);return}const n=self.performance.now(),a=r.requestScheduled;if(n>=a){this.loadingPlaylist(e,t);return}const o=a-n;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(o)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),o)}getDeliveryDirectives(e,t,s,r){let n=$c(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(s=t.msn,r=t.part,n=Qr.No),new Bc(s,r,n)}checkRetry(e){const t=e.details,s=Sn(e),r=e.errorAction,{action:n,retryCount:a=0,retryConfig:o}=r||{},l=!!r&&!!o&&(n===Qe.RetryRequest||!r.resolved&&n===Qe.SendAlternateToPenaltyBox);if(l){var c;if(a>=o.maxNumRetry)return!1;if(s&&(c=e.context)!=null&&c.deliveryDirectives)this.warn(`Retrying playlist loading ${a+1}/${o.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const u=fl(o,a);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),u),this.warn(`Retrying playlist loading ${a+1}/${o.maxNumRetry} after "${t}" in ${u}ms`)}e.levelRetry=!0,r.resolved=!0}return l}}function Uh(i,e){if(i.length!==e.length)return!1;for(let t=0;t<i.length;t++)if(!mr(i[t].attrs,e[t].attrs))return!1;return!0}function mr(i,e,t){const s=i["STABLE-RENDITION-ID"];return s&&!t?s===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(r=>i[r]!==e[r])}function mo(i,e){return e.label.toLowerCase()===i.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(i.lang||"").toLowerCase())}class IE extends Al{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.MANIFEST_PARSED,this.onManifestParsed,this),e.on(y.LEVEL_LOADING,this.onLevelLoading,this),e.on(y.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(y.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(y.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.MANIFEST_PARSED,this.onManifestParsed,this),e.off(y.LEVEL_LOADING,this.onLevelLoading,this),e.off(y.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(y.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(y.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:s,groupId:r,details:n}=t,a=this.tracksInGroup[s];if(!a||a.groupId!==r){this.warn(`Audio track with id:${s} and group:${r} not found in active group ${a?.groupId}`);return}const o=a.details;a.details=t.details,this.log(`Audio track ${s} "${a.name}" lang:${a.lang} group:${r} loaded [${n.startSN}-${n.endSN}]`),s===this.trackId&&this.playlistLoaded(s,t,o)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const s=t.audioGroups||null,r=this.groupIds;let n=this.currentTrack;if(!s||r?.length!==s?.length||s!=null&&s.some(o=>r?.indexOf(o)===-1)){this.groupIds=s,this.trackId=-1,this.currentTrack=null;const o=this.tracks.filter(d=>!s||s.indexOf(d.groupId)!==-1);if(o.length)this.selectDefaultTrack&&!o.some(d=>d.default)&&(this.selectDefaultTrack=!1),o.forEach((d,h)=>{d.id=h});else if(!n&&!this.tracksInGroup.length)return;this.tracksInGroup=o;const l=this.hls.config.audioPreference;if(!n&&l){const d=Qt(l,o,Qs);if(d>-1)n=o[d];else{const h=Qt(l,this.tracks);n=this.tracks[h]}}let c=this.findTrackId(n);c===-1&&n&&(c=this.findTrackId(null));const u={audioTracks:o};this.log(`Updating audio tracks, ${o.length} track(s) found in group(s): ${s?.join(",")}`),this.hls.trigger(y.AUDIO_TRACKS_UPDATED,u);const f=this.trackId;if(c!==-1&&f===-1)this.setAudioTrack(c);else if(o.length&&f===-1){var a;const d=new Error(`No audio track selected for current audio group-ID(s): ${(a=this.groupIds)==null?void 0:a.join(",")} track count: ${o.length}`);this.warn(d.message),this.hls.trigger(y.ERROR,{type:ie.MEDIA_ERROR,details:k.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:d})}}}onError(e,t){t.fatal||!t.context||t.context.type===Ee.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const s=this.allAudioTracks;if(this.selectDefaultTrack=!1,s.length){const r=this.currentTrack;if(r&&si(e,r,Qs))return r;const n=Qt(e,this.tracksInGroup,Qs);if(n>-1){const a=this.tracksInGroup[n];return this.setAudioTrack(n),a}else if(r){let a=t.loadLevel;a===-1&&(a=t.firstAutoLevel);const o=Ny(e,t.levels,s,a,Qs);if(o===-1)return null;t.nextLoadLevel=o}if(e.channels||e.audioCodec){const a=Qt(e,s);if(a>-1)return s[a]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const s=this.currentTrack,r=t[e],n=r.details&&!r.details.live;if(e===this.trackId&&r===s&&n||(this.log(`Switching to audio-track ${e} "${r.name}" lang:${r.lang} group:${r.groupId} channels:${r.channels}`),this.trackId=e,this.currentTrack=r,this.hls.trigger(y.AUDIO_TRACK_SWITCHING,Re({},r)),n))return;const a=this.switchParams(r.url,s?.details,r.details);this.loadPlaylist(a)}findTrackId(e){const t=this.tracksInGroup;for(let s=0;s<t.length;s++){const r=t[s];if(!(this.selectDefaultTrack&&!r.default)&&(!e||si(e,r,Qs)))return s}if(e){const{name:s,lang:r,assocLang:n,characteristics:a,audioCodec:o,channels:l}=e;for(let c=0;c<t.length;c++){const u=t[c];if(si({name:s,lang:r,assocLang:n,characteristics:a,audioCodec:o,channels:l},u,Qs))return c}for(let c=0;c<t.length;c++){const u=t[c];if(mr(e.attrs,u.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return c}for(let c=0;c<t.length;c++){const u=t[c];if(mr(e.attrs,u.attrs,["LANGUAGE"]))return c}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&Tn(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=e.id,r=e.groupId,n=this.getUrlWithDirectives(e.url,t),a=e.details,o=a?.age;this.log(`Loading audio-track ${s} "${e.name}" lang:${e.lang} group:${r}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${o&&a.live?" age "+o.toFixed(1)+(a.type&&" "+a.type||""):""} ${n}`),this.hls.trigger(y.AUDIO_TRACK_LOADING,{url:n,id:s,groupId:r,deliveryDirectives:t||null,track:e})}}class LE{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,s){if(this.queues===null||this.tracks===null)return;const r=this.queues[t];r.push(e),r.length===1&&!s&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const s={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(s,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const s={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(s)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const s=(t=e[0])==null?void 0:t.label;(s==="async-blocker"||s==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const r=t[0];try{r.execute()}catch(n){var s;if(r.onError(n),this.queues===null||this.tracks===null)return;const a=(s=this.tracks[e])==null?void 0:s.buffer;a!=null&&a.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,s;return(t=this.queues)!=null&&t[e]||(s=this.tracks)!=null&&s[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const s=(t=this.tracks)==null?void 0:t[e],r=s?.buffer;return r?`SourceBuffer${r.updating?" updating":""}${s.ended?" ended":""}${s.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(s=>s.label).join(", "))||""}}const Au=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,Gh="HlsJsTrackRemovedError";class _E extends Error{constructor(e){super(e),this.name=Gh}}class RE extends Pt{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=s=>{var r;this.hls&&((r=this.mediaSource)==null?void 0:r.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=s=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=s=>{const{media:r,mediaSource:n}=this;s&&this.log("Media source opened"),!(!r||!n)&&(n.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(y.MEDIA_ATTACHED,{media:r,mediaSource:n}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:s,_objectUrl:r}=this;s!==r&&this.error(`Media element src was set while attaching MediaSource (${r} > ${s})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=X1($s(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.MANIFEST_PARSED,this.onManifestParsed,this),e.on(y.BUFFER_RESET,this.onBufferReset,this),e.on(y.BUFFER_APPENDING,this.onBufferAppending,this),e.on(y.BUFFER_CODECS,this.onBufferCodecs,this),e.on(y.BUFFER_EOS,this.onBufferEos,this),e.on(y.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(y.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(y.FRAG_PARSED,this.onFragParsed,this),e.on(y.FRAG_CHANGED,this.onFragChanged,this),e.on(y.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.MANIFEST_PARSED,this.onManifestParsed,this),e.off(y.BUFFER_RESET,this.onBufferReset,this),e.off(y.BUFFER_APPENDING,this.onBufferAppending,this),e.off(y.BUFFER_CODECS,this.onBufferCodecs,this),e.off(y.BUFFER_EOS,this.onBufferEos,this),e.off(y.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(y.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(y.FRAG_PARSED,this.onFragParsed,this),e.off(y.FRAG_CHANGED,this.onFragChanged,this),e.off(y.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const s={};if(this.operationQueue){const n=this.isUpdating();n||this.operationQueue.removeBlockers();const a=this.isQueued();(n||a)&&this.warn(`Transfering MediaSource with${a?" operations in queue":""}${n?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const r=this.transferData;return!this.sourceBufferCount&&r&&r.mediaSource===t?we(s,r.tracks):this.sourceBuffers.forEach(n=>{const[a]=n;a&&(s[a]=we({},this.tracks[a]),this.removeBuffer(a)),n[0]=n[1]=null}),{media:e,mediaSource:t,tracks:s}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var s;let r=2;(t.audio&&!t.video||!t.altAudio)&&(r=1),this.bufferCodecEventsTotal=r,this.log(`${r} bufferCodec event(s) expected.`),(s=this.transferData)!=null&&s.mediaSource&&this.sourceBufferCount&&r&&this.bufferCreated()}onMediaAttaching(e,t){const s=this.media=t.media;this.transferData=this.overrides=void 0;const r=$s(this.appendSource);if(r){const n=!!t.mediaSource;(n||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const a=this.mediaSource=t.mediaSource||new r;if(this.assignMediaSource(a),n)this._objectUrl=s.src,this.attachTransferred();else{const o=this._objectUrl=self.URL.createObjectURL(a);if(this.appendSource)try{s.removeAttribute("src");const l=self.ManagedMediaSource;s.disableRemotePlayback=s.disableRemotePlayback||l&&a instanceof l,Iu(s),CE(s,o),s.load()}catch{s.src=o}else s.src=o}s.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,s;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(s=e.constructor)==null?void 0:s.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const s=this.tracks,r=t.tracks,n=r?Object.keys(r):null,a=n?n.length:0,o=()=>{Promise.resolve().then(()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()})};if(r&&n&&a){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${Pe(s,(l,c)=>l==="initSegment"?void 0:c)};
transfer tracks: ${Pe(r,(l,c)=>l==="initSegment"?void 0:c)}}`),!Nd(r,s)){t.mediaSource=null,t.tracks=void 0;const l=e.currentTime,c=this.details,u=Math.max(l,c?.fragments[0].start||0);if(u-l>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${l} -> ${u}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(r)}"->"${Object.keys(s)}") start time: ${u} currentTime: ${l}`),this.onMediaDetaching(y.MEDIA_DETACHING,{}),this.onMediaAttaching(y.MEDIA_ATTACHING,t),e.currentTime=u;return}this.transferData=void 0,n.forEach(l=>{const c=l,u=r[c];if(u){const f=u.buffer;if(f){const d=this.fragmentTracker,h=u.id;if(d.hasFragments(h)||d.hasParts(h)){const p=fe.getBuffered(f);d.detectEvictedFragments(c,p,h,null,!0)}const g=Ia(c),m=[c,f];this.sourceBuffers[g]=m,f.updating&&this.operationQueue&&this.operationQueue.prependBlocker(c),this.trackSourceBuffer(c,u)}}}),o(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),o()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const s=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:r,mediaSource:n,_objectUrl:a}=this;if(n){if(this.log(`media source ${s?"transferring":"detaching"}`),s)this.sourceBuffers.forEach(([o])=>{o&&this.removeBuffer(o)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const o=n.readyState==="open";try{const l=n.sourceBuffers;for(let c=l.length;c--;)o&&l[c].abort(),n.removeSourceBuffer(l[c]);o&&n.endOfStream()}catch(l){this.warn(`onMediaDetaching: ${l.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}n.removeEventListener("sourceopen",this._onMediaSourceOpen),n.removeEventListener("sourceended",this._onMediaSourceEnded),n.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(n.removeEventListener("startstreaming",this._onStartStreaming),n.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}r&&(r.removeEventListener("emptied",this._onMediaEmptied),s||(a&&self.URL.revokeObjectURL(a),this.mediaSrc===a?(r.removeAttribute("src"),this.appendSource&&Iu(r),r.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(y.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const s=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),s)try{var r;(r=this.mediaSource)!=null&&r.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(s)}catch(n){this.warn(`onBufferReset ${e}`,n)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[Ia(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new LE(this.tracks)}onBufferCodecs(e,t){var s;const r=this.tracks,n=Object.keys(t);this.log(`BUFFER_CODECS: "${n}" (current SB count ${this.sourceBufferCount})`);const a="audiovideo"in t&&(r.audio||r.video)||r.audiovideo&&("audio"in t||"video"in t),o=!a&&this.sourceBufferCount&&this.media&&n.some(l=>!r[l]);if(a||o){this.warn(`Unsupported transition between "${Object.keys(r)}" and "${n}" SourceBuffers`);return}n.forEach(l=>{var c,u;const f=t[l],{id:d,codec:h,levelCodec:g,container:m,metadata:p,supplemental:v}=f;let E=r[l];const x=(c=this.transferData)==null||(c=c.tracks)==null?void 0:c[l],T=x!=null&&x.buffer?x:E,S=T?.pendingCodec||T?.codec,C=T?.levelCodec;E||(E=r[l]={buffer:void 0,listeners:[],codec:h,supplemental:v,container:m,levelCodec:g,metadata:p,id:d});const A=Xr(S,C),w=A?.replace(Au,"$1");let L=Xr(h,g);const I=(u=L)==null?void 0:u.replace(Au,"$1");L&&A&&w!==I&&(l.slice(0,5)==="audio"&&(L=En(L,this.appendSource)),this.log(`switching codec ${S} to ${L}`),L!==(E.pendingCodec||E.codec)&&(E.pendingCodec=L),E.container=m,this.appendChangeType(l,m,L))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&(this.bufferCodecEventsTotal>1&&!this.tracks.video&&!t.video&&((s=t.audio)==null?void 0:s.id)==="main"&&(this.log("Main audio-only"),this.bufferCodecEventsTotal=1),this.mediaSourceOpenOrEnded&&this.checkPendingTracks())}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const s=this.tracks[t];return e[t]={id:s.id,container:s.container,codec:s.codec,levelCodec:s.levelCodec},e},{})}appendChangeType(e,t,s){const r=`${t};codecs=${s}`,n={label:`change-type=${r}`,execute:()=>{const a=this.tracks[e];if(a){const o=a.buffer;o!=null&&o.changeType&&(this.log(`changing ${e} sourceBuffer type to ${r}`),o.changeType(r),a.codec=s,a.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:a=>{this.warn(`Failed to change ${e} SourceBuffer type`,a)}};this.append(n,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const s=e.start,r=s+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(s,se.MAIN))==null?void 0:t.gap)===!0)return;const a={label:"block-audio",execute:()=>{var o;const l=this.tracks.video;(this.lastVideoAppendEnd>r||l!=null&&l.buffer&&fe.isBuffered(l.buffer,r)||((o=this.fragmentTracker.getAppendedFrag(r,se.MAIN))==null?void 0:o.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:o=>{this.warn("Error executing block-audio operation",o)}};this.blockedAudioAppend={op:a,frag:e},this.append(a,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:s}=this,{data:r,type:n,parent:a,frag:o,part:l,chunkMeta:c,offset:u}=t,f=c.buffering[n],{sn:d,cc:h}=o,g=self.performance.now();f.start=g;const m=o.stats.buffering,p=l?l.stats.buffering:null;m.start===0&&(m.start=g),p&&p.start===0&&(p.start=g);const v=s.audio;let E=!1;n==="audio"&&v?.container==="audio/mpeg"&&(E=!this.lastMpegAudioChunk||c.id===1||this.lastMpegAudioChunk.sn!==c.sn,this.lastMpegAudioChunk=c);const x=s.video,T=x?.buffer;if(T&&d!=="initSegment"){const A=l||o,w=this.blockedAudioAppend;if(n==="audio"&&a!=="main"&&!this.blockedAudioAppend&&!(x.ending||x.ended)){const I=A.start+A.duration*.05,O=T.buffered,P=this.currentOp("video");!O.length&&!P?this.blockAudio(A):!P&&!fe.isBuffered(T,I)&&this.lastVideoAppendEnd<I&&this.blockAudio(A)}else if(n==="video"){const L=A.end;if(w){const I=w.frag.start;(L>I||L<this.lastVideoAppendEnd||fe.isBuffered(T,I))&&this.unblockAudio()}this.lastVideoAppendEnd=L}}const S=(l||o).start,C={label:`append-${n}`,execute:()=>{var A;f.executeStart=self.performance.now();const w=(A=this.tracks[n])==null?void 0:A.buffer;w&&(E?this.updateTimestampOffset(w,S,.1,n,d,h):u!==void 0&&J(u)&&this.updateTimestampOffset(w,u,1e-6,n,d,h)),this.appendExecutor(r,n)},onStart:()=>{},onComplete:()=>{const A=self.performance.now();f.executeEnd=f.end=A,m.first===0&&(m.first=A),p&&p.first===0&&(p.first=A);const w={};this.sourceBuffers.forEach(([L,I])=>{L&&(w[L]=fe.getBuffered(I))}),this.appendErrors[n]=0,n==="audio"||n==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(y.BUFFER_APPENDED,{type:n,frag:o,part:l,chunkMeta:c,parent:o.type,timeRanges:w})},onError:A=>{var w;const L={type:ie.MEDIA_ERROR,parent:o.type,details:k.BUFFER_APPEND_ERROR,sourceBufferName:n,frag:o,part:l,chunkMeta:c,error:A,err:A,fatal:!1},I=(w=this.media)==null?void 0:w.error;if(A.code===DOMException.QUOTA_EXCEEDED_ERR||A.name=="QuotaExceededError"||"quota"in A)L.details=k.BUFFER_FULL_ERROR;else if(A.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!I)L.errorAction=Ai(!0);else if(A.name===Gh&&this.sourceBufferCount===0)L.errorAction=Ai(!0);else{const O=++this.appendErrors[n];this.warn(`Failed ${O}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${n}" sourceBuffer (${I||"no media error"})`),(O>=this.hls.config.appendErrorMaxRetry||I)&&(L.fatal=!0)}this.hls.trigger(y.ERROR,L)}};this.log(`queuing "${n}" append sn: ${d}${l?" p: "+l.index:""} of ${o.type===se.MAIN?"level":"track"} ${o.level} cc: ${h}`),this.append(C,n,this.isPending(this.tracks[n]))}getFlushOp(e,t,s){return this.log(`queuing "${e}" remove ${t}-${s}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,s)},onStart:()=>{},onComplete:()=>{this.hls.trigger(y.BUFFER_FLUSHED,{type:e})},onError:r=>{this.warn(`Failed to remove ${t}-${s} from "${e}" SourceBuffer`,r)}}}onBufferFlushing(e,t){const{type:s,startOffset:r,endOffset:n}=t;s?this.append(this.getFlushOp(s,r,n),s):this.sourceBuffers.forEach(([a])=>{a&&this.append(this.getFlushOp(a,r,n),a)})}onFragParsed(e,t){const{frag:s,part:r}=t,n=[],a=r?r.elementaryStreams:s.elementaryStreams;a[ke.AUDIOVIDEO]?n.push("audiovideo"):(a[ke.AUDIO]&&n.push("audio"),a[ke.VIDEO]&&n.push("video"));const o=()=>{const l=self.performance.now();s.stats.buffering.end=l,r&&(r.stats.buffering.end=l);const c=r?r.stats:s.stats;this.hls.trigger(y.FRAG_BUFFERED,{frag:s,part:r,stats:c,id:s.type})};n.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${s.type} level: ${s.level} sn: ${s.sn}`),this.blockBuffers(o,n).catch(l=>{this.warn(`Fragment buffered callback ${l}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{if(e){const t=this.tracks[e];if(t)return!t.ended||t.ending}return!1})}onBufferEos(e,t){var s;this.sourceBuffers.forEach(([a])=>{if(a){const o=this.tracks[a];(!t.type||t.type===a)&&(o.ending=!0,o.ended||(o.ended=!0,this.log(`${a} buffer reached EOS`)))}});const r=((s=this.overrides)==null?void 0:s.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([a])=>{var o;return a&&!((o=this.tracks[a])!=null&&o.ended)})?r?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:a}=this;if(!a||a.readyState!=="open"){a&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${a.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),a.endOfStream(),this.hls.trigger(y.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(y.BUFFERED_TO_END,void 0)):t.type==="video"&&this.unblockAudio()}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===k.BUFFER_APPEND_ERROR&&t.frag){var s;const r=(s=t.errorAction)==null?void 0:s.nextAutoLevel;J(r)&&r!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:s}=this;if(!s||t===null||!this.sourceBufferCount)return;const r=e.config,n=s.currentTime,a=t.levelTargetDuration,o=t.live&&r.liveBackBufferLength!==null?r.liveBackBufferLength:r.backBufferLength;if(J(o)&&o>=0){const c=Math.max(o,a),u=Math.floor(n/a)*a-c;this.flushBackBuffer(n,a,u)}const l=r.frontBufferFlushThreshold;if(J(l)&&l>0){const c=Math.max(r.maxBufferLength,l),u=Math.max(c,a),f=Math.floor(n/a)*a+u;this.flushFrontBuffer(n,a,f)}}flushBackBuffer(e,t,s){this.sourceBuffers.forEach(([r,n])=>{if(n){const o=fe.getBuffered(n);if(o.length>0&&s>o.start(0)){var a;this.hls.trigger(y.BACK_BUFFER_REACHED,{bufferEnd:s});const l=this.tracks[r];if((a=this.details)!=null&&a.live)this.hls.trigger(y.LIVE_BACK_BUFFER_REACHED,{bufferEnd:s});else if(l!=null&&l.ended){this.log(`Cannot flush ${r} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(y.BUFFER_FLUSHING,{startOffset:0,endOffset:s,type:r})}}})}flushFrontBuffer(e,t,s){this.sourceBuffers.forEach(([r,n])=>{if(n){const a=fe.getBuffered(n),o=a.length;if(o<2)return;const l=a.start(o-1),c=a.end(o-1);if(s>l||e>=l&&e<=c)return;this.hls.trigger(y.BUFFER_FLUSHING,{startOffset:l,endOffset:1/0,type:r})}})}getDurationAndRange(){var e;const{details:t,mediaSource:s}=this;if(!t||!this.media||s?.readyState!=="open")return null;const r=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&s.setLiveSeekableRange){const c=Math.max(0,t.fragmentStart),u=Math.max(c,r);return{duration:1/0,start:c,end:u}}return{duration:1/0}}const n=(e=this.overrides)==null?void 0:e.duration;if(n)return J(n)?{duration:n}:null;const a=this.media.duration,o=J(s.duration)?s.duration:0;return r>o&&r>a||!J(a)?{duration:r}:null}updateMediaSource({duration:e,start:t,end:s}){const r=this.mediaSource;!this.media||!r||r.readyState!=="open"||(r.duration!==e&&(J(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),r.duration=e),t!==void 0&&s!==void 0&&(this.log(`MediaSource duration is set to ${r.duration}. Setting seekable range to ${t}-${s}.`),r.setLiveSeekableRange(t,s)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:s}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${Pe(s)}`),this.tracksReady){var r;const n=(r=this.transferData)==null?void 0:r.tracks;n&&Object.keys(n).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,s])=>{if(t){const r=this.tracks[t];e[t]={buffer:s,container:r.container,codec:r.codec,supplemental:r.supplemental,levelCodec:r.levelCodec,id:r.id,metadata:r.metadata}}}),this.hls.trigger(y.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(y.ERROR,{type:ie.MEDIA_ERROR,details:k.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:s}=this;if(!s)throw new Error("createSourceBuffers called when mediaSource was null");for(const n in e){const a=n,o=e[a];if(this.isPending(o)){const l=this.getTrackCodec(o,a),c=`${o.container};codecs=${l}`;o.codec=l,this.log(`creating sourceBuffer(${c})${this.currentOp(a)?" Queued":""} ${Pe(o)}`);try{const u=s.addSourceBuffer(c),f=Ia(a),d=[a,u];t[f]=d,o.buffer=u}catch(u){var r;this.error(`error while trying to add sourceBuffer: ${u.message}`),this.shiftAndExecuteNext(a),(r=this.operationQueue)==null||r.removeBlockers(),delete this.tracks[a],this.hls.trigger(y.ERROR,{type:ie.MEDIA_ERROR,details:k.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:u,sourceBufferName:a,mimeType:c,parent:o.id});return}this.trackSourceBuffer(a,o)}}this.bufferCreated()}getTrackCodec(e,t){const s=e.supplemental;let r=e.codec;s&&(t==="video"||t==="audiovideo")&&cr(s,"video")&&(r=vy(r,s));const n=Xr(r,e.levelCodec);return n?t.slice(0,5)==="audio"?En(n,this.appendSource):n:""}trackSourceBuffer(e,t){const s=t.buffer;if(!s)return;const r=this.getTrackCodec(t,e);this.tracks[e]={buffer:s,codec:r,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(n,a)=>{const o=a.removedRanges;o!=null&&o.length&&this.hls.trigger(y.BUFFER_FLUSHED,{type:n})})}get mediaSrc(){var e,t;const s=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return s?.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const s=this.currentOp(e);s&&(s.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var s;const r=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(s=this.mediaSource)==null?void 0:s.readyState}`);this.error(`${r}`,t),this.hls.trigger(y.ERROR,{type:ie.MEDIA_ERROR,details:k.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:r,fatal:!1});const n=this.currentOp(e);n&&n.onError(r)}updateTimestampOffset(e,t,s,r,n,a){const o=t-e.timestampOffset;Math.abs(o)>=s&&(this.log(`Updating ${r} SourceBuffer timestampOffset to ${t} (sn: ${n} cc: ${a})`),e.timestampOffset=t)}removeExecutor(e,t,s){const{media:r,mediaSource:n}=this,a=this.tracks[e],o=a?.buffer;if(!r||!n||!o){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const l=J(r.duration)?r.duration:1/0,c=J(n.duration)?n.duration:1/0,u=Math.max(0,t),f=Math.min(s,l,c);f>u&&(!a.ending||a.ended)?(a.ended=!1,this.log(`Removing [${u},${f}] from the ${e} SourceBuffer`),o.remove(u,f)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const s=this.tracks[t],r=s?.buffer;if(!r)throw new _E(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);s.ending=!1,s.ended=!1,r.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:s}=this,r=t.map(a=>this.appendBlocker(a));return t.length>1&&this.blockedAudioAppend&&this.unblockAudio(),Promise.all(r).then(a=>{s===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var s;const r=(s=this.tracks[t])==null?void 0:s.buffer;!r||r.updating||this.shiftAndExecuteNext(t)})}append(e,t,s){this.operationQueue&&this.operationQueue.append(e,t,s)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,s){const r=this.tracks[e];if(!r)return;const n=r.buffer;if(!n)return;const a=s.bind(this,e);r.listeners.push({event:t,listener:a}),n.addEventListener(t,a)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const s=t.buffer;s&&(t.listeners.forEach(r=>{s.removeEventListener(r.event,r.listener)}),t.listeners.length=0)}}function Iu(i){const e=i.querySelectorAll("source");[].slice.call(e).forEach(t=>{i.removeChild(t)})}function CE(i,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,i.appendChild(t)}function Ia(i){return i==="audio"?1:0}class Il{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(y.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(y.MANIFEST_PARSED,this.onManifestParsed,this),e.on(y.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(y.BUFFER_CODECS,this.onBufferCodecs,this),e.on(y.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(y.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(y.MANIFEST_PARSED,this.onManifestParsed,this),e.off(y.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(y.BUFFER_CODECS,this.onBufferCodecs,this),e.off(y.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const s=this.hls.levels[t.droppedLevel];this.isLevelAllowed(s)&&this.restrictedLevels.push({bitrate:s.bitrate,height:s.height,width:s.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const s=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,s.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&J(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,s=this.getMaxLevel(e.length-1);s!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${s}: ${e[s].height}p@${e[s].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=s,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const s=t.filter((r,n)=>this.isLevelAllowed(r)&&n<=e);return this.clientRect=null,Il.getMaxLevelByMediaSize(s,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const s=e.getBoundingClientRect();t.width=s.width,t.height=s.height,!t.width&&!t.height&&(t.width=s.right-s.left||e.width||0,t.height=s.bottom-s.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(s=>e.bitrate===s.bitrate&&e.width===s.width&&e.height===s.height)}static getMaxLevelByMediaSize(e,t,s){if(!(e!=null&&e.length))return-1;const r=(o,l)=>l?o.width!==l.width||o.height!==l.height:!0;let n=e.length-1;const a=Math.max(t,s);for(let o=0;o<e.length;o+=1){const l=e[o];if((l.width>=a||l.height>=a)&&r(l,e[o+1])){n=o;break}}return n}}const wE={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},mt=wE,DE={HLS:"h"},kE=DE;class ts{constructor(e,t){Array.isArray(e)&&(e=e.map(s=>s instanceof ts?s:new ts(s))),this.value=e,this.params=t}}const PE="Dict";function OE(i){return Array.isArray(i)?JSON.stringify(i):i instanceof Map?"Map{}":i instanceof Set?"Set{}":typeof i=="object"?JSON.stringify(i):String(i)}function ME(i,e,t,s){return new Error(`failed to ${i} "${OE(e)}" as ${t}`,{cause:s})}function ss(i,e,t){return ME("serialize",i,e,t)}class Vh{constructor(e){this.description=e}}const Lu="Bare Item",FE="Boolean";function NE(i){if(typeof i!="boolean")throw ss(i,FE);return i?"?1":"?0"}function $E(i){return btoa(String.fromCharCode(...i))}const BE="Byte Sequence";function UE(i){if(ArrayBuffer.isView(i)===!1)throw ss(i,BE);return`:${$E(i)}:`}const GE="Integer";function VE(i){return i<-999999999999999||999999999999999<i}function Kh(i){if(VE(i))throw ss(i,GE);return i.toString()}function KE(i){return`@${Kh(i.getTime()/1e3)}`}function Hh(i,e){if(i<0)return-Hh(-i,e);const t=Math.pow(10,e);if(Math.abs(i*t%1-.5)<Number.EPSILON){const r=Math.floor(i*t);return(r%2===0?r:r+1)/t}else return Math.round(i*t)/t}const HE="Decimal";function jE(i){const e=Hh(i,3);if(Math.floor(Math.abs(e)).toString().length>12)throw ss(i,HE);const t=e.toString();return t.includes(".")?t:`${t}.0`}const WE="String",YE=/[\x00-\x1f\x7f]+/;function zE(i){if(YE.test(i))throw ss(i,WE);return`"${i.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function qE(i){return i.description||i.toString().slice(7,-1)}const XE="Token";function _u(i){const e=qE(i);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw ss(e,XE);return e}function po(i){switch(typeof i){case"number":if(!J(i))throw ss(i,Lu);return Number.isInteger(i)?Kh(i):jE(i);case"string":return zE(i);case"symbol":return _u(i);case"boolean":return NE(i);case"object":if(i instanceof Date)return KE(i);if(i instanceof Uint8Array)return UE(i);if(i instanceof Vh)return _u(i);default:throw ss(i,Lu)}}const QE="Key";function yo(i){if(/^[a-z*][a-z0-9\-_.*]*$/.test(i)===!1)throw ss(i,QE);return i}function Ll(i){return i==null?"":Object.entries(i).map(([e,t])=>t===!0?`;${yo(e)}`:`;${yo(e)}=${po(t)}`).join("")}function jh(i){return i instanceof ts?`${po(i.value)}${Ll(i.params)}`:po(i)}function ZE(i){return`(${i.value.map(jh).join(" ")})${Ll(i.params)}`}function JE(i,e={whitespace:!0}){if(typeof i!="object"||i==null)throw ss(i,PE);const t=i instanceof Map?i.entries():Object.entries(i),s=e?.whitespace?" ":"";return Array.from(t).map(([r,n])=>{n instanceof ts||(n=new ts(n));let a=yo(r);return n.value===!0?a+=Ll(n.params):(a+="=",Array.isArray(n.value)?a+=ZE(n):a+=jh(n)),a}).join(`,${s}`)}function Wh(i,e){return JE(i,e)}const jt="CMCD-Object",Be="CMCD-Request",zs="CMCD-Session",_s="CMCD-Status",ex={br:jt,ab:jt,d:jt,ot:jt,tb:jt,tpb:jt,lb:jt,tab:jt,lab:jt,url:jt,pb:Be,bl:Be,tbl:Be,dl:Be,ltc:Be,mtp:Be,nor:Be,nrr:Be,rc:Be,sn:Be,sta:Be,su:Be,ttfb:Be,ttfbb:Be,ttlb:Be,cmsdd:Be,cmsds:Be,smrt:Be,df:Be,cs:Be,ts:Be,cid:zs,pr:zs,sf:zs,sid:zs,st:zs,v:zs,msd:zs,bs:_s,bsd:_s,cdn:_s,rtp:_s,bg:_s,pt:_s,ec:_s,e:_s},tx={REQUEST:Be};function sx(i){return Object.keys(i).reduce((e,t)=>{var s;return(s=i[t])===null||s===void 0||s.forEach(r=>e[r]=t),e},{})}function ix(i,e){const t={};if(!i)return t;const s=Object.keys(i),r=e?sx(e):{};return s.reduce((n,a)=>{var o;const l=ex[a]||r[a]||tx.REQUEST,c=(o=n[l])!==null&&o!==void 0?o:n[l]={};return c[a]=i[a],n},t)}function rx(i){return["ot","sf","st","e","sta"].includes(i)}function nx(i){return typeof i=="number"?J(i):i!=null&&i!==""&&i!==!1}const Yh="event";function ax(i,e){const t=new URL(i),s=new URL(e);if(t.origin!==s.origin)return i;const r=t.pathname.split("/").slice(1),n=s.pathname.split("/").slice(1,-1);for(;r[0]===n[0];)r.shift(),n.shift();for(;n.length;)n.shift(),r.unshift("..");return r.join("/")+t.search+t.hash}const tn=i=>Math.round(i),vo=(i,e)=>Array.isArray(i)?i.map(t=>vo(t,e)):i instanceof ts&&typeof i.value=="string"?new ts(vo(i.value,e),i.params):(e.baseUrl&&(i=ax(i,e.baseUrl)),e.version===1?encodeURIComponent(i):i),Or=i=>tn(i/100)*100,ox=(i,e)=>{let t=i;return e.version>=2&&(i instanceof ts&&typeof i.value=="string"?t=new ts([i]):typeof i=="string"&&(t=[i])),vo(t,e)},lx={br:tn,d:tn,bl:Or,dl:Or,mtp:Or,nor:ox,rtp:Or,tb:tn},zh="request",qh="response",_l=["ab","bg","bl","br","bs","bsd","cdn","cid","cs","df","ec","lab","lb","ltc","msd","mtp","pb","pr","pt","sf","sid","sn","st","sta","tab","tb","tbl","tpb","ts","v"],cx=["e"],ux=/^[a-zA-Z0-9-.]+-[a-zA-Z0-9-.]+$/;function zn(i){return ux.test(i)}function fx(i){return _l.includes(i)||cx.includes(i)||zn(i)}const Xh=["d","dl","nor","ot","rtp","su"];function dx(i){return _l.includes(i)||Xh.includes(i)||zn(i)}const hx=["cmsdd","cmsds","rc","smrt","ttfb","ttfbb","ttlb","url"];function gx(i){return _l.includes(i)||Xh.includes(i)||hx.includes(i)||zn(i)}const mx=["bl","br","bs","cid","d","dl","mtp","nor","nrr","ot","pr","rtp","sf","sid","st","su","tb","v"];function px(i){return mx.includes(i)||zn(i)}const yx={[qh]:gx,[Yh]:fx,[zh]:dx};function Qh(i,e={}){const t={};if(i==null||typeof i!="object")return t;const s=e.version||i.v||1,r=e.reportingMode||zh,n=s===1?px:yx[r];let a=Object.keys(i).filter(n);const o=e.filter;typeof o=="function"&&(a=a.filter(o));const l=r===qh||r===Yh;l&&!a.includes("ts")&&a.push("ts"),s>1&&!a.includes("v")&&a.push("v");const c=we({},lx,e.formatters),u={version:s,reportingMode:r,baseUrl:e.baseUrl};return a.sort().forEach(f=>{let d=i[f];const h=c[f];if(typeof h=="function"&&(d=h(d,u)),f==="v"){if(s===1)return;d=s}f=="pr"&&d===1||(l&&f==="ts"&&!J(d)&&(d=Date.now()),nx(d)&&(rx(f)&&typeof d=="string"&&(d=new Vh(d)),t[f]=d))}),t}function vx(i,e={}){const t={};if(!i)return t;const s=Qh(i,e),r=ix(s,e?.customHeaderMap);return Object.entries(r).reduce((n,[a,o])=>{const l=Wh(o,{whitespace:!1});return l&&(n[a]=l),n},t)}function Ex(i,e,t){return we(i,vx(e,t))}const xx="CMCD";function Tx(i,e={}){return i?Wh(Qh(i,e),{whitespace:!1}):""}function Sx(i,e={}){if(!i)return"";const t=Tx(i,e);return encodeURIComponent(t)}function bx(i,e={}){if(!i)return"";const t=Sx(i,e);return`${xx}=${t}`}const Ru=/CMCD=[^&#]+/;function Ax(i,e,t){const s=bx(e,t);if(!s)return i;if(Ru.test(i))return i.replace(Ru,s);const r=i.includes("?")?"&":"?";return`${i}${r}${s}`}class Ix{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=r=>{try{this.apply(r,{ot:mt.MANIFEST,su:!this.initialized})}catch(n){this.hls.logger.warn("Could not generate manifest CMCD data.",n)}},this.applyFragmentData=r=>{try{const{frag:n,part:a}=r,o=this.hls.levels[n.level],l=this.getObjectType(n),c={d:(a||n).duration*1e3,ot:l};(l===mt.VIDEO||l===mt.AUDIO||l==mt.MUXED)&&(c.br=o.bitrate/1e3,c.tb=this.getTopBandwidth(l)/1e3,c.bl=this.getBufferLength(l));const u=a?this.getNextPart(a):this.getNextFrag(n);u!=null&&u.url&&u.url!==n.url&&(c.nor=u.url),this.apply(r,c)}catch(n){this.hls.logger.warn("Could not generate segment CMCD data.",n)}},this.hls=e;const t=this.config=e.config,{cmcd:s}=t;s!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=s.sessionId||e.sessionId,this.cid=s.contentId,this.useHeaders=s.useHeaders===!0,this.includeKeys=s.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(y.MEDIA_DETACHED,this.onMediaDetached,this),e.on(y.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(y.MEDIA_DETACHED,this.onMediaDetached,this),e.off(y.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var s,r;this.audioBuffer=(s=t.tracks.audio)==null?void 0:s.buffer,this.videoBuffer=(r=t.tracks.video)==null?void 0:r.buffer}createData(){var e;return{v:1,sf:kE.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){we(t,this.createData());const s=t.ot===mt.INIT||t.ot===mt.VIDEO||t.ot===mt.MUXED;this.starved&&s&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:r}=this;r&&(t=Object.keys(t).reduce((a,o)=>(r.includes(o)&&(a[o]=t[o]),a),{}));const n={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),Ex(e.headers,t,n)):e.url=Ax(e.url,t,n)}getNextFrag(e){var t;const s=(t=this.hls.levels[e.level])==null?void 0:t.details;if(s){const r=e.sn-s.startSN;return s.fragments[r+1]}}getNextPart(e){var t;const{index:s,fragment:r}=e,n=(t=this.hls.levels[r.level])==null||(t=t.details)==null?void 0:t.partList;if(n){const{sn:a}=r;for(let o=n.length-1;o>=0;o--){const l=n[o];if(l.index===s&&l.fragment.sn===a)return n[o+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return mt.TIMED_TEXT;if(e.sn==="initSegment")return mt.INIT;if(t==="audio")return mt.AUDIO;if(t==="main")return this.hls.audioTracks.length?mt.VIDEO:mt.MUXED}getTopBandwidth(e){let t=0,s;const r=this.hls;if(e===mt.AUDIO)s=r.audioTracks;else{const n=r.maxAutoLevel,a=n>-1?n+1:r.levels.length;s=r.levels.slice(0,a)}return s.forEach(n=>{n.bitrate>t&&(t=n.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,s=e===mt.AUDIO?this.audioBuffer:this.videoBuffer;return!s||!t?NaN:fe.bufferInfo(s,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,s=e||this.config.loader;return class{constructor(n){this.loader=void 0,this.loader=new s(n)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(n,a,o){t(n),this.loader.load(n,a,o)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,s=e||this.config.loader;return class{constructor(n){this.loader=void 0,this.loader=new s(n)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(n,a,o){t(n),this.loader.load(n,a,o)}}}}const Lx=3e5;class _x extends Pt{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(y.MANIFEST_PARSED,this.onManifestParsed,this),e.on(y.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(y.MANIFEST_PARSED,this.onManifestParsed,this),e.off(y.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(s=>s!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:s}=t;s!==null&&(this.pathwayId=s.pathwayId,this.uri=s.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:s}=t;if(s?.action===Qe.SendAlternateToPenaltyBox&&s.flags===Tt.MoveAllAlternatesMatchingHost){const r=this.levels;let n=this._pathwayPriority,a=this.pathwayId;if(t.context){const{groupId:o,pathwayId:l,type:c}=t.context;o&&r?a=this.getPathwayForGroupId(o,c,a):l&&(a=l)}a in this.penalizedPathways||(this.penalizedPathways[a]=performance.now()),!n&&r&&(n=this.pathways()),n&&n.length>1&&(this.updatePathwayPriority(n),s.resolved=this.pathwayId!==a),t.details===k.BUFFER_APPEND_ERROR&&!t.fatal?s.resolved=!0:s.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${a} levels: ${r&&r.length} priorities: ${Pe(n)} penalized: ${Pe(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const s=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${s}"`),t=this.getLevelsForPathway(s),this.pathwayId=s}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const s=this.penalizedPathways,r=performance.now();Object.keys(s).forEach(n=>{r-s[n]>Lx&&delete s[n]});for(let n=0;n<e.length;n++){const a=e[n];if(a in s)continue;if(a===this.pathwayId)return;const o=this.hls.nextLoadLevel,l=this.hls.levels[o];if(t=this.getLevelsForPathway(a),t.length>0){this.log(`Setting Pathway to "${a}"`),this.pathwayId=a,yh(t),this.hls.trigger(y.LEVELS_UPDATED,{levels:t});const c=this.hls.levels[o];l&&c&&this.levels&&(c.attrs["STABLE-VARIANT-ID"]!==l.attrs["STABLE-VARIANT-ID"]&&c.bitrate!==l.bitrate&&this.log(`Unstable Pathways change from bitrate ${l.bitrate} to ${c.bitrate}`),this.hls.nextLoadLevel=o);break}}}getPathwayForGroupId(e,t,s){const r=this.getLevelsForPathway(s).concat(this.levels||[]);for(let n=0;n<r.length;n++)if(t===Ee.AUDIO_TRACK&&r[n].hasAudioGroup(e)||t===Ee.SUBTITLE_TRACK&&r[n].hasSubtitleGroup(e))return r[n].pathwayId;return s}clonePathways(e){const t=this.levels;if(!t)return;const s={},r={};e.forEach(n=>{const{ID:a,"BASE-ID":o,"URI-REPLACEMENT":l}=n;if(t.some(u=>u.pathwayId===a))return;const c=this.getLevelsForPathway(o).map(u=>{const f=new Ne(u.attrs);f["PATHWAY-ID"]=a;const d=f.AUDIO&&`${f.AUDIO}_clone_${a}`,h=f.SUBTITLES&&`${f.SUBTITLES}_clone_${a}`;d&&(s[f.AUDIO]=d,f.AUDIO=d),h&&(r[f.SUBTITLES]=h,f.SUBTITLES=h);const g=Zh(u.uri,f["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",l),m=new fr({attrs:f,audioCodec:u.audioCodec,bitrate:u.bitrate,height:u.height,name:u.name,url:g,videoCodec:u.videoCodec,width:u.width});if(u.audioGroups)for(let p=1;p<u.audioGroups.length;p++)m.addGroupId("audio",`${u.audioGroups[p]}_clone_${a}`);if(u.subtitleGroups)for(let p=1;p<u.subtitleGroups.length;p++)m.addGroupId("text",`${u.subtitleGroups[p]}_clone_${a}`);return m});t.push(...c),Cu(this.audioTracks,s,l,a),Cu(this.subtitleTracks,r,l,a)})}loadSteeringManifest(e){const t=this.hls.config,s=t.loader;this.loader&&this.loader.destroy(),this.loader=new s(t);let r;try{r=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(r.protocol!=="data:"){const u=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;r.searchParams.set("_HLS_pathway",this.pathwayId),r.searchParams.set("_HLS_throughput",""+u)}const n={responseType:"json",url:r.href},a=t.steeringManifestLoadPolicy.default,o=a.errorRetry||a.timeoutRetry||{},l={loadPolicy:a,timeout:a.maxLoadTimeMs,maxRetry:o.maxNumRetry||0,retryDelay:o.retryDelayMs||0,maxRetryDelay:o.maxRetryDelayMs||0},c={onSuccess:(u,f,d,h)=>{this.log(`Loaded steering manifest: "${r}"`);const g=u.data;if(g?.VERSION!==1){this.log(`Steering VERSION ${g.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=g.TTL;const{"RELOAD-URI":m,"PATHWAY-CLONES":p,"PATHWAY-PRIORITY":v}=g;if(m)try{this.uri=new self.URL(m,r).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${m}`);return}this.scheduleRefresh(this.uri||d.url),p&&this.clonePathways(p);const E={steeringManifest:g,url:r.toString()};this.hls.trigger(y.STEERING_MANIFEST_LOADED,E),v&&this.updatePathwayPriority(v)},onError:(u,f,d,h)=>{if(this.log(`Error loading steering manifest: ${u.code} ${u.text} (${f.url})`),this.stopLoad(),u.code===410){this.enabled=!1,this.log(`Steering manifest ${f.url} no longer available`);return}let g=this.timeToLoad*1e3;if(u.code===429){const m=this.loader;if(typeof m?.getResponseHeader=="function"){const p=m.getResponseHeader("Retry-After");p&&(g=parseFloat(p)*1e3)}this.log(`Steering manifest ${f.url} rate limited`);return}this.scheduleRefresh(this.uri||f.url,g)},onTimeout:(u,f,d)=>{this.log(`Timeout loading steering manifest (${f.url})`),this.scheduleRefresh(this.uri||f.url)}};this.log(`Requesting steering manifest: ${r}`),this.loader.load(n,l,c)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var s;const r=(s=this.hls)==null?void 0:s.media;if(r&&!r.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function Cu(i,e,t,s){i&&Object.keys(e).forEach(r=>{const n=i.filter(a=>a.groupId===r).map(a=>{const o=we({},a);return o.details=void 0,o.attrs=new Ne(o.attrs),o.url=o.attrs.URI=Zh(a.url,a.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),o.groupId=o.attrs["GROUP-ID"]=e[r],o.attrs["PATHWAY-ID"]=s,o});i.push(...n)})}function Zh(i,e,t,s){const{HOST:r,PARAMS:n,[t]:a}=s;let o;e&&(o=a?.[e],o&&(i=o));const l=new self.URL(i);return r&&!o&&(l.host=r),n&&Object.keys(n).sort().forEach(c=>{c&&l.searchParams.set(c,n[c])}),l.href}class Li extends Pt{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.mediaResolved=void 0,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=Li.CDMCleanupPromise?[Li.CDMCleanupPromise]:[],this.bannedKeyIds={},this.onMediaEncrypted=t=>{const{initDataType:s,initData:r}=t,n=`"${t.type}" event: init data type: "${s}"`;if(this.debug(n),r!==null){if(!this.keyFormatPromise){let a=Object.keys(this.keySystemAccessPromises);a.length||(a=Gi(this.config));const o=a.map(ya).filter(l=>!!l);this.keyFormatPromise=this.getKeyFormatPromise(o)}this.keyFormatPromise.then(a=>{const o=Zr(a);if(s!=="sinf"||o!==$e.FAIRPLAY){this.log(`Ignoring "${t.type}" event with init data type: "${s}" for selected key-system ${o}`);return}let l;try{const h=He(new Uint8Array(r)),g=ml(JSON.parse(h).sinf),m=Wd(g);if(!m)throw new Error("'schm' box missing or not cbcs/cenc with schi > tenc");l=new Uint8Array(m.subarray(8,24))}catch(h){this.warn(`${n} Failed to parse sinf: ${h}`);return}const c=Ze(l),{keyIdToKeySessionPromise:u,mediaKeySessions:f}=this;let d=u[c];for(let h=0;h<f.length;h++){const g=f[h],m=g.decryptdata;if(!m.keyId)continue;const p=Ze(m.keyId);if(An(l,m.keyId)||m.uri.replace(/-/g,"").indexOf(c)!==-1){if(d=u[p],!d)continue;if(m.pssh)break;delete u[p],m.pssh=new Uint8Array(r),m.keyId=l,d=u[c]=d.then(()=>this.generateRequestWithPreferredKeySession(g,s,r,"encrypted-event-key-match")),d.catch(v=>this.handleError(v));break}}d||this.handleError(new Error(`Key ID ${c} not encountered in playlist. Key-system sessions ${f.length}.`))}).catch(a=>this.handleError(a))}},this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onMediaEncrypted=this.onWaitingForKey=null}registerListeners(){this.hls.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(y.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(y.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(y.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(y.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(y.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(y.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(y.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(y.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:s}=this.config,r=t?.[e];if(r)return r.licenseUrl;if(e===$e.WIDEVINE&&s)return s}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,s=t?.[e];if(s)return s.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,s=(a,o,l)=>!!a&&l.indexOf(a)===o,r=t.map(a=>a.audioCodec).filter(s),n=t.map(a=>a.videoCodec).filter(s);return r.length+n.length===0&&n.push("avc1.42e01e"),new Promise((a,o)=>{const l=c=>{const u=c.shift();this.getMediaKeysPromise(u,r,n).then(f=>a({keySystem:u,mediaKeys:f})).catch(f=>{c.length?l(c):f instanceof Et?o(f):o(new Et({type:ie.KEY_SYSTEM_ERROR,details:k.KEY_SYSTEM_NO_ACCESS,error:f,fatal:!0},f.message))})};l(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:s}=this.config;if(typeof s!="function"){let r=`Configured requestMediaKeySystemAccess is not a function ${s}`;return ch===null&&self.location.protocol==="http:"&&(r=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(r))}return s(e,t)}getMediaKeysPromise(e,t,s){var r;const n=ov(e,t,s,this.config.drmSystemOptions||{});let a=this.keySystemAccessPromises[e],o=(r=a)==null?void 0:r.keySystemAccess;if(!o){this.log(`Requesting encrypted media "${e}" key-system access with config: ${Pe(n)}`),o=this.requestMediaKeySystemAccess(e,n);const l=a=this.keySystemAccessPromises[e]={keySystemAccess:o};return o.catch(c=>{this.log(`Failed to obtain access to key-system "${e}": ${c}`)}),o.then(c=>{this.log(`Access for key-system "${c.keySystem}" obtained`);const u=this.fetchServerCertificate(e);this.log(`Create media-keys for "${e}"`);const f=l.mediaKeys=c.createMediaKeys().then(d=>(this.log(`Media-keys created for "${e}"`),l.hasMediaKeys=!0,u.then(h=>h?this.setMediaKeysServerCertificate(d,e,h):d)));return f.catch(d=>{this.error(`Failed to create media-keys for "${e}"}: ${d}`)}),f})}return o.then(()=>a.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:s}){this.log(`Creating key-system session "${t}" keyId: ${Ze(e.keyId||[])} keyUri: ${e.uri}`);const r=s.createSession(),n={decryptdata:e,keySystem:t,mediaKeys:s,mediaKeysSession:r,keyStatus:"status-pending"};return this.mediaKeySessions.push(n),n}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const s=this.createMediaKeySessionContext(e),r=Mr(t),n="cenc";this.keyIdToKeySessionPromise[r]=this.generateRequestWithPreferredKeySession(s,n,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}updateKeySession(e,t){const s=e.mediaKeysSession;return this.log(`Updating key-session "${s.sessionId}" for keyId ${Ze(e.decryptdata.keyId||[])}
      } (data length: ${t.byteLength})`),s.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>ya(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:s})=>this.attemptSetMediaKeys(t,s))}selectKeySystem(e){return new Promise((t,s)=>{this.getKeySystemSelectionPromise(e).then(({keySystem:r})=>{const n=ya(r);n?t(n):s(new Error(`Unable to find format for key-system "${r}"`))}).catch(s)})}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=Gi(this.config),s=e.map(Zr).filter(r=>!!r&&t.indexOf(r)!==-1);return this.selectKeySystem(s)}getKeyStatus(e){const{mediaKeySessions:t}=this;for(let s=0;s<t.length;s++){const r=Rx(e,t[s]);if(r)return r}}loadKey(e){const t=e.keyInfo.decryptdata,s=Mr(t),r=this.bannedKeyIds[s];if(r||this.getKeyStatus(t)==="internal-error"){const o=wu(r||"internal-error",t);return this.handleError(o,e.frag),Promise.reject(o)}const n=`(keyId: ${s} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${n}`);const a=this.keyIdToKeySessionPromise[s];if(!a){const o=this.getKeySystemForKeyPromise(t).then(({keySystem:l,mediaKeys:c})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${n}`),this.attemptSetMediaKeys(l,c).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:l,mediaKeys:c,decryptdata:t}))))).then(l=>{const c="cenc",u=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(l,c,u,"playlist-key")});return o.catch(l=>this.handleError(l,e.frag)),this.keyIdToKeySessionPromise[s]=o,o}return a.catch(o=>{if(o instanceof Et){const l=Re({},o.data);this.getKeyStatus(t)==="internal-error"&&(l.decryptdata=t);const c=new Et(l,o.message);this.handleError(c,e.frag)}}),a}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e,t){if(this.hls)if(e instanceof Et){t&&(e.data.frag=t);const s=e.data.decryptdata;this.error(`${e.message}${s?` (${Ze(s.keyId||[])})`:""}`),this.hls.trigger(y.ERROR,e.data)}else this.error(e.message),this.hls.trigger(y.ERROR,{type:ie.KEY_SYSTEM_ERROR,details:k.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0})}getKeySystemForKeyPromise(e){const t=Mr(e),s=this.keyIdToKeySessionPromise[t];if(!s){const r=Zr(e.keyFormat),n=r?[r]:Gi(this.config);return this.attemptKeySystemAccess(n)}return s}getKeySystemSelectionPromise(e){if(e.length||(e=Gi(this.config)),e.length===0)throw new Et({type:ie.KEY_SYSTEM_ERROR,details:k.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${Pe({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaResolved=void 0,this.mediaKeys===t)return Promise.resolve();const s=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const r=Promise.all(s).then(()=>this.media?this.media.setMediaKeys(t):new Promise((n,a)=>{this.mediaResolved=()=>{if(this.mediaResolved=void 0,!this.media)return a(new Error("Attempted to set mediaKeys without media element attached"));this.mediaKeys=t,this.media.setMediaKeys(t).then(n).catch(a)}}));return this.mediaKeys=t,this.setMediaKeysQueue.push(r),r.then(()=>{this.log(`Media-keys set for "${e}"`),s.push(r),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(n=>s.indexOf(n)===-1)})}generateRequestWithPreferredKeySession(e,t,s,r){var n;const a=(n=this.config.drmSystems)==null||(n=n[e.keySystem])==null?void 0:n.generateRequest;if(a)try{const g=a.call(this.hls,t,s,e);if(!g)throw new Error("Invalid response from configured generateRequest filter");t=g.initDataType,s=g.initData?g.initData:null,e.decryptdata.pssh=s?new Uint8Array(s):null}catch(g){if(this.warn(g.message),this.hls&&this.hls.config.debug)throw g}if(s===null)return this.log(`Skipping key-session request for "${r}" (no initData)`),Promise.resolve(e);const o=Mr(e.decryptdata),l=e.decryptdata.uri;this.log(`Generating key-session request for "${r}" keyId: ${o} URI: ${l} (init data type: ${t} length: ${s.byteLength})`);const c=new yl,u=e._onmessage=g=>{const m=e.mediaKeysSession;if(!m){c.emit("error",new Error("invalid state"));return}const{messageType:p,message:v}=g;this.log(`"${p}" message event for session "${m.sessionId}" message size: ${v.byteLength}`),p==="license-request"||p==="license-renewal"?this.renewLicense(e,v).catch(E=>{c.eventNames().length?c.emit("error",E):this.handleError(E)}):p==="license-release"?e.keySystem===$e.FAIRPLAY&&this.updateKeySession(e,co("acknowledged")).then(()=>this.removeSession(e)).catch(E=>this.handleError(E)):this.warn(`unhandled media key message type "${p}"`)},f=(g,m)=>{m.keyStatus=g;let p;g.startsWith("usable")?c.emit("resolved"):g==="internal-error"||g==="output-restricted"||g==="output-downscaled"?p=wu(g,m.decryptdata):g==="expired"?p=new Error(`key expired (keyId: ${o})`):g==="released"?p=new Error("key released"):g==="status-pending"||this.warn(`unhandled key status change "${g}" (keyId: ${o})`),p&&(c.eventNames().length?c.emit("error",p):this.handleError(p))},d=e._onkeystatuseschange=g=>{if(!e.mediaKeysSession){c.emit("error",new Error("invalid state"));return}const p=this.getKeyStatuses(e);if(!Object.keys(p).some(T=>p[T]!=="status-pending"))return;if(p[o]==="expired"){this.log(`Expired key ${Pe(p)} in key-session "${e.mediaKeysSession.sessionId}"`),this.renewKeySession(e);return}let E=p[o];if(E)f(E,e);else{var x;e.keyStatusTimeouts||(e.keyStatusTimeouts={}),(x=e.keyStatusTimeouts)[o]||(x[o]=self.setTimeout(()=>{if(!e.mediaKeysSession||!this.mediaKeys)return;const S=this.getKeyStatus(e.decryptdata);if(S&&S!=="status-pending")return this.log(`No status for keyId ${o} in key-session "${e.mediaKeysSession.sessionId}". Using session key-status ${S} from other session.`),f(S,e);this.log(`key status for ${o} in key-session "${e.mediaKeysSession.sessionId}" timed out after 1000ms`),E="internal-error",f(E,e)},1e3)),this.log(`No status for keyId ${o} (${Pe(p)}).`)}};gt(e.mediaKeysSession,"message",u),gt(e.mediaKeysSession,"keystatuseschange",d);const h=new Promise((g,m)=>{c.on("error",m),c.on("resolved",g)});return e.mediaKeysSession.generateRequest(t,s).then(()=>{this.log(`Request generated for key-session "${e.mediaKeysSession.sessionId}" keyId: ${o} URI: ${l}`)}).catch(g=>{throw new Et({type:ie.KEY_SYSTEM_ERROR,details:k.KEY_SYSTEM_NO_SESSION,error:g,decryptdata:e.decryptdata,fatal:!1},`Error generating key-session request: ${g}`)}).then(()=>h).catch(g=>(c.removeAllListeners(),this.removeSession(e).then(()=>{throw g}))).then(()=>(c.removeAllListeners(),e))}getKeyStatuses(e){const t={};return e.mediaKeysSession.keyStatuses.forEach((s,r)=>{if(typeof r=="string"&&typeof s=="object"){const o=r;r=s,s=o}const n="buffer"in r?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):new Uint8Array(r);if(e.keySystem===$e.PLAYREADY&&n.length===16){const o=Ze(n);t[o]=s,oh(n)}const a=Ze(n);s==="internal-error"&&(this.bannedKeyIds[a]=s),this.log(`key status change "${s}" for keyStatuses keyId: ${a} key-session "${e.mediaKeysSession.sessionId}"`),t[a]=s}),t}fetchServerCertificate(e){const t=this.config,s=t.loader,r=new s(t),n=this.getServerCertificateUrl(e);return n?(this.log(`Fetching server certificate for "${e}"`),new Promise((a,o)=>{const l={responseType:"arraybuffer",url:n},c=t.certLoadPolicy.default,u={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},f={onSuccess:(d,h,g,m)=>{a(d.data)},onError:(d,h,g,m)=>{o(new Et({type:ie.KEY_SYSTEM_ERROR,details:k.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:g,response:Re({url:l.url,data:void 0},d)},`"${e}" certificate request failed (${n}). Status: ${d.code} (${d.text})`))},onTimeout:(d,h,g)=>{o(new Et({type:ie.KEY_SYSTEM_ERROR,details:k.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:g,response:{url:l.url,data:void 0}},`"${e}" certificate request timed out (${n})`))},onAbort:(d,h,g)=>{o(new Error("aborted"))}};r.load(l,u,f)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,s){return new Promise((r,n)=>{e.setServerCertificate(s).then(a=>{this.log(`setServerCertificate ${a?"success":"not supported by CDM"} (${s.byteLength}) on "${t}"`),r(e)}).catch(a=>{n(new Et({type:ie.KEY_SYSTEM_ERROR,details:k.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:a,fatal:!0},a.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(s=>this.updateKeySession(e,new Uint8Array(s)).catch(r=>{throw new Et({type:ie.KEY_SYSTEM_ERROR,details:k.KEY_SYSTEM_SESSION_UPDATE_FAILED,decryptdata:e.decryptdata,error:r,fatal:!1},r.message)}))}unpackPlayReadyKeyMessage(e,t){const s=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!s.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const r=new DOMParser().parseFromString(s,"application/xml"),n=r.querySelectorAll("HttpHeader");if(n.length>0){let u;for(let f=0,d=n.length;f<d;f++){var a,o;u=n[f];const h=(a=u.querySelector("name"))==null?void 0:a.textContent,g=(o=u.querySelector("value"))==null?void 0:o.textContent;h&&g&&e.setRequestHeader(h,g)}}const l=r.querySelector("Challenge"),c=l?.textContent;if(!c)throw new Error("Cannot find <Challenge> in key message");return co(atob(c))}setupLicenseXHR(e,t,s,r){const n=this.config.licenseXhrSetup;return n?Promise.resolve().then(()=>{if(!s.decryptdata)throw new Error("Key removed");return n.call(this.hls,e,t,s,r)}).catch(a=>{if(!s.decryptdata)throw a;return e.open("POST",t,!0),n.call(this.hls,e,t,s,r)}).then(a=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:a||r})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:r}))}requestLicense(e,t){const s=this.config.keyLoadPolicy.default;return new Promise((r,n)=>{const a=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${a}`);const o=new XMLHttpRequest;o.responseType="arraybuffer",o.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return n(new Error("invalid state"));if(o.readyState===4)if(o.status===200){this._requestLicenseFailureCount=0;let l=o.response;this.log(`License received ${l instanceof ArrayBuffer?l.byteLength:l}`);const c=this.config.licenseResponseCallback;if(c)try{l=c.call(this.hls,o,a,e)}catch(u){this.error(u)}r(l)}else{const l=s.errorRetry,c=l?l.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>c||o.status>=400&&o.status<500)n(new Et({type:ie.KEY_SYSTEM_ERROR,details:k.KEY_SYSTEM_LICENSE_REQUEST_FAILED,decryptdata:e.decryptdata,fatal:!0,networkDetails:o,response:{url:a,data:void 0,code:o.status,text:o.statusText}},`License Request XHR failed (${a}). Status: ${o.status} (${o.statusText})`));else{const u=c-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${u} attempts left`),this.requestLicense(e,t).then(r,n)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=o,this.setupLicenseXHR(o,a,e,t).then(({xhr:l,licenseChallenge:c})=>{e.keySystem==$e.PLAYREADY&&(c=this.unpackPlayReadyKeyMessage(l,c)),l.send(c)}).catch(n)})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const s=t.media;this.media=s,gt(s,"encrypted",this.onMediaEncrypted),gt(s,"waitingforkey",this.onWaitingForKey);const r=this.mediaResolved;r?r():this.mediaKeys=s.mediaKeys}onMediaDetached(){const e=this.media;e&&(yt(e,"encrypted",this.onMediaEncrypted),yt(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},this.bannedKeyIds={};const t=this.mediaResolved;if(t&&t(),!this.mediaKeys&&!this.mediaKeySessions.length)return;const s=this.media,r=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,Fs.clearKeyUriToKeyIdMap();const n=r.length;Li.CDMCleanupPromise=Promise.all(r.map(a=>this.removeSession(a)).concat((s==null||(e=s.setMediaKeys(null))==null?void 0:e.catch(a=>{this.log(`Could not clear media keys: ${a}`),this.hls&&this.hls.trigger(y.ERROR,{type:ie.OTHER_ERROR,details:k.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${a}`)})}))||Promise.resolve())).catch(a=>{this.log(`Could not close sessions and clear media keys: ${a}`),this.hls&&this.hls.trigger(y.ERROR,{type:ie.OTHER_ERROR,details:k.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${a}`)})}).then(()=>{n&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this._clear()}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const s=t.reduce((r,n)=>(r.indexOf(n.keyFormat)===-1&&r.push(n.keyFormat),r),[]);this.log(`Selecting key-system from session-keys ${s.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(s)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:s,decryptdata:r}=e;if(t){this.log(`Remove licenses and keys and close session "${t.sessionId}" keyId: ${Ze(r?.keyId||[])}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),s&&s.readyState!==XMLHttpRequest.DONE&&s.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const n=this.mediaKeySessions.indexOf(e);n>-1&&this.mediaKeySessions.splice(n,1);const{keyStatusTimeouts:a}=e;a&&Object.keys(a).forEach(c=>self.clearTimeout(a[c]));const{drmSystemOptions:o}=this.config;return(cv(o)?new Promise((c,u)=>{self.setTimeout(()=>u(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(c).catch(u)}):Promise.resolve()).catch(c=>{this.log(`Could not remove session: ${c}`),this.hls&&this.hls.trigger(y.ERROR,{type:ie.OTHER_ERROR,details:k.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${c}`)})}).then(()=>t.close()).catch(c=>{this.log(`Could not close session: ${c}`),this.hls&&this.hls.trigger(y.ERROR,{type:ie.OTHER_ERROR,details:k.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${c}`)})})}return Promise.resolve()}}Li.CDMCleanupPromise=void 0;function Mr(i){if(!i)throw new Error("Could not read keyId of undefined decryptdata");if(i.keyId===null)throw new Error("keyId is null");return Ze(i.keyId)}function Rx(i,e){if(i.keyId&&e.mediaKeysSession.keyStatuses.has(i.keyId))return e.mediaKeysSession.keyStatuses.get(i.keyId);if(i.matches(e.decryptdata))return e.keyStatus}class Et extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}function wu(i,e){const t=i==="output-restricted",s=t?k.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:k.KEY_SYSTEM_STATUS_INTERNAL_ERROR;return new Et({type:ie.KEY_SYSTEM_ERROR,details:s,fatal:!1,decryptdata:e},t?"HDCP level output restricted":`key status changed to "${i}"`)}class Cx{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(y.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(y.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(y.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(y.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const s=this.hls.config;if(s.capLevelOnFPSDrop){const r=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=r,r&&typeof r.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),s.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,s){const r=performance.now();if(t){if(this.lastTime){const n=r-this.lastTime,a=s-this.lastDroppedFrames,o=t-this.lastDecodedFrames,l=1e3*a/n,c=this.hls;if(c.trigger(y.FPS_DROP,{currentDropped:a,currentDecoded:o,totalDroppedFrames:s}),l>0&&a>c.config.fpsDroppedMonitoringThreshold*o){let u=c.currentLevel;c.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+u),u>0&&(c.autoLevelCapping===-1||c.autoLevelCapping>=u)&&(u=u-1,c.trigger(y.FPS_DROP_LEVEL_CAPPING,{level:u,droppedLevel:c.currentLevel}),c.autoLevelCapping=u,this.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=s,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function Jh(i,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=i,e.dispatchEvent(t)}function e0(i,e){const t=i.mode;if(t==="disabled"&&(i.mode="hidden"),i.cues&&!i.cues.getCueById(e.id))try{if(i.addCue(e),!i.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(s){Ce.debug(`[texttrack-utils]: ${s}`);try{const r=new self.TextTrackCue(e.startTime,e.endTime,e.text);r.id=e.id,i.addCue(r)}catch(r){Ce.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${r}`)}}t==="disabled"&&(i.mode=t)}function vi(i,e){const t=i.mode;if(t==="disabled"&&(i.mode="hidden"),i.cues)for(let s=i.cues.length;s--;)e&&i.cues[s].removeEventListener("enter",e),i.removeCue(i.cues[s]);t==="disabled"&&(i.mode=t)}function Eo(i,e,t,s){const r=i.mode;if(r==="disabled"&&(i.mode="hidden"),i.cues&&i.cues.length>0){const n=Dx(i.cues,e,t);for(let a=0;a<n.length;a++)(!s||s(n[a]))&&i.removeCue(n[a])}r==="disabled"&&(i.mode=r)}function wx(i,e){if(e<=i[0].startTime)return 0;const t=i.length-1;if(e>i[t].endTime)return-1;let s=0,r=t,n;for(;s<=r;)if(n=Math.floor((r+s)/2),e<i[n].startTime)r=n-1;else if(e>i[n].startTime&&s<t)s=n+1;else return n;return i[s].startTime-e<e-i[r].startTime?s:r}function Dx(i,e,t){const s=[],r=wx(i,e);if(r>-1)for(let n=r,a=i.length;n<a;n++){const o=i[n];if(o.startTime>=e&&o.endTime<=t)s.push(o);else if(o.startTime>t)return s}return s}function sn(i){const e=[];for(let t=0;t<i.length;t++){const s=i[t];(s.kind==="subtitles"||s.kind==="captions")&&s.label&&e.push(i[t])}return e}class kx extends Al{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const s=sn(this.media.textTracks);for(let n=0;n<s.length;n++)if(s[n].mode==="hidden")t=s[n];else if(s[n].mode==="showing"){t=s[n];break}const r=this.findTrackForTextTrack(t);this.subtitleTrack!==r&&this.setSubtitleTrack(r)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.MANIFEST_PARSED,this.onManifestParsed,this),e.on(y.LEVEL_LOADING,this.onLevelLoading,this),e.on(y.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(y.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(y.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.MANIFEST_PARSED,this.onManifestParsed,this),e.off(y.LEVEL_LOADING,this.onLevelLoading,this),e.off(y.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(y.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(y.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const s=this.media;if(!s)return;const r=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||s.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,r)return;sn(s.textTracks).forEach(a=>{vi(a)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:s,groupId:r,details:n}=t,a=this.tracksInGroup[s];if(!a||a.groupId!==r){this.warn(`Subtitle track with id:${s} and group:${r} not found in active group ${a?.groupId}`);return}const o=a.details;a.details=t.details,this.log(`Subtitle track ${s} "${a.name}" lang:${a.lang} group:${r} loaded [${n.startSN}-${n.endSN}]`),s===this.trackId&&this.playlistLoaded(s,t,o)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const s=t.subtitleGroups||null,r=this.groupIds;let n=this.currentTrack;if(!s||r?.length!==s?.length||s!=null&&s.some(a=>r?.indexOf(a)===-1)){this.groupIds=s,this.trackId=-1,this.currentTrack=null;const a=this.tracks.filter(u=>!s||s.indexOf(u.groupId)!==-1);if(a.length)this.selectDefaultTrack&&!a.some(u=>u.default)&&(this.selectDefaultTrack=!1),a.forEach((u,f)=>{u.id=f});else if(!n&&!this.tracksInGroup.length)return;this.tracksInGroup=a;const o=this.hls.config.subtitlePreference;if(!n&&o){this.selectDefaultTrack=!1;const u=Qt(o,a);if(u>-1)n=a[u];else{const f=Qt(o,this.tracks);n=this.tracks[f]}}let l=this.findTrackId(n);l===-1&&n&&(l=this.findTrackId(null));const c={subtitleTracks:a};this.log(`Updating subtitle tracks, ${a.length} track(s) found in "${s?.join(",")}" group-id`),this.hls.trigger(y.SUBTITLE_TRACKS_UPDATED,c),l!==-1&&this.trackId===-1&&this.setSubtitleTrack(l)}}findTrackId(e){const t=this.tracksInGroup,s=this.selectDefaultTrack;for(let r=0;r<t.length;r++){const n=t[r];if(!(s&&!n.default||!s&&!e)&&(!e||si(n,e)))return r}if(e){for(let r=0;r<t.length;r++){const n=t[r];if(mr(e.attrs,n.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return r}for(let r=0;r<t.length;r++){const n=t[r];if(mr(e.attrs,n.attrs,["LANGUAGE"]))return r}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let s=0;s<t.length;s++){const r=t[s];if(mo(r,e))return s}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===Ee.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const s=this.currentTrack;if(s&&si(e,s))return s;const r=Qt(e,this.tracksInGroup);if(r>-1){const n=this.tracksInGroup[r];return this.setSubtitleTrack(r),n}else{if(s)return null;{const n=Qt(e,t);if(n>-1)return t[n]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=e.id,r=e.groupId,n=this.getUrlWithDirectives(e.url,t),a=e.details,o=a?.age;this.log(`Loading subtitle ${s} "${e.name}" lang:${e.lang} group:${r}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${o&&a.live?" age "+o.toFixed(1)+(a.type&&" "+a.type||""):""} ${n}`),this.hls.trigger(y.SUBTITLE_TRACK_LOADING,{url:n,id:s,groupId:r,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=sn(e.textTracks),s=this.currentTrack;let r;if(s&&(r=t.filter(n=>mo(s,n))[0],r||this.warn(`Unable to find subtitle TextTrack with name "${s.name}" and language "${s.lang}"`)),[].slice.call(t).forEach(n=>{n.mode!=="disabled"&&n!==r&&(n.mode="disabled")}),r){const n=this.subtitleDisplay?"showing":"hidden";r.mode!==n&&(r.mode=n)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!J(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const s=this.currentTrack,r=t[e]||null;if(this.trackId=e,this.currentTrack=r,this.toggleTrackModes(),!r){this.hls.trigger(y.SUBTITLE_TRACK_SWITCH,{id:e});return}const n=!!r.details&&!r.details.live;if(e===this.trackId&&r===s&&n)return;this.log(`Switching to subtitle-track ${e}`+(r?` "${r.name}" lang:${r.lang} group:${r.groupId}`:""));const{id:a,groupId:o="",name:l,type:c,url:u}=r;this.hls.trigger(y.SUBTITLE_TRACK_SWITCH,{id:a,groupId:o,name:l,type:c,url:u});const f=this.switchParams(r.url,s?.details,r.details);this.loadPlaylist(f)}}function Px(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{const n=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(r=="x"?n:n&3|8).toString(16)})}}}function Ji(i){let e=5381,t=i.length;for(;t;)e=e*33^i.charCodeAt(--t);return(e>>>0).toString()}const _i=.025;let Rn=(function(i){return i[i.Point=0]="Point",i[i.Range=1]="Range",i})({});function Ox(i,e,t){return`${i.identifier}-${t+1}-${Ji(e)}`}class Mx{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const s=this.playoutLimit;return e<=0||isNaN(s)?!1:s===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>s}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return La(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,s=La(t,e);return t-s<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=J(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return La(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<_i))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?Rn.Range:Rn.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return Fx(this)}}function La(i,e){return i-e.start<e.duration/2&&!(Math.abs(i-(e.start+e.duration))<_i)?e.start:e.start+e.duration}function t0(i,e,t){const s=new self.URL(i,t);return s.protocol!=="data:"&&s.searchParams.set("_HLS_primary_id",e),s}function _a(i,e){for(;(t=i.assetList[++e])!=null&&t.error;)var t;return e}function Fx(i){return`["${i.identifier}" ${i.cue.pre?"<pre>":i.cue.post?"<post>":""}${i.timelineStart.toFixed(2)}-${i.resumeTime.toFixed(2)}]`}function yi(i){const e=i.timelineStart,t=i.duration||0;return`["${i.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class Nx{constructor(e,t,s,r){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls&&this.hls.trigger(y.PLAYOUT_LIMIT_REACHED,{})};const n=this.hls=new e(t);this.interstitial=s,this.assetItem=r;const a=()=>{this.hasDetails=!0};n.once(y.LEVEL_LOADED,a),n.once(y.AUDIO_TRACK_LOADED,a),n.once(y.SUBTITLE_TRACK_LOADED,a),n.on(y.MEDIA_ATTACHING,(o,{media:l})=>{this.removeMediaListeners(),this.mediaAttached=l,this.interstitial.playoutLimit&&(l.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&n.on(y.BUFFER_APPENDED,()=>{const u=this.bufferedEnd;this.reachedPlayout(u)&&(this._bufferedEosTime=u,n.trigger(y.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){return this.interstitial.appendInPlace}loadSource(){const e=this.hls;if(e)if(e.url)e.levels.length&&!e.started&&e.startLoad(-1,!0);else{let t=this.assetItem.uri;try{t=t0(t,e.config.primarySessionId||"").href}catch{}e.loadSource(t)}}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e)return!1;const s=Math.min(this._bufferedEosTime||1/0,this.duration),r=this.timelineOffset,n=fe.bufferInfo(e,r,0);return this.getAssetTime(n.end)>=s-.02}reachedPlayout(e){const s=this.interstitial.playoutLimit;return this.startOffset+e>=s}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=fe.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;if(!e)return 0;const t=this.interstitial.playoutLimit;if(t){const s=t-this.startOffset;if(s>0&&s<e)return s}return e}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const s=e-t;if(Math.abs(s)>1/9e4&&this.hls){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,s=this.duration;return Math.min(Math.max(0,e-t),s)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls&&this.hls.destroy(),this.hls=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){var t;this.loadSource(),(t=this.hls)==null||t.attachMedia(e)}detachMedia(){var e;this.removeMediaListeners(),this.mediaAttached=null,(e=this.hls)==null||e.detachMedia()}resumeBuffering(){var e;(e=this.hls)==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.hls)==null||e.pauseBuffering()}transferMedia(){var e;return this.bufferSnapShot(),((e=this.hls)==null?void 0:e.transferMedia())||null}resetDetails(){const e=this.hls;if(e&&this.hasDetails){e.stopLoad();const t=s=>delete s.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,s){var r;(r=this.hls)==null||r.on(e,t)}once(e,t,s){var r;(r=this.hls)==null||r.once(e,t)}off(e,t,s){var r;(r=this.hls)==null||r.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${yi(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const Du=.033;class $x extends Pt{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((s,r)=>e<=r.startOffset&&t>r.startOffset?(delete r.error,s+1):s,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let s=-1;e.nextEvent?s=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(s=this.findEventIndex(e.previousEvent.identifier)+1);const r=this.items;if(r)for(r[s]||(t===void 0&&(t=e.start),s=this.findItemIndexAtTime(t));s>=0&&(n=r[s])!=null&&n.event;){var n;s--}return s}findItemIndexAtTime(e,t){const s=this.items;if(s)for(let r=0;r<s.length;r++){let n=s[r];if(t&&t!=="primary"&&(n=n[t]),e===n.start||e>n.start&&e<n.end)return r}return-1}findJumpRestrictedIndex(e,t){const s=this.items;if(s)for(let r=e;r<=t&&s[r];r++){const n=s[r].event;if(n!=null&&n.restrictions.jump&&!n.appendInPlace)return r}return-1}findEventIndex(e){const t=this.items;if(t)for(let r=t.length;r--;){var s;if(((s=t[r].event)==null?void 0:s.identifier)===e)return r}return-1}findAssetIndex(e,t){const s=e.assetList,r=s.length;if(r>1)for(let n=0;n<r;n++){const a=s[n];if(!a.error){const o=a.timelineStart;if(t===o||t>o&&(t<o+(a.duration||0)||n===r-1))return n}}return 0}get assetIdAtEnd(){var e;const t=(e=this.items)==null||(e=e[this.length-1])==null?void 0:e.event;if(t){const s=t.assetList,r=s[s.length-1];if(r)return r.identifier}return null}parseInterstitialDateRanges(e,t){const s=e.main.details,{dateRanges:r}=s,n=this.events,a=this.parseDateRanges(r,{url:s.url},t),o=Object.keys(r),l=n?n.filter(c=>!o.includes(c.identifier)):[];a.length&&a.sort((c,u)=>{const f=c.cue.pre,d=c.cue.post,h=u.cue.pre,g=u.cue.post;if(f&&!h)return-1;if(h&&!f||d&&!g)return 1;if(g&&!d)return-1;if(!f&&!h&&!d&&!g){const m=c.startTime,p=u.startTime;if(m!==p)return m-p}return c.dateRange.tagOrder-u.dateRange.tagOrder}),this.events=a,l.forEach(c=>{this.removeEvent(c)}),this.updateSchedule(e,l)}updateSchedule(e,t=[],s=!1){const r=this.events||[];if(r.length||t.length||this.length<2){const n=this.items,a=this.parseSchedule(r,e);(s||t.length||n?.length!==a.length||a.some((l,c)=>Math.abs(l.playout.start-n[c].playout.start)>.005||Math.abs(l.playout.end-n[c].playout.end)>.005))&&(this.items=a,this.onScheduleUpdate(t,n))}}parseDateRanges(e,t,s){const r=[],n=Object.keys(e);for(let a=0;a<n.length;a++){const o=n[a],l=e[o];if(l.isInterstitial){let c=this.eventMap[o];c?c.setDateRange(l):(c=new Mx(l,t),this.eventMap[o]=c,s===!1&&(c.appendInPlace=s)),r.push(c)}}return r}parseSchedule(e,t){const s=[],r=t.main.details,n=r.live?1/0:r.edge;let a=0;if(e=e.filter(l=>!l.error&&!(l.cue.once&&l.hasPlayed)),e.length){this.resolveOffsets(e,t);let l=0,c=0;if(e.forEach((u,f)=>{const d=u.cue.pre,h=u.cue.post,g=e[f-1]||null,m=u.appendInPlace,p=h?n:u.startOffset,v=u.duration,E=u.timelineOccupancy===Rn.Range?v:0,x=u.resumptionOffset,T=g?.startTime===p,S=p+u.cumulativeDuration;let C=m?S+v:p+x;if(d||!h&&p<=0){const w=c;c+=E,u.timelineStart=S;const L=a;a+=v,s.push({event:u,start:S,end:C,playout:{start:L,end:a},integrated:{start:w,end:c}})}else if(p<=n){if(!T){const I=p-l;if(I>Du){const O=l,P=c;c+=I;const H=a;a+=I;const Q={previousEvent:e[f-1]||null,nextEvent:u,start:O,end:O+I,playout:{start:H,end:a},integrated:{start:P,end:c}};s.push(Q)}else I>0&&g&&(g.cumulativeDuration+=I,s[s.length-1].end=p)}h&&(C=S),u.timelineStart=S;const w=c;c+=E;const L=a;a+=v,s.push({event:u,start:S,end:C,playout:{start:L,end:a},integrated:{start:w,end:c}})}else return;const A=u.resumeTime;h||A>n?l=n:l=A}),l<n){var o;const u=l,f=c,d=n-l;c+=d;const h=a;a+=d,s.push({previousEvent:((o=s[s.length-1])==null?void 0:o.event)||null,nextEvent:null,start:l,end:u+d,playout:{start:h,end:a},integrated:{start:f,end:c}})}this.setDurations(n,a,c)}else s.push({previousEvent:null,nextEvent:null,start:0,end:n,playout:{start:0,end:n},integrated:{start:0,end:n}}),this.setDurations(n,n,n);return s}setDurations(e,t,s){this.durations={primary:e,playout:t,integrated:s}}resolveOffsets(e,t){const s=t.main.details,r=s.live?1/0:s.edge;let n=0,a=-1;e.forEach((o,l)=>{const c=o.cue.pre,u=o.cue.post,f=c?0:u?r:o.startTime;this.updateAssetDurations(o),a===f?o.cumulativeDuration=n:(n=0,a=f),!u&&o.snapOptions.in&&(o.resumeAnchor=ii(null,s.fragments,o.startOffset+o.resumptionOffset,0,0)||void 0),o.appendInPlace&&!o.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(o,t)||(o.appendInPlace=!1)),!o.appendInPlace&&l+1<e.length&&e[l+1].startTime-e[l].resumeTime<Du&&(e[l+1].appendInPlace=!1,e[l+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${o}`));const h=J(o.resumeOffset)?o.resumeOffset:o.duration;n+=h})}primaryCanResumeInPlaceAt(e,t){const s=e.resumeTime,r=e.startTime+e.resumptionOffset;return Math.abs(s-r)>_i?(this.log(`"${e.identifier}" resumption ${s} not aligned with estimated timeline end ${r}`),!1):!Object.keys(t).some(a=>{const o=t[a].details,l=o.edge;if(s>=l)return this.log(`"${e.identifier}" resumption ${s} past ${a} playlist end ${l}`),!1;const c=ii(null,o.fragments,s);if(!c)return this.log(`"${e.identifier}" resumption ${s} does not align with any fragments in ${a} playlist (${o.fragStart}-${o.fragmentEnd})`),!0;const u=a==="audio"?.175:0;return Math.abs(c.start-s)<_i+u||Math.abs(c.end-s)<_i+u?!1:(this.log(`"${e.identifier}" resumption ${s} not aligned with ${a} fragment bounds (${c.start}-${c.end} sn: ${c.sn} cc: ${c.cc})`),!0)})}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let s=0,r=!1,n=!1;for(let a=0;a<e.assetList.length;a++){const o=e.assetList[a],l=t+s;o.startOffset=s,o.timelineStart=l,r||(r=o.duration===null),n||(n=!!o.error);const c=o.error?0:o.duration||0;s+=c}r&&!n?e.duration=Math.max(s,e.duration):e.duration=s}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function Ot(i){return`[${i.event?'"'+i.event.identifier+'"':"primary"}: ${i.start.toFixed(2)}-${i.end.toFixed(2)}]`}class Bx{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const s=e.assetListUrl;let r;try{r=t0(s,this.hls.sessionId,e.baseUrl)}catch(d){const h=this.assignAssetListError(e,k.ASSET_LIST_LOAD_ERROR,d,s);this.hls.trigger(y.ERROR,h);return}t&&r.protocol!=="data:"&&r.searchParams.set("_HLS_start_offset",""+t);const n=this.hls.config,a=n.loader,o=new a(n),l={responseType:"json",url:r.href},c=n.interstitialAssetListLoadPolicy.default,u={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},f={onSuccess:(d,h,g,m)=>{const p=d.data,v=p?.ASSETS;if(!Array.isArray(v)){const E=this.assignAssetListError(e,k.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),g.url,h,m);this.hls.trigger(y.ERROR,E);return}e.assetListResponse=p,this.hls.trigger(y.ASSET_LIST_LOADED,{event:e,assetListResponse:p,networkDetails:m})},onError:(d,h,g,m)=>{const p=this.assignAssetListError(e,k.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${d.code} ${d.text} (${h.url})`),h.url,m,g);this.hls.trigger(y.ERROR,p)},onTimeout:(d,h,g)=>{const m=this.assignAssetListError(e,k.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${h.url})`),h.url,d,g);this.hls.trigger(y.ERROR,m)}};return o.load(l,u,f),this.hls.trigger(y.ASSET_LIST_LOADING,{event:e}),o}assignAssetListError(e,t,s,r,n,a){return e.error=s,{type:ie.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:r,error:s,networkDetails:a,stats:n}}}function ku(i){var e;i==null||(e=i.play())==null||e.catch(()=>{})}function Fr(i,e){return`[${i}] Advancing timeline position to ${e}`}class Ux extends Pt{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const s=this.currentTime;if(s===void 0||this.playbackDisabled||!this.schedule)return;const r=s-this.timelinePos;if(Math.abs(r)<1/7056e5)return;const a=r<=-.01;this.timelinePos=s,this.bufferedPos=s;const o=this.playingItem;if(!o){this.checkBuffer();return}if(a&&this.schedule.resetErrorsInRange(s,s-r)&&this.updateSchedule(!0),this.checkBuffer(),a&&s<o.start||s>=o.end){var l;const h=this.findItemIndex(o);let g=this.schedule.findItemIndexAtTime(s);if(g===-1&&(g=h+(a?-1:1),this.log(`seeked ${a?"back ":""}to position not covered by schedule ${s} (resolving from ${h} to ${g})`)),!this.isInterstitial(o)&&(l=this.media)!=null&&l.paused&&(this.shouldPlay=!1),!a&&g>h){const m=this.schedule.findJumpRestrictedIndex(h+1,g);if(m>h){this.setSchedulePosition(m);return}}this.setSchedulePosition(g);return}const c=this.playingAsset;if(!c){if(this.playingLastItem&&this.isInterstitial(o)){const h=o.event.assetList[0];h&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(s,h))}return}const u=c.timelineStart,f=c.duration||0;if(a&&s<u||s>=u+f){var d;(d=o.event)!=null&&d.appendInPlace&&(this.clearAssetPlayers(o.event,o),this.flushFrontBuffer(s)),this.setScheduleToAssetAtTime(s,c)}},this.onTimeupdate=()=>{const s=this.currentTime;if(s===void 0||this.playbackDisabled)return;if(s>this.timelinePos)this.timelinePos=s,s>this.bufferedPos&&this.checkBuffer();else return;const r=this.playingItem;if(!r||this.playingLastItem)return;if(s>=r.end){this.timelinePos=r.end;const o=this.findItemIndex(r);this.setSchedulePosition(o+1)}const n=this.playingAsset;if(!n)return;const a=n.timelineStart+(n.duration||0);s>=a&&this.setScheduleToAssetAtTime(s,n)},this.onScheduleUpdate=(s,r)=>{const n=this.schedule;if(!n)return;const a=this.playingItem,o=n.events||[],l=n.items||[],c=n.durations,u=s.map(m=>m.identifier),f=!!(o.length||u.length);(f||r)&&this.log(`INTERSTITIALS_UPDATED (${o.length}): ${o}
Schedule: ${l.map(m=>Ot(m))} pos: ${this.timelinePos}`),u.length&&this.log(`Removed events ${u}`);let d=null,h=null;a&&(d=this.updateItem(a,this.timelinePos),this.itemsMatch(a,d)?this.playingItem=d:this.waitingItem=this.endedItem=null),this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const g=this.bufferingItem;if(g&&(h=this.updateItem(g,this.bufferedPos),this.itemsMatch(g,h)?this.bufferingItem=h:g.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(g.event,null))),s.forEach(m=>{m.assetList.forEach(p=>{this.clearAssetPlayer(p.identifier,null)})}),this.playerQueue.forEach(m=>{if(m.interstitial.appendInPlace){const p=m.assetItem.timelineStart,v=m.timelineOffset-p;if(v)try{m.timelineOffset=p}catch(E){Math.abs(v)>_i&&this.warn(`${E} ("${m.assetId}" ${m.timelineOffset}->${p})`)}}}),f||r){if(this.hls.trigger(y.INTERSTITIALS_UPDATED,{events:o.slice(0),schedule:l.slice(0),durations:c,removedIds:u}),this.isInterstitial(a)&&u.includes(a.event.identifier)){this.warn(`Interstitial "${a.event.identifier}" removed while playing`),this.primaryFallback(a.event);return}a&&this.trimInPlace(d,a),g&&h!==d&&this.trimInPlace(h,g),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new Bx(e),this.schedule=new $x(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e&&(e.on(y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(y.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(y.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(y.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(y.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(y.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(y.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(y.BUFFER_APPENDED,this.onBufferAppended,this),e.on(y.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(y.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(y.MEDIA_ENDED,this.onMediaEnded,this),e.on(y.ERROR,this.onError,this),e.on(y.DESTROYING,this.onDestroying,this))}unregisterListeners(){const e=this.hls;e&&(e.off(y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(y.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(y.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(y.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(y.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(y.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(y.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(y.BUFFER_CODECS,this.onBufferCodecs,this),e.off(y.BUFFER_APPENDED,this.onBufferAppended,this),e.off(y.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(y.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(y.MEDIA_ENDED,this.onMediaEnded,this),e.off(y.ERROR,this.onError,this),e.off(y.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.schedule=this.manager=null,this.hls=this.HlsPlayerClass=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){yt(e,"play",this.onPlay),yt(e,"pause",this.onPause),yt(e,"seeking",this.onSeeking),yt(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const s=this.media=t.media;gt(s,"seeking",this.onSeeking),gt(s,"timeupdate",this.onTimeupdate),gt(s,"play",this.onPlay),gt(s,"pause",this.onPause)}onMediaAttached(e,t){const s=this.effectivePlayingItem,r=this.detachedData;if(this.detachedData=null,s===null)this.checkStart();else if(!r){this.clearScheduleState();const n=this.findItemIndex(s);this.setSchedulePosition(n)}}clearScheduleState(){this.log("clear schedule state"),this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const s=!!t.transferMedia,r=this.media;if(this.media=null,!s&&(r&&this.removeMediaListeners(r),this.detachedData)){const n=this.getBufferingPlayer();n&&(this.log(`Removing schedule state for detachedData and ${n}`),this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,n.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.hls)return null;if(this.manager)return this.manager;const e=this,t=()=>e.bufferingItem||e.waitingItem,s=f=>f&&e.getAssetPlayer(f.identifier),r=(f,d,h,g,m)=>{if(f){let p=f[d].start;const v=f.event;if(v){if(d==="playout"||v.timelineOccupancy!==Rn.Point){const E=s(h);E?.interstitial===v&&(p+=E.assetItem.startOffset+E[m])}}else{const E=g==="bufferedPos"?a():e[g];p+=E-f.start}return p}return 0},n=(f,d)=>{var h;if(f!==0&&d!=="primary"&&(h=e.schedule)!=null&&h.length){var g;const m=e.schedule.findItemIndexAtTime(f),p=(g=e.schedule.items)==null?void 0:g[m];if(p){const v=p[d].start-p.start;return f+v}}return f},a=()=>{const f=e.bufferedPos;return f===Number.MAX_VALUE?o("primary"):Math.max(f,0)},o=f=>{var d,h;return(d=e.primaryDetails)!=null&&d.live?e.primaryDetails.edge:((h=e.schedule)==null?void 0:h.durations[f])||0},l=(f,d)=>{var h,g;const m=e.effectivePlayingItem;if(m!=null&&(h=m.event)!=null&&h.restrictions.skip||!e.schedule)return;e.log(`seek to ${f} "${d}"`);const p=e.effectivePlayingItem,v=e.schedule.findItemIndexAtTime(f,d),E=(g=e.schedule.items)==null?void 0:g[v],x=e.getBufferingPlayer(),T=x?.interstitial,S=T?.appendInPlace,C=p&&e.itemsMatch(p,E);if(p&&(S||C)){const A=s(e.playingAsset),w=A?.media||e.primaryMedia;if(w){const L=d==="primary"?w.currentTime:r(p,d,e.playingAsset,"timelinePos","currentTime"),I=f-L,O=(S?L:w.currentTime)+I;if(O>=0&&(!A||S||O<=A.duration)){w.currentTime=O;return}}}if(E){let A=f;if(d!=="primary"){const L=E[d].start,I=f-L;A=E.start+I}const w=!e.isInterstitial(E);if((!e.isInterstitial(p)||p.event.appendInPlace)&&(w||E.event.appendInPlace)){const L=e.media||(S?x?.media:null);L&&(L.currentTime=A)}else if(p){const L=e.findItemIndex(p);if(v>L){const O=e.schedule.findJumpRestrictedIndex(L+1,v);if(O>L){e.setSchedulePosition(O);return}}let I=0;if(w)e.timelinePos=A,e.checkBuffer();else{const O=E.event.assetList,P=f-(E[d]||E).start;for(let H=O.length;H--;){const Q=O[H];if(Q.duration&&P>=Q.startOffset&&P<Q.startOffset+Q.duration){I=H;break}}}e.setSchedulePosition(v,I)}}},c=()=>{const f=e.effectivePlayingItem;if(e.isInterstitial(f))return f;const d=t();return e.isInterstitial(d)?d:null},u={get bufferedEnd(){const f=t(),d=e.bufferingItem;if(d&&d===f){var h;return r(d,"playout",e.bufferingAsset,"bufferedPos","bufferedEnd")-d.playout.start||((h=e.bufferingAsset)==null?void 0:h.startOffset)||0}return 0},get currentTime(){const f=c(),d=e.effectivePlayingItem;return d&&d===f?r(d,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-d.playout.start:0},set currentTime(f){const d=c(),h=e.effectivePlayingItem;h&&h===d&&l(f+h.playout.start,"playout")},get duration(){const f=c();return f?f.playout.end-f.playout.start:0},get assetPlayers(){var f;const d=(f=c())==null?void 0:f.event.assetList;return d?d.map(h=>e.getAssetPlayer(h.identifier)):[]},get playingIndex(){var f;const d=(f=c())==null?void 0:f.event;return d&&e.effectivePlayingAsset?d.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return c()}};return this.manager={get events(){var f;return((f=e.schedule)==null||(f=f.events)==null?void 0:f.slice(0))||[]},get schedule(){var f;return((f=e.schedule)==null||(f=f.items)==null?void 0:f.slice(0))||[]},get interstitialPlayer(){return c()?u:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const f=t();return e.findItemIndex(f)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const f=e.effectivePlayingItem;return e.findItemIndex(f)},primary:{get bufferedEnd(){return a()},get currentTime(){const f=e.timelinePos;return f>0?f:0},set currentTime(f){l(f,"primary")},get duration(){return o("primary")},get seekableStart(){var f;return((f=e.primaryDetails)==null?void 0:f.fragmentStart)||0}},integrated:{get bufferedEnd(){return r(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return r(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(f){l(f,"integrated")},get duration(){return o("integrated")},get seekableStart(){var f;return n(((f=e.primaryDetails)==null?void 0:f.fragmentStart)||0,"integrated")}},skip:()=>{const f=e.effectivePlayingItem,d=f?.event;if(d&&!d.restrictions.skip){const h=e.findItemIndex(f);if(d.appendInPlace){const g=f.playout.start+f.event.duration;l(g+.001,"playout")}else e.advanceAfterAssetEnded(d,h,1/0)}}}}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,s=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!s?!1:this.findItemIndex(t)===s.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t;if(this.mediaSelection===null)return;const s=this.waitingItem||this.playingItem;if(this.isInterstitial(s)&&!s.event.appendInPlace)return;let r=this.media;!r&&(e=this.bufferingItem)!=null&&(e=e.event)!=null&&e.appendInPlace&&(r=this.primaryMedia);const n=(t=r)==null?void 0:t.currentTime;if(!(n===void 0||!J(n)))return n}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const s=this.getAssetPlayer(e);s&&this.transferMediaFromPlayer(s,t)}transferMediaFromPlayer(e,t){const s=e.interstitial.appendInPlace,r=e.media;if(s&&r===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&r){this.detachedData={media:r};return}const n=e.transferMedia();this.log(`transfer MediaSource from ${e} ${Pe(n)}`),this.detachedData=n}else t&&r&&(this.shouldPlay||(this.shouldPlay=!r.paused))}transferMediaTo(e,t){var s,r;if(e.media===t)return;let n=null;const a=this.hls,o=e!==a,l=o&&e.interstitial.appendInPlace,c=(s=this.detachedData)==null?void 0:s.mediaSource;let u;if(a.media)l&&(n=a.transferMedia(),this.detachedData=n),u="Primary";else if(c){const g=this.getBufferingPlayer();g?(n=g.transferMedia(),u=`${g}`):u="detached MediaSource"}else u="detached media";if(!n){if(c)n=this.detachedData,this.log(`using detachedData: MediaSource ${Pe(n)}`);else if(!this.detachedData||a.media===t){const g=this.playerQueue;g.length>1&&g.forEach(m=>{if(o&&m.interstitial.appendInPlace!==l){const p=m.interstitial;this.clearInterstitial(m.interstitial,null),p.appendInPlace=!1,p.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${p}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const f=n&&"mediaSource"in n&&((r=n.mediaSource)==null?void 0:r.readyState)!=="closed",d=f&&n?n:t;this.log(`${f?"transfering MediaSource":"attaching media"} to ${o?e:"Primary"} from ${u} (media.currentTime: ${t.currentTime})`);const h=this.schedule;if(d===n&&h){const g=o&&e.assetId===h.assetIdAtEnd;d.overrides={duration:h.duration,endOfStream:!o||g,cueRemoval:!o}}e.attachMedia(d)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e?.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const s=this.timelinePos,r=this.effectivePlayingItem;if(s===-1){const n=this.hls.startPosition;if(this.log(Fr("checkStart",n)),this.timelinePos=n,t.length&&t[0].cue.pre){const a=e.findEventIndex(t[0].identifier);this.setSchedulePosition(a)}else if(n>=0||!this.primaryLive){const a=this.timelinePos=n>0?n:0,o=e.findItemIndexAtTime(a);this.setSchedulePosition(o)}}else if(r&&!this.playingItem){const n=e.findItemIndex(r);this.setSchedulePosition(n)}}advanceAssetBuffering(e,t){const s=e.event,r=s.findAssetIndex(t),n=_a(s,r);if(!s.isAssetPastPlayoutLimit(n))this.bufferedToEvent(e,n);else if(this.schedule){var a;const o=(a=this.schedule.items)==null?void 0:a[this.findItemIndex(e)+1];o&&this.bufferedToItem(o)}}advanceAfterAssetEnded(e,t,s){const r=_a(e,s);if(e.isAssetPastPlayoutLimit(r)){if(this.schedule){const n=this.schedule.items;if(n){const a=t+1,o=n.length;if(a>=o){this.setSchedulePosition(-1);return}const l=e.resumeTime;this.timelinePos<l&&(this.log(Fr("advanceAfterAssetEnded",l)),this.timelinePos=l,e.appendInPlace&&this.advanceInPlace(l),this.checkBuffer(this.bufferedPos<l)),this.setSchedulePosition(a)}}}else{if(e.appendInPlace){const n=e.assetList[r];n&&this.advanceInPlace(n.timelineStart)}this.setSchedulePosition(t,r)}}setScheduleToAssetAtTime(e,t){const s=this.schedule;if(!s)return;const r=t.parentIdentifier,n=s.getEvent(r);if(n){const a=s.findEventIndex(r),o=s.findAssetIndex(n,e);this.advanceAfterAssetEnded(n,a,o-1)}}setSchedulePosition(e,t){var s;const r=(s=this.schedule)==null?void 0:s.items;if(!r||this.playbackDisabled)return;const n=e>=0?r[e]:null;this.log(`setSchedulePosition ${e}, ${t} (${n&&Ot(n)}) pos: ${this.timelinePos}`);const a=this.waitingItem||this.playingItem,o=this.playingLastItem;if(this.isInterstitial(a)){const u=a.event,f=this.playingAsset,d=f?.identifier,h=d?this.getAssetPlayer(d):null;if(h&&d&&(!this.eventItemsMatch(a,n)||t!==void 0&&d!==u.assetList[t].identifier)){var l;const g=u.findAssetIndex(f);if(this.log(`INTERSTITIAL_ASSET_ENDED ${g+1}/${u.assetList.length} ${yi(f)}`),this.endedAsset=f,this.playingAsset=null,this.hls.trigger(y.INTERSTITIAL_ASSET_ENDED,{asset:f,assetListIndex:g,event:u,schedule:r.slice(0),scheduleIndex:e,player:h}),a!==this.playingItem){this.itemsMatch(a,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(u,this.findItemIndex(this.playingItem),g);return}this.retreiveMediaSource(d,n),h.media&&!((l=this.detachedData)!=null&&l.mediaSource)&&h.detachMedia()}if(!this.eventItemsMatch(a,n)&&(this.endedItem=a,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${u} ${Ot(a)}`),u.hasPlayed=!0,this.hls.trigger(y.INTERSTITIAL_ENDED,{event:u,schedule:r.slice(0),scheduleIndex:e}),u.cue.once)){var c;this.updateSchedule();const g=(c=this.schedule)==null?void 0:c.items;if(n&&g){const m=this.findItemIndex(n);this.advanceSchedule(m,g,t,a,o)}return}}this.advanceSchedule(e,r,t,a,o)}advanceSchedule(e,t,s,r,n){const a=this.schedule;if(!a)return;const o=t[e]||null,l=this.primaryMedia,c=this.playerQueue;if(c.length&&c.forEach(u=>{const f=u.interstitial,d=a.findEventIndex(f.identifier);(d<e||d>e+1)&&this.clearInterstitial(f,o)}),this.isInterstitial(o)){this.timelinePos=Math.min(Math.max(this.timelinePos,o.start),o.end);const u=o.event;if(s===void 0){s=a.findAssetIndex(u,this.timelinePos);const g=_a(u,s-1);if(u.isAssetPastPlayoutLimit(g)||u.appendInPlace&&this.timelinePos===o.end){this.advanceAfterAssetEnded(u,e,s);return}s=g}const f=this.waitingItem;this.assetsBuffered(o,l)||this.setBufferingItem(o);let d=this.preloadAssets(u,s);if(this.eventItemsMatch(o,f||r)||(this.waitingItem=o,this.log(`INTERSTITIAL_STARTED ${Ot(o)} ${u.appendInPlace?"append in place":""}`),this.hls.trigger(y.INTERSTITIAL_STARTED,{event:u,schedule:t.slice(0),scheduleIndex:e})),!u.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${u}`);return}if(u.assetListLoader&&(u.assetListLoader.destroy(),u.assetListLoader=void 0),!l){this.log(`Waiting for attachMedia to start Interstitial ${u}`);return}this.waitingItem=this.endedItem=null,this.playingItem=o;const h=u.assetList[s];if(!h){this.advanceAfterAssetEnded(u,e,s||0);return}if(d||(d=this.getAssetPlayer(h.identifier)),d===null||d.destroyed){const g=u.assetList.length;this.warn(`asset ${s+1}/${g} player destroyed ${u}`),d=this.createAssetPlayer(u,h,s),d.loadSource()}if(!this.eventItemsMatch(o,this.bufferingItem)&&u.appendInPlace&&this.isAssetBuffered(h))return;this.startAssetPlayer(d,s,t,e,l),this.shouldPlay&&ku(d.media)}else o?(this.resumePrimary(o,e,r),this.shouldPlay&&ku(this.hls.media)):n&&this.isInterstitial(r)&&(this.endedItem=null,this.playingItem=r,r.event.appendInPlace||this.attachPrimary(a.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e;return(e=this.mediaSelection)==null?void 0:e.main.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,s){var r,n;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${Ot(e)}`),!((r=this.detachedData)!=null&&r.mediaSource)){let o=this.timelinePos;(o<e.start||o>=e.end)&&(o=this.getPrimaryResumption(e,t),this.log(Fr("resumePrimary",o)),this.timelinePos=o),this.attachPrimary(o,e)}if(!s)return;const a=(n=this.schedule)==null?void 0:n.items;a&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${Ot(e)}`),this.hls.trigger(y.INTERSTITIALS_PRIMARY_RESUMED,{schedule:a.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const s=e.start;if(this.primaryLive){const r=this.primaryDetails;if(t===0)return this.hls.startPosition;if(r&&(s<r.fragmentStart||s>r.edge))return this.hls.liveSyncPosition||-1}return s}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:fe.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,s){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const r=this.primaryMedia;if(!r)return;const n=this.hls;n.media?this.checkBuffer():(this.transferMediaTo(n,r),s&&this.startLoadingPrimaryAt(e,s)),s||(this.log(Fr("attachPrimary",e)),this.timelinePos=e,this.startLoadingPrimaryAt(e,s))}startLoadingPrimaryAt(e,t){var s;const r=this.hls;!r.loadingEnabled||!r.media||Math.abs((((s=r.mainForwardBufferInfo)==null?void 0:s.start)||r.media.currentTime)-e)>.5?r.startLoad(e,t):r.bufferingEnabled||r.resumeBuffering()}onManifestLoading(){var e;this.stopLoad(),(e=this.schedule)==null||e.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(y.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(y.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1||!this.schedule)return;const s=this.hls.levels[t.level];if(!s.details)return;const r=Re(Re({},this.mediaSelection||this.altSelection),{},{main:s});this.mediaSelection=r,this.schedule.parseInterstitialDateRanges(r,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const s=this.hls.audioTracks[t.id],r=this.mediaSelection;if(!r){this.altSelection=Re(Re({},this.altSelection),{},{audio:s});return}const n=Re(Re({},r),{},{audio:s});this.mediaSelection=n}onSubtitleTrackUpdated(e,t){const s=this.hls.subtitleTracks[t.id],r=this.mediaSelection;if(!r){this.altSelection=Re(Re({},this.altSelection),{},{subtitles:s});return}const n=Re(Re({},r),{},{subtitles:s});this.mediaSelection=n}onAudioTrackSwitching(e,t){const s=Gc(t);this.playerQueue.forEach(({hls:r})=>r&&(r.setAudioOption(t)||r.setAudioOption(s)))}onSubtitleTrackSwitch(e,t){const s=Gc(t);this.playerQueue.forEach(({hls:r})=>r&&(r.setSubtitleOption(t)||t.id!==-1&&r.setSubtitleOption(s)))}onBufferCodecs(e,t){const s=t.tracks;s&&(this.requiredTracks=s)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const s=this.playingItem;if(s&&!this.itemsMatch(s,this.bufferingItem)&&!this.isInterstitial(s)){const r=this.timelinePos;this.bufferedPos=r,this.checkBuffer()}}onBufferedToEnd(e){if(!this.schedule)return;const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let r=0;r<t.length;r++){const n=t[r];if(n.cue.post){var s;const a=this.schedule.findEventIndex(n.identifier),o=(s=this.schedule.items)==null?void 0:s[a];this.isInterstitial(o)&&this.eventItemsMatch(o,this.bufferingItem)&&this.bufferedToItem(o,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const s=this.findItemIndex(t);this.setSchedulePosition(s+1)}else this.shouldPlay=!1}updateItem(e,t){var s;const r=(s=this.schedule)==null?void 0:s.items;if(e&&r){const n=this.findItemIndex(e,t);return r[n]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((n,a)=>{e.event.isAssetPastPlayoutLimit(a)&&this.clearAssetPlayer(n.identifier,null)});const s=e.end+.25,r=fe.bufferInfo(this.primaryMedia,s,0);(r.end>s||(r.nextStart||0)>s)&&(this.log(`trim buffered interstitial ${Ot(e)} (was ${Ot(t)})`),this.attachPrimary(s,null,!0),this.flushFrontBuffer(s))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var s;return!!t&&(e===t||e.event.identifier===((s=t.event)==null?void 0:s.identifier))}findItemIndex(e,t){return e&&this.schedule?this.schedule.findItemIndex(e,t):-1}updateSchedule(e=!1){var t;const s=this.mediaSelection;s&&((t=this.schedule)==null||t.updateSchedule(s,[],e))}checkBuffer(e){var t;const s=(t=this.schedule)==null?void 0:t.items;if(!s)return;const r=fe.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=r.len<1),this.updateBufferedPos(r.end,s,e)}updateBufferedPos(e,t,s){const r=this.schedule,n=this.bufferingItem;if(this.bufferedPos>e||!r)return;if(t.length===1&&this.itemsMatch(t[0],n)){this.bufferedPos=e;return}const a=this.playingItem,o=this.findItemIndex(a);let l=r.findItemIndexAtTime(e);if(this.bufferedPos<e){var c;const u=this.findItemIndex(n),f=Math.min(u+1,t.length-1),d=t[f];if((l===-1&&n&&e>=n.end||(c=d.event)!=null&&c.appendInPlace&&e+.01>=d.start)&&(l=f),this.isInterstitial(n)){const h=n.event;if(f-o>1&&h.appendInPlace===!1||h.assetList.length===0&&h.assetListLoader)return}if(this.bufferedPos=e,l>u&&l>o)this.bufferedToItem(d);else{const h=this.primaryDetails;this.primaryLive&&h&&e>h.edge-h.targetduration&&d.start<h.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(d)&&this.preloadAssets(d.event,0)}}else s&&a&&!this.itemsMatch(a,n)&&(l===o?this.bufferedToItem(a):l===o+1&&this.bufferedToItem(t[l]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(r=>{const n=this.getAssetPlayer(r.identifier);return!(n!=null&&n.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,s=this.schedule;if(!this.itemsMatch(e,t)&&s){const{items:r,events:n}=s;if(!r||!n)return t;const a=this.isInterstitial(e),o=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const l=o?o.remaining:t?t.end-this.timelinePos:0;if(this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${Ot(e)}`+(t?` (${l.toFixed(2)} remaining)`:"")),!this.playbackDisabled)if(a){const c=s.findAssetIndex(e.event,this.bufferedPos);e.event.assetList.forEach((u,f)=>{const d=this.getAssetPlayer(u.identifier);d&&(f===c&&d.loadSource(),d.resumeBuffering())})}else this.hls.resumeBuffering(),this.playerQueue.forEach(c=>c.pauseBuffering());this.hls.trigger(y.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:n.slice(0),schedule:r.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}else this.bufferingItem!==e&&(this.bufferingItem=e);return t}bufferedToItem(e,t=0){const s=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(s!==null){this.bufferingAsset=null;const r=this.detachedData;r?r.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),s=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(s)}bufferedToEvent(e,t){const s=e.event,r=s.assetList.length===0&&!s.assetListLoader,n=s.cue.once;if(r||!n){const a=this.preloadAssets(s,t);if(a!=null&&a.interstitial.appendInPlace){const o=this.primaryMedia;o&&this.bufferAssetPlayer(a,o)}}}preloadAssets(e,t){const s=e.assetUrl,r=e.assetList.length,n=r===0&&!e.assetListLoader,a=e.cue.once;if(n){const l=e.timelineStart;if(e.appendInPlace){var o;const d=this.playingItem;!this.isInterstitial(d)&&(d==null||(o=d.nextEvent)==null?void 0:o.identifier)===e.identifier&&this.flushFrontBuffer(l+.25)}let c,u=0;if(!this.playingItem&&this.primaryLive&&(u=this.hls.startPosition,u===-1&&(u=this.hls.liveSyncPosition||0)),u&&!(e.cue.pre||e.cue.post)){const d=u-l;d>0&&(c=Math.round(d*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${s?1:r} ${e}${c?` live-start: ${u} start-offset: ${c}`:""}`),s)return this.createAsset(e,0,0,l,e.duration,s);const f=this.assetListLoader.loadAssetList(e,c);f&&(e.assetListLoader=f)}else if(!a&&r){for(let c=t;c<r;c++){const u=e.assetList[c],f=this.getAssetPlayerQueueIndex(u.identifier);(f===-1||this.playerQueue[f].destroyed)&&!u.error&&this.createAssetPlayer(e,u,c)}const l=e.assetList[t];if(l){const c=this.getAssetPlayer(l.identifier);return c&&c.loadSource(),c}}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(r=>{this.hls.trigger(y.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:r})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let s=0;s<t.length;s++)if(e===t[s].assetId)return s;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let s=0;s<e.length;s++)if(e[s].media===t)return e[s]}return null}createAsset(e,t,s,r,n,a){const o={parentIdentifier:e.identifier,identifier:Ox(e,a,t),duration:n,startOffset:s,timelineStart:r,uri:a};return this.createAssetPlayer(e,o,t)}createAssetPlayer(e,t,s){const r=this.hls,n=r.userConfig;let a=n.videoPreference;const o=r.loadLevelObj||r.levels[r.currentLevel];(a||o)&&(a=we({},a),o.videoCodec&&(a.videoCodec=o.videoCodec),o.videoRange&&(a.allowedVideoRanges=[o.videoRange]));const l=r.audioTracks[r.audioTrack],c=r.subtitleTracks[r.subtitleTrack];let u=0;if(this.primaryLive||e.appendInPlace){const T=this.timelinePos-t.timelineStart;if(T>1){const S=t.duration;S&&T<S&&(u=T)}}const f=t.identifier,d=Re(Re({},n),{},{maxMaxBufferLength:Math.min(180,r.config.maxMaxBufferLength),autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:r.sessionId,assetPlayerId:f,abrEwmaDefaultEstimate:r.bandwidthEstimate,interstitialsController:void 0,startPosition:u,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:a,audioPreference:l||n.audioPreference,subtitlePreference:c||n.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(d.timelineOffset=t.timelineStart));const h=d.cmcd;h!=null&&h.sessionId&&h.contentId&&(d.cmcd=we({},h,{contentId:Ji(t.uri)})),this.getAssetPlayer(f)&&this.warn(`Duplicate date range identifier ${e} and asset ${f}`);const g=new Nx(this.HlsPlayerClass,d,e,t);this.playerQueue.push(g),e.assetList[s]=t;let m=!0;const p=T=>{if(T.live){var S;const w=new Error(`Interstitials MUST be VOD assets ${e}`),L={fatal:!0,type:ie.OTHER_ERROR,details:k.INTERSTITIAL_ASSET_ITEM_ERROR,error:w},I=((S=this.schedule)==null?void 0:S.findEventIndex(e.identifier))||-1;this.handleAssetItemError(L,e,I,s,w.message);return}const C=T.edge-T.fragmentStart,A=t.duration;(m||A===null||C>A)&&(m=!1,this.log(`Interstitial asset "${f}" duration change ${A} > ${C}`),t.duration=C,this.updateSchedule())};g.on(y.LEVEL_UPDATED,(T,{details:S})=>p(S)),g.on(y.LEVEL_PTS_UPDATED,(T,{details:S})=>p(S)),g.on(y.EVENT_CUE_ENTER,()=>this.onInterstitialCueEnter());const v=(T,S)=>{const C=this.getAssetPlayer(f);if(C&&S.tracks){C.off(y.BUFFER_CODECS,v),C.tracks=S.tracks;const A=this.primaryMedia;this.bufferingAsset===C.assetItem&&A&&!C.media&&this.bufferAssetPlayer(C,A)}};g.on(y.BUFFER_CODECS,v);const E=()=>{var T;const S=this.getAssetPlayer(f);if(this.log(`buffered to end of asset ${S}`),!S||!this.schedule)return;const C=this.schedule.findEventIndex(e.identifier),A=(T=this.schedule.items)==null?void 0:T[C];this.isInterstitial(A)&&this.advanceAssetBuffering(A,t)};g.on(y.BUFFERED_TO_END,E);const x=T=>()=>{if(!this.getAssetPlayer(f)||!this.schedule)return;this.shouldPlay=!0;const C=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,C,T)};return g.once(y.MEDIA_ENDED,x(s)),g.once(y.PLAYOUT_LIMIT_REACHED,x(1/0)),g.on(y.ERROR,(T,S)=>{if(!this.schedule)return;const C=this.getAssetPlayer(f);if(S.details===k.BUFFER_STALLED_ERROR){if(C!=null&&C.appendInPlace){this.handleInPlaceStall(e);return}this.onTimeupdate(),this.checkBuffer(!0);return}this.handleAssetItemError(S,e,this.schedule.findEventIndex(e.identifier),s,`Asset player error ${S.error} ${e}`)}),g.on(y.DESTROYING,()=>{if(!this.getAssetPlayer(f)||!this.schedule)return;const S=new Error(`Asset player destroyed unexpectedly ${f}`),C={fatal:!0,type:ie.OTHER_ERROR,details:k.INTERSTITIAL_ASSET_ITEM_ERROR,error:S};this.handleAssetItemError(C,e,this.schedule.findEventIndex(e.identifier),s,S.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${yi(t)}`),this.hls.trigger(y.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:s,event:e,player:g}),g}clearInterstitial(e,t){this.clearAssetPlayers(e,t),e.reset()}clearAssetPlayers(e,t){e.assetList.forEach(s=>{this.clearAssetPlayer(s.identifier,t)})}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const s=this.playerQueue[t];this.transferMediaFromPlayer(s,null),s.resetDetails()}}clearAssetPlayer(e,t){const s=this.getAssetPlayerQueueIndex(e);if(s!==-1){const r=this.playerQueue[s];this.log(`clear ${r} toSegment: ${t&&Ot(t)}`),this.transferMediaFromPlayer(r,t),this.playerQueue.splice(s,1),r.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,s,r,n){const{interstitial:a,assetItem:o,assetId:l}=e,c=a.assetList.length,u=this.playingAsset;this.endedAsset=null,this.playingAsset=o,(!u||u.identifier!==l)&&(u&&(this.clearAssetPlayer(u.identifier,s[r]),delete u.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${c} ${yi(o)}`),this.hls.trigger(y.INTERSTITIAL_ASSET_STARTED,{asset:o,assetListIndex:t,event:a,schedule:s.slice(0),scheduleIndex:r,player:e})),this.bufferAssetPlayer(e,n)}bufferAssetPlayer(e,t){var s,r;if(!this.schedule)return;const{interstitial:n,assetItem:a}=e,o=this.schedule.findEventIndex(n.identifier),l=(s=this.schedule.items)==null?void 0:s[o];if(!l)return;e.loadSource(),this.setBufferingItem(l),this.bufferingAsset=a;const c=this.getBufferingPlayer();if(c===e)return;const u=n.appendInPlace;if(u&&c?.interstitial.appendInPlace===!1)return;const f=c?.tracks||((r=this.detachedData)==null?void 0:r.tracks)||this.requiredTracks;if(u&&a!==this.playingAsset){if(!e.tracks){this.log(`Waiting for track info before buffering ${e}`);return}if(f&&!Nd(f,e.tracks)){const d=new Error(`Asset ${yi(a)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(f)}')`),h={fatal:!0,type:ie.OTHER_ERROR,details:k.INTERSTITIAL_ASSET_ITEM_ERROR,error:d},g=n.findAssetIndex(a);this.handleAssetItemError(h,n,o,g,d.message);return}}this.transferMediaTo(e,t)}handleInPlaceStall(e){const t=this.schedule,s=this.primaryMedia;if(!t||!s)return;const r=s.currentTime,n=t.findAssetIndex(e,r),a=e.assetList[n];if(a){const o=this.getAssetPlayer(a.identifier);if(o){const l=o.currentTime||r-a.timelineStart,c=o.duration-l;if(this.warn(`Stalled at ${l} of ${l+c} in ${o} ${e} (media.currentTime: ${r})`),l&&(c/s.playbackRate<.5||o.bufferedInPlaceToEnd(s))&&o.hls){const u=t.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,u,n)}}}}advanceInPlace(e){const t=this.primaryMedia;t&&t.currentTime<e&&(t.currentTime=e)}handleAssetItemError(e,t,s,r,n){if(e.details===k.BUFFER_STALLED_ERROR)return;const a=t.assetList[r]||null;if(this.warn(`INTERSTITIAL_ASSET_ERROR ${a&&yi(a)} ${e.error}`),!this.schedule)return;const o=a?.identifier||"",l=this.getAssetPlayerQueueIndex(o),c=this.playerQueue[l]||null,u=this.schedule.items,f=we({},e,{fatal:!1,errorAction:Ai(!0),asset:a,assetListIndex:r,event:t,schedule:u,scheduleIndex:s,player:c});if(this.hls.trigger(y.INTERSTITIAL_ASSET_ERROR,f),!e.fatal)return;const d=this.playingAsset,h=this.bufferingAsset,g=new Error(n);if(a&&(this.clearAssetPlayer(o,null),a.error=g),!t.assetList.some(m=>!m.error))t.error=g;else for(let m=r;m<t.assetList.length;m++)this.resetAssetPlayer(t.assetList[m].identifier);this.updateSchedule(!0),t.error?this.primaryFallback(t):d&&d.identifier===o?this.advanceAfterAssetEnded(t,s,r):h&&h.identifier===o&&this.isInterstitial(this.bufferingItem)&&this.advanceAssetBuffering(this.bufferingItem,h)}primaryFallback(e){const t=e.timelineStart,s=this.effectivePlayingItem;let r=this.timelinePos;if(s){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${r} playing: ${Ot(s)} error: ${e.error}`),r===-1&&(r=this.hls.startPosition);const a=this.updateItem(s,r);this.itemsMatch(s,a)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t))}else if(r===-1){this.checkStart();return}if(!this.schedule)return;const n=this.schedule.findItemIndexAtTime(r);this.setSchedulePosition(n)}onAssetListLoaded(e,t){var s,r;const n=t.event,a=n.identifier,o=t.assetListResponse.ASSETS;if(!((s=this.schedule)!=null&&s.hasEvent(a)))return;const l=n.timelineStart,c=n.duration;let u=0;o.forEach((m,p)=>{const v=parseFloat(m.DURATION);this.createAsset(n,p,u,l+u,v,m.URI),u+=v}),n.duration=u,this.log(`Loaded asset-list with duration: ${u} (was: ${c}) ${n}`);const f=this.waitingItem,d=f?.event.identifier===a;this.updateSchedule();const h=(r=this.bufferingItem)==null?void 0:r.event;if(d){var g;const m=this.schedule.findEventIndex(a),p=(g=this.schedule.items)==null?void 0:g[m];if(p){if(!this.playingItem&&this.timelinePos>p.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==m){n.error=new Error(`Interstitial ${o.length?"no longer within playback range":"asset-list is empty"} ${this.timelinePos} ${n}`),this.log(n.error.message),this.updateSchedule(!0),this.primaryFallback(n);return}this.setBufferingItem(p)}this.setSchedulePosition(m)}else if(h?.identifier===a){const m=n.assetList[0];if(m){const p=this.getAssetPlayer(m.identifier);if(h.appendInPlace){const v=this.primaryMedia;p&&v&&this.bufferAssetPlayer(p,v)}else p&&p.loadSource()}}}onError(e,t){if(this.schedule)switch(t.details){case k.ASSET_LIST_PARSING_ERROR:case k.ASSET_LIST_LOAD_ERROR:case k.ASSET_LIST_LOAD_TIMEOUT:{const s=t.interstitial;s&&(this.updateSchedule(!0),this.primaryFallback(s));break}case k.BUFFER_STALLED_ERROR:{const s=this.endedItem||this.waitingItem||this.playingItem;if(this.isInterstitial(s)&&s.event.appendInPlace){this.handleInPlaceStall(s.event);return}this.log(`Primary player stall @${this.timelinePos} bufferedPos: ${this.bufferedPos}`),this.onTimeupdate(),this.checkBuffer(!0);break}}}}const Pu=500;class Gx extends pl{constructor(e,t,s){super(e,t,s,"subtitle-stream-controller",se.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(y.LEVEL_LOADED,this.onLevelLoaded,this),e.on(y.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(y.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(y.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(y.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(y.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(y.LEVEL_LOADED,this.onLevelLoaded,this),e.off(y.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(y.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(y.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(y.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(y.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=N.IDLE,this.setInterval(Pu),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:s,success:r}=t;if(this.fragContextChanged(s)||(Ve(s)&&(this.fragPrevious=s),this.state=N.IDLE),!r)return;const n=this.tracksBuffered[this.currentTrackId];if(!n)return;let a;const o=s.start;for(let c=0;c<n.length;c++)if(o>=n[c].start&&o<=n[c].end){a=n[c];break}const l=s.start+s.duration;a?a.end=l:(a={start:o,end:l},n.push(a)),this.fragmentTracker.fragBuffered(s),this.fragBufferedComplete(s,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:s,endOffset:r}=t;if(s===0&&r!==Number.POSITIVE_INFINITY){const n=r-1;if(n<=0)return;t.endOffsetSubtitles=Math.max(0,n),this.tracksBuffered.forEach(a=>{for(let o=0;o<a.length;){if(a[o].end<=n){a.shift();continue}else if(a[o].start<n)a[o].start=n;else break;o++}}),this.fragmentTracker.removeFragmentsInRange(s,n,se.SUBTITLE)}}onError(e,t){const s=t.frag;s?.type===se.SUBTITLE&&(t.details===k.FRAG_GAP&&this.fragmentTracker.fragBuffered(s,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==N.STOPPED&&(this.state=N.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&Uh(this.levels,t)){this.levels=t.map(s=>new fr(s));return}this.tracksBuffered=[],this.levels=t.map(s=>{const r=new fr(s);return this.tracksBuffered[r.id]=[],r}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,se.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var s;if(this.currentTrackId=t.id,!((s=this.levels)!=null&&s.length)||this.currentTrackId===-1){this.clearInterval();return}const r=this.levels[this.currentTrackId];r!=null&&r.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,r&&this.state!==N.STOPPED&&this.setInterval(Pu)}onSubtitleTrackLoaded(e,t){var s;const{currentTrackId:r,levels:n}=this,{details:a,id:o}=t;if(!n){this.warn(`Subtitle tracks were reset while loading level ${o}`);return}const l=n[o];if(o>=n.length||!l)return;this.log(`Subtitle track ${o} loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""},duration:${a.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let c=0;if(a.live||(s=l.details)!=null&&s.live){if(a.deltaUpdateFailed)return;const f=this.mainDetails;if(!f){this.startFragRequested=!1;return}const d=f.fragments[0];if(!l.details)a.hasProgramDateTime&&f.hasProgramDateTime?(Ln(a,f),c=a.fragmentStart):d&&(c=d.start,fo(a,c));else{var u;c=this.alignPlaylists(a,l.details,(u=this.levelLastLoaded)==null?void 0:u.details),c===0&&d&&(c=d.start,fo(a,c))}f&&!this.startFragRequested&&this.setStartPosition(f,c)}l.details=a,this.levelLastLoaded=l,o===r&&(this.hls.trigger(y.SUBTITLE_TRACK_UPDATED,{details:a,id:o,groupId:t.groupId}),this.tick(),a.live&&!this.fragCurrent&&this.media&&this.state===N.IDLE&&(ii(null,a.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),l.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:s}=e,r=t.decryptdata,n=this.hls;if(!this.fragContextChanged(t)&&s&&s.byteLength>0&&r!=null&&r.key&&r.iv&&Ii(r.method)){const a=performance.now();this.decrypter.decrypt(new Uint8Array(s),r.key.buffer,r.iv.buffer,gl(r.method)).catch(o=>{throw n.trigger(y.ERROR,{type:ie.MEDIA_ERROR,details:k.FRAG_DECRYPT_ERROR,fatal:!1,error:o,reason:o.message,frag:t}),o}).then(o=>{const l=performance.now();n.trigger(y.FRAG_DECRYPTED,{frag:t,payload:o,stats:{tstart:a,tdecrypt:l}})}).catch(o=>{this.warn(`${o.name}: ${o.message}`),this.state=N.IDLE})}}doTick(){if(!this.media){this.state=N.IDLE;return}if(this.state===N.IDLE){const{currentTrackId:e,levels:t}=this,s=t?.[e];if(!s||!t.length||!s.details||this.waitForLive(s))return;const{config:r}=this,n=this.getLoadPosition(),a=fe.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],n,r.maxBufferHole),{end:o,len:l}=a,c=s.details,u=this.hls.maxBufferLength+c.levelTargetDuration;if(l>u)return;const f=c.fragments,d=f.length,h=c.edge;let g=null;const m=this.fragPrevious;if(o<h){const E=r.maxFragLookUpTolerance,x=o>h-E?0:E;g=ii(m,f,Math.max(f[0].start,o),x),!g&&m&&m.start<f[0].start&&(g=f[0])}else g=f[d-1];if(g=this.filterReplacedPrimary(g,s.details),!g)return;const p=g.sn-c.startSN,v=f[p-1];if(v&&v.cc===g.cc&&this.fragmentTracker.getState(v)===je.NOT_LOADED&&(g=v),this.fragmentTracker.getState(g)===je.NOT_LOADED){const E=this.mapToInitFragWhenRequired(g);E&&this.loadFragment(E,s,o)}}}loadFragment(e,t,s){Ve(e)?super.loadFragment(e,t,s):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new Vx(this.tracksBuffered[this.currentTrackId]||[])}}class Vx{constructor(e){this.buffered=void 0;const t=(s,r,n)=>{if(r=r>>>0,r>n-1)throw new DOMException(`Failed to execute '${s}' on 'TimeRanges': The index provided (${r}) is greater than the maximum bound (${n})`);return e[r][s]};this.buffered={get length(){return e.length},end(s){return t("end",s,e.length)},start(s){return t("start",s,e.length)}}}}const Kx={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},s0=i=>String.fromCharCode(Kx[i]||i),Mt=15,as=100,Hx={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},jx={17:2,18:4,21:6,22:8,23:10,19:13,20:15},Wx={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},Yx={25:2,26:4,29:6,30:8,31:10,27:13,28:15},zx=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class qx{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const s=typeof t=="function"?t():t;Ce.log(`${this.time} [${e}] ${s}`)}}}const qs=function(e){const t=[];for(let s=0;s<e.length;s++)t.push(e[s].toString(16));return t};class i0{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let s=0;s<t.length;s++){const r=t[s];e.hasOwnProperty(r)&&(this[r]=e[r])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class Xx{constructor(){this.uchar=" ",this.penState=new i0}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class Qx{constructor(e){this.chars=[],this.pos=0,this.currPenState=new i0,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<as;t++)this.chars.push(new Xx);this.logger=e}equals(e){for(let t=0;t<as;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<as;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<as;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>as&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=as)}moveCursor(e){const t=this.pos+e;if(e>1)for(let s=this.pos+1;s<t+1;s++)this.chars[s].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=s0(e);if(this.pos>=as){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<as;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let s=0;s<as;s++){const r=this.chars[s].uchar;r!==" "&&(t=!1),e.push(r)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class Ra{constructor(e){this.rows=[],this.currRow=Mt-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<Mt;t++)this.rows.push(new Qx(e));this.logger=e}reset(){for(let e=0;e<Mt;e++)this.rows[e].clear();this.currRow=Mt-1}equals(e){let t=!0;for(let s=0;s<Mt;s++)if(!this.rows[s].equals(e.rows[s])){t=!1;break}return t}copy(e){for(let t=0;t<Mt;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<Mt;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+Pe(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let o=0;o<Mt;o++)this.rows[o].clear();const n=this.currRow+1-this.nrRollUpRows,a=this.lastOutputScreen;if(a){const o=a.rows[n].cueStartTime,l=this.logger.time;if(o!==null&&l!==null&&o<l)for(let c=0;c<this.nrRollUpRows;c++)this.rows[t-this.nrRollUpRows+c+1].copy(a.rows[n+c])}}this.currRow=t;const s=this.rows[this.currRow];if(e.indent!==null){const n=e.indent,a=Math.max(n-1,0);s.setCursor(e.indent),e.color=s.chars[a].penState.foreground}const r={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(r)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+Pe(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let s="",r=-1;for(let n=0;n<Mt;n++){const a=this.rows[n].getTextString();a&&(r=n+1,e?t.push("Row "+r+": '"+a+"'"):t.push(a.trim()))}return t.length>0&&(e?s="["+t.join(" | ")+"]":s=t.join(`
`)),s}getTextAndFormat(){return this.rows}}class Ou{constructor(e,t,s){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new Ra(s),this.nonDisplayedMemory=new Ra(s),this.lastOutputScreen=new Ra(s),this.currRollUpRow=this.displayedMemory.rows[Mt-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=s}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[Mt-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let s=0;s<e.length;s++)this.writeScreen.insertChar(e[s]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const s=Math.floor(e/2)-16,r=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=r[s]}this.logger.log(2,"MIDROW: "+Pe(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class Mu{constructor(e,t,s){this.channels=void 0,this.currentChannel=0,this.cmdHistory=Jx(),this.logger=void 0;const r=this.logger=new qx;this.channels=[null,new Ou(e,t,r),new Ou(e+1,s,r)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let s=0;s<t.length;s+=2){const r=t[s]&127,n=t[s+1]&127;let a=!1,o=null;if(r===0&&n===0)continue;this.logger.log(3,()=>"["+qs([t[s],t[s+1]])+"] -> ("+qs([r,n])+")");const l=this.cmdHistory;if(r>=16&&r<=31){if(Zx(r,n,l)){Nr(null,null,l),this.logger.log(3,()=>"Repeated command ("+qs([r,n])+") is dropped");continue}Nr(r,n,this.cmdHistory),a=this.parseCmd(r,n),a||(a=this.parseMidrow(r,n)),a||(a=this.parsePAC(r,n)),a||(a=this.parseBackgroundAttributes(r,n))}else Nr(null,null,l);if(!a&&(o=this.parseChars(r,n),o)){const u=this.currentChannel;u&&u>0?this.channels[u].insertChars(o):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!a&&!o&&this.logger.log(2,()=>"Couldn't parse cleaned data "+qs([r,n])+" orig: "+qs([t[s],t[s+1]]))}}parseCmd(e,t){const s=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,r=(e===23||e===31)&&t>=33&&t<=35;if(!(s||r))return!1;const n=e===20||e===21||e===23?1:2,a=this.channels[n];return e===20||e===21||e===28||e===29?t===32?a.ccRCL():t===33?a.ccBS():t===34?a.ccAOF():t===35?a.ccAON():t===36?a.ccDER():t===37?a.ccRU(2):t===38?a.ccRU(3):t===39?a.ccRU(4):t===40?a.ccFON():t===41?a.ccRDC():t===42?a.ccTR():t===43?a.ccRTD():t===44?a.ccEDM():t===45?a.ccCR():t===46?a.ccENM():t===47&&a.ccEOC():a.ccTO(t-32),this.currentChannel=n,!0}parseMidrow(e,t){let s=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?s=1:s=2,s!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const r=this.channels[s];return r?(r.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+qs([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let s;const r=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,n=(e===16||e===24)&&t>=64&&t<=95;if(!(r||n))return!1;const a=e<=23?1:2;t>=64&&t<=95?s=a===1?Hx[e]:Wx[e]:s=a===1?jx[e]:Yx[e];const o=this.channels[a];return o?(o.setPAC(this.interpretPAC(s,t)),this.currentChannel=a,!0):!1}interpretPAC(e,t){let s;const r={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?s=t-96:s=t-64,r.underline=(s&1)===1,s<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(s/2)]:s<=15?(r.italics=!0,r.color="white"):r.indent=Math.floor((s-16)/2)*4,r}parseChars(e,t){let s,r=null,n=null;if(e>=25?(s=2,n=e-8):(s=1,n=e),n>=17&&n<=19){let a;n===17?a=t+80:n===18?a=t+112:a=t+144,this.logger.log(2,()=>"Special char '"+s0(a)+"' in channel "+s),r=[a]}else e>=32&&e<=127&&(r=t===0?[e]:[e,t]);return r&&this.logger.log(3,()=>"Char codes =  "+qs(r).join(",")),r}parseBackgroundAttributes(e,t){const s=(e===16||e===24)&&t>=32&&t<=47,r=(e===23||e===31)&&t>=45&&t<=47;if(!(s||r))return!1;let n;const a={};e===16||e===24?(n=Math.floor((t-32)/2),a.background=zx[n],t%2===1&&(a.background=a.background+"_semi")):t===45?a.background="transparent":(a.foreground="black",t===47&&(a.underline=!0));const o=e<=23?1:2;return this.channels[o].setBkgData(a),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}Nr(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const s=this.channels[t];s&&s.cueSplitAtTime(e)}}}function Nr(i,e,t){t.a=i,t.b=e}function Zx(i,e,t){return t.a===i&&t.b===e}function Jx(){return{a:null,b:null}}var Rl=(function(){if(In!=null&&In.VTTCue)return self.VTTCue;const i=["","lr","rl"],e=["start","middle","end","left","right"];function t(o,l){if(typeof l!="string"||!Array.isArray(o))return!1;const c=l.toLowerCase();return~o.indexOf(c)?c:!1}function s(o){return t(i,o)}function r(o){return t(e,o)}function n(o,...l){let c=1;for(;c<arguments.length;c++){const u=arguments[c];for(const f in u)o[f]=u[f]}return o}function a(o,l,c){const u=this,f={enumerable:!0};u.hasBeenReset=!1;let d="",h=!1,g=o,m=l,p=c,v=null,E="",x=!0,T="auto",S="start",C=50,A="middle",w=50,L="middle";Object.defineProperty(u,"id",n({},f,{get:function(){return d},set:function(I){d=""+I}})),Object.defineProperty(u,"pauseOnExit",n({},f,{get:function(){return h},set:function(I){h=!!I}})),Object.defineProperty(u,"startTime",n({},f,{get:function(){return g},set:function(I){if(typeof I!="number")throw new TypeError("Start time must be set to a number.");g=I,this.hasBeenReset=!0}})),Object.defineProperty(u,"endTime",n({},f,{get:function(){return m},set:function(I){if(typeof I!="number")throw new TypeError("End time must be set to a number.");m=I,this.hasBeenReset=!0}})),Object.defineProperty(u,"text",n({},f,{get:function(){return p},set:function(I){p=""+I,this.hasBeenReset=!0}})),Object.defineProperty(u,"region",n({},f,{get:function(){return v},set:function(I){v=I,this.hasBeenReset=!0}})),Object.defineProperty(u,"vertical",n({},f,{get:function(){return E},set:function(I){const O=s(I);if(O===!1)throw new SyntaxError("An invalid or illegal string was specified.");E=O,this.hasBeenReset=!0}})),Object.defineProperty(u,"snapToLines",n({},f,{get:function(){return x},set:function(I){x=!!I,this.hasBeenReset=!0}})),Object.defineProperty(u,"line",n({},f,{get:function(){return T},set:function(I){if(typeof I!="number"&&I!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");T=I,this.hasBeenReset=!0}})),Object.defineProperty(u,"lineAlign",n({},f,{get:function(){return S},set:function(I){const O=r(I);if(!O)throw new SyntaxError("An invalid or illegal string was specified.");S=O,this.hasBeenReset=!0}})),Object.defineProperty(u,"position",n({},f,{get:function(){return C},set:function(I){if(I<0||I>100)throw new Error("Position must be between 0 and 100.");C=I,this.hasBeenReset=!0}})),Object.defineProperty(u,"positionAlign",n({},f,{get:function(){return A},set:function(I){const O=r(I);if(!O)throw new SyntaxError("An invalid or illegal string was specified.");A=O,this.hasBeenReset=!0}})),Object.defineProperty(u,"size",n({},f,{get:function(){return w},set:function(I){if(I<0||I>100)throw new Error("Size must be between 0 and 100.");w=I,this.hasBeenReset=!0}})),Object.defineProperty(u,"align",n({},f,{get:function(){return L},set:function(I){const O=r(I);if(!O)throw new SyntaxError("An invalid or illegal string was specified.");L=O,this.hasBeenReset=!0}})),u.displayState=void 0}return a.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},a})();class eT{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function r0(i){function e(s,r,n,a){return(s|0)*3600+(r|0)*60+(n|0)+parseFloat(a||0)}const t=i.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}class tT{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,s){return s?this.has(e)?this.values[e]:t[s]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,s){for(let r=0;r<s.length;++r)if(t===s[r]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const s=parseFloat(t);if(s>=0&&s<=100)return this.set(e,s),!0}return!1}}function n0(i,e,t,s){const r=s?i.split(s):[i];for(const n in r){if(typeof r[n]!="string")continue;const a=r[n].split(t);if(a.length!==2)continue;const o=a[0],l=a[1];e(o,l)}}const xo=new Rl(0,0,""),$r=xo.align==="middle"?"middle":"center";function sT(i,e,t){const s=i;function r(){const o=r0(i);if(o===null)throw new Error("Malformed timestamp: "+s);return i=i.replace(/^[^\sa-zA-Z-]+/,""),o}function n(o,l){const c=new tT;n0(o,function(d,h){let g;switch(d){case"region":for(let m=t.length-1;m>=0;m--)if(t[m].id===h){c.set(d,t[m].region);break}break;case"vertical":c.alt(d,h,["rl","lr"]);break;case"line":g=h.split(","),c.integer(d,g[0]),c.percent(d,g[0])&&c.set("snapToLines",!1),c.alt(d,g[0],["auto"]),g.length===2&&c.alt("lineAlign",g[1],["start",$r,"end"]);break;case"position":g=h.split(","),c.percent(d,g[0]),g.length===2&&c.alt("positionAlign",g[1],["start",$r,"end","line-left","line-right","auto"]);break;case"size":c.percent(d,h);break;case"align":c.alt(d,h,["start",$r,"end","left","right"]);break}},/:/,/\s/),l.region=c.get("region",null),l.vertical=c.get("vertical","");let u=c.get("line","auto");u==="auto"&&xo.line===-1&&(u=-1),l.line=u,l.lineAlign=c.get("lineAlign","start"),l.snapToLines=c.get("snapToLines",!0),l.size=c.get("size",100),l.align=c.get("align",$r);let f=c.get("position","auto");f==="auto"&&xo.position===50&&(f=l.align==="start"||l.align==="left"?0:l.align==="end"||l.align==="right"?100:50),l.position=f}function a(){i=i.replace(/^\s+/,"")}if(a(),e.startTime=r(),a(),i.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+s);i=i.slice(3),a(),e.endTime=r(),a(),n(i,e)}function a0(i){return i.replace(/<br(?: \/)?>/gi,`
`)}class iT{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new eT,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function s(){let n=t.buffer,a=0;for(n=a0(n);a<n.length&&n[a]!=="\r"&&n[a]!==`
`;)++a;const o=n.slice(0,a);return n[a]==="\r"&&++a,n[a]===`
`&&++a,t.buffer=n.slice(a),o}function r(n){n0(n,function(a,o){},/:/)}try{let n="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;n=s();const o=n.match(/^()?WEBVTT([ \t].*)?$/);if(!(o!=null&&o[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let a=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(a?a=!1:n=s(),t.state){case"HEADER":/:/.test(n)?r(n):n||(t.state="ID");continue;case"NOTE":n||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(n)){t.state="NOTE";break}if(!n)continue;if(t.cue=new Rl(0,0,""),t.state="CUE",n.indexOf("-->")===-1){t.cue.id=n;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{sT(n,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const o=n.indexOf("-->")!==-1;if(!n||o&&(a=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=n}continue;case"BADCUE":n||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const rT=/\r\n|\n\r|\n|\r/g,Ca=function(e,t,s=0){return e.slice(s,s+t.length)===t},nT=function(e){let t=parseInt(e.slice(-3));const s=parseInt(e.slice(-6,-4)),r=parseInt(e.slice(-9,-7)),n=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!J(t)||!J(s)||!J(r)||!J(n))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*s,t+=60*1e3*r,t+=3600*1e3*n,t};function Cl(i,e,t){return Ji(i.toString())+Ji(e.toString())+Ji(t)}const aT=function(e,t,s){let r=e[t],n=e[r.prevCC];if(!n||!n.new&&r.new){e.ccOffset=e.presentationOffset=r.start,r.new=!1;return}for(;(a=n)!=null&&a.new;){var a;e.ccOffset+=r.start-n.start,r.new=!1,r=n,n=e[r.prevCC]}e.presentationOffset=s};function oT(i,e,t,s,r,n,a){const o=new iT,l=_t(new Uint8Array(i)).trim().replace(rT,`
`).split(`
`),c=[],u=e?hE(e.baseTime,e.timescale):0;let f="00:00.000",d=0,h=0,g,m=!0;o.oncue=function(p){const v=t[s];let E=t.ccOffset;const x=(d-u)/9e4;if(v!=null&&v.new&&(h!==void 0?E=t.ccOffset=v.start:aT(t,s,x)),x){if(!e){g=new Error("Missing initPTS for VTT MPEGTS");return}E=x-t.presentationOffset}const T=p.endTime-p.startTime,S=St((p.startTime+E-h)*9e4,r*9e4)/9e4;p.startTime=Math.max(S,0),p.endTime=Math.max(S+T,0);const C=p.text.trim();p.text=decodeURIComponent(encodeURIComponent(C)),p.id||(p.id=Cl(p.startTime,p.endTime,C)),p.endTime>0&&c.push(p)},o.onparsingerror=function(p){g=p},o.onflush=function(){if(g){a(g);return}n(c)},l.forEach(p=>{if(m)if(Ca(p,"X-TIMESTAMP-MAP=")){m=!1,p.slice(16).split(",").forEach(v=>{Ca(v,"LOCAL:")?f=v.slice(6):Ca(v,"MPEGTS:")&&(d=parseInt(v.slice(7)))});try{h=nT(f)/1e3}catch(v){g=v}return}else p===""&&(m=!1);o.parse(p+`
`)}),o.flush()}const wa="stpp.ttml.im1t",o0=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,l0=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,lT={left:"start",center:"center",right:"end",start:"start",end:"end"};function Fu(i,e,t,s){const r=ve(new Uint8Array(i),["mdat"]);if(r.length===0){s(new Error("Could not parse IMSC1 mdat"));return}const n=r.map(o=>_t(o)),a=dE(e.baseTime,1,e.timescale);try{n.forEach(o=>t(cT(o,a)))}catch(o){s(o)}}function cT(i,e){const r=new DOMParser().parseFromString(i,"text/xml").getElementsByTagName("tt")[0];if(!r)throw new Error("Invalid ttml");const n={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},a=Object.keys(n).reduce((f,d)=>(f[d]=r.getAttribute(`ttp:${d}`)||n[d],f),{}),o=r.getAttribute("xml:space")!=="preserve",l=Nu(Da(r,"styling","style")),c=Nu(Da(r,"layout","region")),u=Da(r,"body","[begin]");return[].map.call(u,f=>{const d=c0(f,o);if(!d||!f.hasAttribute("begin"))return null;const h=Pa(f.getAttribute("begin"),a),g=Pa(f.getAttribute("dur"),a);let m=Pa(f.getAttribute("end"),a);if(h===null)throw $u(f);if(m===null){if(g===null)throw $u(f);m=h+g}const p=new Rl(h-e,m-e,d);p.id=Cl(p.startTime,p.endTime,p.text);const v=c[f.getAttribute("region")],E=l[f.getAttribute("style")],x=uT(v,E,l),{textAlign:T}=x;if(T){const S=lT[T];S&&(p.lineAlign=S),p.align=T}return we(p,x),p}).filter(f=>f!==null)}function Da(i,e,t){const s=i.getElementsByTagName(e)[0];return s?[].slice.call(s.querySelectorAll(t)):[]}function Nu(i){return i.reduce((e,t)=>{const s=t.getAttribute("xml:id");return s&&(e[s]=t),e},{})}function c0(i,e){return[].slice.call(i.childNodes).reduce((t,s,r)=>{var n;return s.nodeName==="br"&&r?t+`
`:(n=s.childNodes)!=null&&n.length?c0(s,e):e?t+s.textContent.trim().replace(/\s+/g," "):t+s.textContent},"")}function uT(i,e,t){const s="http://www.w3.org/ns/ttml#styling";let r=null;const n=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],a=i!=null&&i.hasAttribute("style")?i.getAttribute("style"):null;return a&&t.hasOwnProperty(a)&&(r=t[a]),n.reduce((o,l)=>{const c=ka(e,s,l)||ka(i,s,l)||ka(r,s,l);return c&&(o[l]=c),o},{})}function ka(i,e,t){return i&&i.hasAttributeNS(e,t)?i.getAttributeNS(e,t):null}function $u(i){return new Error(`Could not parse ttml timestamp ${i}`)}function Pa(i,e){if(!i)return null;let t=r0(i);return t===null&&(o0.test(i)?t=fT(i,e):l0.test(i)&&(t=dT(i,e))),t}function fT(i,e){const t=o0.exec(i),s=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+s/e.frameRate}function dT(i,e){const t=l0.exec(i),s=Number(t[1]);switch(t[2]){case"h":return s*3600;case"m":return s*60;case"ms":return s*1e3;case"f":return s/e.frameRate;case"t":return s/e.tickRate}return s}class Br{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,s){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=s,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class hT{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Uu(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(y.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(y.FRAG_LOADING,this.onFragLoading,this),e.on(y.FRAG_LOADED,this.onFragLoaded,this),e.on(y.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(y.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(y.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(y.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(y.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(y.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(y.FRAG_LOADING,this.onFragLoading,this),e.off(y.FRAG_LOADED,this.onFragLoaded,this),e.off(y.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(y.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(y.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(y.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(y.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new Br(this,"textTrack1"),t=new Br(this,"textTrack2"),s=new Br(this,"textTrack3"),r=new Br(this,"textTrack4");this.cea608Parser1=new Mu(1,e,t),this.cea608Parser2=new Mu(3,s,r)}addCues(e,t,s,r,n){let a=!1;for(let o=n.length;o--;){const l=n[o],c=gT(l[0],l[1],t,s);if(c>=0&&(l[0]=Math.min(l[0],t),l[1]=Math.max(l[1],s),a=!0,c/(s-t)>.5))return}if(a||n.push([t,s]),this.config.renderTextTracksNatively){const o=this.captionsTracks[e];this.Cues.newCue(o,t,s,r)}else{const o=this.Cues.newCue(null,t,s,r);this.hls.trigger(y.CUES_PARSED,{type:"captions",cues:o,track:e})}}onInitPtsFound(e,{frag:t,id:s,initPTS:r,timescale:n,trackId:a}){const{unparsedVttFrags:o}=this;s===se.MAIN&&(this.initPTS[t.cc]={baseTime:r,timescale:n,trackId:a}),o.length&&(this.unparsedVttFrags=[],o.forEach(l=>{this.initPTS[l.frag.cc]?this.onFragLoaded(y.FRAG_LOADED,l):this.hls.trigger(y.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:l.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:s}=this;if(s)for(let r=0;r<s.textTracks.length;r++){const n=s.textTracks[r];if(Bu(n,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return n}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:s,media:r}=this,{label:n,languageCode:a}=t[e],o=this.getExistingTrack(n,a);if(o)s[e]=o,vi(s[e]),Jh(s[e],r);else{const l=this.createTextTrack("captions",n,a);l&&(l[e]=!0,s[e]=l)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const s=t.label,r={_id:e,label:s,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=r,this.hls.trigger(y.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[r]})}createTextTrack(e,t,s){const r=this.media;if(r)return r.addTextTrack(e,t,s)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const s=!!t.transferMedia;if(this.media=null,s)return;const{captionsTracks:r}=this;Object.keys(r).forEach(n=>{vi(r[n]),delete r[n]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=Uu(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let s=0;s<t.length;s++)vi(t[s])}onSubtitleTracksUpdated(e,t){const s=t.subtitleTracks||[],r=s.some(n=>n.textCodec===wa);if(this.config.enableWebVTT||r&&this.config.enableIMSC1){if(Uh(this.tracks,s)){this.tracks=s;return}if(this.textTracks=[],this.tracks=s,this.config.renderTextTracksNatively){const a=this.media,o=a?sn(a.textTracks):null;if(this.tracks.forEach((l,c)=>{let u;if(o){let f=null;for(let d=0;d<o.length;d++)if(o[d]&&Bu(o[d],l)){f=o[d],o[d]=null;break}f&&(u=f)}if(u)vi(u);else{const f=u0(l);u=this.createTextTrack(f,l.name,l.lang),u&&(u.mode="disabled")}u&&this.textTracks.push(u)}),o!=null&&o.length){const l=o.filter(c=>c!==null).map(c=>c.label);l.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${l.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const a=this.tracks.map(o=>({label:o.name,kind:o.type.toLowerCase(),default:o.default,subtitleTrack:o}));this.hls.trigger(y.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:a})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(s=>{const r=/(?:CC|SERVICE)([1-4])/.exec(s.instreamId);if(!r)return;const n=`textTrack${r[1]}`,a=this.captionsProperties[n];a&&(a.label=s.name,s.lang&&(a.languageCode=s.lang),a.media=s)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t?.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===se.MAIN){var s,r;const{cea608Parser1:n,cea608Parser2:a,lastSn:o}=this,{cc:l,sn:c}=t.frag,u=(s=(r=t.part)==null?void 0:r.index)!=null?s:-1;n&&a&&(c!==o+1||c===o&&u!==this.lastPartIndex+1||l!==this.lastCc)&&(n.reset(),a.reset()),this.lastCc=l,this.lastSn=c,this.lastPartIndex=u}}onFragLoaded(e,t){const{frag:s,payload:r}=t;if(s.type===se.SUBTITLE)if(r.byteLength){const n=s.decryptdata,a="stats"in t;if(n==null||!n.encrypted||a){const o=this.tracks[s.level],l=this.vttCCs;l[s.cc]||(l[s.cc]={start:s.start,prevCC:this.prevCC,new:!0},this.prevCC=s.cc),o&&o.textCodec===wa?this._parseIMSC1(s,r):this._parseVTTs(t)}}else this.hls.trigger(y.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const s=this.hls;Fu(t,this.initPTS[e.cc],r=>{this._appendCues(r,e.level),s.trigger(y.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},r=>{s.logger.log(`Failed to parse IMSC1: ${r}`),s.trigger(y.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:r})})}_parseVTTs(e){var t;const{frag:s,payload:r}=e,{initPTS:n,unparsedVttFrags:a}=this,o=n.length-1;if(!n[s.cc]&&o===-1){a.push(e);return}const l=this.hls,c=(t=s.initSegment)!=null&&t.data?kt(s.initSegment.data,new Uint8Array(r)).buffer:r;oT(c,this.initPTS[s.cc],this.vttCCs,s.cc,s.start,u=>{this._appendCues(u,s.level),l.trigger(y.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:s})},u=>{const f=u.message==="Missing initPTS for VTT MPEGTS";f?a.push(e):this._fallbackToIMSC1(s,r),l.logger.log(`Failed to parse VTT cue: ${u}`),!(f&&o>s.cc)&&l.trigger(y.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:s,error:u})})}_fallbackToIMSC1(e,t){const s=this.tracks[e.level];s.textCodec||Fu(t,this.initPTS[e.cc],()=>{s.textCodec=wa,this._parseIMSC1(e,t)},()=>{s.textCodec="wvtt"})}_appendCues(e,t){const s=this.hls;if(this.config.renderTextTracksNatively){const r=this.textTracks[t];if(!r||r.mode==="disabled")return;e.forEach(n=>e0(r,n))}else{const r=this.tracks[t];if(!r)return;const n=r.default?"default":"subtitles"+t;s.trigger(y.CUES_PARSED,{type:"subtitles",cues:e,track:n})}}onFragDecrypted(e,t){const{frag:s}=t;s.type===se.SUBTITLE&&this.onFragLoaded(y.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:s,samples:r}=t;if(!(s.type===se.MAIN&&this.closedCaptionsForLevel(s)==="NONE"))for(let n=0;n<r.length;n++){const a=r[n].bytes;if(a){this.cea608Parser1||this.initCea608Parsers();const o=this.extractCea608Data(a);this.cea608Parser1.addData(r[n].pts,o[0]),this.cea608Parser2.addData(r[n].pts,o[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:s,endOffsetSubtitles:r,type:n}){const{media:a}=this;if(!(!a||a.currentTime<s)){if(!n||n==="video"){const{captionsTracks:o}=this;Object.keys(o).forEach(l=>Eo(o[l],t,s))}if(this.config.renderTextTracksNatively&&t===0&&r!==void 0){const{textTracks:o}=this;Object.keys(o).forEach(l=>Eo(o[l],t,r))}}}extractCea608Data(e){const t=[[],[]],s=e[0]&31;let r=2;for(let n=0;n<s;n++){const a=e[r++],o=127&e[r++],l=127&e[r++];if(o===0&&l===0)continue;if((4&a)!==0){const u=3&a;(u===0||u===1)&&(t[u].push(o),t[u].push(l))}}return t}}function u0(i){return i.characteristics&&/transcribes-spoken-dialog/gi.test(i.characteristics)&&/describes-music-and-sound/gi.test(i.characteristics)?"captions":"subtitles"}function Bu(i,e){return!!i&&i.kind===u0(e)&&mo(e,i)}function gT(i,e,t,s){return Math.min(e,s)-Math.max(i,t)}function Uu(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const mT=/\s/,pT={newCue(i,e,t,s){const r=[];let n,a,o,l,c;const u=self.VTTCue||self.TextTrackCue;for(let d=0;d<s.rows.length;d++)if(n=s.rows[d],o=!0,l=0,c="",!n.isEmpty()){var f;for(let m=0;m<n.chars.length;m++)mT.test(n.chars[m].uchar)&&o?l++:(c+=n.chars[m].uchar,o=!1);n.cueStartTime=e,e===t&&(t+=1e-4),l>=16?l--:l++;const h=a0(c.trim()),g=Cl(e,t,h);i!=null&&(f=i.cues)!=null&&f.getCueById(g)||(a=new u(e,t,h),a.id=g,a.line=d+1,a.align="left",a.position=10+Math.min(80,Math.floor(l*8/32)*10),r.push(a))}return i&&r.length&&(r.sort((d,h)=>d.line==="auto"||h.line==="auto"?0:d.line>8&&h.line>8?h.line-d.line:d.line-h.line),r.forEach(d=>e0(i,d))),r}};function yT(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const vT=/(\d+)-(\d+)\/(\d+)/;class Gu{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||ST,this.controller=new self.AbortController,this.stats=new ol}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,s){const r=this.stats;if(r.loading.start)throw new Error("Loader can only be used once.");r.loading.start=self.performance.now();const n=ET(e,this.controller.signal),a=e.responseType==="arraybuffer",o=a?"byteLength":"length",{maxTimeToFirstByteMs:l,maxLoadTimeMs:c}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=s,this.request=this.fetchSetup(e,n),self.clearTimeout(this.requestTimeout),t.timeout=l&&J(l)?l:c,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))},t.timeout),(gr(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(f=>{var d;this.response=this.loader=f;const h=Math.max(self.performance.now(),r.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=c,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))},c-(h-r.loading.start)),!f.ok){const{status:m,statusText:p}=f;throw new bT(p||"fetch, bad network response",m,f)}r.loading.first=h,r.total=TT(f.headers)||r.total;const g=(d=this.callbacks)==null?void 0:d.onProgress;return g&&J(t.highWaterMark)?this.loadProgressively(f,r,e,t.highWaterMark,g):a?f.arrayBuffer():e.responseType==="json"?f.json():f.text()}).then(f=>{var d,h;const g=this.response;if(!g)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),r.loading.end=Math.max(self.performance.now(),r.loading.first);const m=f[o];m&&(r.loaded=r.total=m);const p={url:g.url,data:f,code:g.status},v=(d=this.callbacks)==null?void 0:d.onProgress;v&&!J(t.highWaterMark)&&v(r,e,f,g),(h=this.callbacks)==null||h.onSuccess(p,r,e,g)}).catch(f=>{var d;if(self.clearTimeout(this.requestTimeout),r.aborted)return;const h=f&&f.code||0,g=f?f.message:null;(d=this.callbacks)==null||d.onError({code:h,text:g},e,f?f.details:null,r)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,s,r=0,n){const a=new xh,o=e.body.getReader(),l=()=>o.read().then(c=>{if(c.done)return a.dataLength&&n(t,s,a.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const u=c.value,f=u.length;return t.loaded+=f,f<r||a.dataLength?(a.push(u),a.dataLength>=r&&n(t,s,a.flush().buffer,e)):n(t,s,u.buffer,e),l()}).catch(()=>Promise.reject());return l()}}function ET(i,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(we({},i.headers))};return i.rangeEnd&&t.headers.set("Range","bytes="+i.rangeStart+"-"+String(i.rangeEnd-1)),t}function xT(i){const e=vT.exec(i);if(e)return parseInt(e[2])-parseInt(e[1])+1}function TT(i){const e=i.get("Content-Range");if(e){const s=xT(e);if(J(s))return s}const t=i.get("Content-Length");if(t)return parseInt(t)}function ST(i,e){return new self.Request(i.url,e)}class bT extends Error{constructor(e,t,s){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=s}}const AT=/^age:\s*[\d.]+\s*$/im;class f0{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new ol,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,s){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=s,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const s=this.loader=new self.XMLHttpRequest,r=this.stats;r.loading.first=0,r.loaded=0,r.aborted=!1;const n=this.xhrSetup;n?Promise.resolve().then(()=>{if(!(this.loader!==s||this.stats.aborted))return n(s,t.url)}).catch(a=>{if(!(this.loader!==s||this.stats.aborted))return s.open("GET",t.url,!0),n(s,t.url)}).then(()=>{this.loader!==s||this.stats.aborted||this.openAndSendXhr(s,t,e)}).catch(a=>{var o;(o=this.callbacks)==null||o.onError({code:s.status,text:a.message},t,s,r)}):this.openAndSendXhr(s,t,e)}openAndSendXhr(e,t,s){e.readyState||e.open("GET",t.url,!0);const r=t.headers,{maxTimeToFirstByteMs:n,maxLoadTimeMs:a}=s.loadPolicy;if(r)for(const o in r)e.setRequestHeader(o,r[o]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),s.timeout=n&&J(n)?n:a,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:s}=this;if(!e||!t)return;const r=t.readyState,n=this.config;if(!s.aborted&&r>=2&&(s.loading.first===0&&(s.loading.first=Math.max(self.performance.now(),s.loading.start),n.timeout!==n.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),n.timeout=n.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.loadPolicy.maxLoadTimeMs-(s.loading.first-s.loading.start)))),r===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const c=t.status,u=t.responseType==="text"?t.responseText:null;if(c>=200&&c<300){const g=u??t.response;if(g!=null){var a,o;s.loading.end=Math.max(self.performance.now(),s.loading.first);const m=t.responseType==="arraybuffer"?g.byteLength:g.length;s.loaded=s.total=m,s.bwEstimate=s.total*8e3/(s.loading.end-s.loading.first);const p=(a=this.callbacks)==null?void 0:a.onProgress;p&&p(s,e,g,t);const v={url:t.responseURL,data:g,code:c};(o=this.callbacks)==null||o.onSuccess(v,s,e,t);return}}const f=n.loadPolicy.errorRetry,d=s.retry,h={url:e.url,data:void 0,code:c};if(bn(f,d,!1,h))this.retry(f);else{var l;Ce.error(`${c} while loading ${e.url}`),(l=this.callbacks)==null||l.onError({code:c,text:t.statusText},e,t,s)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(bn(e,t,!0))this.retry(e);else{var s;Ce.warn(`timeout while loading ${(s=this.context)==null?void 0:s.url}`);const r=this.callbacks;r&&(this.abortInternal(),r.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:s}=this;this.retryDelay=fl(e,s.retry),s.retry++,Ce.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t?.url}, retrying ${s.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&AT.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const IT={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},LT=Re(Re({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:f0,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:$y,bufferController:RE,capLevelController:Il,errorController:Ky,fpsController:Cx,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:ch,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:IT},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},_T()),{},{subtitleStreamController:Gx,subtitleTrackController:kx,timelineController:hT,audioStreamController:AE,audioTrackController:IE,emeController:Li,cmcdController:Ix,contentSteeringController:_x,interstitialsController:Ux});function _T(){return{cueHandler:pT,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function RT(i,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const s=To(i),r=["manifest","level","frag"],n=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return r.forEach(a=>{const o=`${a==="level"?"playlist":a}LoadPolicy`,l=e[o]===void 0,c=[];n.forEach(u=>{const f=`${a}Loading${u}`,d=e[f];if(d!==void 0&&l){c.push(f);const h=s[o].default;switch(e[o]={default:h},u){case"TimeOut":h.maxLoadTimeMs=d,h.maxTimeToFirstByteMs=d;break;case"MaxRetry":h.errorRetry.maxNumRetry=d,h.timeoutRetry.maxNumRetry=d;break;case"RetryDelay":h.errorRetry.retryDelayMs=d,h.timeoutRetry.retryDelayMs=d;break;case"MaxRetryTimeout":h.errorRetry.maxRetryDelayMs=d,h.timeoutRetry.maxRetryDelayMs=d;break}}}),c.length&&t.warn(`hls.js config: "${c.join('", "')}" setting(s) are deprecated, use "${o}": ${Pe(e[o])}`)}),Re(Re({},s),e)}function To(i){return i&&typeof i=="object"?Array.isArray(i)?i.map(To):Object.keys(i).reduce((e,t)=>(e[t]=To(i[t]),e),{}):i}function CT(i,e){const t=i.loader;t!==Gu&&t!==f0?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),i.progressive=!1):yT()&&(i.loader=Gu,i.progressive=!0,i.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const rn=2,wT=.1,DT=.05,kT=100;class PT extends rh{constructor(e,t){super("gap-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var s;(s=this.media)!=null&&s.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var s;this.ended=((s=this.media)==null?void 0:s.currentTime)||1,this.hls.trigger(y.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(y.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(y.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(kT),this.mediaSource=t.mediaSource;const s=this.media=t.media;gt(s,"playing",this.onMediaPlaying),gt(s,"waiting",this.onMediaWaiting),gt(s,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:s}=this;s&&(yt(s,"playing",this.onMediaPlaying),yt(s,"waiting",this.onMediaWaiting),yt(s,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var s,r;const n=(s=this.hls)==null?void 0:s.config;if(!n)return;const a=this.media;if(!a)return;const{seeking:o}=a,l=this.seeking&&!o,c=!this.seeking&&o,u=a.paused&&!o||a.ended||a.playbackRate===0;if(this.seeking=o,e!==t){t&&(this.ended=0),this.moved=!0,o||(this.nudgeRetry=0,n.nudgeOnVideoHole&&!u&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(c||l){l&&this.stallResolved(e);return}if(u){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&a.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(y.MEDIA_ENDED,{stalled:!1}));return}if(!fe.getBuffered(a).length){this.nudgeRetry=0;return}const f=fe.bufferInfo(a,e,0),d=f.nextStart||0,h=this.fragmentTracker;if(o&&h&&this.hls){const C=Vu(this.hls.inFlightFragments,e),A=f.len>rn,w=!d||C||d-e>rn&&!h.getPartialFragment(e);if(A||w)return;this.moved=!1}const g=(r=this.hls)==null?void 0:r.latestLevelDetails;if(!this.moved&&this.stalled!==null&&h){if(!(f.len>0)&&!d)return;const A=Math.max(d,f.start||0)-e,L=!!(g!=null&&g.live)?g.targetduration*2:rn,I=Ur(e,h);if(A>0&&(A<=L||I)){a.paused||this._trySkipBufferHole(I);return}}const m=n.detectStallWithCurrentTimeMs,p=self.performance.now(),v=this.waiting;let E=this.stalled;if(E===null)if(v>0&&p-v<m)E=this.stalled=v;else{this.stalled=p;return}const x=p-E;if(!o&&(x>=m||v)&&this.hls){var T;if(((T=this.mediaSource)==null?void 0:T.readyState)==="ended"&&!(g!=null&&g.live)&&Math.abs(e-(g?.edge||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(y.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(f),!this.media||!this.hls)return}const S=fe.bufferInfo(a,e,n.maxBufferHole);this._tryFixBufferStall(S,x,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const s=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(s)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(y.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var s;const r=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(s=this.buffered.audio)!=null&&s.length&&r&&r.length>1&&e>r.end(0)){const n=fe.bufferedInfo(fe.timeRangesToArray(this.buffered.audio),e,0);if(n.len>1&&t>=n.start){const a=fe.timeRangesToArray(r),o=fe.bufferedInfo(a,t,0).bufferedIndex;if(o>-1&&o<a.length-1){const l=fe.bufferedInfo(a,e,0).bufferedIndex,c=a[o].end,u=a[o+1].start;if((l===-1||l>o)&&u-c<1&&e-c<2){const f=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${c} -> ${u} buffered index: ${l}`);this.warn(f.message),this.media.currentTime+=1e-6;let d=Ur(e,this.fragmentTracker);d&&"fragment"in d?d=d.fragment:d||(d=void 0);const h=fe.bufferInfo(this.media,e,0);this.hls.trigger(y.ERROR,{type:ie.MEDIA_ERROR,details:k.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:f,reason:f.message,frag:d,buffer:h.len,bufferInfo:h})}}}}}_tryFixBufferStall(e,t,s){var r,n;const{fragmentTracker:a,media:o}=this,l=(r=this.hls)==null?void 0:r.config;if(!o||!a||!l)return;const c=(n=this.hls)==null?void 0:n.latestLevelDetails,u=Ur(s,a);if((u||c!=null&&c.live&&s<c.fragmentStart)&&(this._trySkipBufferHole(u)||!this.media))return;const f=e.buffered,d=this.adjacentTraversal(e,s);(f&&f.length>1&&e.len>l.maxBufferHole||e.nextStart&&(e.nextStart-s<l.maxBufferHole||d))&&(t>l.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const s=this.fragmentTracker,r=e.nextStart;if(s&&r){const n=s.getFragAtPos(t,se.MAIN),a=s.getFragAtPos(r,se.MAIN);if(n&&a)return a.sn-n.sn<2}return!1}_reportStall(e){const{hls:t,media:s,stallReported:r,stalled:n}=this;if(!r&&n!==null&&s&&t){this.stallReported=!0;const a=new Error(`Playback stalling at @${s.currentTime} due to low buffer (${Pe(e)})`);this.warn(a.message),t.trigger(y.ERROR,{type:ie.MEDIA_ERROR,details:k.BUFFER_STALLED_ERROR,fatal:!1,error:a,buffer:e.len,bufferInfo:e,stalled:{start:n}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:s,media:r}=this,n=(t=this.hls)==null?void 0:t.config;if(!r||!s||!n)return 0;const a=r.currentTime,o=fe.bufferInfo(r,a,0),l=a<o.start?o.start:o.nextStart;if(l&&this.hls){const u=o.len<=n.maxBufferHole,f=o.len>0&&o.len<1&&r.readyState<3,d=l-a;if(d>0&&(u||f)){if(d>n.maxBufferHole){let g=!1;if(a===0){const m=s.getAppendedFrag(0,se.MAIN);m&&l<m.end&&(g=!0)}if(!g&&e){var c;if(!((c=this.hls.loadLevelObj)!=null&&c.details)||Vu(this.hls.inFlightFragments,l))return 0;let p=!1,v=e.end;for(;v<l;){const E=Ur(v,s);if(E)v+=E.duration;else{p=!0;break}}if(p)return 0}}const h=Math.max(l+DT,a+wT);if(this.warn(`skipping hole, adjusting currentTime from ${a} to ${h}`),this.moved=!0,r.currentTime=h,!(e!=null&&e.gap)){const g=new Error(`fragment loaded with buffer holes, seeking from ${a} to ${h}`),m={type:ie.MEDIA_ERROR,details:k.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:g,reason:g.message,buffer:o.len,bufferInfo:o};e&&("fragment"in e?m.part=e:m.frag=e),this.hls.trigger(y.ERROR,m)}return h}}return 0}_tryNudgeBuffer(e){const{hls:t,media:s,nudgeRetry:r}=this,n=t?.config;if(!s||!n)return 0;const a=s.currentTime;if(this.nudgeRetry++,r<n.nudgeMaxRetry){const o=a+(r+1)*n.nudgeOffset,l=new Error(`Nudging 'currentTime' from ${a} to ${o}`);this.warn(l.message),s.currentTime=o,t.trigger(y.ERROR,{type:ie.MEDIA_ERROR,details:k.BUFFER_NUDGE_ON_STALL,error:l,fatal:!1,buffer:e.len,bufferInfo:e})}else{const o=new Error(`Playhead still not moving while enough data buffered @${a} after ${n.nudgeMaxRetry} nudges`);this.error(o.message),t.trigger(y.ERROR,{type:ie.MEDIA_ERROR,details:k.BUFFER_STALLED_ERROR,error:o,fatal:!0,buffer:e.len,bufferInfo:e})}}}function Vu(i,e){const t=Ku(i.main);if(t&&t.start<=e)return t;const s=Ku(i.audio);return s&&s.start<=e?s:null}function Ku(i){if(!i)return null;switch(i.state){case N.IDLE:case N.STOPPED:case N.ENDED:case N.ERROR:return null}return i.frag}function Ur(i,e){return e.getAppendedFrag(i,se.MAIN)||e.getPartialFragment(i)}const OT=.25;function So(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function Oa(i,e,t,s,r){let n=new i(e,t,"");try{n.value=s,r&&(n.type=r)}catch{n=new i(e,t,Pe(r?Re({type:r},s):s))}return n}const Gr=(()=>{const i=So();try{i&&new i(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class MT{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.assetCue=void 0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(y.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e&&(e.on(y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(y.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(y.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(y.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}_unregisterListeners(){const{hls:e}=this;e&&(e.off(y.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(y.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(y.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(y.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this))}onMediaAttaching(e,t){var s;this.media=t.media,((s=t.overrides)==null?void 0:s.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){var e;const t=(e=this.hls)==null?void 0:e.latestLevelDetails;t&&this.updateDateRangeCues(t)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&vi(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const s=e[t];if(s.kind==="metadata"&&s.label==="id3")return Jh(s,this.media),s}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media||!this.hls)return;const{enableEmsgMetadataCues:s,enableID3MetadataCues:r}=this.hls.config;if(!s&&!r)return;const{samples:n}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const a=So();if(a)for(let o=0;o<n.length;o++){const l=n[o].type;if(l===At.emsg&&!s||!r)continue;const c=_h(n[o].data),u=n[o].pts;let f=u+n[o].duration;f>Gr&&(f=Gr),f-u<=0&&(f=u+OT);for(let h=0;h<c.length;h++){const g=c[h];if(!Rh(g)){this.updateId3CueEnds(u,l);const m=Oa(a,u,f,g,l);m&&this.id3Track.addCue(m)}}}}updateId3CueEnds(e,t){var s;const r=(s=this.id3Track)==null?void 0:s.cues;if(r)for(let n=r.length;n--;){const a=r[n];a.type===t&&a.startTime<e&&a.endTime===Gr&&(a.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:s,type:r}){const{id3Track:n,hls:a}=this;if(!a)return;const{config:{enableEmsgMetadataCues:o,enableID3MetadataCues:l}}=a;if(n&&(o||l)){let c;r==="audio"?c=u=>u.type===At.audioId3&&l:r==="video"?c=u=>u.type===At.emsg&&o:c=u=>u.type===At.audioId3&&l||u.type===At.emsg&&o,Eo(n,t,s,c)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.hls||!this.media)return;const{assetPlayerId:s,timelineOffset:r,enableDateRangeMetadataCues:n,interstitialsController:a}=this.hls.config;if(!n)return;const o=So();if(s&&r&&!a){const{fragmentStart:m,fragmentEnd:p}=e;let v=this.assetCue;v?(v.startTime=m,v.endTime=p):o&&(v=this.assetCue=Oa(o,m,p,{assetPlayerId:this.hls.config.assetPlayerId},"hlsjs.interstitial.asset"),v&&(v.id=s,this.id3Track||(this.id3Track=this.createTrack(this.media)),this.id3Track.addCue(v),v.addEventListener("enter",this.onEventCueEnter)))}if(!e.hasProgramDateTime)return;const{id3Track:l}=this,{dateRanges:c}=e,u=Object.keys(c);let f=this.dateRangeCuesAppended;if(l&&t){var d;if((d=l.cues)!=null&&d.length){const m=Object.keys(f).filter(p=>!u.includes(p));for(let p=m.length;p--;){var h;const v=m[p],E=(h=f[v])==null?void 0:h.cues;delete f[v],E&&Object.keys(E).forEach(x=>{const T=E[x];if(T){T.removeEventListener("enter",this.onEventCueEnter);try{l.removeCue(T)}catch{}}})}}else f=this.dateRangeCuesAppended={}}const g=e.fragments[e.fragments.length-1];if(!(u.length===0||!J(g?.programDateTime))){this.id3Track||(this.id3Track=this.createTrack(this.media));for(let m=0;m<u.length;m++){const p=u[m],v=c[p],E=v.startTime,x=f[p],T=x?.cues||{};let S=x?.durationKnown||!1,C=Gr;const{duration:A,endDate:w}=v;if(w&&A!==null)C=E+A,S=!0;else if(v.endOnNext&&!S){const I=u.reduce((O,P)=>{if(P!==v.id){const H=c[P];if(H.class===v.class&&H.startDate>v.startDate&&(!O||v.startDate<O.startDate))return H}return O},null);I&&(C=I.startTime,S=!0)}const L=Object.keys(v.attr);for(let I=0;I<L.length;I++){const O=L[I];if(!sv(O))continue;const P=T[O];if(P)S&&!(x!=null&&x.durationKnown)?P.endTime=C:Math.abs(P.startTime-E)>.01&&(P.startTime=E,P.endTime=C);else if(o){let H=v.attr[O];iv(O)&&(H=$d(H));const Z=Oa(o,E,C,{key:O,data:H},At.dateRange);Z&&(Z.id=p,this.id3Track.addCue(Z),T[O]=Z,a&&(O==="X-ASSET-LIST"||O==="X-ASSET-URL")&&Z.addEventListener("enter",this.onEventCueEnter))}}f[p]={cues:T,dateRange:v,durationKnown:S}}}}}class FT{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,s=this.levelDetails;if(!t||!s)return;this.currentTime=t.currentTime;const r=this.computeLatency();if(r===null)return;this._latency=r;const{lowLatencyMode:n,maxLiveSyncPlaybackRate:a}=this.config;if(!n||a===1||!s.live)return;const o=this.targetLatency;if(o===null)return;const l=r-o,c=Math.min(this.maxLatency,o+s.targetduration);if(l<c&&l>.05&&this.forwardBufferLength>1){const f=Math.min(2,Math.max(1,a)),d=Math.round(2/(1+Math.exp(-.75*l-this.edgeStalled))*20)/20,h=Math.min(f,Math.max(1,d));this.changeMediaPlaybackRate(t,h)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:s,targetduration:r}=e,{liveSyncDuration:n,liveSyncDurationCount:a,lowLatencyMode:o}=this.config,l=this.hls.userConfig;let c=o&&s||t;(this._targetLatencyUpdated||l.liveSyncDuration||l.liveSyncDurationCount||c===0)&&(c=n!==void 0?n:a*r);const u=r;return c+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,u)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const s=this.levelDetails;if(s===null)return null;const r=s.edge,n=e-t-this.edgeStalled,a=r-s.totalduration,o=r-(this.config.lowLatencyMode&&s.partTarget||s.targetduration);return Math.min(Math.max(a,n),o)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const s=e.buffered.length;return(s?e.buffered.end(s-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(y.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(y.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(y.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(y.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var s;t.details===k.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(s=this.levelDetails)!=null&&s.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var s,r;e.playbackRate!==t&&((s=this.hls)==null||s.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(r=this.targetLatency)==null?void 0:r.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class NT extends Al{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(y.LEVEL_LOADED,this.onLevelLoaded,this),e.on(y.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(y.FRAG_BUFFERED,this.onFragBuffered,this),e.on(y.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(y.LEVEL_LOADED,this.onLevelLoaded,this),e.off(y.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(y.FRAG_BUFFERED,this.onFragBuffered,this),e.off(y.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const s=this.hls.config.preferManagedMediaSource,r=[],n={},a={};let o=!1,l=!1,c=!1;t.levels.forEach(u=>{const f=u.attrs;let{audioCodec:d,videoCodec:h}=u;d&&(u.audioCodec=d=En(d,s)||void 0),h&&(h=u.videoCodec=Ey(h));const{width:g,height:m,unknownCodecs:p}=u,v=p?.length||0;if(o||(o=!!(g&&m)),l||(l=!!h),c||(c=!!d),v||d&&!this.isAudioSupported(d)||h&&!this.isVideoSupported(h)){this.log(`Some or all CODECS not supported "${f.CODECS}"`);return}const{CODECS:E,"FRAME-RATE":x,"HDCP-LEVEL":T,"PATHWAY-ID":S,RESOLUTION:C,"VIDEO-RANGE":A}=f,L=`${`${S||"."}-`}${u.bitrate}-${C}-${x}-${E}-${A}-${T}`;if(n[L])if(n[L].uri!==u.url&&!u.attrs["PATHWAY-ID"]){const I=a[L]+=1;u.attrs["PATHWAY-ID"]=new Array(I+1).join(".");const O=this.createLevel(u);n[L]=O,r.push(O)}else n[L].addGroupId("audio",f.AUDIO),n[L].addGroupId("text",f.SUBTITLES);else{const I=this.createLevel(u);n[L]=I,a[L]=1,r.push(I)}}),this.filterAndSortMediaOptions(r,t,o,l,c)}createLevel(e){const t=new fr(e),s=e.supplemental;if(s!=null&&s.videoCodec&&!this.isVideoSupported(s.videoCodec)){const r=new Error(`SUPPLEMENTAL-CODECS not supported "${s.videoCodec}"`);this.log(r.message),t.supportedResult=Xd(r,[])}return t}isAudioSupported(e){return cr(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return cr(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,s,r,n){var a;let o=[],l=[],c=e;const u=((a=t.stats)==null?void 0:a.parsing)||{};if((s||r)&&n&&(c=c.filter(({videoCodec:E,videoRange:x,width:T,height:S})=>(!!E||!!(T&&S))&&Cy(x))),c.length===0){Promise.resolve().then(()=>{if(this.hls){let E="no level with compatible codecs found in manifest",x=E;t.levels.length&&(x=`one or more CODECS in variant not supported: ${Pe(t.levels.map(S=>S.attrs.CODECS).filter((S,C,A)=>A.indexOf(S)===C))}`,this.warn(x),E+=` (${x})`);const T=new Error(E);this.hls.trigger(y.ERROR,{type:ie.MEDIA_ERROR,details:k.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:T,reason:x})}}),u.end=performance.now();return}t.audioTracks&&(o=t.audioTracks.filter(E=>!E.audioCodec||this.isAudioSupported(E.audioCodec)),Hu(o)),t.subtitles&&(l=t.subtitles,Hu(l));const f=c.slice(0);c.sort((E,x)=>{if(E.attrs["HDCP-LEVEL"]!==x.attrs["HDCP-LEVEL"])return(E.attrs["HDCP-LEVEL"]||"")>(x.attrs["HDCP-LEVEL"]||"")?1:-1;if(s&&E.height!==x.height)return E.height-x.height;if(E.frameRate!==x.frameRate)return E.frameRate-x.frameRate;if(E.videoRange!==x.videoRange)return xn.indexOf(E.videoRange)-xn.indexOf(x.videoRange);if(E.videoCodec!==x.videoCodec){const T=Mc(E.videoCodec),S=Mc(x.videoCodec);if(T!==S)return S-T}if(E.uri===x.uri&&E.codecSet!==x.codecSet){const T=vn(E.codecSet),S=vn(x.codecSet);if(T!==S)return S-T}return E.averageBitrate!==x.averageBitrate?E.averageBitrate-x.averageBitrate:0});let d=f[0];if(this.steering&&(c=this.steering.filterParsedLevels(c),c.length!==f.length)){for(let E=0;E<f.length;E++)if(f[E].pathwayId===c[0].pathwayId){d=f[E];break}}this._levels=c;for(let E=0;E<c.length;E++)if(c[E]===d){var h;this._firstLevel=E;const x=d.bitrate,T=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${c.length} level(s) found, first bitrate: ${x}`),((h=this.hls.userConfig)==null?void 0:h.abrEwmaDefaultEstimate)===void 0){const S=Math.min(x,this.hls.config.abrEwmaDefaultEstimateMax);S>T&&T===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=S)}break}const g=n&&!r,m=this.hls.config,p=!!(m.audioStreamController&&m.audioTrackController),v={levels:c,audioTracks:o,subtitleTracks:l,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:n,video:r,altAudio:p&&!g&&o.some(E=>!!E.url)};u.end=performance.now(),this.hls.trigger(y.MANIFEST_PARSED,v)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const u=new Error("invalid level idx"),f=e<0;if(this.hls.trigger(y.ERROR,{type:ie.OTHER_ERROR,details:k.LEVEL_SWITCH_ERROR,level:e,fatal:f,error:u,reason:u.message}),f)return;e=Math.min(e,t.length-1)}const s=this.currentLevelIndex,r=this.currentLevel,n=r?r.attrs["PATHWAY-ID"]:void 0,a=t[e],o=a.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=a,s===e&&r&&n===o)return;this.log(`Switching to level ${e} (${a.height?a.height+"p ":""}${a.videoRange?a.videoRange+" ":""}${a.codecSet?a.codecSet+" ":""}@${a.bitrate})${o?" with Pathway "+o:""} from level ${s}${n?" with Pathway "+n:""}`);const l={level:e,attrs:a.attrs,details:a.details,bitrate:a.bitrate,averageBitrate:a.averageBitrate,maxBitrate:a.maxBitrate,realBitrate:a.realBitrate,width:a.width,height:a.height,codecSet:a.codecSet,audioCodec:a.audioCodec,videoCodec:a.videoCodec,audioGroups:a.audioGroups,subtitleGroups:a.subtitleGroups,loaded:a.loaded,loadError:a.loadError,fragmentError:a.fragmentError,name:a.name,id:a.id,uri:a.uri,url:a.url,urlId:0,audioGroupIds:a.audioGroupIds,textGroupIds:a.textGroupIds};this.hls.trigger(y.LEVEL_SWITCHING,l);const c=a.details;if(!c||c.live){const u=this.switchParams(a.uri,r?.details,c);this.loadPlaylist(u)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),s=e.filter(r=>t.indexOf(r)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=s}}onError(e,t){t.fatal||!t.context||t.context.type===Ee.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===se.MAIN){const s=t.elementaryStreams;if(!Object.keys(s).some(n=>!!s[n]))return;const r=this._levels[t.level];r!=null&&r.loadError&&(this.log(`Resetting level error count of ${r.loadError} on frag buffered`),r.loadError=0)}}onLevelLoaded(e,t){var s;const{level:r,details:n}=t,a=t.levelInfo;if(!a){var o;this.warn(`Invalid level index ${r}`),(o=t.deliveryDirectives)!=null&&o.skip&&(n.deltaUpdateFailed=!0);return}if(a===this.currentLevel||t.withoutMultiVariant){a.fragmentError===0&&(a.loadError=0);let l=a.details;l===t.details&&l.advanced&&(l=void 0),this.playlistLoaded(r,t,l)}else(s=t.deliveryDirectives)!=null&&s.skip&&(n.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const s=this.getUrlWithDirectives(e.uri,t),r=this.currentLevelIndex,n=e.attrs["PATHWAY-ID"],a=e.details,o=a?.age;this.log(`Loading level index ${r}${t?.msn!==void 0?" at sn "+t.msn+" part "+t.part:""}${n?" Pathway "+n:""}${o&&a.live?" age "+o.toFixed(1)+(a.type&&" "+a.type||""):""} ${s}`),this.hls.trigger(y.LEVEL_LOADING,{url:s,level:r,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const s=this._levels.filter((n,a)=>a!==e?!0:(this.steering&&this.steering.removeLevel(n),n===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,n.details&&n.details.fragments.forEach(o=>o.level=-1)),!1));yh(s),this._levels=s,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const r=s.length-1;this._firstLevel=Math.min(this._firstLevel,r),this._startLevel&&(this._startLevel=Math.min(this._startLevel,r)),this.hls.trigger(y.LEVELS_UPDATED,{levels:s})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:s}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(y.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:s}))}}function Hu(i){const e={};i.forEach(t=>{const s=t.groupId||"";t.id=e[s]=e[s]||0,e[s]++})}function d0(){return self.SourceBuffer||self.WebKitSourceBuffer}function h0(){if(!$s())return!1;const e=d0();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function $T(){if(!h0())return!1;const i=$s();return typeof i?.isTypeSupported=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>i.isTypeSupported(ur(e,"video")))||["mp4a.40.2","fLaC"].some(e=>i.isTypeSupported(ur(e,"audio"))))}function BT(){var i;const e=d0();return typeof(e==null||(i=e.prototype)==null?void 0:i.changeType)=="function"}const UT=100;class GT extends pl{constructor(e,t,s){super(e,t,s,"stream-controller",se.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const r=this.media,n=r?r.currentTime:null;if(n===null||!J(n)||(this.log(`Media seeked to ${n.toFixed(3)}`),!this.getBufferedFrag(n)))return;const a=this.getFwdBufferInfoAtPos(r,n,se.MAIN,0);if(a===null||a.len===0){this.warn(`Main forward buffer length at ${n} on "seeked" event ${a?a.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(y.MANIFEST_PARSED,this.onManifestParsed,this),e.on(y.LEVEL_LOADING,this.onLevelLoading,this),e.on(y.LEVEL_LOADED,this.onLevelLoaded,this),e.on(y.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(y.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(y.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(y.BUFFER_CREATED,this.onBufferCreated,this),e.on(y.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(y.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(y.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(y.MANIFEST_PARSED,this.onManifestParsed,this),e.off(y.LEVEL_LOADED,this.onLevelLoaded,this),e.off(y.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(y.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(y.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(y.BUFFER_CREATED,this.onBufferCreated,this),e.off(y.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(y.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(y.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:s,hls:r}=this;if(this.stopLoad(),this.setInterval(UT),this.level=-1,!this.startFragRequested){let n=r.startLevel;n===-1&&(r.config.testBandwidth&&this.levels.length>1?(n=0,this.bitrateTest=!0):n=r.firstAutoLevel),r.nextLoadLevel=n,this.level=r.loadLevel,this._hasEnoughToStart=!!t}s>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${s.toFixed(3)}`),e=s),this.state=N.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=N.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case N.WAITING_LEVEL:{const{levels:e,level:t}=this,s=e?.[t],r=s?.details;if(r&&(!r.live||this.levelLastLoaded===s&&!this.waitForLive(s))){if(this.waitForCdnTuneIn(r))break;this.state=N.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=N.IDLE;break}break}case N.FRAG_LOADING_WAITING_RETRY:this.checkRetryDate();break}this.state===N.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:s,media:r}=this;if(t===null||!r&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const n=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(s!=null&&s[n]))return;const a=s[n],o=this.getMainFwdBufferInfo();if(o===null)return;const l=this.getLevelDetails();if(l&&this._streamEnded(o,l)){const m={};this.altAudio===2&&(m.type="video"),this.hls.trigger(y.BUFFER_EOS,m),this.state=N.ENDED;return}if(!this.buffering)return;e.loadLevel!==n&&e.manualLevel===-1&&this.log(`Adapting to level ${n} from level ${this.level}`),this.level=e.nextLoadLevel=n;const c=a.details;if(!c||this.state===N.WAITING_LEVEL||this.waitForLive(a)){this.level=n,this.state=N.WAITING_LEVEL,this.startFragRequested=!1;return}const u=o.len,f=this.getMaxBufferLength(a.maxBitrate);if(u>=f)return;this.backtrackFragment&&this.backtrackFragment.start>o.end&&(this.backtrackFragment=null);const d=this.backtrackFragment?this.backtrackFragment.start:o.end;let h=this.getNextFragment(d,c);if(this.couldBacktrack&&!this.fragPrevious&&h&&Ve(h)&&this.fragmentTracker.getState(h)!==je.OK){var g;const p=((g=this.backtrackFragment)!=null?g:h).sn-c.startSN,v=c.fragments[p-1];v&&h.cc===v.cc&&(h=v,this.fragmentTracker.removeFragment(v))}else this.backtrackFragment&&o.len&&(this.backtrackFragment=null);if(h&&this.isLoopLoading(h,d)){if(!h.gap){const p=this.audioOnly&&!this.altAudio?ke.AUDIO:ke.VIDEO,v=(p===ke.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;v&&this.afterBufferFlushed(v,p,se.MAIN)}h=this.getNextFragmentLoopLoading(h,c,o,se.MAIN,f)}h&&(h.initSegment&&!h.initSegment.data&&!this.bitrateTest&&(h=h.initSegment),this.loadFragment(h,a,d))}loadFragment(e,t,s){const r=this.fragmentTracker.getState(e);r===je.NOT_LOADED||r===je.PARTIAL?Ve(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,s):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,se.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let s;const r=this.getAppendedFrag(t.currentTime);r&&r.start>1&&this.flushMainBuffer(0,r.start-1);const n=this.getLevelDetails();if(n!=null&&n.live){const o=this.getMainFwdBufferInfo();if(!o||o.len<n.targetduration*2)return}if(!t.paused&&e){const o=this.hls.nextLoadLevel,l=e[o],c=this.fragLastKbps;c&&this.fragCurrent?s=this.fragCurrent.duration*l.maxBitrate/(1e3*c)+1:s=0}else s=0;const a=this.getBufferedFrag(t.currentTime+s);if(a){const o=this.followingBufferedFrag(a);if(o){this.abortCurrentFrag();const l=o.maxStartPTS?o.maxStartPTS:o.start,c=o.duration,u=Math.max(a.end,l+Math.min(Math.max(c-this.config.maxFragLookUpTolerance,c*(this.couldBacktrack?.5:.125)),c*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(u,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case N.KEY_LOADING:case N.FRAG_LOADING:case N.FRAG_LOADING_WAITING_RETRY:case N.PARSING:case N.PARSED:this.state=N.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const s=t.media;gt(s,"playing",this.onMediaPlaying),gt(s,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:s}=this;s&&(yt(s,"playing",this.onMediaPlaying),yt(s,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(y.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let s=!1,r=!1;for(let n=0;n<t.levels.length;n++){const a=t.levels[n].audioCodec;a&&(s=s||a.indexOf("mp4a.40.2")!==-1,r=r||a.indexOf("mp4a.40.5")!==-1)}this.audioCodecSwitch=s&&r&&!BT(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:s}=this;if(!s||this.state!==N.IDLE)return;const r=t.levelInfo;(!r.details||r.details.live&&(this.levelLastLoaded!==r||r.details.expired)||this.waitForCdnTuneIn(r.details))&&(this.state=N.WAITING_LEVEL)}onLevelLoaded(e,t){var s;const{levels:r,startFragRequested:n}=this,a=t.level,o=t.details,l=o.totalduration;if(!r){this.warn(`Levels were reset while loading level ${a}`);return}this.log(`Level ${a} loaded [${o.startSN},${o.endSN}]${o.lastPartSn?`[part-${o.lastPartSn}-${o.lastPartIndex}]`:""}, cc [${o.startCC}, ${o.endCC}] duration:${l}`);const c=t.levelInfo,u=this.fragCurrent;u&&(this.state===N.FRAG_LOADING||this.state===N.FRAG_LOADING_WAITING_RETRY)&&u.level!==t.level&&u.loader&&this.abortCurrentFrag();let f=0;if(o.live||(s=c.details)!=null&&s.live){var d;if(this.checkLiveUpdate(o),o.deltaUpdateFailed)return;f=this.alignPlaylists(o,c.details,(d=this.levelLastLoaded)==null?void 0:d.details)}if(c.details=o,this.levelLastLoaded=c,n||this.setStartPosition(o,f),this.hls.trigger(y.LEVEL_UPDATED,{details:o,level:a}),this.state===N.WAITING_LEVEL){if(this.waitForCdnTuneIn(o))return;this.state=N.IDLE}n&&o.live&&this.synchronizeToLiveEdge(o),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:s}=this;if(!s)return;const r=this.hls.liveSyncPosition,n=this.getLoadPosition(),a=e.fragmentStart,o=e.edge,l=n>=a-t.maxFragLookUpTolerance&&n<=o;if(r!==null&&s.duration>r&&(n<r||!l)){const u=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!l&&s.readyState<4||n<o-u)&&(this._hasEnoughToStart||(this.nextLoadPosition=r),s.readyState))if(this.warn(`Playback: ${n.toFixed(3)} is located too far from the end of live sliding playlist: ${o}, reset currentTime to : ${r.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var c;const f=fe.bufferInfo(s,r,0);if(!((c=f.buffered)!=null&&c.length)){s.currentTime=r;return}if(f.start<=n){s.currentTime=r;return}const{nextStart:h}=fe.bufferedInfo(f.buffered,n,0);h&&(s.currentTime=h)}else s.currentTime=r}}_handleFragmentLoadProgress(e){var t;const s=e.frag,{part:r,payload:n}=e,{levels:a}=this;if(!a){this.warn(`Levels were reset while fragment load was in progress. Fragment ${s.sn} of level ${s.level} will not be buffered`);return}const o=a[s.level];if(!o){this.warn(`Level ${s.level} not found on progress`);return}const l=o.details;if(!l){this.warn(`Dropping fragment ${s.sn} of level ${s.level} after level details were reset`),this.fragmentTracker.removeFragment(s);return}const c=o.videoCodec,u=l.PTSKnown||!l.live,f=(t=s.initSegment)==null?void 0:t.data,d=this._getAudioCodec(o),h=this.transmuxer=this.transmuxer||new Bh(this.hls,se.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),g=r?r.index:-1,m=g!==-1,p=new hl(s.level,s.sn,s.stats.chunkCount,n.byteLength,g,m),v=this.initPTS[s.cc];h.push(n,f,d,c,s,r,l.totalduration,u,p,v)}onAudioTrackSwitching(e,t){const s=this.hls,r=this.altAudio!==0;if(Tn(t.url,s))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const a=this.fragCurrent;a&&(this.log("Switching to main audio track, cancel main fragment load"),a.abortRequests(),this.fragmentTracker.removeFragment(a)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(r){this.altAudio=0,this.fragmentTracker.removeAllFragments(),s.once(y.BUFFER_FLUSHED,()=>{this.hls&&this.hls.trigger(y.AUDIO_TRACK_SWITCHED,t)}),s.trigger(y.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}s.trigger(y.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const s=Tn(t.url,this.hls);if(s){const r=this.videoBuffer;r&&this.mediaBuffer!==r&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=r)}this.altAudio=s?2:0,this.tick()}onBufferCreated(e,t){const s=t.tracks;let r,n,a=!1;for(const o in s){const l=s[o];if(l.id==="main"){if(n=o,r=l,o==="video"){const c=s[o];c&&(this.videoBuffer=c.buffer)}}else a=!0}a&&r?(this.log(`Alternate track found, use ${n}.buffered to schedule main fragment loading`),this.mediaBuffer=r.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:s,part:r}=t,n=s.type===se.MAIN;if(n){if(this.fragContextChanged(s)){this.warn(`Fragment ${s.sn}${r?" p: "+r.index:""} of level ${s.level} finished buffering, but was aborted. state: ${this.state}`),this.state===N.PARSED&&(this.state=N.IDLE);return}const o=r?r.stats:s.stats;this.fragLastKbps=Math.round(8*o.total/(o.buffering.end-o.loading.first)),Ve(s)&&(this.fragPrevious=s),this.fragBufferedComplete(s,r)}const a=this.media;a&&(!this._hasEnoughToStart&&fe.getBuffered(a).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),n&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var s;if(t.fatal){this.state=N.ERROR;return}switch(t.details){case k.FRAG_GAP:case k.FRAG_PARSING_ERROR:case k.FRAG_DECRYPT_ERROR:case k.FRAG_LOAD_ERROR:case k.FRAG_LOAD_TIMEOUT:case k.KEY_LOAD_ERROR:case k.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(se.MAIN,t);break;case k.LEVEL_LOAD_ERROR:case k.LEVEL_LOAD_TIMEOUT:case k.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===N.WAITING_LEVEL&&((s=t.context)==null?void 0:s.type)===Ee.LEVEL&&(this.state=N.IDLE);break;case k.BUFFER_ADD_CODEC_ERROR:case k.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case k.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&(!this.config.interstitialsController&&this.config.assetPlayerId?this._hasEnoughToStart=!0:this.flushMainBuffer(0,Number.POSITIVE_INFINITY));break;case k.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=N.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==ke.AUDIO||!this.altAudio){const s=(t===ke.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;s&&(this.afterBufferFlushed(s,t,se.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let s=this.startPosition;if(s>=0&&t<s){if(e.seeking){this.log(`could not seek to ${s}, already seeking at ${t}`);return}const r=this.timelineOffset;r&&s&&(s+=r);const n=this.getLevelDetails(),a=fe.getBuffered(e),o=a.length?a.start(0):0,l=o-s,c=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||l>0&&(l<c||this.loadingParts&&l<2*(n?.partTarget||0)))&&(this.log(`adjusting start position by ${l} to match buffer start`),s+=l,this.startPosition=s),t<s&&(this.log(`seek to target start position ${s} from current time ${t} buffer start ${o}`),e.currentTime=s)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(s=>{const{hls:r}=this,n=s?.frag;if(!n||this.fragContextChanged(n))return;t.fragmentError=0,this.state=N.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const a=n.stats;a.parsing.start=a.parsing.end=a.buffering.start=a.buffering.end=self.performance.now(),r.trigger(y.FRAG_LOADED,s),n.bitrateTest=!1}).catch(s=>{this.state===N.STOPPED||this.state===N.ERROR||(this.warn(s),this.resetFragmentLoading(e))})}_handleTransmuxComplete(e){const t=this.playlistType,{hls:s}=this,{remuxResult:r,chunkMeta:n}=e,a=this.getCurrentContext(n);if(!a){this.resetWhenMissingContext(n);return}const{frag:o,part:l,level:c}=a,{video:u,text:f,id3:d,initSegment:h}=r,{details:g}=c,m=this.altAudio?void 0:r.audio;if(this.fragContextChanged(o)){this.fragmentTracker.removeFragment(o);return}if(this.state=N.PARSING,h){const p=h.tracks;if(p){const T=o.initSegment||o;if(this.unhandledEncryptionError(h,o))return;this._bufferInitSegment(c,p,T,n),s.trigger(y.FRAG_PARSING_INIT_SEGMENT,{frag:T,id:t,tracks:p})}const v=h.initPTS,E=h.timescale,x=this.initPTS[o.cc];if(J(v)&&(!x||x.baseTime!==v||x.timescale!==E)){const T=h.trackId;this.initPTS[o.cc]={baseTime:v,timescale:E,trackId:T},s.trigger(y.INIT_PTS_FOUND,{frag:o,id:t,initPTS:v,timescale:E,trackId:T})}}if(u&&g){m&&u.type==="audiovideo"&&this.logMuxedErr(o);const p=g.fragments[o.sn-1-g.startSN],v=o.sn===g.startSN,E=!p||o.cc>p.cc;if(r.independent!==!1){const{startPTS:x,endPTS:T,startDTS:S,endDTS:C}=u;if(l)l.elementaryStreams[u.type]={startPTS:x,endPTS:T,startDTS:S,endDTS:C};else if(u.firstKeyFrame&&u.independent&&n.id===1&&!E&&(this.couldBacktrack=!0),u.dropped&&u.independent){const A=this.getMainFwdBufferInfo(),w=(A?A.end:this.getLoadPosition())+this.config.maxBufferHole,L=u.firstKeyFramePTS?u.firstKeyFramePTS:x;if(!v&&w<L-this.config.maxBufferHole&&!E){this.backtrack(o);return}else E&&(o.gap=!0);o.setElementaryStreamInfo(u.type,o.start,T,o.start,C,!0)}else v&&x-(g.appliedTimelineOffset||0)>rn&&(o.gap=!0);o.setElementaryStreamInfo(u.type,x,T,S,C),this.backtrackFragment&&(this.backtrackFragment=o),this.bufferFragmentData(u,o,l,n,v||E)}else if(v||E)o.gap=!0;else{this.backtrack(o);return}}if(m){const{startPTS:p,endPTS:v,startDTS:E,endDTS:x}=m;l&&(l.elementaryStreams[ke.AUDIO]={startPTS:p,endPTS:v,startDTS:E,endDTS:x}),o.setElementaryStreamInfo(ke.AUDIO,p,v,E,x),this.bufferFragmentData(m,o,l,n)}if(g&&d!=null&&d.samples.length){const p={id:t,frag:o,details:g,samples:d.samples};s.trigger(y.FRAG_PARSING_METADATA,p)}if(g&&f){const p={id:t,frag:o,details:g,samples:f.samples};s.trigger(y.FRAG_PARSING_USERDATA,p)}}logMuxedErr(e){this.warn(`${Ve(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,s,r){if(this.state!==N.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(s));const{audio:n,video:a,audiovideo:o}=t;if(n){const c=e.audioCodec;let u=Xr(n.codec,c);u==="mp4a"&&(u="mp4a.40.5");const f=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){u&&(u.indexOf("mp4a.40.5")!==-1?u="mp4a.40.2":u="mp4a.40.5");const d=n.metadata;d&&"channelCount"in d&&(d.channelCount||1)!==1&&f.indexOf("firefox")===-1&&(u="mp4a.40.5")}u&&u.indexOf("mp4a.40.5")!==-1&&f.indexOf("android")!==-1&&n.container!=="audio/mpeg"&&(u="mp4a.40.2",this.log(`Android: force audio codec to ${u}`)),c&&c!==u&&this.log(`Swapping manifest audio codec "${c}" for "${u}"`),n.levelCodec=u,n.id=se.MAIN,this.log(`Init audio buffer, container:${n.container}, codecs[selected/level/parsed]=[${u||""}/${c||""}/${n.codec}]`),delete t.audiovideo}if(a){a.levelCodec=e.videoCodec,a.id=se.MAIN;const c=a.codec;if(c?.length===4)switch(c){case"hvc1":case"hev1":a.codec="hvc1.1.6.L120.90";break;case"av01":a.codec="av01.0.04M.08";break;case"avc1":a.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${a.container}, codecs[level/parsed]=[${e.videoCodec||""}/${c}]${a.codec!==c?" parsed-corrected="+a.codec:""}${a.supplemental?" supplemental="+a.supplemental:""}`),delete t.audiovideo}o&&(this.log(`Init audiovideo buffer, container:${o.container}, codecs[level/parsed]=[${e.codecs}/${o.codec}]`),delete t.video,delete t.audio);const l=Object.keys(t);if(l.length){if(this.hls.trigger(y.BUFFER_CODECS,t),!this.hls)return;l.forEach(c=>{const f=t[c].initSegment;f!=null&&f.byteLength&&this.hls.trigger(y.BUFFER_APPENDING,{type:c,data:f,frag:s,part:null,chunkMeta:r,parent:s.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,se.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,s=e?.[t];return s?this.getMaxBufferLength(s.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=N.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const s=e.currentTime;if(fe.isBuffered(e,s)?t=this.getAppendedFrag(s):fe.isBuffered(e,s+.1)&&(t=this.getAppendedFrag(s+.1)),t){this.backtrackFragment=null;const r=this.fragPlaying,n=t.level;(!r||t.sn!==r.sn||r.level!==n)&&(this.fragPlaying=t,this.hls.trigger(y.FRAG_CHANGED,{frag:t}),(!r||r.level!==n)&&this.hls.trigger(y.LEVEL_SWITCHED,{level:n}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return J(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(J(t)){const s=this.getLevelDetails(),r=this.currentFrag||(s?ii(null,s.fragments,t):null);if(r){const n=r.programDateTime;if(n!==null){const a=n+(t-r.start)*1e3;return new Date(a)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class VT extends Pt{constructor(e,t){super("key-loader",t),this.config=void 0,this.keyIdToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const s in this.keyIdToKeyInfo){const r=this.keyIdToKeyInfo[s].loader;if(r){var t;if(e&&e!==((t=r.context)==null?void 0:t.frag.type))return;r.abort()}}}detach(){for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyIdToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyIdToKeyInfo){const t=this.keyIdToKeyInfo[e].loader;t&&t.destroy()}this.keyIdToKeyInfo={}}createKeyLoadError(e,t=k.KEY_LOAD_ERROR,s,r,n){return new ls({type:ie.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:n,error:s,networkDetails:r})}loadClear(e,t,s){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let r=0,n=t.length;r<n;r++){const a=t[r];if(e.cc<=a.cc&&(!Ve(e)||!Ve(a)||e.sn<a.sn)||!s&&r==n-1)return this.emeController.selectKeySystemFormat(a).then(o=>{if(!this.emeController)return;a.setKeyFormat(o);const l=Zr(o);if(l)return this.emeController.getKeySystemAccess([l])})}if(this.config.requireKeySystemAccessOnStart){const r=Gi(this.config);if(r.length)return this.emeController.getKeySystemAccess(r)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var s,r;t&&e.setKeyFormat(t);const n=e.decryptdata;if(!n){const c=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:`Missing decryption data on fragment in onKeyLoading (emeEnabled with controller: ${this.emeController&&this.config.emeEnabled})`);return Promise.reject(this.createKeyLoadError(e,k.KEY_LOAD_ERROR,c))}const a=n.uri;if(!a)return Promise.reject(this.createKeyLoadError(e,k.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${a}"`)));const o=Ma(n);let l=this.keyIdToKeyInfo[o];if((s=l)!=null&&s.decryptdata.key)return n.key=l.decryptdata.key,Promise.resolve({frag:e,keyInfo:l});if(this.emeController&&(r=l)!=null&&r.keyLoadPromise)switch(this.emeController.getKeyStatus(l.decryptdata)){case"usable":case"usable-in-future":return l.keyLoadPromise.then(u=>{const{keyInfo:f}=u;return n.key=f.decryptdata.key,{frag:e,keyInfo:f}})}switch(this.log(`${this.keyIdToKeyInfo[o]?"Rel":"L"}oading${n.keyId?" keyId: "+Ze(n.keyId):""} URI: ${n.uri} from ${e.type} ${e.level}`),l=this.keyIdToKeyInfo[o]={decryptdata:n,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},n.method){case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return n.keyFormat==="identity"?this.loadKeyHTTP(l,e):this.loadKeyEME(l,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(l,e);default:return Promise.reject(this.createKeyLoadError(e,k.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${n.method}"`)))}}loadKeyEME(e,t){const s={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var r;if(!e.decryptdata.keyId&&(r=t.initSegment)!=null&&r.data){const a=oy(t.initSegment.data);if(a.length){let o=a[0];o.some(l=>l!==0)?(this.log(`Using keyId found in init segment ${Ze(o)}`),Fs.setKeyIdForUri(e.decryptdata.uri,o)):(o=Fs.addKeyIdForUri(e.decryptdata.uri),this.log(`Generating keyId to patch media ${Ze(o)}`)),e.decryptdata.keyId=o}}if(!e.decryptdata.keyId&&!Ve(t))return Promise.resolve(s);const n=this.emeController.loadKey(s);return(e.keyLoadPromise=n.then(a=>(e.mediaKeySessionContext=a,s))).catch(a=>{throw e.keyLoadPromise=null,"data"in a&&(a.data.frag=t),a})}return Promise.resolve(s)}loadKeyHTTP(e,t){const s=this.config,r=s.loader,n=new r(s);return t.keyLoader=e.loader=n,e.keyLoadPromise=new Promise((a,o)=>{const l={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},c=s.keyLoadPolicy.default,u={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},f={onSuccess:(d,h,g,m)=>{const{frag:p,keyInfo:v}=g,E=Ma(v.decryptdata);if(!p.decryptdata||v!==this.keyIdToKeyInfo[E])return o(this.createKeyLoadError(p,k.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),m));v.decryptdata.key=p.decryptdata.key=new Uint8Array(d.data),p.keyLoader=null,v.loader=null,a({frag:p,keyInfo:v})},onError:(d,h,g,m)=>{this.resetLoader(h),o(this.createKeyLoadError(t,k.KEY_LOAD_ERROR,new Error(`HTTP Error ${d.code} loading key ${d.text}`),g,Re({url:l.url,data:void 0},d)))},onTimeout:(d,h,g)=>{this.resetLoader(h),o(this.createKeyLoadError(t,k.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),g))},onAbort:(d,h,g)=>{this.resetLoader(h),o(this.createKeyLoadError(t,k.INTERNAL_ABORTED,new Error("key loading aborted"),g))}};n.load(l,u,f)})}resetLoader(e){const{frag:t,keyInfo:s,url:r}=e,n=s.loader;t.keyLoader===n&&(t.keyLoader=null,s.loader=null);const a=Ma(s.decryptdata)||r;delete this.keyIdToKeyInfo[a],n&&n.destroy()}}function Ma(i){if(i.keyFormat!==Je.FAIRPLAY){const e=i.keyId;if(e)return Ze(e)}return i.uri}function ju(i){const{type:e}=i;switch(e){case Ee.AUDIO_TRACK:return se.AUDIO;case Ee.SUBTITLE_TRACK:return se.SUBTITLE;default:return se.MAIN}}function Fa(i,e){let t=i.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class KT{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(y.MANIFEST_LOADING,this.onManifestLoading,this),e.on(y.LEVEL_LOADING,this.onLevelLoading,this),e.on(y.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(y.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(y.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(y.MANIFEST_LOADING,this.onManifestLoading,this),e.off(y.LEVEL_LOADING,this.onLevelLoading,this),e.off(y.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(y.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(y.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,s=t.pLoader,r=t.loader,n=s||r,a=new n(t);return this.loaders[e.type]=a,a}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:s}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:Ee.MANIFEST,url:s,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:s,level:r,pathwayId:n,url:a,deliveryDirectives:o,levelInfo:l}=t;this.load({id:s,level:r,pathwayId:n,responseType:"text",type:Ee.LEVEL,url:a,deliveryDirectives:o,levelOrTrack:l})}onAudioTrackLoading(e,t){const{id:s,groupId:r,url:n,deliveryDirectives:a,track:o}=t;this.load({id:s,groupId:r,level:null,responseType:"text",type:Ee.AUDIO_TRACK,url:n,deliveryDirectives:a,levelOrTrack:o})}onSubtitleTrackLoading(e,t){const{id:s,groupId:r,url:n,deliveryDirectives:a,track:o}=t;this.load({id:s,groupId:r,level:null,responseType:"text",type:Ee.SUBTITLE_TRACK,url:n,deliveryDirectives:a,levelOrTrack:o})}onLevelsUpdated(e,t){const s=this.loaders[Ee.LEVEL];if(s){const r=s.context;r&&!t.levels.some(n=>n===r.levelOrTrack)&&(s.abort(),delete this.loaders[Ee.LEVEL])}}load(e){var t;const s=this.hls.config;let r=this.getInternalLoader(e);if(r){const c=this.hls.logger,u=r.context;if(u&&u.levelOrTrack===e.levelOrTrack&&(u.url===e.url||u.deliveryDirectives&&!e.deliveryDirectives)){u.url===e.url?c.log(`[playlist-loader]: ignore ${e.url} ongoing request`):c.log(`[playlist-loader]: ignore ${e.url} in favor of ${u.url}`);return}c.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),r.abort()}let n;if(e.type===Ee.MANIFEST?n=s.manifestLoadPolicy.default:n=we({},s.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),r=this.createInternalLoader(e),J((t=e.deliveryDirectives)==null?void 0:t.part)){let c;if(e.type===Ee.LEVEL&&e.level!==null?c=this.hls.levels[e.level].details:e.type===Ee.AUDIO_TRACK&&e.id!==null?c=this.hls.audioTracks[e.id].details:e.type===Ee.SUBTITLE_TRACK&&e.id!==null&&(c=this.hls.subtitleTracks[e.id].details),c){const u=c.partTarget,f=c.targetduration;if(u&&f){const d=Math.max(u*3,f*.8)*1e3;n=we({},n,{maxTimeToFirstByteMs:Math.min(d,n.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(d,n.maxTimeToFirstByteMs)})}}}const a=n.errorRetry||n.timeoutRetry||{},o={loadPolicy:n,timeout:n.maxLoadTimeMs,maxRetry:a.maxNumRetry||0,retryDelay:a.retryDelayMs||0,maxRetryDelay:a.maxRetryDelayMs||0},l={onSuccess:(c,u,f,d)=>{const h=this.getInternalLoader(f);this.resetInternalLoader(f.type);const g=c.data;u.parsing.start=performance.now(),Zt.isMediaPlaylist(g)||f.type!==Ee.MANIFEST?this.handleTrackOrLevelPlaylist(c,u,f,d||null,h):this.handleMasterPlaylist(c,u,f,d)},onError:(c,u,f,d)=>{this.handleNetworkError(u,f,!1,c,d)},onTimeout:(c,u,f)=>{this.handleNetworkError(u,f,!0,void 0,c)}};r.load(e,o,l)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:s}=this.hls;(e||s)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,s,r){const n=this.hls,a=e.data,o=Fa(e,s),l=Zt.parseMasterPlaylist(a,o);if(l.playlistParsingError){t.parsing.end=performance.now(),this.handleManifestParsingError(e,s,l.playlistParsingError,r,t);return}const{contentSteering:c,levels:u,sessionData:f,sessionKeys:d,startTimeOffset:h,variableList:g}=l;this.variableList=g,u.forEach(E=>{const{unknownCodecs:x}=E;if(x){const{preferManagedMediaSource:T}=this.hls.config;let{audioCodec:S,videoCodec:C}=E;for(let A=x.length;A--;){const w=x[A];cr(w,"audio",T)?(E.audioCodec=S=S?`${S},${w}`:w,wi.audio[S.substring(0,4)]=2,x.splice(A,1)):cr(w,"video",T)&&(E.videoCodec=C=C?`${C},${w}`:w,wi.video[C.substring(0,4)]=2,x.splice(A,1))}}});const{AUDIO:m=[],SUBTITLES:p,"CLOSED-CAPTIONS":v}=Zt.parseMasterPlaylistMedia(a,o,l);m.length&&!m.some(x=>!x.url)&&u[0].audioCodec&&!u[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),m.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new Ne({}),bitrate:0,url:""})),n.trigger(y.MANIFEST_LOADED,{levels:u,audioTracks:m,subtitles:p,captions:v,contentSteering:c,url:o,stats:t,networkDetails:r,sessionData:f,sessionKeys:d,startTimeOffset:h,variableList:g})}handleTrackOrLevelPlaylist(e,t,s,r,n){const a=this.hls,{id:o,level:l,type:c}=s,u=Fa(e,s),f=J(l)?l:J(o)?o:0,d=ju(s),h=Zt.parseLevelPlaylist(e.data,u,f,d,0,this.variableList);if(c===Ee.MANIFEST){const g={attrs:new Ne({}),bitrate:0,details:h,name:"",url:u};h.requestScheduled=t.loading.start+gh(h,0),a.trigger(y.MANIFEST_LOADED,{levels:[g],audioTracks:[],url:u,stats:t,networkDetails:r,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),s.levelDetails=h,this.handlePlaylistLoaded(h,e,t,s,r,n)}handleManifestParsingError(e,t,s,r,n){this.hls.trigger(y.ERROR,{type:ie.NETWORK_ERROR,details:k.MANIFEST_PARSING_ERROR,fatal:t.type===Ee.MANIFEST,url:e.url,err:s,error:s,reason:s.message,response:e,context:t,networkDetails:r,stats:n})}handleNetworkError(e,t,s=!1,r,n){let a=`A network ${s?"timeout":"error"+(r?" (status "+r.code+")":"")} occurred while loading ${e.type}`;e.type===Ee.LEVEL?a+=`: ${e.level} id: ${e.id}`:(e.type===Ee.AUDIO_TRACK||e.type===Ee.SUBTITLE_TRACK)&&(a+=` id: ${e.id} group-id: "${e.groupId}"`);const o=new Error(a);this.hls.logger.warn(`[playlist-loader]: ${a}`);let l=k.UNKNOWN,c=!1;const u=this.getInternalLoader(e);switch(e.type){case Ee.MANIFEST:l=s?k.MANIFEST_LOAD_TIMEOUT:k.MANIFEST_LOAD_ERROR,c=!0;break;case Ee.LEVEL:l=s?k.LEVEL_LOAD_TIMEOUT:k.LEVEL_LOAD_ERROR,c=!1;break;case Ee.AUDIO_TRACK:l=s?k.AUDIO_TRACK_LOAD_TIMEOUT:k.AUDIO_TRACK_LOAD_ERROR,c=!1;break;case Ee.SUBTITLE_TRACK:l=s?k.SUBTITLE_TRACK_LOAD_TIMEOUT:k.SUBTITLE_LOAD_ERROR,c=!1;break}u&&this.resetInternalLoader(e.type);const f={type:ie.NETWORK_ERROR,details:l,fatal:c,url:e.url,loader:u,context:e,error:o,networkDetails:t,stats:n};if(r){const d=t?.url||e.url;f.response=Re({url:d,data:void 0},r)}this.hls.trigger(y.ERROR,f)}handlePlaylistLoaded(e,t,s,r,n,a){const o=this.hls,{type:l,level:c,levelOrTrack:u,id:f,groupId:d,deliveryDirectives:h}=r,g=Fa(t,r),m=ju(r);let p=typeof r.level=="number"&&m===se.MAIN?c:void 0;const v=e.playlistParsingError;if(v){if(this.hls.logger.warn(`${v} ${e.url}`),!o.config.ignorePlaylistParsingErrors){o.trigger(y.ERROR,{type:ie.NETWORK_ERROR,details:k.LEVEL_PARSING_ERROR,fatal:!1,url:g,error:v,reason:v.message,response:t,context:r,level:p,parent:m,networkDetails:n,stats:s});return}e.playlistParsingError=null}if(!e.fragments.length){const E=e.playlistParsingError=new Error("No Segments found in Playlist");o.trigger(y.ERROR,{type:ie.NETWORK_ERROR,details:k.LEVEL_EMPTY_ERROR,fatal:!1,url:g,error:E,reason:E.message,response:t,context:r,level:p,parent:m,networkDetails:n,stats:s});return}switch(e.live&&a&&(a.getCacheAge&&(e.ageHeader=a.getCacheAge()||0),(!a.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),l){case Ee.MANIFEST:case Ee.LEVEL:if(p){if(!u)p=0;else if(u!==o.levels[p]){const E=o.levels.indexOf(u);E>-1&&(p=E)}}o.trigger(y.LEVEL_LOADED,{details:e,levelInfo:u||o.levels[0],level:p||0,id:f||0,stats:s,networkDetails:n,deliveryDirectives:h,withoutMultiVariant:l===Ee.MANIFEST});break;case Ee.AUDIO_TRACK:o.trigger(y.AUDIO_TRACK_LOADED,{details:e,track:u,id:f||0,groupId:d||"",stats:s,networkDetails:n,deliveryDirectives:h});break;case Ee.SUBTITLE_TRACK:o.trigger(y.SUBTITLE_TRACK_LOADED,{details:e,track:u,id:f||0,groupId:d||"",stats:s,networkDetails:n,deliveryDirectives:h});break}}}class ms{static get version(){return dr}static isMSESupported(){return h0()}static isSupported(){return $T()}static getMediaSource(){return $s()}static get Events(){return y}static get MetadataSchema(){return At}static get ErrorTypes(){return ie}static get ErrorDetails(){return k}static get DefaultConfig(){return ms.defaultConfig?ms.defaultConfig:LT}static set DefaultConfig(e){ms.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new yl,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=q1(e.debug||!1,"Hls instance",e.assetPlayerId),s=this.config=RT(ms.DefaultConfig,e,t);this.userConfig=e,s.progressive&&CT(s,t);const{abrController:r,bufferController:n,capLevelController:a,errorController:o,fpsController:l}=s,c=new o(this),u=this.abrController=new r(this),f=new Hy(this),d=s.interstitialsController,h=d?this.interstitialsController=new d(this,ms):null,g=this.bufferController=new n(this,f),m=this.capLevelController=new a(this),p=new l(this),v=new KT(this),E=s.contentSteeringController,x=E?new E(this):null,T=this.levelController=new NT(this,x),S=new MT(this),C=new VT(this.config,this.logger),A=this.streamController=new GT(this,f,C),w=this.gapController=new PT(this,f);m.setStreamController(A),p.setStreamController(A);const L=[v,T,A];h&&L.splice(1,0,h),x&&L.splice(1,0,x),this.networkControllers=L;const I=[u,g,w,m,p,S,f];this.audioTrackController=this.createController(s.audioTrackController,L);const O=s.audioStreamController;O&&L.push(this.audioStreamController=new O(this,f,C)),this.subtitleTrackController=this.createController(s.subtitleTrackController,L);const P=s.subtitleStreamController;P&&L.push(this.subtititleStreamController=new P(this,f,C)),this.createController(s.timelineController,I),C.emeController=this.emeController=this.createController(s.emeController,I),this.cmcdController=this.createController(s.cmcdController,I),this.latencyController=this.createController(FT,I),this.coreComponents=I,L.push(c);const H=c.onErrorOut;typeof H=="function"&&this.on(y.ERROR,H,c),this.on(y.MANIFEST_LOADED,v.onManifestLoaded,v)}createController(e,t){if(e){const s=new e(this);return t&&t.push(s),s}return null}on(e,t,s=this){this._emitter.on(e,t,s)}once(e,t,s=this){this._emitter.once(e,t,s)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,s=this,r){this._emitter.off(e,t,s,r)}listeners(e){return this._emitter.listeners(e)}emit(e,t,s){return this._emitter.emit(e,t,s)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(s){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+s.message+'". Here is a stacktrace:',s),!this.triggeringException){this.triggeringException=!0;const r=e===y.ERROR;this.trigger(y.ERROR,{type:ie.OTHER_ERROR,details:k.INTERNAL_EXCEPTION,fatal:r,event:e,error:s}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(y.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const n=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(y.ERROR,{type:ie.OTHER_ERROR,details:k.ATTACH_MEDIA_ERROR,fatal:!0,error:n});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,s=t?e.media:e,r=t?e:{media:s};this._media=s,this.trigger(y.MEDIA_ATTACHING,r)}detachMedia(){this.logger.log("detachMedia"),this.trigger(y.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(y.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,s=this._url,r=this._url=al.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${r}`),t&&s&&(s!==r||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(y.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let s=0;s<this.networkControllers.length&&(this.networkControllers[s].startLoad(e,t),!(!this.started||!this.networkControllers));s++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[se.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[se.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[se.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e?.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=Px()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){Ry(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const s=e.length;for(let r=0;r<s;r++)if(e[r].maxBitrate>=t)return r;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:s}=this;let r;if(t===-1&&e!=null&&e.length?r=e.length-1:r=t,s)for(let n=r;n--;){const a=e[n].attrs["HDCP-LEVEL"];if(a&&a<=s)return n}return r}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const s=Jd(t);return Qd(e,s,navigator.mediaCapabilities)}}ms.defaultConfig=void 0;const HT="/assets/invest1-C_LOZ1g-.jpg",jT="/assets/farmer-CesFC0mr.webp",WT="/assets/track-B8hJgWFq.webp",YT="/assets/fallback-image-CA1jl3KV.png",zT={class:"relative h-screen overflow-hidden bg-[#FDFCF8] bg-[url('/images/fallback-image.png')] bg-cover"},qT=["poster"],XT=["src"],QT={class:"absolute top-0 left-0 z-10 w-full h-full transition-opacity duration-1000 bg-black/50"},ZT={class:"absolute mt-12 transform -translate-x-1/2 bottom-6 left-1/2"},JT={href:"/solutions.html"},eS={key:0,href:"/",class:"block mb-12"},tS={class:"font-montserrat font-semibold max-w-[1000px] text-center mx-auto text-3xl sm:text-4xl md:text-5xl lg:text-6xl leading-tight"},sS={key:1,class:"flex justify-center mt-10"},iS={key:0,class:"flex flex-wrap items-stretch justify-center gap-6 max-w-[1000px] mx-auto mt-8 sm:mt-20 transition-all duration-700 ease-in-out"},rS=["onClick"],nS={class:"px-2 py-3 mb-4 transition-all duration-300 rounded-lg bg-white/15 backdrop-blur-xs group-hover:bg-black/40"},aS=["innerHTML"],oS={class:"font-medium text-lg sm:text-xl relative inline-block after:content-[''] after:block after:w-0 after:h-[2px] after:bg-white after:transition-all after:duration-300 group-hover:after:w-full"},lS={class:"text-sm sm:text-md text-[rgb(255,255,0)] mt-2 max-w-[300px]"},cS={class:"relative flex flex-col w-full max-w-6xl overflow-hidden bg-white shadow-xl rounded-2xl sm:flex-row animate-fadeIn"},uS=["src"],fS={class:"flex flex-col justify-between w-full p-5 text-gray-800 sm:w-1/2 sm:p-6"},dS={class:"overflow-y-auto max-h-[65vh] sm:max-h-full"},hS={class:"flex items-center gap-4 mb-4"},gS={class:"flex items-center justify-center flex-shrink-0 bg-green-100 rounded-lg shared-icon-box w-14 h-14"},mS=["innerHTML"],pS={class:"text-xl font-bold leading-tight text-green-600 sm:text-2xl"},yS={class:"mb-6 text-sm leading-relaxed text-gray-600 sm:text-base"},vS={class:"hidden text-right text-white transition-all duration-500 translate-x-3 opacity-0 w-28 group-hover:opacity-100 group-hover:translate-x-0 sm:inline-block"},ES=["href"],xS=["innerHTML"],TS="/videos/adaptive1/master.m3u8",SS="/videos/adaptive2/master.m3u8",bS={__name:"Hero",props:{videoVariant:{type:Number,default:1}},emits:["update:videoVariant"],setup(i,{emit:e}){const t=i,s=e,r=Ye("Impacting lives through sustainable agriculture..."),n=Ye(t.videoVariant),a=Ye(TS),o=Ye(0),l=Ye(null),c=Ye(null),u=Ye(!1),f=Ye(!1),d=Ye({}),h=Ye(!1),g=[{title:"Invest with us",subtitle:"For Guaranteed Crop Returns (GCR)",svg:`
<svg
  xmlns="http://www.w3.org/2000/svg"
  viewBox="0 0 24 24"
  width="38"
  height="38"
  preserveAspectRatio="xMidYMid meet"
  style="display:block; width:38px; height:38px; object-fit:contain; overflow:visible;"
  fill="currentColor"
  stroke="currentColor"
  stroke-width="0.2"
  stroke-linecap="round"
  stroke-linejoin="round"
  paint-order="stroke fill"
  vector-effect="non-scaling-stroke"
>
  <path d="M12.6817 8.96741C12.8677 8.87876 13.0339 8.75775 13.1874 8.62084C15.0701 6.94125 14.0217 3.6902 11.3825 3.54423C9.33442 3.39061 7.90788 5.75501 8.76715 7.64449C9.0184 8.19697 9.51794 8.77039 10.0967 8.98834C9.83969 8.97281 9.04848 8.93141 8.8066 8.98147C8.48718 9.04755 8.46577 9.49072 8.80717 9.54319C9.0388 9.57877 9.32557 9.55387 9.5641 9.55354L11.0802 9.55369L13.4556 9.55519C13.6167 9.5574 13.842 9.59614 13.9721 9.47689C14.0812 9.3768 14.0905 9.19875 13.9842 9.09232C13.8223 8.93025 13.522 8.96497 13.315 8.96539L12.6817 8.96741ZM11.4932 4.11799C13.5892 4.32052 14.3096 7.00275 12.7187 8.29871C12.3033 8.63707 11.6725 8.85315 11.1358 8.77916C9.11062 8.58259 8.32717 5.86144 9.93382 4.57627C10.3521 4.24166 10.9586 4.0545 11.4932 4.11799Z"/>
  <path d="M11.3998 8.26587C10.8931 8.40987 11.1338 8.12899 10.7884 7.97974C9.84538 7.57227 10.2313 6.52395 10.5964 6.84222C10.6807 6.91568 10.7621 7.25337 10.9295 7.42272C11.3071 7.80469 12.0239 7.33639 11.6914 6.97024C11.4902 6.74865 11.199 6.80659 10.9348 6.75342C10.0895 6.58332 9.97708 5.42419 10.6564 5.0598C10.7515 5.00877 10.9313 4.96647 10.9967 4.88468C10.9993 4.74214 11.0896 4.635 11.2276 4.5957C11.593 4.59747 11.5144 4.79014 11.6098 4.92117C11.6474 4.97292 11.7793 5.01409 11.8384 5.04799C12.6593 5.51907 12.4194 6.53134 11.9696 6.30975C11.8305 6.24128 11.8687 5.98808 11.823 5.85964C11.5807 5.1792 10.5682 5.47635 10.7926 5.97345C10.9308 6.27979 11.4578 6.21218 11.7367 6.32179C12.4873 6.61677 12.5042 7.66452 11.7919 7.97412C11.7376 7.9977 11.6775 7.99939 11.6223 8.02249C11.5991 8.15288 11.5141 8.21063 11.3998 8.26587Z"/>
  <path d="M17.3977 8.5035C17.5834 8.31911 17.7926 8.1507 18.0027 7.995C18.1684 7.87211 18.5943 7.65345 18.3729 7.40032C18.1897 7.19088 17.5258 7.05693 17.2628 7.03601C16.3114 6.9804 15.8805 7.42905 15.1522 7.50581C14.8828 7.5342 14.5562 7.28062 14.3228 7.36807C14.1964 7.41547 14.1002 7.63005 14.1654 7.75342C14.2888 7.9866 15.4764 8.11267 15.6094 8.08087C15.7303 8.05192 15.8358 7.95975 15.9415 7.89697C16.3882 7.63166 17.018 7.51207 17.5249 7.63987C17.2244 7.91036 16.3468 8.63872 16.3914 9.07166C16.407 9.22248 16.5535 9.33255 16.7027 9.31233C16.8781 9.28856 16.9377 9.11471 17.0296 8.98811C17.7973 9.30877 18.104 9.9483 18.515 10.5808C18.9756 11.2896 19.7214 11.4304 20.4764 11.5946C20.6583 12.3018 20.611 13.0359 20.4194 13.7354C19.0737 14.1669 19.2426 13.8702 18.269 14.8948C17.8872 15.2965 17.4025 15.6268 16.9136 15.8827C16.5042 16.0969 16.0179 16.2447 15.7011 16.5909C15.073 17.2775 15.0709 18.3078 15.1126 19.1846C14.8547 19.1812 14.5883 19.1984 14.3318 19.1727C14.0872 18.5488 14.1798 17.6938 13.2297 17.4973C12.9037 17.4298 12.5764 17.5377 12.2529 17.5687C11.5545 17.6358 10.8639 17.5141 10.188 17.3452C8.8416 17.0086 8.40251 17.0124 8.23402 18.5458L8.16341 19.18C7.91711 19.1845 7.6698 19.1866 7.4238 19.1725C7.40103 18.0429 7.46703 16.8329 6.65692 15.9345C5.75741 14.9368 4.96736 14.0908 4.70006 12.6804C4.2957 10.5467 5.69662 8.55405 7.72226 7.96815C8.00321 7.88688 8.43251 7.90342 8.34997 7.49058C8.19168 7.19186 7.8492 7.33526 7.60143 7.41476C5.81722 7.98735 4.68585 9.05715 4.23078 10.8584C3.28203 10.4833 4.65892 9.75112 3.80883 9.56947C3.26752 9.71231 2.92121 11.0602 4.11772 11.3892C3.91732 13.0096 4.62663 14.488 5.66505 15.6917C6.01743 16.1002 6.40563 16.3879 6.61338 16.9053C6.85635 17.5103 6.86377 18.1756 6.86643 18.8177C6.86775 19.1296 6.75199 19.6823 7.18594 19.7367C7.35652 19.7581 8.19277 19.7676 8.36812 19.7391C9.04616 19.6287 8.54122 17.6676 9.18671 17.7023C9.4359 17.7157 9.84056 17.836 10.0992 17.8962C11.0123 18.1087 11.7701 18.2292 12.7038 18.0699C14.043 17.8413 13.4247 19.2592 14.066 19.6908C14.2617 19.8225 14.5897 19.7485 14.811 19.7462C15.603 19.7377 15.7211 19.8903 15.6723 18.9825C15.6388 18.3593 15.6523 17.381 16.1446 16.9332C16.363 16.7346 16.8287 16.554 17.1062 16.411C17.6782 16.1166 18.1978 15.7593 18.6514 15.3019C18.859 15.0926 19.0281 14.8017 19.2996 14.6685C19.726 14.4593 20.6547 14.3771 20.8881 14.0274C21.1816 13.5878 21.319 11.6351 20.8505 11.1714C20.7032 11.0257 20.1958 10.9828 19.976 10.9175C19.1077 10.6595 19.1125 10.3769 18.643 9.70548C18.3115 9.23148 17.8833 8.81756 17.3977 8.5035Z"/>
  <path d="M16.5662 11.8703C17.8661 11.9647 18.0163 10.1471 16.7788 9.98934C15.5264 9.90313 15.3449 11.6964 16.5662 11.8703ZM16.7342 10.538C17.2814 10.649 17.1096 11.4337 16.6061 11.3176C16.1124 11.1613 16.2046 10.5107 16.7342 10.538ZM7.99158 11.057C8.47765 11.0671 8.96497 11.0605 9.45119 11.0606L13.7613 11.0596C13.981 11.0597 14.2054 11.0783 14.4242 11.0699C14.8207 11.0547 14.8233 10.6044 14.4649 10.5028C14.23 10.4815 13.9539 10.5031 13.7148 10.5034L9.47992 10.5035C9.23324 10.5034 7.99139 10.4516 7.83292 10.5431C7.60795 10.6731 7.72424 11.0279 7.99158 11.057Z"/>
</svg>


    `,image:HT,description:"This works on a grow-for-me model where potential investors have an opportunity to invest in a crop production portfolio cycle for an ROI either as an individual, a group or a corporate body."},{title:"Farm with us",subtitle:"For Managed Farm Services (MFS)",svg:`
      <svg viewBox="0 0 24 24"
  width="38"
  height="38"
  preserveAspectRatio="xMidYMid meet"
  style="display:block; width:38px; height:38px; object-fit:contain; overflow:visible;"
  fill="currentColor"
  stroke=""
  stroke-width="2"
  stroke-linecap="round"
  stroke-linejoin="round"
  vector-effect="non-scaling-stroke" xmlns="http://www.w3.org/2000/svg">
<path d="M5.625 14.25C4.38375 14.25 3.375 15.2588 3.375 16.5C3.375 17.7412 4.38375 18.75 5.625 18.75C6.86625 18.75 7.875 17.7412 7.875 16.5C7.875 15.2588 6.86625 14.25 5.625 14.25ZM5.625 18C4.79625 18 4.125 17.3288 4.125 16.5C4.125 15.6712 4.79625 15 5.625 15C6.45375 15 7.125 15.6712 7.125 16.5C7.125 17.3288 6.45375 18 5.625 18Z" fill="currentColor"/>
<path d="M21.75 14.6325V11.625C21.75 10.7962 21.0788 10.125 20.25 10.125H18.75V7.5C18.75 7.29375 18.5813 7.125 18.375 7.125H18V6.17625C18 5.74875 18.24 5.3625 18.6225 5.17125L19.2938 4.8375C19.4775 4.74375 19.5525 4.51875 19.4625 4.335C19.3688 4.15125 19.1438 4.07625 18.96 4.16625L18.2888 4.5C17.6513 4.81875 17.2537 5.46375 17.2537 6.17625V7.125H16.8787C16.6725 7.125 16.5037 7.29375 16.5037 7.5V10.125H13.0463L11.7338 4.875H12.0037C12.6225 4.875 13.1287 4.36875 13.1287 3.75C13.1287 3.13125 12.6225 2.625 12.0037 2.625H2.25C2.04375 2.625 1.875 2.79375 1.875 3V4.5C1.875 4.70625 2.04375 4.875 2.25 4.875H2.625V10.1775C1.98 10.3462 1.5 10.9275 1.5 11.625V13.9125C1.0275 14.6625 0.75 15.5475 0.75 16.5C0.75 17.8387 1.29375 19.0537 2.17125 19.935C2.17125 19.9387 2.175 19.9425 2.17875 19.9462C2.1825 19.95 2.18625 19.95 2.19 19.9537C3.07125 20.8312 4.28625 21.375 5.625 21.375C6.96375 21.375 8.17875 20.8312 9.06 19.9537C9.06375 19.9537 9.0675 19.95 9.07125 19.9462C9.075 19.9425 9.075 19.9387 9.07875 19.935C9.52125 19.4925 9.8775 18.96 10.1212 18.375H15.8212C16.17 20.085 17.685 21.375 19.4963 21.375C21.5625 21.375 23.2463 19.6913 23.2463 17.625C23.2463 16.4025 22.6538 15.3188 21.7463 14.6325H21.75ZM17.25 7.875H18V10.125H17.25V7.875ZM15 10.875H19.125V11.625C19.125 11.8313 18.9563 12 18.75 12H15.375C15.1687 12 15 11.8313 15 11.625V10.875ZM12.27 10.125H6.375V4.875H10.9575L12.27 10.125ZM2.625 3.375H12C12.2063 3.375 12.375 3.54375 12.375 3.75C12.375 3.95625 12.2063 4.125 12 4.125H2.625V3.375ZM5.625 4.875V10.125H3.375V4.875H5.625ZM9.375 16.875H9.73125C9.6525 17.73 9.315 18.5137 8.79375 19.1362L8.5425 18.885C8.39625 18.7388 8.16 18.7388 8.01375 18.885C7.8675 19.0313 7.8675 19.2675 8.01375 19.4138L8.265 19.665C7.63875 20.1862 6.85875 20.5237 6.00375 20.6025V20.2463C6.00375 20.04 5.835 19.8713 5.62875 19.8713C5.4225 19.8713 5.25375 20.04 5.25375 20.2463V20.6025C4.39875 20.5237 3.615 20.1862 2.9925 19.665L3.24375 19.4138C3.39 19.2675 3.39 19.0313 3.24375 18.885C3.0975 18.7388 2.86125 18.7388 2.715 18.885L2.46375 19.1362C1.9425 18.51 1.605 17.73 1.52625 16.875H1.8825C2.08875 16.875 2.2575 16.7063 2.2575 16.5C2.2575 16.2937 2.08875 16.125 1.8825 16.125H1.52625C1.605 15.27 1.9425 14.4863 2.46375 13.8638L2.715 14.115C2.79 14.19 2.88375 14.2238 2.98125 14.2238C3.07875 14.2238 3.1725 14.1862 3.2475 14.115C3.39375 13.9687 3.39375 13.7325 3.2475 13.5862L2.99625 13.335C3.6225 12.8138 4.4025 12.4763 5.2575 12.3975V12.7537C5.2575 12.96 5.42625 13.1287 5.6325 13.1287C5.83875 13.1287 6.0075 12.96 6.0075 12.7537V12.3975C6.8625 12.4763 7.64625 12.8138 8.26875 13.335L8.0175 13.5862C7.87125 13.7325 7.87125 13.9687 8.0175 14.115C8.0925 14.19 8.18625 14.2238 8.28375 14.2238C8.38125 14.2238 8.475 14.1862 8.55 14.115L8.80125 13.8638C9.3225 14.49 9.66 15.27 9.73875 16.125H9.3825C9.17625 16.125 9.0075 16.2937 9.0075 16.5C9.0075 16.7063 9.17625 16.875 9.3825 16.875H9.375ZM15.75 17.625H10.365C10.4212 17.3813 10.4625 17.13 10.4813 16.875H15.825C15.7763 17.1187 15.75 17.37 15.75 17.625ZM10.4813 16.125C10.3913 14.9362 9.87375 13.8638 9.07875 13.065C9.07875 13.0613 9.075 13.0575 9.07125 13.0538C9.0675 13.05 9.06375 13.05 9.06 13.0463C8.17875 12.1688 6.96375 11.625 5.625 11.625C4.28625 11.625 3.1275 12.1462 2.25 12.99V11.625C2.25 11.2125 2.5875 10.875 3 10.875H14.25V11.625C14.25 12.2437 14.7563 12.75 15.375 12.75H18.75C19.3687 12.75 19.875 12.2437 19.875 11.625V10.875H20.25C20.6625 10.875 21 11.2125 21 11.625V14.19C20.5387 13.9875 20.0325 13.875 19.5 13.875C17.9662 13.875 16.6463 14.8013 16.065 16.125H10.4813ZM19.5 20.625C17.8463 20.625 16.5 19.2787 16.5 17.625C16.5 15.9713 17.8463 14.625 19.5 14.625C21.1537 14.625 22.5 15.9713 22.5 17.625C22.5 19.2787 21.1537 20.625 19.5 20.625Z" fill="currentColor"/>
<path d="M19.5 15.75C18.465 15.75 17.625 16.59 17.625 17.625C17.625 18.66 18.465 19.5 19.5 19.5C20.535 19.5 21.375 18.66 21.375 17.625C21.375 16.59 20.535 15.75 19.5 15.75ZM19.5 18.75C18.8813 18.75 18.375 18.2437 18.375 17.625C18.375 17.0063 18.8813 16.5 19.5 16.5C20.1187 16.5 20.625 17.0063 20.625 17.625C20.625 18.2437 20.1187 18.75 19.5 18.75ZM12 13.5C11.7937 13.5 11.625 13.6687 11.625 13.875V15C11.625 15.2063 11.7937 15.375 12 15.375C12.2063 15.375 12.375 15.2063 12.375 15V13.875C12.375 13.6687 12.2063 13.5 12 13.5ZM13.5 13.5C13.2937 13.5 13.125 13.6687 13.125 13.875V15C13.125 15.2063 13.2937 15.375 13.5 15.375C13.7063 15.375 13.875 15.2063 13.875 15V13.875C13.875 13.6687 13.7063 13.5 13.5 13.5ZM15 13.5C14.7937 13.5 14.625 13.6687 14.625 13.875V15C14.625 15.2063 14.7937 15.375 15 15.375C15.2063 15.375 15.375 15.2063 15.375 15V13.875C15.375 13.6687 15.2063 13.5 15 13.5Z" fill="currentColor"/>
</svg>

    `,image:jT,description:"This model is perfectly designed to suit absentee investor farmers who are interested in alternate investment options for good medium-long term returns: where you can lease an area of our arable serviced farm estate, facilities and labour resources for all your crop farming venture needs and we provide agronomist advice to help improve crop yields. This works on a farm-for-me model without your physical presence on the farm, where potential investors have the opportunity to invest in a farm set-up."},{title:"Track with us",subtitle:"For day-to-day Decisive Farm Monitoring(DFM)",svg:`
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" height="38" width="38" viewBox="0 0 24 24" stroke-width="1" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 3v11.25A2.25 2.25 0 0 0 6 16.5h2.25M3.75 3h-1.5m1.5 0h16.5m0 0h1.5m-1.5 0v11.25A2.25 2.25 0 0 1 18 16.5h-2.25m-7.5 0h7.5m-7.5 0-1 3m8.5-3 1 3m0 0 .5 1.5m-.5-1.5h-9.5m0 0-.5 1.5M9 11.25v1.5M12 9v3.75m3-6v6"></path>
      </svg>
    `,image:WT,description:'We offer a seamless one-stop-shop opportunity to track, monitor and decide on farm operational activities, i.e. from planting, harvesting to sales, as well as crop investment cycles at the click of a button. This operates on pay-as-you-go model with "myFarm" ERP solution. Now you can easily farm from your phone everywhere you are. With this model farming is borderless.'}],m=[{name:"WhatsApp",icon:"whatsapp",link:"https://wa.me/233503301132",svg:null},{name:"LinkedIn",link:"https://www.linkedin.com/company/farmgate-africa-industries/",svg:`
      <svg id="brand-linkedin" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
      viewBox="0 0 24 24">
        <path d="M0,0H24V24H0Z" fill="none"></path>
        <path d="M4,4,4,6A2,2,0,0,1,6,4H18a2,2,0,0,1,2,2V18a2,2,0,0,1-2,2H6a2,2,0,0,1-2-2Z"
        fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
        stroke-width="2"></path>
        <path d="M8,11v5" stroke="currentColor" stroke-width="2"
        stroke-linecap="round" stroke-linejoin="round"></path>
        <path d="M8,8v.01" stroke="currentColor" stroke-width="2"
        stroke-linecap="round" stroke-linejoin="round"></path>
        <path d="M12,16V11" stroke="currentColor" stroke-width="2"
        stroke-linecap="round" stroke-linejoin="round"></path>
        <path d="M16,16V13a2,2,0,0,0-4,0" stroke="currentColor" stroke-width="2"
        stroke-linecap="round" stroke-linejoin="round"></path>
      </svg>
    `},{name:"YouTube",link:"https://youtube.com/@farmgateafrica?si=cmGVgyhsOkbbzmv9",svg:`
      <svg id="brand-youtube" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
      viewBox="0 0 24 24">
        <path d="M0,0H24V24H0Z" fill="none"></path>
        <path d="M3,5,3,9A4,4,0,0,1,7,5H17a4,4,0,0,1,4,4v6a4,4,0,0,1-4,4H7a4,4,0,0,1-4-4Z"
        fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
        stroke-width="2"></path>
        <path d="M10,9l5,3-5,3Z" stroke="currentColor" stroke-width="2"
        stroke-linecap="round" stroke-linejoin="round"></path>
      </svg>
    `},{name:"TikTok",link:"https://www.tiktok.com/@farmgate.africa?_t=ZM-8uDH4dxrfC3&_r=1",svg:`
      <svg id="brand-tiktok" xmlns="http://www.w3.org/2000/svg" width="24" height="24"
      viewBox="0 0 24 24">
        <path d="M0,0H24V24H0Z" fill="none"></path>
        <path d="M9,12a4,4,0,1,0,4,4V4a5,5,0,0,0,5,5" fill="none"
        stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"
        stroke-width="2"></path>
      </svg>
    `},{name:"Instagram",link:"https://www.instagram.com/farmgate_africa?igsh=YnAzN2Vsb3NqbmV4",svg:`
      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
      viewBox="0 0 24 24">
        <path d="M0,0H24V24H0Z" fill="none"></path>
        <rect x="4" y="4" width="16" height="16" rx="4"
        stroke="currentColor" stroke-width="2" fill="none"></rect>
        <circle cx="12" cy="12" r="3"
        stroke="currentColor" stroke-width="2" fill="none"></circle>
        <circle cx="16.5" cy="7.5" r="1" fill="currentColor"></circle>
      </svg>
    `},{name:"X (Twitter)",link:"https://x.com/FarmGate_Africa?t=ez-1Eavg8y9abxxLS_F0gw&s=09",svg:`
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640">
  <path d="M453.2 112L523.8 112L369.6 288.2L551 528L409 528L297.7 382.6L170.5 528L99.8 528L264.7 339.5L90.8 112L236.4 112L336.9 244.9L453.2 112zM428.4 485.8L467.5 485.8L215.1 152L173.1 152L428.4 485.8z"
        fill="currentColor"></path>
</svg>

    `}];Vn(()=>{document.body.style.overflow="hidden";const x=l.value;ms.isSupported()?(c.value=new ms,c.value.loadSource(a.value),c.value.attachMedia(x)):x.canPlayType("application/vnd.apple.mpegurl")?x.src=a.value:(x.src=a.value,x.load())}),Jo(()=>{document.body.style.overflow="auto",c.value&&c.value.destroy()});function p(){u.value=!0,r.value="gateway to farming",a.value=SS,o.value++,n.value=2,s("update:videoVariant",2)}function v(x){d.value=x,f.value=!0}function E(){f.value=!1}return(x,T)=>{const S=ud("font-awesome-icon");return Te(),Ie("div",zT,[(Te(),Ie("video",{key:o.value,class:"absolute top-0 left-0 w-full h-full object-cover brightness-[0.7] z-0",poster:n.value===2?Wt(YT):"",onPlay:T[0]||(T[0]=C=>h.value=!0),autoplay:"",muted:"",loop:"",playsinline:"",preload:"auto"},[R("source",{src:a.value,type:"video/mp4"},null,8,XT)],40,qT)),jr(R("div",QT,null,512),[[Fd,n.value===2&&!h.value]]),R("div",ZT,[R("a",JT,[xe(U1)])]),R("div",{class:bt(["absolute left-1/2 -translate-x-1/2 w-full px-8 text-white z-10 pb-5 max-w-[1440px] mx-auto text-center transition-all duration-700 ease-in-out hero-content",u.value?"top-[25%]":"top-1/2 -translate-y-1/2"])},[n.value===1?(Te(),Ie("a",eS,[...T[1]||(T[1]=[R("img",{src:Ui,alt:"FarmGate Africa Logo",class:"block w-40 mx-auto sm:hidden"},null,-1)])])):ut("",!0),R("h1",tS,us(r.value),1),u.value?ut("",!0):(Te(),Ie("div",sS,[R("button",{onClick:p,class:"relative flex items-center gap-2 px-6 py-3 overflow-hidden text-base font-semibold text-white transition-all duration-300 rounded-full shadow-lg cursor-pointer group bg-gradient-to-r from-green-800 to-yellow-600 hover:shadow-xl animate-bounce-button"},[T[2]||(T[2]=np('<div class="flex items-center justify-center bg-white rounded-full shadow-sm w-7 h-7" data-v-be414f97><svg width="14" height="18" viewBox="0 0 5 7" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-4.5 rotate-[15deg]" data-v-be414f97><path d="M4.85 2.41003C4.53 3.81003 3.78 4.59003 2.61 4.75003V6.13003C2.49 6.19003 2.36 6.26003 2.24 6.33003V4.75003C1.07 4.59003 0.32 3.81003 0 2.41003C1.42 2.73003 2.21 3.49003 2.36 4.68003H2.49C2.65 3.48003 3.43 2.73003 4.85 2.41003Z" fill="#129C48" data-v-be414f97></path><path d="M2.42987 0C1.62987 1.26 1.62987 2.37 2.41987 3.34C3.20987 2.37 3.21987 1.26 2.42987 0Z" fill="#129C48" data-v-be414f97></path></svg></div><span class="relative z-10" data-v-be414f97> Start growing with us </span>',2)),xe(S,{icon:["far","arrow-right"],class:"transition-transform duration-300 group-hover:translate-x-1"})])])),xe(ks,{name:"fade-up"},{default:fs(()=>[u.value?(Te(),Ie("div",iS,[(Te(),Ie(dt,null,dn(g,C=>R("div",{key:C.title,onClick:A=>v(C),class:"flex flex-col items-center text-center text-white cursor-pointer group w-full sm:w-[45%] lg:w-[30%]"},[R("div",nS,[R("div",{innerHTML:C.svg,class:"text-white w-[38px] h-[38px]"},null,8,aS)]),R("h3",oS,us(C.title),1),R("p",lS,us(C.subtitle),1)],8,rS)),64))])):ut("",!0)]),_:1})],2),f.value?(Te(),Ie("div",{key:0,class:"fixed inset-0 z-50 flex items-center justify-center px-4 bg-black/60 backdrop-blur-sm",onClick:Kp(E,["self"])},[R("div",cS,[R("button",{onClick:E,class:"absolute text-3xl text-gray-600 top-2 right-3 hover:text-gray-900 sm:text-4xl"},"  "),R("img",{src:d.value.image,alt:"option image",class:"object-cover w-full h-52 sm:h-auto sm:w-1/2"},null,8,uS),R("div",fS,[R("div",dS,[R("div",hS,[R("div",gS,[R("div",{innerHTML:d.value.svg,class:"flex items-center justify-center text-green-700 modal-svg w-7 h-7","aria-hidden":"true"},null,8,mS)]),R("h2",pS,us(d.value.title),1)]),R("p",yS,us(d.value.description),1)]),R("button",{onClick:E,class:"py-2 mt-2 text-sm text-white transition bg-green-600 rounded-lg hover:bg-green-700 sm:text-base"}," How it works ")])])])):ut("",!0),xe(ks,{name:"fade-up"},{default:fs(()=>[R("div",{class:bt([["social-icons-hero",n.value===2?"video2":""],"absolute z-20 flex flex-col items-center gap-4 transform -translate-y-1/2 top-1/2 right-6"])},[(Te(),Ie(dt,null,dn(m,(C,A)=>R("div",{key:C.name,class:"flex items-center gap-3 group",style:yr({transitionDelay:A*.1+"s"})},[R("span",vS,us(C.name),1),R("a",{href:C.link,target:"_blank",class:"flex items-center justify-center w-12 h-12 text-white transition-all duration-300 backdrop-blur-md bg-black/40 border border-transparent rounded-full group-hover:bg-transparent group-hover:text-[rgb(255,255,0)] group-hover:border-[rgb(255,255,0)]"},[C.svg?(Te(),Ie("div",{key:0,innerHTML:C.svg,class:"w-6 h-6 text-current"},null,8,xS)):(Te(),il(S,{key:1,icon:["fab",C.icon],class:"text-lg"},null,8,["icon"]))],8,ES)],4)),64))],2)]),_:1})])}}},AS=nl(bS,[["__scopeId","data-v-be414f97"]]),IS={class:"relative"},LS={__name:"Home",setup(i){const e=Ye("home"),t=Ye(1);return(s,r)=>(Te(),Ie("div",IS,[xe(F1,{showMobileLogo:!1,videoVariant:t.value,onPageChange:r[0]||(r[0]=n=>e.value=n)},null,8,["videoVariant"]),e.value==="home"?(Te(),il(AS,{key:0,videoVariant:t.value,"onUpdate:videoVariant":r[1]||(r[1]=n=>t.value=n)},null,8,["videoVariant"])):ut("",!0)]))}};function bo(i,e){(e==null||e>i.length)&&(e=i.length);for(var t=0,s=Array(e);t<e;t++)s[t]=i[t];return s}function _S(i){if(Array.isArray(i))return i}function RS(i){if(Array.isArray(i))return bo(i)}function CS(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function wS(i,e){for(var t=0;t<e.length;t++){var s=e[t];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,g0(s.key),s)}}function DS(i,e,t){return e&&wS(i.prototype,e),Object.defineProperty(i,"prototype",{writable:!1}),i}function nn(i,e){var t=typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(!t){if(Array.isArray(i)||(t=wl(i))||e){t&&(i=t);var s=0,r=function(){};return{s:r,n:function(){return s>=i.length?{done:!0}:{done:!1,value:i[s++]}},e:function(l){throw l},f:r}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var n,a=!0,o=!1;return{s:function(){t=t.call(i)},n:function(){var l=t.next();return a=l.done,l},e:function(l){o=!0,n=l},f:function(){try{a||t.return==null||t.return()}finally{if(o)throw n}}}}function pe(i,e,t){return(e=g0(e))in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function kS(i){if(typeof Symbol<"u"&&i[Symbol.iterator]!=null||i["@@iterator"]!=null)return Array.from(i)}function PS(i,e){var t=i==null?null:typeof Symbol<"u"&&i[Symbol.iterator]||i["@@iterator"];if(t!=null){var s,r,n,a,o=[],l=!0,c=!1;try{if(n=(t=t.call(i)).next,e===0){if(Object(t)!==t)return;l=!1}else for(;!(l=(s=n.call(t)).done)&&(o.push(s.value),o.length!==e);l=!0);}catch(u){c=!0,r=u}finally{try{if(!l&&t.return!=null&&(a=t.return(),Object(a)!==a))return}finally{if(c)throw r}}return o}}function OS(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function MS(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Wu(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);e&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(i,r).enumerable})),t.push.apply(t,s)}return t}function W(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Wu(Object(t),!0).forEach(function(s){pe(i,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):Wu(Object(t)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(t,s))})}return i}function qn(i,e){return _S(i)||PS(i,e)||wl(i,e)||OS()}function Ut(i){return RS(i)||kS(i)||wl(i)||MS()}function FS(i,e){if(typeof i!="object"||!i)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function g0(i){var e=FS(i,"string");return typeof e=="symbol"?e:e+""}function Cn(i){"@babel/helpers - typeof";return Cn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Cn(i)}function wl(i,e){if(i){if(typeof i=="string")return bo(i,e);var t={}.toString.call(i).slice(8,-1);return t==="Object"&&i.constructor&&(t=i.constructor.name),t==="Map"||t==="Set"?Array.from(i):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?bo(i,e):void 0}}var Yu=function(){},Dl={},m0={},p0=null,y0={mark:Yu,measure:Yu};try{typeof window<"u"&&(Dl=window),typeof document<"u"&&(m0=document),typeof MutationObserver<"u"&&(p0=MutationObserver),typeof performance<"u"&&(y0=performance)}catch{}var NS=Dl.navigator||{},zu=NS.userAgent,qu=zu===void 0?"":zu,Us=Dl,Fe=m0,Xu=p0,Vr=y0;Us.document;var bs=!!Fe.documentElement&&!!Fe.head&&typeof Fe.addEventListener=="function"&&typeof Fe.createElement=="function",v0=~qu.indexOf("MSIE")||~qu.indexOf("Trident/"),Na,$S=/fa(k|kd|s|r|l|t|d|dr|dl|dt|b|slr|slpr|wsb|tl|ns|nds|es|jr|jfr|jdr|usb|ufsb|udsb|cr|ss|sr|sl|st|sds|sdr|sdl|sdt)?[\-\ ]/,BS=/Font ?Awesome ?([567 ]*)(Solid|Regular|Light|Thin|Duotone|Brands|Free|Pro|Sharp Duotone|Sharp|Kit|Notdog Duo|Notdog|Chisel|Etch|Thumbprint|Jelly Fill|Jelly Duo|Jelly|Utility|Utility Fill|Utility Duo|Slab Press|Slab|Whiteboard)?.*/i,E0={classic:{fa:"solid",fas:"solid","fa-solid":"solid",far:"regular","fa-regular":"regular",fal:"light","fa-light":"light",fat:"thin","fa-thin":"thin",fab:"brands","fa-brands":"brands"},duotone:{fa:"solid",fad:"solid","fa-solid":"solid","fa-duotone":"solid",fadr:"regular","fa-regular":"regular",fadl:"light","fa-light":"light",fadt:"thin","fa-thin":"thin"},sharp:{fa:"solid",fass:"solid","fa-solid":"solid",fasr:"regular","fa-regular":"regular",fasl:"light","fa-light":"light",fast:"thin","fa-thin":"thin"},"sharp-duotone":{fa:"solid",fasds:"solid","fa-solid":"solid",fasdr:"regular","fa-regular":"regular",fasdl:"light","fa-light":"light",fasdt:"thin","fa-thin":"thin"},slab:{"fa-regular":"regular",faslr:"regular"},"slab-press":{"fa-regular":"regular",faslpr:"regular"},thumbprint:{"fa-light":"light",fatl:"light"},whiteboard:{"fa-semibold":"semibold",fawsb:"semibold"},notdog:{"fa-solid":"solid",fans:"solid"},"notdog-duo":{"fa-solid":"solid",fands:"solid"},etch:{"fa-solid":"solid",faes:"solid"},jelly:{"fa-regular":"regular",fajr:"regular"},"jelly-fill":{"fa-regular":"regular",fajfr:"regular"},"jelly-duo":{"fa-regular":"regular",fajdr:"regular"},chisel:{"fa-regular":"regular",facr:"regular"},utility:{"fa-semibold":"semibold",fausb:"semibold"},"utility-duo":{"fa-semibold":"semibold",faudsb:"semibold"},"utility-fill":{"fa-semibold":"semibold",faufsb:"semibold"}},US={GROUP:"duotone-group",PRIMARY:"primary",SECONDARY:"secondary"},x0=["fa-classic","fa-duotone","fa-sharp","fa-sharp-duotone","fa-thumbprint","fa-whiteboard","fa-notdog","fa-notdog-duo","fa-chisel","fa-etch","fa-jelly","fa-jelly-fill","fa-jelly-duo","fa-slab","fa-slab-press","fa-utility","fa-utility-duo","fa-utility-fill"],et="classic",xr="duotone",T0="sharp",S0="sharp-duotone",b0="chisel",A0="etch",I0="jelly",L0="jelly-duo",_0="jelly-fill",R0="notdog",C0="notdog-duo",w0="slab",D0="slab-press",k0="thumbprint",P0="utility",O0="utility-duo",M0="utility-fill",F0="whiteboard",GS="Classic",VS="Duotone",KS="Sharp",HS="Sharp Duotone",jS="Chisel",WS="Etch",YS="Jelly",zS="Jelly Duo",qS="Jelly Fill",XS="Notdog",QS="Notdog Duo",ZS="Slab",JS="Slab Press",eb="Thumbprint",tb="Utility",sb="Utility Duo",ib="Utility Fill",rb="Whiteboard",N0=[et,xr,T0,S0,b0,A0,I0,L0,_0,R0,C0,w0,D0,k0,P0,O0,M0,F0];Na={},pe(pe(pe(pe(pe(pe(pe(pe(pe(pe(Na,et,GS),xr,VS),T0,KS),S0,HS),b0,jS),A0,WS),I0,YS),L0,zS),_0,qS),R0,XS),pe(pe(pe(pe(pe(pe(pe(pe(Na,C0,QS),w0,ZS),D0,JS),k0,eb),P0,tb),O0,sb),M0,ib),F0,rb);var nb={classic:{900:"fas",400:"far",normal:"far",300:"fal",100:"fat"},duotone:{900:"fad",400:"fadr",300:"fadl",100:"fadt"},sharp:{900:"fass",400:"fasr",300:"fasl",100:"fast"},"sharp-duotone":{900:"fasds",400:"fasdr",300:"fasdl",100:"fasdt"},slab:{400:"faslr"},"slab-press":{400:"faslpr"},whiteboard:{600:"fawsb"},thumbprint:{300:"fatl"},notdog:{900:"fans"},"notdog-duo":{900:"fands"},etch:{900:"faes"},chisel:{400:"facr"},jelly:{400:"fajr"},"jelly-fill":{400:"fajfr"},"jelly-duo":{400:"fajdr"},utility:{600:"fausb"},"utility-duo":{600:"faudsb"},"utility-fill":{600:"faufsb"}},ab={"Font Awesome 7 Free":{900:"fas",400:"far"},"Font Awesome 7 Pro":{900:"fas",400:"far",normal:"far",300:"fal",100:"fat"},"Font Awesome 7 Brands":{400:"fab",normal:"fab"},"Font Awesome 7 Duotone":{900:"fad",400:"fadr",normal:"fadr",300:"fadl",100:"fadt"},"Font Awesome 7 Sharp":{900:"fass",400:"fasr",normal:"fasr",300:"fasl",100:"fast"},"Font Awesome 7 Sharp Duotone":{900:"fasds",400:"fasdr",normal:"fasdr",300:"fasdl",100:"fasdt"},"Font Awesome 7 Jelly":{400:"fajr",normal:"fajr"},"Font Awesome 7 Jelly Fill":{400:"fajfr",normal:"fajfr"},"Font Awesome 7 Jelly Duo":{400:"fajdr",normal:"fajdr"},"Font Awesome 7 Slab":{400:"faslr",normal:"faslr"},"Font Awesome 7 Slab Press":{400:"faslpr",normal:"faslpr"},"Font Awesome 7 Thumbprint":{300:"fatl",normal:"fatl"},"Font Awesome 7 Notdog":{900:"fans",normal:"fans"},"Font Awesome 7 Notdog Duo":{900:"fands",normal:"fands"},"Font Awesome 7 Etch":{900:"faes",normal:"faes"},"Font Awesome 7 Chisel":{400:"facr",normal:"facr"},"Font Awesome 7 Whiteboard":{600:"fawsb",normal:"fawsb"},"Font Awesome 7 Utility":{600:"fausb",normal:"fausb"},"Font Awesome 7 Utility Duo":{600:"faudsb",normal:"faudsb"},"Font Awesome 7 Utility Fill":{600:"faufsb",normal:"faufsb"}},ob=new Map([["classic",{defaultShortPrefixId:"fas",defaultStyleId:"solid",styleIds:["solid","regular","light","thin","brands"],futureStyleIds:[],defaultFontWeight:900}],["duotone",{defaultShortPrefixId:"fad",defaultStyleId:"solid",styleIds:["solid","regular","light","thin"],futureStyleIds:[],defaultFontWeight:900}],["sharp",{defaultShortPrefixId:"fass",defaultStyleId:"solid",styleIds:["solid","regular","light","thin"],futureStyleIds:[],defaultFontWeight:900}],["sharp-duotone",{defaultShortPrefixId:"fasds",defaultStyleId:"solid",styleIds:["solid","regular","light","thin"],futureStyleIds:[],defaultFontWeight:900}],["chisel",{defaultShortPrefixId:"facr",defaultStyleId:"regular",styleIds:["regular"],futureStyleIds:[],defaultFontWeight:400}],["etch",{defaultShortPrefixId:"faes",defaultStyleId:"solid",styleIds:["solid"],futureStyleIds:[],defaultFontWeight:900}],["jelly",{defaultShortPrefixId:"fajr",defaultStyleId:"regular",styleIds:["regular"],futureStyleIds:[],defaultFontWeight:400}],["jelly-duo",{defaultShortPrefixId:"fajdr",defaultStyleId:"regular",styleIds:["regular"],futureStyleIds:[],defaultFontWeight:400}],["jelly-fill",{defaultShortPrefixId:"fajfr",defaultStyleId:"regular",styleIds:["regular"],futureStyleIds:[],defaultFontWeight:400}],["notdog",{defaultShortPrefixId:"fans",defaultStyleId:"solid",styleIds:["solid"],futureStyleIds:[],defaultFontWeight:900}],["notdog-duo",{defaultShortPrefixId:"fands",defaultStyleId:"solid",styleIds:["solid"],futureStyleIds:[],defaultFontWeight:900}],["slab",{defaultShortPrefixId:"faslr",defaultStyleId:"regular",styleIds:["regular"],futureStyleIds:[],defaultFontWeight:400}],["slab-press",{defaultShortPrefixId:"faslpr",defaultStyleId:"regular",styleIds:["regular"],futureStyleIds:[],defaultFontWeight:400}],["thumbprint",{defaultShortPrefixId:"fatl",defaultStyleId:"light",styleIds:["light"],futureStyleIds:[],defaultFontWeight:300}],["utility",{defaultShortPrefixId:"fausb",defaultStyleId:"semibold",styleIds:["semibold"],futureStyleIds:[],defaultFontWeight:600}],["utility-duo",{defaultShortPrefixId:"faudsb",defaultStyleId:"semibold",styleIds:["semibold"],futureStyleIds:[],defaultFontWeight:600}],["utility-fill",{defaultShortPrefixId:"faufsb",defaultStyleId:"semibold",styleIds:["semibold"],futureStyleIds:[],defaultFontWeight:600}],["whiteboard",{defaultShortPrefixId:"fawsb",defaultStyleId:"semibold",styleIds:["semibold"],futureStyleIds:[],defaultFontWeight:600}]]),lb={chisel:{regular:"facr"},classic:{brands:"fab",light:"fal",regular:"far",solid:"fas",thin:"fat"},duotone:{light:"fadl",regular:"fadr",solid:"fad",thin:"fadt"},etch:{solid:"faes"},jelly:{regular:"fajr"},"jelly-duo":{regular:"fajdr"},"jelly-fill":{regular:"fajfr"},notdog:{solid:"fans"},"notdog-duo":{solid:"fands"},sharp:{light:"fasl",regular:"fasr",solid:"fass",thin:"fast"},"sharp-duotone":{light:"fasdl",regular:"fasdr",solid:"fasds",thin:"fasdt"},slab:{regular:"faslr"},"slab-press":{regular:"faslpr"},thumbprint:{light:"fatl"},utility:{semibold:"fausb"},"utility-duo":{semibold:"faudsb"},"utility-fill":{semibold:"faufsb"},whiteboard:{semibold:"fawsb"}},$0=["fak","fa-kit","fakd","fa-kit-duotone"],Qu={kit:{fak:"kit","fa-kit":"kit"},"kit-duotone":{fakd:"kit-duotone","fa-kit-duotone":"kit-duotone"}},cb=["kit"],ub="kit",fb="kit-duotone",db="Kit",hb="Kit Duotone";pe(pe({},ub,db),fb,hb);var gb={kit:{"fa-kit":"fak"}},mb={"Font Awesome Kit":{400:"fak",normal:"fak"},"Font Awesome Kit Duotone":{400:"fakd",normal:"fakd"}},pb={kit:{fak:"fa-kit"}},Zu={kit:{kit:"fak"},"kit-duotone":{"kit-duotone":"fakd"}},$a,Kr={GROUP:"duotone-group",SWAP_OPACITY:"swap-opacity",PRIMARY:"primary",SECONDARY:"secondary"},yb=["fa-classic","fa-duotone","fa-sharp","fa-sharp-duotone","fa-thumbprint","fa-whiteboard","fa-notdog","fa-notdog-duo","fa-chisel","fa-etch","fa-jelly","fa-jelly-fill","fa-jelly-duo","fa-slab","fa-slab-press","fa-utility","fa-utility-duo","fa-utility-fill"],vb="classic",Eb="duotone",xb="sharp",Tb="sharp-duotone",Sb="chisel",bb="etch",Ab="jelly",Ib="jelly-duo",Lb="jelly-fill",_b="notdog",Rb="notdog-duo",Cb="slab",wb="slab-press",Db="thumbprint",kb="utility",Pb="utility-duo",Ob="utility-fill",Mb="whiteboard",Fb="Classic",Nb="Duotone",$b="Sharp",Bb="Sharp Duotone",Ub="Chisel",Gb="Etch",Vb="Jelly",Kb="Jelly Duo",Hb="Jelly Fill",jb="Notdog",Wb="Notdog Duo",Yb="Slab",zb="Slab Press",qb="Thumbprint",Xb="Utility",Qb="Utility Duo",Zb="Utility Fill",Jb="Whiteboard";$a={},pe(pe(pe(pe(pe(pe(pe(pe(pe(pe($a,vb,Fb),Eb,Nb),xb,$b),Tb,Bb),Sb,Ub),bb,Gb),Ab,Vb),Ib,Kb),Lb,Hb),_b,jb),pe(pe(pe(pe(pe(pe(pe(pe($a,Rb,Wb),Cb,Yb),wb,zb),Db,qb),kb,Xb),Pb,Qb),Ob,Zb),Mb,Jb);var e2="kit",t2="kit-duotone",s2="Kit",i2="Kit Duotone";pe(pe({},e2,s2),t2,i2);var r2={classic:{"fa-brands":"fab","fa-duotone":"fad","fa-light":"fal","fa-regular":"far","fa-solid":"fas","fa-thin":"fat"},duotone:{"fa-regular":"fadr","fa-light":"fadl","fa-thin":"fadt"},sharp:{"fa-solid":"fass","fa-regular":"fasr","fa-light":"fasl","fa-thin":"fast"},"sharp-duotone":{"fa-solid":"fasds","fa-regular":"fasdr","fa-light":"fasdl","fa-thin":"fasdt"},slab:{"fa-regular":"faslr"},"slab-press":{"fa-regular":"faslpr"},whiteboard:{"fa-semibold":"fawsb"},thumbprint:{"fa-light":"fatl"},notdog:{"fa-solid":"fans"},"notdog-duo":{"fa-solid":"fands"},etch:{"fa-solid":"faes"},jelly:{"fa-regular":"fajr"},"jelly-fill":{"fa-regular":"fajfr"},"jelly-duo":{"fa-regular":"fajdr"},chisel:{"fa-regular":"facr"},utility:{"fa-semibold":"fausb"},"utility-duo":{"fa-semibold":"faudsb"},"utility-fill":{"fa-semibold":"faufsb"}},n2={classic:["fas","far","fal","fat","fad"],duotone:["fadr","fadl","fadt"],sharp:["fass","fasr","fasl","fast"],"sharp-duotone":["fasds","fasdr","fasdl","fasdt"],slab:["faslr"],"slab-press":["faslpr"],whiteboard:["fawsb"],thumbprint:["fatl"],notdog:["fans"],"notdog-duo":["fands"],etch:["faes"],jelly:["fajr"],"jelly-fill":["fajfr"],"jelly-duo":["fajdr"],chisel:["facr"],utility:["fausb"],"utility-duo":["faudsb"],"utility-fill":["faufsb"]},Ao={classic:{fab:"fa-brands",fad:"fa-duotone",fal:"fa-light",far:"fa-regular",fas:"fa-solid",fat:"fa-thin"},duotone:{fadr:"fa-regular",fadl:"fa-light",fadt:"fa-thin"},sharp:{fass:"fa-solid",fasr:"fa-regular",fasl:"fa-light",fast:"fa-thin"},"sharp-duotone":{fasds:"fa-solid",fasdr:"fa-regular",fasdl:"fa-light",fasdt:"fa-thin"},slab:{faslr:"fa-regular"},"slab-press":{faslpr:"fa-regular"},whiteboard:{fawsb:"fa-semibold"},thumbprint:{fatl:"fa-light"},notdog:{fans:"fa-solid"},"notdog-duo":{fands:"fa-solid"},etch:{faes:"fa-solid"},jelly:{fajr:"fa-regular"},"jelly-fill":{fajfr:"fa-regular"},"jelly-duo":{fajdr:"fa-regular"},chisel:{facr:"fa-regular"},utility:{fausb:"fa-semibold"},"utility-duo":{faudsb:"fa-semibold"},"utility-fill":{faufsb:"fa-semibold"}},a2=["fa-solid","fa-regular","fa-light","fa-thin","fa-duotone","fa-brands","fa-semibold"],B0=["fa","fas","far","fal","fat","fad","fadr","fadl","fadt","fab","fass","fasr","fasl","fast","fasds","fasdr","fasdl","fasdt","faslr","faslpr","fawsb","fatl","fans","fands","faes","fajr","fajfr","fajdr","facr","fausb","faudsb","faufsb"].concat(yb,a2),o2=["solid","regular","light","thin","duotone","brands","semibold"],U0=[1,2,3,4,5,6,7,8,9,10],l2=U0.concat([11,12,13,14,15,16,17,18,19,20]),c2=["aw","fw","pull-left","pull-right"],u2=[].concat(Ut(Object.keys(n2)),o2,c2,["2xs","xs","sm","lg","xl","2xl","beat","border","fade","beat-fade","bounce","flip-both","flip-horizontal","flip-vertical","flip","inverse","layers","layers-bottom-left","layers-bottom-right","layers-counter","layers-text","layers-top-left","layers-top-right","li","pull-end","pull-start","pulse","rotate-180","rotate-270","rotate-90","rotate-by","shake","spin-pulse","spin-reverse","spin","stack-1x","stack-2x","stack","ul","width-auto","width-fixed",Kr.GROUP,Kr.SWAP_OPACITY,Kr.PRIMARY,Kr.SECONDARY]).concat(U0.map(function(i){return"".concat(i,"x")})).concat(l2.map(function(i){return"w-".concat(i)})),f2={"Font Awesome 5 Free":{900:"fas",400:"far"},"Font Awesome 5 Pro":{900:"fas",400:"far",normal:"far",300:"fal"},"Font Awesome 5 Brands":{400:"fab",normal:"fab"},"Font Awesome 5 Duotone":{900:"fad"}},xs="___FONT_AWESOME___",Io=16,G0="fa",V0="svg-inline--fa",ri="data-fa-i2svg",Lo="data-fa-pseudo-element",d2="data-fa-pseudo-element-pending",kl="data-prefix",Pl="data-icon",Ju="fontawesome-i2svg",h2="async",g2=["HTML","HEAD","STYLE","SCRIPT"],K0=["::before","::after",":before",":after"],H0=(function(){try{return!0}catch{return!1}})();function Tr(i){return new Proxy(i,{get:function(t,s){return s in t?t[s]:t[et]}})}var j0=W({},E0);j0[et]=W(W(W(W({},{"fa-duotone":"duotone"}),E0[et]),Qu.kit),Qu["kit-duotone"]);var m2=Tr(j0),_o=W({},lb);_o[et]=W(W(W(W({},{duotone:"fad"}),_o[et]),Zu.kit),Zu["kit-duotone"]);var ef=Tr(_o),Ro=W({},Ao);Ro[et]=W(W({},Ro[et]),pb.kit);var Ol=Tr(Ro),Co=W({},r2);Co[et]=W(W({},Co[et]),gb.kit);Tr(Co);var p2=$S,W0="fa-layers-text",y2=BS,v2=W({},nb);Tr(v2);var E2=["class","data-prefix","data-icon","data-fa-transform","data-fa-mask"],Ba=US,x2=[].concat(Ut(cb),Ut(u2)),er=Us.FontAwesomeConfig||{};function T2(i){var e=Fe.querySelector("script["+i+"]");if(e)return e.getAttribute(i)}function S2(i){return i===""?!0:i==="false"?!1:i==="true"?!0:i}if(Fe&&typeof Fe.querySelector=="function"){var b2=[["data-family-prefix","familyPrefix"],["data-css-prefix","cssPrefix"],["data-family-default","familyDefault"],["data-style-default","styleDefault"],["data-replacement-class","replacementClass"],["data-auto-replace-svg","autoReplaceSvg"],["data-auto-add-css","autoAddCss"],["data-search-pseudo-elements","searchPseudoElements"],["data-search-pseudo-elements-warnings","searchPseudoElementsWarnings"],["data-search-pseudo-elements-full-scan","searchPseudoElementsFullScan"],["data-observe-mutations","observeMutations"],["data-mutate-approach","mutateApproach"],["data-keep-original-source","keepOriginalSource"],["data-measure-performance","measurePerformance"],["data-show-missing-icons","showMissingIcons"]];b2.forEach(function(i){var e=qn(i,2),t=e[0],s=e[1],r=S2(T2(t));r!=null&&(er[s]=r)})}var Y0={styleDefault:"solid",familyDefault:et,cssPrefix:G0,replacementClass:V0,autoReplaceSvg:!0,autoAddCss:!0,searchPseudoElements:!1,searchPseudoElementsWarnings:!0,searchPseudoElementsFullScan:!1,observeMutations:!0,mutateApproach:"async",keepOriginalSource:!0,measurePerformance:!1,showMissingIcons:!0};er.familyPrefix&&(er.cssPrefix=er.familyPrefix);var ki=W(W({},Y0),er);ki.autoReplaceSvg||(ki.observeMutations=!1);var ae={};Object.keys(Y0).forEach(function(i){Object.defineProperty(ae,i,{enumerable:!0,set:function(t){ki[i]=t,tr.forEach(function(s){return s(ae)})},get:function(){return ki[i]}})});Object.defineProperty(ae,"familyPrefix",{enumerable:!0,set:function(e){ki.cssPrefix=e,tr.forEach(function(t){return t(ae)})},get:function(){return ki.cssPrefix}});Us.FontAwesomeConfig=ae;var tr=[];function A2(i){return tr.push(i),function(){tr.splice(tr.indexOf(i),1)}}var gi=Io,Jt={size:16,x:0,y:0,rotate:0,flipX:!1,flipY:!1};function I2(i){if(!(!i||!bs)){var e=Fe.createElement("style");e.setAttribute("type","text/css"),e.innerHTML=i;for(var t=Fe.head.childNodes,s=null,r=t.length-1;r>-1;r--){var n=t[r],a=(n.tagName||"").toUpperCase();["STYLE","LINK"].indexOf(a)>-1&&(s=n)}return Fe.head.insertBefore(e,s),i}}var L2="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";function tf(){for(var i=12,e="";i-- >0;)e+=L2[Math.random()*62|0];return e}function Pi(i){for(var e=[],t=(i||[]).length>>>0;t--;)e[t]=i[t];return e}function Ml(i){return i.classList?Pi(i.classList):(i.getAttribute("class")||"").split(" ").filter(function(e){return e})}function z0(i){return"".concat(i).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function _2(i){return Object.keys(i||{}).reduce(function(e,t){return e+"".concat(t,'="').concat(z0(i[t]),'" ')},"").trim()}function Xn(i){return Object.keys(i||{}).reduce(function(e,t){return e+"".concat(t,": ").concat(i[t].trim(),";")},"")}function Fl(i){return i.size!==Jt.size||i.x!==Jt.x||i.y!==Jt.y||i.rotate!==Jt.rotate||i.flipX||i.flipY}function R2(i){var e=i.transform,t=i.containerWidth,s=i.iconWidth,r={transform:"translate(".concat(t/2," 256)")},n="translate(".concat(e.x*32,", ").concat(e.y*32,") "),a="scale(".concat(e.size/16*(e.flipX?-1:1),", ").concat(e.size/16*(e.flipY?-1:1),") "),o="rotate(".concat(e.rotate," 0 0)"),l={transform:"".concat(n," ").concat(a," ").concat(o)},c={transform:"translate(".concat(s/2*-1," -256)")};return{outer:r,inner:l,path:c}}function C2(i){var e=i.transform,t=i.width,s=t===void 0?Io:t,r=i.height,n=r===void 0?Io:r,a="";return v0?a+="translate(".concat(e.x/gi-s/2,"em, ").concat(e.y/gi-n/2,"em) "):a+="translate(calc(-50% + ".concat(e.x/gi,"em), calc(-50% + ").concat(e.y/gi,"em)) "),a+="scale(".concat(e.size/gi*(e.flipX?-1:1),", ").concat(e.size/gi*(e.flipY?-1:1),") "),a+="rotate(".concat(e.rotate,"deg) "),a}var w2=`:root, :host {
  --fa-font-solid: normal 900 1em/1 "Font Awesome 7 Free";
  --fa-font-regular: normal 400 1em/1 "Font Awesome 7 Free";
  --fa-font-light: normal 300 1em/1 "Font Awesome 7 Pro";
  --fa-font-thin: normal 100 1em/1 "Font Awesome 7 Pro";
  --fa-font-duotone: normal 900 1em/1 "Font Awesome 7 Duotone";
  --fa-font-duotone-regular: normal 400 1em/1 "Font Awesome 7 Duotone";
  --fa-font-duotone-light: normal 300 1em/1 "Font Awesome 7 Duotone";
  --fa-font-duotone-thin: normal 100 1em/1 "Font Awesome 7 Duotone";
  --fa-font-brands: normal 400 1em/1 "Font Awesome 7 Brands";
  --fa-font-sharp-solid: normal 900 1em/1 "Font Awesome 7 Sharp";
  --fa-font-sharp-regular: normal 400 1em/1 "Font Awesome 7 Sharp";
  --fa-font-sharp-light: normal 300 1em/1 "Font Awesome 7 Sharp";
  --fa-font-sharp-thin: normal 100 1em/1 "Font Awesome 7 Sharp";
  --fa-font-sharp-duotone-solid: normal 900 1em/1 "Font Awesome 7 Sharp Duotone";
  --fa-font-sharp-duotone-regular: normal 400 1em/1 "Font Awesome 7 Sharp Duotone";
  --fa-font-sharp-duotone-light: normal 300 1em/1 "Font Awesome 7 Sharp Duotone";
  --fa-font-sharp-duotone-thin: normal 100 1em/1 "Font Awesome 7 Sharp Duotone";
  --fa-font-slab-regular: normal 400 1em/1 "Font Awesome 7 Slab";
  --fa-font-slab-press-regular: normal 400 1em/1 "Font Awesome 7 Slab Press";
  --fa-font-whiteboard-semibold: normal 600 1em/1 "Font Awesome 7 Whiteboard";
  --fa-font-thumbprint-light: normal 300 1em/1 "Font Awesome 7 Thumbprint";
  --fa-font-notdog-solid: normal 900 1em/1 "Font Awesome 7 Notdog";
  --fa-font-notdog-duo-solid: normal 900 1em/1 "Font Awesome 7 Notdog Duo";
  --fa-font-etch-solid: normal 900 1em/1 "Font Awesome 7 Etch";
  --fa-font-jelly-regular: normal 400 1em/1 "Font Awesome 7 Jelly";
  --fa-font-jelly-fill-regular: normal 400 1em/1 "Font Awesome 7 Jelly Fill";
  --fa-font-jelly-duo-regular: normal 400 1em/1 "Font Awesome 7 Jelly Duo";
  --fa-font-chisel-regular: normal 400 1em/1 "Font Awesome 7 Chisel";
  --fa-font-utility-semibold: normal 600 1em/1 "Font Awesome 7 Utility";
  --fa-font-utility-duo-semibold: normal 600 1em/1 "Font Awesome 7 Utility Duo";
  --fa-font-utility-fill-semibold: normal 600 1em/1 "Font Awesome 7 Utility Fill";
}

.svg-inline--fa {
  box-sizing: content-box;
  display: var(--fa-display, inline-block);
  height: 1em;
  overflow: visible;
  vertical-align: -0.125em;
  width: var(--fa-width, 1.25em);
}
.svg-inline--fa.fa-2xs {
  vertical-align: 0.1em;
}
.svg-inline--fa.fa-xs {
  vertical-align: 0em;
}
.svg-inline--fa.fa-sm {
  vertical-align: -0.0714285714em;
}
.svg-inline--fa.fa-lg {
  vertical-align: -0.2em;
}
.svg-inline--fa.fa-xl {
  vertical-align: -0.25em;
}
.svg-inline--fa.fa-2xl {
  vertical-align: -0.3125em;
}
.svg-inline--fa.fa-pull-left,
.svg-inline--fa .fa-pull-start {
  float: inline-start;
  margin-inline-end: var(--fa-pull-margin, 0.3em);
}
.svg-inline--fa.fa-pull-right,
.svg-inline--fa .fa-pull-end {
  float: inline-end;
  margin-inline-start: var(--fa-pull-margin, 0.3em);
}
.svg-inline--fa.fa-li {
  width: var(--fa-li-width, 2em);
  inset-inline-start: calc(-1 * var(--fa-li-width, 2em));
  inset-block-start: 0.25em; /* syncing vertical alignment with Web Font rendering */
}

.fa-layers-counter, .fa-layers-text {
  display: inline-block;
  position: absolute;
  text-align: center;
}

.fa-layers {
  display: inline-block;
  height: 1em;
  position: relative;
  text-align: center;
  vertical-align: -0.125em;
  width: var(--fa-width, 1.25em);
}
.fa-layers .svg-inline--fa {
  inset: 0;
  margin: auto;
  position: absolute;
  transform-origin: center center;
}

.fa-layers-text {
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  transform-origin: center center;
}

.fa-layers-counter {
  background-color: var(--fa-counter-background-color, #ff253a);
  border-radius: var(--fa-counter-border-radius, 1em);
  box-sizing: border-box;
  color: var(--fa-inverse, #fff);
  line-height: var(--fa-counter-line-height, 1);
  max-width: var(--fa-counter-max-width, 5em);
  min-width: var(--fa-counter-min-width, 1.5em);
  overflow: hidden;
  padding: var(--fa-counter-padding, 0.25em 0.5em);
  right: var(--fa-right, 0);
  text-overflow: ellipsis;
  top: var(--fa-top, 0);
  transform: scale(var(--fa-counter-scale, 0.25));
  transform-origin: top right;
}

.fa-layers-bottom-right {
  bottom: var(--fa-bottom, 0);
  right: var(--fa-right, 0);
  top: auto;
  transform: scale(var(--fa-layers-scale, 0.25));
  transform-origin: bottom right;
}

.fa-layers-bottom-left {
  bottom: var(--fa-bottom, 0);
  left: var(--fa-left, 0);
  right: auto;
  top: auto;
  transform: scale(var(--fa-layers-scale, 0.25));
  transform-origin: bottom left;
}

.fa-layers-top-right {
  top: var(--fa-top, 0);
  right: var(--fa-right, 0);
  transform: scale(var(--fa-layers-scale, 0.25));
  transform-origin: top right;
}

.fa-layers-top-left {
  left: var(--fa-left, 0);
  right: auto;
  top: var(--fa-top, 0);
  transform: scale(var(--fa-layers-scale, 0.25));
  transform-origin: top left;
}

.fa-1x {
  font-size: 1em;
}

.fa-2x {
  font-size: 2em;
}

.fa-3x {
  font-size: 3em;
}

.fa-4x {
  font-size: 4em;
}

.fa-5x {
  font-size: 5em;
}

.fa-6x {
  font-size: 6em;
}

.fa-7x {
  font-size: 7em;
}

.fa-8x {
  font-size: 8em;
}

.fa-9x {
  font-size: 9em;
}

.fa-10x {
  font-size: 10em;
}

.fa-2xs {
  font-size: calc(10 / 16 * 1em); /* converts a 10px size into an em-based value that's relative to the scale's 16px base */
  line-height: calc(1 / 10 * 1em); /* sets the line-height of the icon back to that of it's parent */
  vertical-align: calc((6 / 10 - 0.375) * 1em); /* vertically centers the icon taking into account the surrounding text's descender */
}

.fa-xs {
  font-size: calc(12 / 16 * 1em); /* converts a 12px size into an em-based value that's relative to the scale's 16px base */
  line-height: calc(1 / 12 * 1em); /* sets the line-height of the icon back to that of it's parent */
  vertical-align: calc((6 / 12 - 0.375) * 1em); /* vertically centers the icon taking into account the surrounding text's descender */
}

.fa-sm {
  font-size: calc(14 / 16 * 1em); /* converts a 14px size into an em-based value that's relative to the scale's 16px base */
  line-height: calc(1 / 14 * 1em); /* sets the line-height of the icon back to that of it's parent */
  vertical-align: calc((6 / 14 - 0.375) * 1em); /* vertically centers the icon taking into account the surrounding text's descender */
}

.fa-lg {
  font-size: calc(20 / 16 * 1em); /* converts a 20px size into an em-based value that's relative to the scale's 16px base */
  line-height: calc(1 / 20 * 1em); /* sets the line-height of the icon back to that of it's parent */
  vertical-align: calc((6 / 20 - 0.375) * 1em); /* vertically centers the icon taking into account the surrounding text's descender */
}

.fa-xl {
  font-size: calc(24 / 16 * 1em); /* converts a 24px size into an em-based value that's relative to the scale's 16px base */
  line-height: calc(1 / 24 * 1em); /* sets the line-height of the icon back to that of it's parent */
  vertical-align: calc((6 / 24 - 0.375) * 1em); /* vertically centers the icon taking into account the surrounding text's descender */
}

.fa-2xl {
  font-size: calc(32 / 16 * 1em); /* converts a 32px size into an em-based value that's relative to the scale's 16px base */
  line-height: calc(1 / 32 * 1em); /* sets the line-height of the icon back to that of it's parent */
  vertical-align: calc((6 / 32 - 0.375) * 1em); /* vertically centers the icon taking into account the surrounding text's descender */
}

.fa-width-auto {
  --fa-width: auto;
}

.fa-fw,
.fa-width-fixed {
  --fa-width: 1.25em;
}

.fa-ul {
  list-style-type: none;
  margin-inline-start: var(--fa-li-margin, 2.5em);
  padding-inline-start: 0;
}
.fa-ul > li {
  position: relative;
}

.fa-li {
  inset-inline-start: calc(-1 * var(--fa-li-width, 2em));
  position: absolute;
  text-align: center;
  width: var(--fa-li-width, 2em);
  line-height: inherit;
}

/* Heads Up: Bordered Icons will not be supported in the future!
  - This feature will be deprecated in the next major release of Font Awesome (v8)!
  - You may continue to use it in this version *v7), but it will not be supported in Font Awesome v8.
*/
/* Notes:
* --@{v.$css-prefix}-border-width = 1/16 by default (to render as ~1px based on a 16px default font-size)
* --@{v.$css-prefix}-border-padding =
  ** 3/16 for vertical padding (to give ~2px of vertical whitespace around an icon considering it's vertical alignment)
  ** 4/16 for horizontal padding (to give ~4px of horizontal whitespace around an icon)
*/
.fa-border {
  border-color: var(--fa-border-color, #eee);
  border-radius: var(--fa-border-radius, 0.1em);
  border-style: var(--fa-border-style, solid);
  border-width: var(--fa-border-width, 0.0625em);
  box-sizing: var(--fa-border-box-sizing, content-box);
  padding: var(--fa-border-padding, 0.1875em 0.25em);
}

.fa-pull-left,
.fa-pull-start {
  float: inline-start;
  margin-inline-end: var(--fa-pull-margin, 0.3em);
}

.fa-pull-right,
.fa-pull-end {
  float: inline-end;
  margin-inline-start: var(--fa-pull-margin, 0.3em);
}

.fa-beat {
  animation-name: fa-beat;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, ease-in-out);
}

.fa-bounce {
  animation-name: fa-bounce;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.28, 0.84, 0.42, 1));
}

.fa-fade {
  animation-name: fa-fade;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.4, 0, 0.6, 1));
}

.fa-beat-fade {
  animation-name: fa-beat-fade;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.4, 0, 0.6, 1));
}

.fa-flip {
  animation-name: fa-flip;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, ease-in-out);
}

.fa-shake {
  animation-name: fa-shake;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, linear);
}

.fa-spin {
  animation-name: fa-spin;
  animation-delay: var(--fa-animation-delay, 0s);
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 2s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, linear);
}

.fa-spin-reverse {
  --fa-animation-direction: reverse;
}

.fa-pulse,
.fa-spin-pulse {
  animation-name: fa-spin;
  animation-direction: var(--fa-animation-direction, normal);
  animation-duration: var(--fa-animation-duration, 1s);
  animation-iteration-count: var(--fa-animation-iteration-count, infinite);
  animation-timing-function: var(--fa-animation-timing, steps(8));
}

@media (prefers-reduced-motion: reduce) {
  .fa-beat,
  .fa-bounce,
  .fa-fade,
  .fa-beat-fade,
  .fa-flip,
  .fa-pulse,
  .fa-shake,
  .fa-spin,
  .fa-spin-pulse {
    animation: none !important;
    transition: none !important;
  }
}
@keyframes fa-beat {
  0%, 90% {
    transform: scale(1);
  }
  45% {
    transform: scale(var(--fa-beat-scale, 1.25));
  }
}
@keyframes fa-bounce {
  0% {
    transform: scale(1, 1) translateY(0);
  }
  10% {
    transform: scale(var(--fa-bounce-start-scale-x, 1.1), var(--fa-bounce-start-scale-y, 0.9)) translateY(0);
  }
  30% {
    transform: scale(var(--fa-bounce-jump-scale-x, 0.9), var(--fa-bounce-jump-scale-y, 1.1)) translateY(var(--fa-bounce-height, -0.5em));
  }
  50% {
    transform: scale(var(--fa-bounce-land-scale-x, 1.05), var(--fa-bounce-land-scale-y, 0.95)) translateY(0);
  }
  57% {
    transform: scale(1, 1) translateY(var(--fa-bounce-rebound, -0.125em));
  }
  64% {
    transform: scale(1, 1) translateY(0);
  }
  100% {
    transform: scale(1, 1) translateY(0);
  }
}
@keyframes fa-fade {
  50% {
    opacity: var(--fa-fade-opacity, 0.4);
  }
}
@keyframes fa-beat-fade {
  0%, 100% {
    opacity: var(--fa-beat-fade-opacity, 0.4);
    transform: scale(1);
  }
  50% {
    opacity: 1;
    transform: scale(var(--fa-beat-fade-scale, 1.125));
  }
}
@keyframes fa-flip {
  50% {
    transform: rotate3d(var(--fa-flip-x, 0), var(--fa-flip-y, 1), var(--fa-flip-z, 0), var(--fa-flip-angle, -180deg));
  }
}
@keyframes fa-shake {
  0% {
    transform: rotate(-15deg);
  }
  4% {
    transform: rotate(15deg);
  }
  8%, 24% {
    transform: rotate(-18deg);
  }
  12%, 28% {
    transform: rotate(18deg);
  }
  16% {
    transform: rotate(-22deg);
  }
  20% {
    transform: rotate(22deg);
  }
  32% {
    transform: rotate(-12deg);
  }
  36% {
    transform: rotate(12deg);
  }
  40%, 100% {
    transform: rotate(0deg);
  }
}
@keyframes fa-spin {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}
.fa-rotate-90 {
  transform: rotate(90deg);
}

.fa-rotate-180 {
  transform: rotate(180deg);
}

.fa-rotate-270 {
  transform: rotate(270deg);
}

.fa-flip-horizontal {
  transform: scale(-1, 1);
}

.fa-flip-vertical {
  transform: scale(1, -1);
}

.fa-flip-both,
.fa-flip-horizontal.fa-flip-vertical {
  transform: scale(-1, -1);
}

.fa-rotate-by {
  transform: rotate(var(--fa-rotate-angle, 0));
}

.svg-inline--fa .fa-primary {
  fill: var(--fa-primary-color, currentColor);
  opacity: var(--fa-primary-opacity, 1);
}

.svg-inline--fa .fa-secondary {
  fill: var(--fa-secondary-color, currentColor);
  opacity: var(--fa-secondary-opacity, 0.4);
}

.svg-inline--fa.fa-swap-opacity .fa-primary {
  opacity: var(--fa-secondary-opacity, 0.4);
}

.svg-inline--fa.fa-swap-opacity .fa-secondary {
  opacity: var(--fa-primary-opacity, 1);
}

.svg-inline--fa mask .fa-primary,
.svg-inline--fa mask .fa-secondary {
  fill: black;
}

.svg-inline--fa.fa-inverse {
  fill: var(--fa-inverse, #fff);
}

.fa-stack {
  display: inline-block;
  height: 2em;
  line-height: 2em;
  position: relative;
  vertical-align: middle;
  width: 2.5em;
}

.fa-inverse {
  color: var(--fa-inverse, #fff);
}

.svg-inline--fa.fa-stack-1x {
  --fa-width: 1.25em;
  height: 1em;
  width: var(--fa-width);
}
.svg-inline--fa.fa-stack-2x {
  --fa-width: 2.5em;
  height: 2em;
  width: var(--fa-width);
}

.fa-stack-1x,
.fa-stack-2x {
  inset: 0;
  margin: auto;
  position: absolute;
  z-index: var(--fa-stack-z-index, auto);
}`;function q0(){var i=G0,e=V0,t=ae.cssPrefix,s=ae.replacementClass,r=w2;if(t!==i||s!==e){var n=new RegExp("\\.".concat(i,"\\-"),"g"),a=new RegExp("\\--".concat(i,"\\-"),"g"),o=new RegExp("\\.".concat(e),"g");r=r.replace(n,".".concat(t,"-")).replace(a,"--".concat(t,"-")).replace(o,".".concat(s))}return r}var sf=!1;function Ua(){ae.autoAddCss&&!sf&&(I2(q0()),sf=!0)}var D2={mixout:function(){return{dom:{css:q0,insertCss:Ua}}},hooks:function(){return{beforeDOMElementCreation:function(){Ua()},beforeI2svg:function(){Ua()}}}},Ts=Us||{};Ts[xs]||(Ts[xs]={});Ts[xs].styles||(Ts[xs].styles={});Ts[xs].hooks||(Ts[xs].hooks={});Ts[xs].shims||(Ts[xs].shims=[]);var Ft=Ts[xs],X0=[],Q0=function(){Fe.removeEventListener("DOMContentLoaded",Q0),wn=1,X0.map(function(e){return e()})},wn=!1;bs&&(wn=(Fe.documentElement.doScroll?/^loaded|^c/:/^loaded|^i|^c/).test(Fe.readyState),wn||Fe.addEventListener("DOMContentLoaded",Q0));function k2(i){bs&&(wn?setTimeout(i,0):X0.push(i))}function Sr(i){var e=i.tag,t=i.attributes,s=t===void 0?{}:t,r=i.children,n=r===void 0?[]:r;return typeof i=="string"?z0(i):"<".concat(e," ").concat(_2(s),">").concat(n.map(Sr).join(""),"</").concat(e,">")}function rf(i,e,t){if(i&&i[e]&&i[e][t])return{prefix:e,iconName:t,icon:i[e][t]}}var Ga=function(e,t,s,r){var n=Object.keys(e),a=n.length,o=t,l,c,u;for(s===void 0?(l=1,u=e[n[0]]):(l=0,u=s);l<a;l++)c=n[l],u=o(u,e[c],c,e);return u};function Z0(i){return Ut(i).length!==1?null:i.codePointAt(0).toString(16)}function nf(i){return Object.keys(i).reduce(function(e,t){var s=i[t],r=!!s.icon;return r?e[s.iconName]=s.icon:e[t]=s,e},{})}function wo(i,e){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=t.skipHooks,r=s===void 0?!1:s,n=nf(e);typeof Ft.hooks.addPack=="function"&&!r?Ft.hooks.addPack(i,nf(e)):Ft.styles[i]=W(W({},Ft.styles[i]||{}),n),i==="fas"&&wo("fa",e)}var pr=Ft.styles,P2=Ft.shims,J0=Object.keys(Ol),O2=J0.reduce(function(i,e){return i[e]=Object.keys(Ol[e]),i},{}),Nl=null,eg={},tg={},sg={},ig={},rg={};function M2(i){return~x2.indexOf(i)}function F2(i,e){var t=e.split("-"),s=t[0],r=t.slice(1).join("-");return s===i&&r!==""&&!M2(r)?r:null}var ng=function(){var e=function(n){return Ga(pr,function(a,o,l){return a[l]=Ga(o,n,{}),a},{})};eg=e(function(r,n,a){if(n[3]&&(r[n[3]]=a),n[2]){var o=n[2].filter(function(l){return typeof l=="number"});o.forEach(function(l){r[l.toString(16)]=a})}return r}),tg=e(function(r,n,a){if(r[a]=a,n[2]){var o=n[2].filter(function(l){return typeof l=="string"});o.forEach(function(l){r[l]=a})}return r}),rg=e(function(r,n,a){var o=n[2];return r[a]=a,o.forEach(function(l){r[l]=a}),r});var t="far"in pr||ae.autoFetchSvg,s=Ga(P2,function(r,n){var a=n[0],o=n[1],l=n[2];return o==="far"&&!t&&(o="fas"),typeof a=="string"&&(r.names[a]={prefix:o,iconName:l}),typeof a=="number"&&(r.unicodes[a.toString(16)]={prefix:o,iconName:l}),r},{names:{},unicodes:{}});sg=s.names,ig=s.unicodes,Nl=Qn(ae.styleDefault,{family:ae.familyDefault})};A2(function(i){Nl=Qn(i.styleDefault,{family:ae.familyDefault})});ng();function $l(i,e){return(eg[i]||{})[e]}function N2(i,e){return(tg[i]||{})[e]}function Js(i,e){return(rg[i]||{})[e]}function ag(i){return sg[i]||{prefix:null,iconName:null}}function $2(i){var e=ig[i],t=$l("fas",i);return e||(t?{prefix:"fas",iconName:t}:null)||{prefix:null,iconName:null}}function Gs(){return Nl}var og=function(){return{prefix:null,iconName:null,rest:[]}};function B2(i){var e=et,t=J0.reduce(function(s,r){return s[r]="".concat(ae.cssPrefix,"-").concat(r),s},{});return N0.forEach(function(s){(i.includes(t[s])||i.some(function(r){return O2[s].includes(r)}))&&(e=s)}),e}function Qn(i){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=e.family,s=t===void 0?et:t,r=m2[s][i];if(s===xr&&!i)return"fad";var n=ef[s][i]||ef[s][r],a=i in Ft.styles?i:null,o=n||a||null;return o}function U2(i){var e=[],t=null;return i.forEach(function(s){var r=F2(ae.cssPrefix,s);r?t=r:s&&e.push(s)}),{iconName:t,rest:e}}function af(i){return i.sort().filter(function(e,t,s){return s.indexOf(e)===t})}var of=B0.concat($0);function Zn(i){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=e.skipLookups,s=t===void 0?!1:t,r=null,n=af(i.filter(function(h){return of.includes(h)})),a=af(i.filter(function(h){return!of.includes(h)})),o=n.filter(function(h){return r=h,!x0.includes(h)}),l=qn(o,1),c=l[0],u=c===void 0?null:c,f=B2(n),d=W(W({},U2(a)),{},{prefix:Qn(u,{family:f})});return W(W(W({},d),H2({values:i,family:f,styles:pr,config:ae,canonical:d,givenPrefix:r})),G2(s,r,d))}function G2(i,e,t){var s=t.prefix,r=t.iconName;if(i||!s||!r)return{prefix:s,iconName:r};var n=e==="fa"?ag(r):{},a=Js(s,r);return r=n.iconName||a||r,s=n.prefix||s,s==="far"&&!pr.far&&pr.fas&&!ae.autoFetchSvg&&(s="fas"),{prefix:s,iconName:r}}var V2=N0.filter(function(i){return i!==et||i!==xr}),K2=Object.keys(Ao).filter(function(i){return i!==et}).map(function(i){return Object.keys(Ao[i])}).flat();function H2(i){var e=i.values,t=i.family,s=i.canonical,r=i.givenPrefix,n=r===void 0?"":r,a=i.styles,o=a===void 0?{}:a,l=i.config,c=l===void 0?{}:l,u=t===xr,f=e.includes("fa-duotone")||e.includes("fad"),d=c.familyDefault==="duotone",h=s.prefix==="fad"||s.prefix==="fa-duotone";if(!u&&(f||d||h)&&(s.prefix="fad"),(e.includes("fa-brands")||e.includes("fab"))&&(s.prefix="fab"),!s.prefix&&V2.includes(t)){var g=Object.keys(o).find(function(p){return K2.includes(p)});if(g||c.autoFetchSvg){var m=ob.get(t).defaultShortPrefixId;s.prefix=m,s.iconName=Js(s.prefix,s.iconName)||s.iconName}}return(s.prefix==="fa"||n==="fa")&&(s.prefix=Gs()||"fas"),s}var j2=(function(){function i(){CS(this,i),this.definitions={}}return DS(i,[{key:"add",value:function(){for(var t=this,s=arguments.length,r=new Array(s),n=0;n<s;n++)r[n]=arguments[n];var a=r.reduce(this._pullDefinitions,{});Object.keys(a).forEach(function(o){t.definitions[o]=W(W({},t.definitions[o]||{}),a[o]),wo(o,a[o]);var l=Ol[et][o];l&&wo(l,a[o]),ng()})}},{key:"reset",value:function(){this.definitions={}}},{key:"_pullDefinitions",value:function(t,s){var r=s.prefix&&s.iconName&&s.icon?{0:s}:s;return Object.keys(r).map(function(n){var a=r[n],o=a.prefix,l=a.iconName,c=a.icon,u=c[2];t[o]||(t[o]={}),u.length>0&&u.forEach(function(f){typeof f=="string"&&(t[o][f]=c)}),t[o][l]=c}),t}}])})(),lf=[],Ei={},Ri={},W2=Object.keys(Ri);function Y2(i,e){var t=e.mixoutsTo;return lf=i,Ei={},Object.keys(Ri).forEach(function(s){W2.indexOf(s)===-1&&delete Ri[s]}),lf.forEach(function(s){var r=s.mixout?s.mixout():{};if(Object.keys(r).forEach(function(a){typeof r[a]=="function"&&(t[a]=r[a]),Cn(r[a])==="object"&&Object.keys(r[a]).forEach(function(o){t[a]||(t[a]={}),t[a][o]=r[a][o]})}),s.hooks){var n=s.hooks();Object.keys(n).forEach(function(a){Ei[a]||(Ei[a]=[]),Ei[a].push(n[a])})}s.provides&&s.provides(Ri)}),t}function Do(i,e){for(var t=arguments.length,s=new Array(t>2?t-2:0),r=2;r<t;r++)s[r-2]=arguments[r];var n=Ei[i]||[];return n.forEach(function(a){e=a.apply(null,[e].concat(s))}),e}function ni(i){for(var e=arguments.length,t=new Array(e>1?e-1:0),s=1;s<e;s++)t[s-1]=arguments[s];var r=Ei[i]||[];r.forEach(function(n){n.apply(null,t)})}function Vs(){var i=arguments[0],e=Array.prototype.slice.call(arguments,1);return Ri[i]?Ri[i].apply(null,e):void 0}function ko(i){i.prefix==="fa"&&(i.prefix="fas");var e=i.iconName,t=i.prefix||Gs();if(e)return e=Js(t,e)||e,rf(lg.definitions,t,e)||rf(Ft.styles,t,e)}var lg=new j2,z2=function(){ae.autoReplaceSvg=!1,ae.observeMutations=!1,ni("noAuto")},q2={i2svg:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return bs?(ni("beforeI2svg",e),Vs("pseudoElements2svg",e),Vs("i2svg",e)):Promise.reject(new Error("Operation requires a DOM of some kind."))},watch:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=e.autoReplaceSvgRoot;ae.autoReplaceSvg===!1&&(ae.autoReplaceSvg=!0),ae.observeMutations=!0,k2(function(){Q2({autoReplaceSvgRoot:t}),ni("watch",e)})}},X2={icon:function(e){if(e===null)return null;if(Cn(e)==="object"&&e.prefix&&e.iconName)return{prefix:e.prefix,iconName:Js(e.prefix,e.iconName)||e.iconName};if(Array.isArray(e)&&e.length===2){var t=e[1].indexOf("fa-")===0?e[1].slice(3):e[1],s=Qn(e[0]);return{prefix:s,iconName:Js(s,t)||t}}if(typeof e=="string"&&(e.indexOf("".concat(ae.cssPrefix,"-"))>-1||e.match(p2))){var r=Zn(e.split(" "),{skipLookups:!0});return{prefix:r.prefix||Gs(),iconName:Js(r.prefix,r.iconName)||r.iconName}}if(typeof e=="string"){var n=Gs();return{prefix:n,iconName:Js(n,e)||e}}}},Rt={noAuto:z2,config:ae,dom:q2,parse:X2,library:lg,findIconDefinition:ko,toHtml:Sr},Q2=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=e.autoReplaceSvgRoot,s=t===void 0?Fe:t;(Object.keys(Ft.styles).length>0||ae.autoFetchSvg)&&bs&&ae.autoReplaceSvg&&Rt.dom.i2svg({node:s})};function Jn(i,e){return Object.defineProperty(i,"abstract",{get:e}),Object.defineProperty(i,"html",{get:function(){return i.abstract.map(function(s){return Sr(s)})}}),Object.defineProperty(i,"node",{get:function(){if(bs){var s=Fe.createElement("div");return s.innerHTML=i.html,s.children}}}),i}function Z2(i){var e=i.children,t=i.main,s=i.mask,r=i.attributes,n=i.styles,a=i.transform;if(Fl(a)&&t.found&&!s.found){var o=t.width,l=t.height,c={x:o/l/2,y:.5};r.style=Xn(W(W({},n),{},{"transform-origin":"".concat(c.x+a.x/16,"em ").concat(c.y+a.y/16,"em")}))}return[{tag:"svg",attributes:r,children:e}]}function J2(i){var e=i.prefix,t=i.iconName,s=i.children,r=i.attributes,n=i.symbol,a=n===!0?"".concat(e,"-").concat(ae.cssPrefix,"-").concat(t):n;return[{tag:"svg",attributes:{style:"display: none;"},children:[{tag:"symbol",attributes:W(W({},r),{},{id:a}),children:s}]}]}function eA(i){var e=["aria-label","aria-labelledby","title","role"];return e.some(function(t){return t in i})}function Bl(i){var e=i.icons,t=e.main,s=e.mask,r=i.prefix,n=i.iconName,a=i.transform,o=i.symbol,l=i.maskId,c=i.extra,u=i.watchable,f=u===void 0?!1:u,d=s.found?s:t,h=d.width,g=d.height,m=[ae.replacementClass,n?"".concat(ae.cssPrefix,"-").concat(n):""].filter(function(S){return c.classes.indexOf(S)===-1}).filter(function(S){return S!==""||!!S}).concat(c.classes).join(" "),p={children:[],attributes:W(W({},c.attributes),{},{"data-prefix":r,"data-icon":n,class:m,role:c.attributes.role||"img",viewBox:"0 0 ".concat(h," ").concat(g)})};!eA(c.attributes)&&!c.attributes["aria-hidden"]&&(p.attributes["aria-hidden"]="true"),f&&(p.attributes[ri]="");var v=W(W({},p),{},{prefix:r,iconName:n,main:t,mask:s,maskId:l,transform:a,symbol:o,styles:W({},c.styles)}),E=s.found&&t.found?Vs("generateAbstractMask",v)||{children:[],attributes:{}}:Vs("generateAbstractIcon",v)||{children:[],attributes:{}},x=E.children,T=E.attributes;return v.children=x,v.attributes=T,o?J2(v):Z2(v)}function cf(i){var e=i.content,t=i.width,s=i.height,r=i.transform,n=i.extra,a=i.watchable,o=a===void 0?!1:a,l=W(W({},n.attributes),{},{class:n.classes.join(" ")});o&&(l[ri]="");var c=W({},n.styles);Fl(r)&&(c.transform=C2({transform:r,width:t,height:s}),c["-webkit-transform"]=c.transform);var u=Xn(c);u.length>0&&(l.style=u);var f=[];return f.push({tag:"span",attributes:l,children:[e]}),f}function tA(i){var e=i.content,t=i.extra,s=W(W({},t.attributes),{},{class:t.classes.join(" ")}),r=Xn(t.styles);r.length>0&&(s.style=r);var n=[];return n.push({tag:"span",attributes:s,children:[e]}),n}var Va=Ft.styles;function Po(i){var e=i[0],t=i[1],s=i.slice(4),r=qn(s,1),n=r[0],a=null;return Array.isArray(n)?a={tag:"g",attributes:{class:"".concat(ae.cssPrefix,"-").concat(Ba.GROUP)},children:[{tag:"path",attributes:{class:"".concat(ae.cssPrefix,"-").concat(Ba.SECONDARY),fill:"currentColor",d:n[0]}},{tag:"path",attributes:{class:"".concat(ae.cssPrefix,"-").concat(Ba.PRIMARY),fill:"currentColor",d:n[1]}}]}:a={tag:"path",attributes:{fill:"currentColor",d:n}},{found:!0,width:e,height:t,icon:a}}var sA={found:!1,width:512,height:512};function iA(i,e){!H0&&!ae.showMissingIcons&&i&&console.error('Icon with name "'.concat(i,'" and prefix "').concat(e,'" is missing.'))}function Oo(i,e){var t=e;return e==="fa"&&ae.styleDefault!==null&&(e=Gs()),new Promise(function(s,r){if(t==="fa"){var n=ag(i)||{};i=n.iconName||i,e=n.prefix||e}if(i&&e&&Va[e]&&Va[e][i]){var a=Va[e][i];return s(Po(a))}iA(i,e),s(W(W({},sA),{},{icon:ae.showMissingIcons&&i?Vs("missingIconAbstract")||{}:{}}))})}var uf=function(){},Mo=ae.measurePerformance&&Vr&&Vr.mark&&Vr.measure?Vr:{mark:uf,measure:uf},Vi='FA "7.1.0"',rA=function(e){return Mo.mark("".concat(Vi," ").concat(e," begins")),function(){return cg(e)}},cg=function(e){Mo.mark("".concat(Vi," ").concat(e," ends")),Mo.measure("".concat(Vi," ").concat(e),"".concat(Vi," ").concat(e," begins"),"".concat(Vi," ").concat(e," ends"))},Ul={begin:rA,end:cg},an=function(){};function ff(i){var e=i.getAttribute?i.getAttribute(ri):null;return typeof e=="string"}function nA(i){var e=i.getAttribute?i.getAttribute(kl):null,t=i.getAttribute?i.getAttribute(Pl):null;return e&&t}function aA(i){return i&&i.classList&&i.classList.contains&&i.classList.contains(ae.replacementClass)}function oA(){if(ae.autoReplaceSvg===!0)return on.replace;var i=on[ae.autoReplaceSvg];return i||on.replace}function lA(i){return Fe.createElementNS("http://www.w3.org/2000/svg",i)}function cA(i){return Fe.createElement(i)}function ug(i){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=e.ceFn,s=t===void 0?i.tag==="svg"?lA:cA:t;if(typeof i=="string")return Fe.createTextNode(i);var r=s(i.tag);Object.keys(i.attributes||[]).forEach(function(a){r.setAttribute(a,i.attributes[a])});var n=i.children||[];return n.forEach(function(a){r.appendChild(ug(a,{ceFn:s}))}),r}function uA(i){var e=" ".concat(i.outerHTML," ");return e="".concat(e,"Font Awesome fontawesome.com "),e}var on={replace:function(e){var t=e[0];if(t.parentNode)if(e[1].forEach(function(r){t.parentNode.insertBefore(ug(r),t)}),t.getAttribute(ri)===null&&ae.keepOriginalSource){var s=Fe.createComment(uA(t));t.parentNode.replaceChild(s,t)}else t.remove()},nest:function(e){var t=e[0],s=e[1];if(~Ml(t).indexOf(ae.replacementClass))return on.replace(e);var r=new RegExp("".concat(ae.cssPrefix,"-.*"));if(delete s[0].attributes.id,s[0].attributes.class){var n=s[0].attributes.class.split(" ").reduce(function(o,l){return l===ae.replacementClass||l.match(r)?o.toSvg.push(l):o.toNode.push(l),o},{toNode:[],toSvg:[]});s[0].attributes.class=n.toSvg.join(" "),n.toNode.length===0?t.removeAttribute("class"):t.setAttribute("class",n.toNode.join(" "))}var a=s.map(function(o){return Sr(o)}).join(`
`);t.setAttribute(ri,""),t.innerHTML=a}};function df(i){i()}function fg(i,e){var t=typeof e=="function"?e:an;if(i.length===0)t();else{var s=df;ae.mutateApproach===h2&&(s=Us.requestAnimationFrame||df),s(function(){var r=oA(),n=Ul.begin("mutate");i.map(r),n(),t()})}}var Gl=!1;function dg(){Gl=!0}function Fo(){Gl=!1}var Dn=null;function hf(i){if(Xu&&ae.observeMutations){var e=i.treeCallback,t=e===void 0?an:e,s=i.nodeCallback,r=s===void 0?an:s,n=i.pseudoElementsCallback,a=n===void 0?an:n,o=i.observeMutationsRoot,l=o===void 0?Fe:o;Dn=new Xu(function(c){if(!Gl){var u=Gs();Pi(c).forEach(function(f){if(f.type==="childList"&&f.addedNodes.length>0&&!ff(f.addedNodes[0])&&(ae.searchPseudoElements&&a(f.target),t(f.target)),f.type==="attributes"&&f.target.parentNode&&ae.searchPseudoElements&&a([f.target],!0),f.type==="attributes"&&ff(f.target)&&~E2.indexOf(f.attributeName))if(f.attributeName==="class"&&nA(f.target)){var d=Zn(Ml(f.target)),h=d.prefix,g=d.iconName;f.target.setAttribute(kl,h||u),g&&f.target.setAttribute(Pl,g)}else aA(f.target)&&r(f.target)})}}),bs&&Dn.observe(l,{childList:!0,attributes:!0,characterData:!0,subtree:!0})}}function fA(){Dn&&Dn.disconnect()}function dA(i){var e=i.getAttribute("style"),t=[];return e&&(t=e.split(";").reduce(function(s,r){var n=r.split(":"),a=n[0],o=n.slice(1);return a&&o.length>0&&(s[a]=o.join(":").trim()),s},{})),t}function hA(i){var e=i.getAttribute("data-prefix"),t=i.getAttribute("data-icon"),s=i.innerText!==void 0?i.innerText.trim():"",r=Zn(Ml(i));return r.prefix||(r.prefix=Gs()),e&&t&&(r.prefix=e,r.iconName=t),r.iconName&&r.prefix||(r.prefix&&s.length>0&&(r.iconName=N2(r.prefix,i.innerText)||$l(r.prefix,Z0(i.innerText))),!r.iconName&&ae.autoFetchSvg&&i.firstChild&&i.firstChild.nodeType===Node.TEXT_NODE&&(r.iconName=i.firstChild.data)),r}function gA(i){var e=Pi(i.attributes).reduce(function(t,s){return t.name!=="class"&&t.name!=="style"&&(t[s.name]=s.value),t},{});return e}function mA(){return{iconName:null,prefix:null,transform:Jt,symbol:!1,mask:{iconName:null,prefix:null,rest:[]},maskId:null,extra:{classes:[],styles:{},attributes:{}}}}function gf(i){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{styleParser:!0},t=hA(i),s=t.iconName,r=t.prefix,n=t.rest,a=gA(i),o=Do("parseNodeAttributes",{},i),l=e.styleParser?dA(i):[];return W({iconName:s,prefix:r,transform:Jt,mask:{iconName:null,prefix:null,rest:[]},maskId:null,symbol:!1,extra:{classes:n,styles:l,attributes:a}},o)}var pA=Ft.styles;function hg(i){var e=ae.autoReplaceSvg==="nest"?gf(i,{styleParser:!1}):gf(i);return~e.extra.classes.indexOf(W0)?Vs("generateLayersText",i,e):Vs("generateSvgReplacementMutation",i,e)}function yA(){return[].concat(Ut($0),Ut(B0))}function mf(i){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;if(!bs)return Promise.resolve();var t=Fe.documentElement.classList,s=function(f){return t.add("".concat(Ju,"-").concat(f))},r=function(f){return t.remove("".concat(Ju,"-").concat(f))},n=ae.autoFetchSvg?yA():x0.concat(Object.keys(pA));n.includes("fa")||n.push("fa");var a=[".".concat(W0,":not([").concat(ri,"])")].concat(n.map(function(u){return".".concat(u,":not([").concat(ri,"])")})).join(", ");if(a.length===0)return Promise.resolve();var o=[];try{o=Pi(i.querySelectorAll(a))}catch{}if(o.length>0)s("pending"),r("complete");else return Promise.resolve();var l=Ul.begin("onTree"),c=o.reduce(function(u,f){try{var d=hg(f);d&&u.push(d)}catch(h){H0||h.name==="MissingIcon"&&console.error(h)}return u},[]);return new Promise(function(u,f){Promise.all(c).then(function(d){fg(d,function(){s("active"),s("complete"),r("pending"),typeof e=="function"&&e(),l(),u()})}).catch(function(d){l(),f(d)})})}function vA(i){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;hg(i).then(function(t){t&&fg([t],e)})}function EA(i){return function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=(e||{}).icon?e:ko(e||{}),r=t.mask;return r&&(r=(r||{}).icon?r:ko(r||{})),i(s,W(W({},t),{},{mask:r}))}}var xA=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},s=t.transform,r=s===void 0?Jt:s,n=t.symbol,a=n===void 0?!1:n,o=t.mask,l=o===void 0?null:o,c=t.maskId,u=c===void 0?null:c,f=t.classes,d=f===void 0?[]:f,h=t.attributes,g=h===void 0?{}:h,m=t.styles,p=m===void 0?{}:m;if(e){var v=e.prefix,E=e.iconName,x=e.icon;return Jn(W({type:"icon"},e),function(){return ni("beforeDOMElementCreation",{iconDefinition:e,params:t}),Bl({icons:{main:Po(x),mask:l?Po(l.icon):{found:!1,width:null,height:null,icon:{}}},prefix:v,iconName:E,transform:W(W({},Jt),r),symbol:a,maskId:u,extra:{attributes:g,styles:p,classes:d}})})}},TA={mixout:function(){return{icon:EA(xA)}},hooks:function(){return{mutationObserverCallbacks:function(t){return t.treeCallback=mf,t.nodeCallback=vA,t}}},provides:function(e){e.i2svg=function(t){var s=t.node,r=s===void 0?Fe:s,n=t.callback,a=n===void 0?function(){}:n;return mf(r,a)},e.generateSvgReplacementMutation=function(t,s){var r=s.iconName,n=s.prefix,a=s.transform,o=s.symbol,l=s.mask,c=s.maskId,u=s.extra;return new Promise(function(f,d){Promise.all([Oo(r,n),l.iconName?Oo(l.iconName,l.prefix):Promise.resolve({found:!1,width:512,height:512,icon:{}})]).then(function(h){var g=qn(h,2),m=g[0],p=g[1];f([t,Bl({icons:{main:m,mask:p},prefix:n,iconName:r,transform:a,symbol:o,maskId:c,extra:u,watchable:!0})])}).catch(d)})},e.generateAbstractIcon=function(t){var s=t.children,r=t.attributes,n=t.main,a=t.transform,o=t.styles,l=Xn(o);l.length>0&&(r.style=l);var c;return Fl(a)&&(c=Vs("generateAbstractTransformGrouping",{main:n,transform:a,containerWidth:n.width,iconWidth:n.width})),s.push(c||n.icon),{children:s,attributes:r}}}},SA={mixout:function(){return{layer:function(t){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=s.classes,n=r===void 0?[]:r;return Jn({type:"layer"},function(){ni("beforeDOMElementCreation",{assembler:t,params:s});var a=[];return t(function(o){Array.isArray(o)?o.map(function(l){a=a.concat(l.abstract)}):a=a.concat(o.abstract)}),[{tag:"span",attributes:{class:["".concat(ae.cssPrefix,"-layers")].concat(Ut(n)).join(" ")},children:a}]})}}}},bA={mixout:function(){return{counter:function(t){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};s.title;var r=s.classes,n=r===void 0?[]:r,a=s.attributes,o=a===void 0?{}:a,l=s.styles,c=l===void 0?{}:l;return Jn({type:"counter",content:t},function(){return ni("beforeDOMElementCreation",{content:t,params:s}),tA({content:t.toString(),extra:{attributes:o,styles:c,classes:["".concat(ae.cssPrefix,"-layers-counter")].concat(Ut(n))}})})}}}},AA={mixout:function(){return{text:function(t){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},r=s.transform,n=r===void 0?Jt:r,a=s.classes,o=a===void 0?[]:a,l=s.attributes,c=l===void 0?{}:l,u=s.styles,f=u===void 0?{}:u;return Jn({type:"text",content:t},function(){return ni("beforeDOMElementCreation",{content:t,params:s}),cf({content:t,transform:W(W({},Jt),n),extra:{attributes:c,styles:f,classes:["".concat(ae.cssPrefix,"-layers-text")].concat(Ut(o))}})})}}},provides:function(e){e.generateLayersText=function(t,s){var r=s.transform,n=s.extra,a=null,o=null;if(v0){var l=parseInt(getComputedStyle(t).fontSize,10),c=t.getBoundingClientRect();a=c.width/l,o=c.height/l}return Promise.resolve([t,cf({content:t.innerHTML,width:a,height:o,transform:r,extra:n,watchable:!0})])}}},gg=new RegExp('"',"ug"),pf=[1105920,1112319],yf=W(W(W(W({},{FontAwesome:{normal:"fas",400:"fas"}}),ab),f2),mb),No=Object.keys(yf).reduce(function(i,e){return i[e.toLowerCase()]=yf[e],i},{}),IA=Object.keys(No).reduce(function(i,e){var t=No[e];return i[e]=t[900]||Ut(Object.entries(t))[0][1],i},{});function LA(i){var e=i.replace(gg,"");return Z0(Ut(e)[0]||"")}function _A(i){var e=i.getPropertyValue("font-feature-settings").includes("ss01"),t=i.getPropertyValue("content"),s=t.replace(gg,""),r=s.codePointAt(0),n=r>=pf[0]&&r<=pf[1],a=s.length===2?s[0]===s[1]:!1;return n||a||e}function RA(i,e){var t=i.replace(/^['"]|['"]$/g,"").toLowerCase(),s=parseInt(e),r=isNaN(s)?"normal":s;return(No[t]||{})[r]||IA[t]}function vf(i,e){var t="".concat(d2).concat(e.replace(":","-"));return new Promise(function(s,r){if(i.getAttribute(t)!==null)return s();var n=Pi(i.children),a=n.filter(function(C){return C.getAttribute(Lo)===e})[0],o=Us.getComputedStyle(i,e),l=o.getPropertyValue("font-family"),c=l.match(y2),u=o.getPropertyValue("font-weight"),f=o.getPropertyValue("content");if(a&&!c)return i.removeChild(a),s();if(c&&f!=="none"&&f!==""){var d=o.getPropertyValue("content"),h=RA(l,u),g=LA(d),m=c[0].startsWith("FontAwesome"),p=_A(o),v=$l(h,g),E=v;if(m){var x=$2(g);x.iconName&&x.prefix&&(v=x.iconName,h=x.prefix)}if(v&&!p&&(!a||a.getAttribute(kl)!==h||a.getAttribute(Pl)!==E)){i.setAttribute(t,E),a&&i.removeChild(a);var T=mA(),S=T.extra;S.attributes[Lo]=e,Oo(v,h).then(function(C){var A=Bl(W(W({},T),{},{icons:{main:C,mask:og()},prefix:h,iconName:E,extra:S,watchable:!0})),w=Fe.createElementNS("http://www.w3.org/2000/svg","svg");e==="::before"?i.insertBefore(w,i.firstChild):i.appendChild(w),w.outerHTML=A.map(function(L){return Sr(L)}).join(`
`),i.removeAttribute(t),s()}).catch(r)}else s()}else s()})}function CA(i){return Promise.all([vf(i,"::before"),vf(i,"::after")])}function wA(i){return i.parentNode!==document.head&&!~g2.indexOf(i.tagName.toUpperCase())&&!i.getAttribute(Lo)&&(!i.parentNode||i.parentNode.tagName!=="svg")}var DA=function(e){return!!e&&K0.some(function(t){return e.includes(t)})},kA=function(e){if(!e)return[];var t=new Set,s=e.split(/,(?![^()]*\))/).map(function(l){return l.trim()});s=s.flatMap(function(l){return l.includes("(")?l:l.split(",").map(function(c){return c.trim()})});var r=nn(s),n;try{for(r.s();!(n=r.n()).done;){var a=n.value;if(DA(a)){var o=K0.reduce(function(l,c){return l.replace(c,"")},a);o!==""&&o!=="*"&&t.add(o)}}}catch(l){r.e(l)}finally{r.f()}return t};function Ef(i){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(bs){var t;if(e)t=i;else if(ae.searchPseudoElementsFullScan)t=i.querySelectorAll("*");else{var s=new Set,r=nn(document.styleSheets),n;try{for(r.s();!(n=r.n()).done;){var a=n.value;try{var o=nn(a.cssRules),l;try{for(o.s();!(l=o.n()).done;){var c=l.value,u=kA(c.selectorText),f=nn(u),d;try{for(f.s();!(d=f.n()).done;){var h=d.value;s.add(h)}}catch(m){f.e(m)}finally{f.f()}}}catch(m){o.e(m)}finally{o.f()}}catch(m){ae.searchPseudoElementsWarnings&&console.warn("Font Awesome: cannot parse stylesheet: ".concat(a.href," (").concat(m.message,`)
If it declares any Font Awesome CSS pseudo-elements, they will not be rendered as SVG icons. Add crossorigin="anonymous" to the <link>, enable searchPseudoElementsFullScan for slower but more thorough DOM parsing, or suppress this warning by setting searchPseudoElementsWarnings to false.`))}}}catch(m){r.e(m)}finally{r.f()}if(!s.size)return;var g=Array.from(s).join(", ");try{t=i.querySelectorAll(g)}catch{}}return new Promise(function(m,p){var v=Pi(t).filter(wA).map(CA),E=Ul.begin("searchPseudoElements");dg(),Promise.all(v).then(function(){E(),Fo(),m()}).catch(function(){E(),Fo(),p()})})}}var PA={hooks:function(){return{mutationObserverCallbacks:function(t){return t.pseudoElementsCallback=Ef,t}}},provides:function(e){e.pseudoElements2svg=function(t){var s=t.node,r=s===void 0?Fe:s;ae.searchPseudoElements&&Ef(r)}}},xf=!1,OA={mixout:function(){return{dom:{unwatch:function(){dg(),xf=!0}}}},hooks:function(){return{bootstrap:function(){hf(Do("mutationObserverCallbacks",{}))},noAuto:function(){fA()},watch:function(t){var s=t.observeMutationsRoot;xf?Fo():hf(Do("mutationObserverCallbacks",{observeMutationsRoot:s}))}}}},Tf=function(e){var t={size:16,x:0,y:0,flipX:!1,flipY:!1,rotate:0};return e.toLowerCase().split(" ").reduce(function(s,r){var n=r.toLowerCase().split("-"),a=n[0],o=n.slice(1).join("-");if(a&&o==="h")return s.flipX=!0,s;if(a&&o==="v")return s.flipY=!0,s;if(o=parseFloat(o),isNaN(o))return s;switch(a){case"grow":s.size=s.size+o;break;case"shrink":s.size=s.size-o;break;case"left":s.x=s.x-o;break;case"right":s.x=s.x+o;break;case"up":s.y=s.y-o;break;case"down":s.y=s.y+o;break;case"rotate":s.rotate=s.rotate+o;break}return s},t)},MA={mixout:function(){return{parse:{transform:function(t){return Tf(t)}}}},hooks:function(){return{parseNodeAttributes:function(t,s){var r=s.getAttribute("data-fa-transform");return r&&(t.transform=Tf(r)),t}}},provides:function(e){e.generateAbstractTransformGrouping=function(t){var s=t.main,r=t.transform,n=t.containerWidth,a=t.iconWidth,o={transform:"translate(".concat(n/2," 256)")},l="translate(".concat(r.x*32,", ").concat(r.y*32,") "),c="scale(".concat(r.size/16*(r.flipX?-1:1),", ").concat(r.size/16*(r.flipY?-1:1),") "),u="rotate(".concat(r.rotate," 0 0)"),f={transform:"".concat(l," ").concat(c," ").concat(u)},d={transform:"translate(".concat(a/2*-1," -256)")},h={outer:o,inner:f,path:d};return{tag:"g",attributes:W({},h.outer),children:[{tag:"g",attributes:W({},h.inner),children:[{tag:s.icon.tag,children:s.icon.children,attributes:W(W({},s.icon.attributes),h.path)}]}]}}}},Ka={x:0,y:0,width:"100%",height:"100%"};function Sf(i){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return i.attributes&&(i.attributes.fill||e)&&(i.attributes.fill="black"),i}function FA(i){return i.tag==="g"?i.children:[i]}var NA={hooks:function(){return{parseNodeAttributes:function(t,s){var r=s.getAttribute("data-fa-mask"),n=r?Zn(r.split(" ").map(function(a){return a.trim()})):og();return n.prefix||(n.prefix=Gs()),t.mask=n,t.maskId=s.getAttribute("data-fa-mask-id"),t}}},provides:function(e){e.generateAbstractMask=function(t){var s=t.children,r=t.attributes,n=t.main,a=t.mask,o=t.maskId,l=t.transform,c=n.width,u=n.icon,f=a.width,d=a.icon,h=R2({transform:l,containerWidth:f,iconWidth:c}),g={tag:"rect",attributes:W(W({},Ka),{},{fill:"white"})},m=u.children?{children:u.children.map(Sf)}:{},p={tag:"g",attributes:W({},h.inner),children:[Sf(W({tag:u.tag,attributes:W(W({},u.attributes),h.path)},m))]},v={tag:"g",attributes:W({},h.outer),children:[p]},E="mask-".concat(o||tf()),x="clip-".concat(o||tf()),T={tag:"mask",attributes:W(W({},Ka),{},{id:E,maskUnits:"userSpaceOnUse",maskContentUnits:"userSpaceOnUse"}),children:[g,v]},S={tag:"defs",children:[{tag:"clipPath",attributes:{id:x},children:FA(d)},T]};return s.push(S,{tag:"rect",attributes:W({fill:"currentColor","clip-path":"url(#".concat(x,")"),mask:"url(#".concat(E,")")},Ka)}),{children:s,attributes:r}}}},$A={provides:function(e){var t=!1;Us.matchMedia&&(t=Us.matchMedia("(prefers-reduced-motion: reduce)").matches),e.missingIconAbstract=function(){var s=[],r={fill:"currentColor"},n={attributeType:"XML",repeatCount:"indefinite",dur:"2s"};s.push({tag:"path",attributes:W(W({},r),{},{d:"M156.5,447.7l-12.6,29.5c-18.7-9.5-35.9-21.2-51.5-34.9l22.7-22.7C127.6,430.5,141.5,440,156.5,447.7z M40.6,272H8.5 c1.4,21.2,5.4,41.7,11.7,61.1L50,321.2C45.1,305.5,41.8,289,40.6,272z M40.6,240c1.4-18.8,5.2-37,11.1-54.1l-29.5-12.6 C14.7,194.3,10,216.7,8.5,240H40.6z M64.3,156.5c7.8-14.9,17.2-28.8,28.1-41.5L69.7,92.3c-13.7,15.6-25.5,32.8-34.9,51.5 L64.3,156.5z M397,419.6c-13.9,12-29.4,22.3-46.1,30.4l11.9,29.8c20.7-9.9,39.8-22.6,56.9-37.6L397,419.6z M115,92.4 c13.9-12,29.4-22.3,46.1-30.4l-11.9-29.8c-20.7,9.9-39.8,22.6-56.8,37.6L115,92.4z M447.7,355.5c-7.8,14.9-17.2,28.8-28.1,41.5 l22.7,22.7c13.7-15.6,25.5-32.9,34.9-51.5L447.7,355.5z M471.4,272c-1.4,18.8-5.2,37-11.1,54.1l29.5,12.6 c7.5-21.1,12.2-43.5,13.6-66.8H471.4z M321.2,462c-15.7,5-32.2,8.2-49.2,9.4v32.1c21.2-1.4,41.7-5.4,61.1-11.7L321.2,462z M240,471.4c-18.8-1.4-37-5.2-54.1-11.1l-12.6,29.5c21.1,7.5,43.5,12.2,66.8,13.6V471.4z M462,190.8c5,15.7,8.2,32.2,9.4,49.2h32.1 c-1.4-21.2-5.4-41.7-11.7-61.1L462,190.8z M92.4,397c-12-13.9-22.3-29.4-30.4-46.1l-29.8,11.9c9.9,20.7,22.6,39.8,37.6,56.9 L92.4,397z M272,40.6c18.8,1.4,36.9,5.2,54.1,11.1l12.6-29.5C317.7,14.7,295.3,10,272,8.5V40.6z M190.8,50 c15.7-5,32.2-8.2,49.2-9.4V8.5c-21.2,1.4-41.7,5.4-61.1,11.7L190.8,50z M442.3,92.3L419.6,115c12,13.9,22.3,29.4,30.5,46.1 l29.8-11.9C470,128.5,457.3,109.4,442.3,92.3z M397,92.4l22.7-22.7c-15.6-13.7-32.8-25.5-51.5-34.9l-12.6,29.5 C370.4,72.1,384.4,81.5,397,92.4z"})});var a=W(W({},n),{},{attributeName:"opacity"}),o={tag:"circle",attributes:W(W({},r),{},{cx:"256",cy:"364",r:"28"}),children:[]};return t||o.children.push({tag:"animate",attributes:W(W({},n),{},{attributeName:"r",values:"28;14;28;28;14;28;"})},{tag:"animate",attributes:W(W({},a),{},{values:"1;0;1;1;0;1;"})}),s.push(o),s.push({tag:"path",attributes:W(W({},r),{},{opacity:"1",d:"M263.7,312h-16c-6.6,0-12-5.4-12-12c0-71,77.4-63.9,77.4-107.8c0-20-17.8-40.2-57.4-40.2c-29.1,0-44.3,9.6-59.2,28.7 c-3.9,5-11.1,6-16.2,2.4l-13.1-9.2c-5.6-3.9-6.9-11.8-2.6-17.2c21.2-27.2,46.4-44.7,91.2-44.7c52.3,0,97.4,29.8,97.4,80.2 c0,67.6-77.4,63.5-77.4,107.8C275.7,306.6,270.3,312,263.7,312z"}),children:t?[]:[{tag:"animate",attributes:W(W({},a),{},{values:"1;0;0;0;0;1;"})}]}),t||s.push({tag:"path",attributes:W(W({},r),{},{opacity:"0",d:"M232.5,134.5l7,168c0.3,6.4,5.6,11.5,12,11.5h9c6.4,0,11.7-5.1,12-11.5l7-168c0.3-6.8-5.2-12.5-12-12.5h-23 C237.7,122,232.2,127.7,232.5,134.5z"}),children:[{tag:"animate",attributes:W(W({},a),{},{values:"0;0;1;1;0;0;"})}]}),{tag:"g",attributes:{class:"missing"},children:s}}}},BA={hooks:function(){return{parseNodeAttributes:function(t,s){var r=s.getAttribute("data-fa-symbol"),n=r===null?!1:r===""?!0:r;return t.symbol=n,t}}}},UA=[D2,TA,SA,bA,AA,PA,OA,MA,NA,$A,BA];Y2(UA,{mixoutsTo:Rt});Rt.noAuto;Rt.config;var GA=Rt.library;Rt.dom;var $o=Rt.parse;Rt.findIconDefinition;Rt.toHtml;var VA=Rt.icon;Rt.layer;Rt.text;Rt.counter;function rt(i,e,t){return(e=WA(e))in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function bf(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(i);e&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(i,r).enumerable})),t.push.apply(t,s)}return t}function ps(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?bf(Object(t),!0).forEach(function(s){rt(i,s,t[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):bf(Object(t)).forEach(function(s){Object.defineProperty(i,s,Object.getOwnPropertyDescriptor(t,s))})}return i}function KA(i,e){if(i==null)return{};var t,s,r=HA(i,e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);for(s=0;s<n.length;s++)t=n[s],e.indexOf(t)===-1&&{}.propertyIsEnumerable.call(i,t)&&(r[t]=i[t])}return r}function HA(i,e){if(i==null)return{};var t={};for(var s in i)if({}.hasOwnProperty.call(i,s)){if(e.indexOf(s)!==-1)continue;t[s]=i[s]}return t}function jA(i,e){if(typeof i!="object"||!i)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var s=t.call(i,e);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function WA(i){var e=jA(i,"string");return typeof e=="symbol"?e:e+""}function kn(i){"@babel/helpers - typeof";return kn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},kn(i)}function Ha(i,e){return Array.isArray(e)&&e.length>0||!Array.isArray(e)&&e?rt({},i,e):{}}function YA(i){var e,t=(e={"fa-spin":i.spin,"fa-pulse":i.pulse,"fa-fw":i.fixedWidth,"fa-border":i.border,"fa-li":i.listItem,"fa-inverse":i.inverse,"fa-flip":i.flip===!0,"fa-flip-horizontal":i.flip==="horizontal"||i.flip==="both","fa-flip-vertical":i.flip==="vertical"||i.flip==="both"},rt(rt(rt(rt(rt(rt(rt(rt(rt(rt(e,"fa-".concat(i.size),i.size!==null),"fa-rotate-".concat(i.rotation),i.rotation!==null),"fa-rotate-by",i.rotateBy),"fa-pull-".concat(i.pull),i.pull!==null),"fa-swap-opacity",i.swapOpacity),"fa-bounce",i.bounce),"fa-shake",i.shake),"fa-beat",i.beat),"fa-fade",i.fade),"fa-beat-fade",i.beatFade),rt(rt(rt(rt(e,"fa-flash",i.flash),"fa-spin-pulse",i.spinPulse),"fa-spin-reverse",i.spinReverse),"fa-width-auto",i.widthAuto));return Object.keys(t).map(function(s){return t[s]?s:null}).filter(function(s){return s})}var zA=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},mg={exports:{}};(function(i){(function(e){var t=function(v,E,x){if(!c(E)||f(E)||d(E)||h(E)||l(E))return E;var T,S=0,C=0;if(u(E))for(T=[],C=E.length;S<C;S++)T.push(t(v,E[S],x));else{T={};for(var A in E)Object.prototype.hasOwnProperty.call(E,A)&&(T[v(A,x)]=t(v,E[A],x))}return T},s=function(v,E){E=E||{};var x=E.separator||"_",T=E.split||/(?=[A-Z])/;return v.split(T).join(x)},r=function(v){return g(v)?v:(v=v.replace(/[\-_\s]+(.)?/g,function(E,x){return x?x.toUpperCase():""}),v.substr(0,1).toLowerCase()+v.substr(1))},n=function(v){var E=r(v);return E.substr(0,1).toUpperCase()+E.substr(1)},a=function(v,E){return s(v,E).toLowerCase()},o=Object.prototype.toString,l=function(v){return typeof v=="function"},c=function(v){return v===Object(v)},u=function(v){return o.call(v)=="[object Array]"},f=function(v){return o.call(v)=="[object Date]"},d=function(v){return o.call(v)=="[object RegExp]"},h=function(v){return o.call(v)=="[object Boolean]"},g=function(v){return v=v-0,v===v},m=function(v,E){var x=E&&"process"in E?E.process:E;return typeof x!="function"?v:function(T,S){return x(T,v,S)}},p={camelize:r,decamelize:a,pascalize:n,depascalize:a,camelizeKeys:function(v,E){return t(m(r,E),v)},decamelizeKeys:function(v,E){return t(m(a,E),v,E)},pascalizeKeys:function(v,E){return t(m(n,E),v)},depascalizeKeys:function(){return this.decamelizeKeys.apply(this,arguments)}};i.exports?i.exports=p:e.humps=p})(zA)})(mg);var qA=mg.exports,XA=["class","style"];function QA(i){return i.split(";").map(function(e){return e.trim()}).filter(function(e){return e}).reduce(function(e,t){var s=t.indexOf(":"),r=qA.camelize(t.slice(0,s)),n=t.slice(s+1).trim();return e[r]=n,e},{})}function ZA(i){return i.split(/\s+/).reduce(function(e,t){return e[t]=!0,e},{})}function pg(i){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(typeof i=="string")return i;var s=(i.children||[]).map(function(l){return pg(l)}),r=Object.keys(i.attributes||{}).reduce(function(l,c){var u=i.attributes[c];switch(c){case"class":l.class=ZA(u);break;case"style":l.style=QA(u);break;default:l.attrs[c]=u}return l},{attrs:{},class:{},style:{}});t.class;var n=t.style,a=n===void 0?{}:n,o=KA(t,XA);return kd(i.tag,ps(ps(ps({},e),{},{class:r.class,style:ps(ps({},r.style),a)},r.attrs),o),s)}var yg=!1;try{yg=!0}catch{}function JA(){if(!yg&&console&&typeof console.error=="function"){var i;(i=console).error.apply(i,arguments)}}function Af(i){if(i&&kn(i)==="object"&&i.prefix&&i.iconName&&i.icon)return i;if($o.icon)return $o.icon(i);if(i===null)return null;if(kn(i)==="object"&&i.prefix&&i.iconName)return i;if(Array.isArray(i)&&i.length===2)return{prefix:i[0],iconName:i[1]};if(typeof i=="string")return{prefix:"fas",iconName:i}}var eI=pm({name:"FontAwesomeIcon",props:{border:{type:Boolean,default:!1},fixedWidth:{type:Boolean,default:!1},flip:{type:[Boolean,String],default:!1,validator:function(e){return[!0,!1,"horizontal","vertical","both"].indexOf(e)>-1}},icon:{type:[Object,Array,String],required:!0},mask:{type:[Object,Array,String],default:null},maskId:{type:String,default:null},listItem:{type:Boolean,default:!1},pull:{type:String,default:null,validator:function(e){return["right","left"].indexOf(e)>-1}},pulse:{type:Boolean,default:!1},rotation:{type:[String,Number],default:null,validator:function(e){return[90,180,270].indexOf(Number.parseInt(e,10))>-1}},rotateBy:{type:Boolean,default:!1},swapOpacity:{type:Boolean,default:!1},size:{type:String,default:null,validator:function(e){return["2xs","xs","sm","lg","xl","2xl","1x","2x","3x","4x","5x","6x","7x","8x","9x","10x"].indexOf(e)>-1}},spin:{type:Boolean,default:!1},transform:{type:[String,Object],default:null},symbol:{type:[Boolean,String],default:!1},title:{type:String,default:null},titleId:{type:String,default:null},inverse:{type:Boolean,default:!1},bounce:{type:Boolean,default:!1},shake:{type:Boolean,default:!1},beat:{type:Boolean,default:!1},fade:{type:Boolean,default:!1},beatFade:{type:Boolean,default:!1},flash:{type:Boolean,default:!1},spinPulse:{type:Boolean,default:!1},spinReverse:{type:Boolean,default:!1},widthAuto:{type:Boolean,default:!1}},setup:function(e,t){var s=t.attrs,r=Ds(function(){return Af(e.icon)}),n=Ds(function(){return Ha("classes",YA(e))}),a=Ds(function(){return Ha("transform",typeof e.transform=="string"?$o.transform(e.transform):e.transform)}),o=Ds(function(){return Ha("mask",Af(e.mask))}),l=Ds(function(){var u=ps(ps(ps(ps({},n.value),a.value),o.value),{},{symbol:e.symbol,maskId:e.maskId});return u.title=e.title,u.titleId=e.titleId,VA(r.value,u)});Wi(l,function(u){if(!u)return JA("Could not find one or more icon(s)",r.value,o.value)},{immediate:!0});var c=Ds(function(){return l.value?pg(l.value.abstract[0],{},s):null});return function(){return c.value}}});var tI={prefix:"fas",iconName:"envelope",icon:[512,512,[128386,9993,61443],"f0e0","M48 64c-26.5 0-48 21.5-48 48 0 15.1 7.1 29.3 19.2 38.4l208 156c17.1 12.8 40.5 12.8 57.6 0l208-156c12.1-9.1 19.2-23.3 19.2-38.4 0-26.5-21.5-48-48-48L48 64zM0 196L0 384c0 35.3 28.7 64 64 64l384 0c35.3 0 64-28.7 64-64l0-188-198.4 148.8c-34.1 25.6-81.1 25.6-115.2 0L0 196z"]},sI={prefix:"fas",iconName:"magnifying-glass",icon:[512,512,[128269,"search"],"f002","M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376C296.3 401.1 253.9 416 208 416 93.1 416 0 322.9 0 208S93.1 0 208 0 416 93.1 416 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z"]},iI=sI,rI={prefix:"fas",iconName:"chevron-right",icon:[320,512,[9002],"f054","M311.1 233.4c12.5 12.5 12.5 32.8 0 45.3l-192 192c-12.5 12.5-32.8 12.5-45.3 0s-12.5-32.8 0-45.3L243.2 256 73.9 86.6c-12.5-12.5-12.5-32.8 0-45.3s32.8-12.5 45.3 0l192 192z"]},nI={prefix:"fas",iconName:"chart-line",icon:[512,512,["line-chart"],"f201","M64 64c0-17.7-14.3-32-32-32S0 46.3 0 64L0 400c0 44.2 35.8 80 80 80l400 0c17.7 0 32-14.3 32-32s-14.3-32-32-32L80 416c-8.8 0-16-7.2-16-16L64 64zm406.6 86.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L320 210.7 262.6 153.4c-12.5-12.5-32.8-12.5-45.3 0l-96 96c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l73.4-73.4 57.4 57.4c12.5 12.5 32.8 12.5 45.3 0l128-128z"]},aI={prefix:"fas",iconName:"chart-bar",icon:[512,512,["bar-chart"],"f080","M32 32c17.7 0 32 14.3 32 32l0 336c0 8.8 7.2 16 16 16l400 0c17.7 0 32 14.3 32 32s-14.3 32-32 32L80 480c-44.2 0-80-35.8-80-80L0 64C0 46.3 14.3 32 32 32zm96 64c0-17.7 14.3-32 32-32l192 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-192 0c-17.7 0-32-14.3-32-32zm32 80l128 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-128 0c-17.7 0-32-14.3-32-32s14.3-32 32-32zm0 112l256 0c17.7 0 32 14.3 32 32s-14.3 32-32 32l-256 0c-17.7 0-32-14.3-32-32s14.3-32 32-32z"]},oI={prefix:"fas",iconName:"user",icon:[448,512,[128100,62144,62470,"user-alt","user-large"],"f007","M224 248a120 120 0 1 0 0-240 120 120 0 1 0 0 240zm-29.7 56C95.8 304 16 383.8 16 482.3 16 498.7 29.3 512 45.7 512l356.6 0c16.4 0 29.7-13.3 29.7-29.7 0-98.5-79.8-178.3-178.3-178.3l-59.4 0z"]},lI={prefix:"fas",iconName:"arrow-right",icon:[512,512,[8594],"f061","M502.6 278.6c12.5-12.5 12.5-32.8 0-45.3l-160-160c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L402.7 224 32 224c-17.7 0-32 14.3-32 32s14.3 32 32 32l370.7 0-105.4 105.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l160-160z"]},cI={prefix:"fas",iconName:"xmark",icon:[384,512,[128473,10005,10006,10060,215,"close","multiply","remove","times"],"f00d","M55.1 73.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3L147.2 256 9.9 393.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0L192.5 301.3 329.9 438.6c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L237.8 256 375.1 118.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L192.5 210.7 55.1 73.4z"]},uI=cI,fI={prefix:"fas",iconName:"phone",icon:[512,512,[128222,128379],"f095","M160.2 25C152.3 6.1 131.7-3.9 112.1 1.4l-5.5 1.5c-64.6 17.6-119.8 80.2-103.7 156.4 37.1 175 174.8 312.7 349.8 349.8 76.3 16.2 138.8-39.1 156.4-103.7l1.5-5.5c5.4-19.7-4.7-40.3-23.5-48.1l-97.3-40.5c-16.5-6.9-35.6-2.1-47 11.8l-38.6 47.2C233.9 335.4 177.3 277 144.8 205.3L189 169.3c13.9-11.3 18.6-30.4 11.8-47L160.2 25z"]},dI={prefix:"fas",iconName:"leaf",icon:[512,512,[],"f06c","M471.3 6.7C477.7 .6 487-1.6 495.6 1.2 505.4 4.5 512 13.7 512 24l0 186.9c0 131.2-108.1 237.1-238.8 237.1-77 0-143.4-49.5-167.5-118.7-35.4 30.8-57.7 76.1-57.7 126.7 0 13.3-10.7 24-24 24S0 469.3 0 456C0 381.1 38.2 315.1 96.1 276.3 131.4 252.7 173.5 240 216 240l80 0c13.3 0 24-10.7 24-24s-10.7-24-24-24l-80 0c-39.7 0-77.3 8.8-111 24.5 23.3-70 89.2-120.5 167-120.5 66.4 0 115.8-22.1 148.7-44 19.2-12.8 35.5-28.1 50.7-45.3z"]},hI={prefix:"fas",iconName:"chevron-left",icon:[320,512,[9001],"f053","M9.4 233.4c-12.5 12.5-12.5 32.8 0 45.3l192 192c12.5 12.5 32.8 12.5 45.3 0s12.5-32.8 0-45.3L77.3 256 246.6 86.6c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0l-192 192z"]},gI={prefix:"fas",iconName:"briefcase",icon:[512,512,[128188],"f0b1","M200 48l112 0c4.4 0 8 3.6 8 8l0 40-128 0 0-40c0-4.4 3.6-8 8-8zm-56 8l0 40-80 0C28.7 96 0 124.7 0 160l0 96 512 0 0-96c0-35.3-28.7-64-64-64l-80 0 0-40c0-30.9-25.1-56-56-56L200 0c-30.9 0-56 25.1-56 56zM512 304l-192 0 0 16c0 17.7-14.3 32-32 32l-64 0c-17.7 0-32-14.3-32-32l0-16-192 0 0 112c0 35.3 28.7 64 64 64l384 0c35.3 0 64-28.7 64-64l0-112z"]},mI={prefix:"fas",iconName:"arrow-down",icon:[384,512,[8595],"f063","M169.4 502.6c12.5 12.5 32.8 12.5 45.3 0l160-160c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L224 402.7 224 32c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 370.7-105.4-105.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l160 160z"]},pI={prefix:"fas",iconName:"bars",icon:[448,512,["navicon"],"f0c9","M0 96C0 78.3 14.3 64 32 64l384 0c17.7 0 32 14.3 32 32s-14.3 32-32 32L32 128C14.3 128 0 113.7 0 96zM0 256c0-17.7 14.3-32 32-32l384 0c17.7 0 32 14.3 32 32s-14.3 32-32 32L32 288c-17.7 0-32-14.3-32-32zM448 416c0 17.7-14.3 32-32 32L32 448c-17.7 0-32-14.3-32-32s14.3-32 32-32l384 0c17.7 0 32 14.3 32 32z"]};var yI={prefix:"fab",iconName:"facebook-f",icon:[320,512,[],"f39e","M80 299.3l0 212.7 116 0 0-212.7 86.5 0 18-97.8-104.5 0 0-34.6c0-51.7 20.3-71.5 72.7-71.5 16.3 0 29.4 .4 37 1.2l0-88.7C291.4 4 256.4 0 236.2 0 129.3 0 80 50.5 80 159.4l0 42.1-66 0 0 97.8 66 0z"]},vI={prefix:"fab",iconName:"youtube",icon:[576,512,[61802],"f167","M549.7 124.1C543.5 100.4 524.9 81.8 501.4 75.5 458.9 64 288.1 64 288.1 64S117.3 64 74.7 75.5C51.2 81.8 32.7 100.4 26.4 124.1 15 167 15 256.4 15 256.4s0 89.4 11.4 132.3c6.3 23.6 24.8 41.5 48.3 47.8 42.6 11.5 213.4 11.5 213.4 11.5s170.8 0 213.4-11.5c23.5-6.3 42-24.2 48.3-47.8 11.4-42.9 11.4-132.3 11.4-132.3s0-89.4-11.4-132.3zM232.2 337.6l0-162.4 142.7 81.2-142.7 81.2z"]},EI={prefix:"fab",iconName:"github",icon:[512,512,[],"f09b","M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3 .3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5 .3-6.2 2.3zm44.2-1.7c-2.9 .7-4.9 2.6-4.6 4.9 .3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM252.8 8c-138.7 0-244.8 105.3-244.8 244 0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1 100-33.2 167.8-128.1 167.8-239 0-138.7-112.5-244-251.2-244zM105.2 352.9c-1.3 1-1 3.3 .7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3 .3 2.9 2.3 3.9 1.6 1 3.6 .7 4.3-.7 .7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3 .7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3 .7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"]},xI={prefix:"fab",iconName:"tiktok",icon:[448,512,[],"e07b","M448.5 209.9c-44 .1-87-13.6-122.8-39.2l0 178.7c0 33.1-10.1 65.4-29 92.6s-45.6 48-76.6 59.6-64.8 13.5-96.9 5.3-60.9-25.9-82.7-50.8-35.3-56-39-88.9 2.9-66.1 18.6-95.2 40-52.7 69.6-67.7 62.9-20.5 95.7-16l0 89.9c-15-4.7-31.1-4.6-46 .4s-27.9 14.6-37 27.3-14 28.1-13.9 43.9 5.2 31 14.5 43.7 22.4 22.1 37.4 26.9 31.1 4.8 46-.1 28-14.4 37.2-27.1 14.2-28.1 14.2-43.8l0-349.4 88 0c-.1 7.4 .6 14.9 1.9 22.2 3.1 16.3 9.4 31.9 18.7 45.7s21.3 25.6 35.2 34.6c19.9 13.1 43.2 20.1 67 20.1l0 87.4z"]},TI={prefix:"fab",iconName:"instagram",icon:[448,512,[],"f16d","M224.3 141a115 115 0 1 0 -.6 230 115 115 0 1 0 .6-230zm-.6 40.4a74.6 74.6 0 1 1 .6 149.2 74.6 74.6 0 1 1 -.6-149.2zm93.4-45.1a26.8 26.8 0 1 1 53.6 0 26.8 26.8 0 1 1 -53.6 0zm129.7 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM399 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z"]},SI={prefix:"fab",iconName:"x-twitter",icon:[448,512,[],"e61b","M357.2 48L427.8 48 273.6 224.2 455 464 313 464 201.7 318.6 74.5 464 3.8 464 168.7 275.5-5.2 48 140.4 48 240.9 180.9 357.2 48zM332.4 421.8l39.1 0-252.4-333.8-42 0 255.3 333.8z"]},bI={prefix:"fab",iconName:"whatsapp",icon:[448,512,[],"f232","M380.9 97.1c-41.9-42-97.7-65.1-157-65.1-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480 117.7 449.1c32.4 17.7 68.9 27 106.1 27l.1 0c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157zm-157 341.6c-33.2 0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3 18.6-68.1-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1s56.2 81.2 56.1 130.5c0 101.8-84.9 184.6-186.6 184.6zM325.1 300.5c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8s-14.3 18-17.6 21.8c-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7 .9-6.9-.5-9.7s-12.5-30.1-17.1-41.2c-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2s-9.7 1.4-14.8 6.9c-5.1 5.6-19.4 19-19.4 46.3s19.9 53.7 22.6 57.4c2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4s4.6-24.1 3.2-26.4c-1.3-2.5-5-3.9-10.5-6.6z"]},AI={prefix:"fab",iconName:"linkedin-in",icon:[448,512,[],"f0e1","M100.3 448l-92.9 0 0-299.1 92.9 0 0 299.1zM53.8 108.1C24.1 108.1 0 83.5 0 53.8 0 39.5 5.7 25.9 15.8 15.8s23.8-15.8 38-15.8 27.9 5.7 38 15.8 15.8 23.8 15.8 38c0 29.7-24.1 54.3-53.8 54.3zM447.9 448l-92.7 0 0-145.6c0-34.7-.7-79.2-48.3-79.2-48.3 0-55.7 37.7-55.7 76.7l0 148.1-92.8 0 0-299.1 89.1 0 0 40.8 1.3 0c12.4-23.5 42.7-48.3 87.9-48.3 94 0 111.3 61.9 111.3 142.3l0 164.3-.1 0z"]};GA.add(oI,pI,dI,uI,lI,mI,hI,rI,nI,gI,aI,fI,tI,iI,EI,TI,vI,yI,bI,AI,xI,SI);function II(i,e){const t=Wp(i);t.component("font-awesome-icon",eI),t.mount(e)}II(LS,"#app");
